	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>[笔记]-十五、this的优先级&amp;总结 | 一切都沉淀为笔记</title>
  <meta name="author" content="Huangzhike">
  
  <meta name="description" content="硬绑定
1234567891011121314151617function foo() &amp;#123;	console.log( this.a );&amp;#125;var obj = &amp;#123;	a:2&amp;#125;;var bar = function() &amp;#123;	foo.call( obj );">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="[笔记]-十五、this的优先级&amp;总结"/>
  <meta property="og:site_name" content="一切都沉淀为笔记"/>

  
  
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="//favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">一切都沉淀为笔记</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="//resume" title="我的主页">
                    <i class="fa fa-github"></i>GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>[笔记]-十五、this的优先级&amp;总结</h2>
					
					<div>
						<span class="post-time">2016-10-29 13:45</span>
					</div>	
					

					<div class="article-content">
						<p>硬绑定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">function foo() &#123;</div><div class="line">	console.log( this.a );</div><div class="line">&#125;</div><div class="line">var obj = &#123;</div><div class="line">	a:2</div><div class="line">&#125;;</div><div class="line">var bar = function() &#123;</div><div class="line">	foo.call( obj );</div><div class="line">&#125;;</div><div class="line">bar(); // 2</div><div class="line">bar.call( window ); // 2  硬绑定的bar不能再修改它的this</div><div class="line">setTimeout( bar, 100 ); // 2 硬绑定的bar不能再修改它的this</div><div class="line"></div><div class="line"></div><div class="line">var bar = foo.call( obj ); // 未创建包裹函数</div><div class="line">bar(); // 2</div><div class="line">bar.call( window ); //  Uncaught TypeError: bar is not a function(…)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">function foo(something) &#123;</div><div class="line">	console.log( this.a, something );</div><div class="line">	return this.a + something;</div><div class="line">&#125;</div><div class="line">var obj = &#123;</div><div class="line">	a:2</div><div class="line">&#125;;</div><div class="line"></div><div class="line">// 硬绑定的典型应用场景就是创建一个包裹函数，传入所有的参数并返回接收到的所有值：</div><div class="line"></div><div class="line">var bar = function() &#123;</div><div class="line">	return foo.apply( obj, arguments );</div><div class="line">&#125;;</div><div class="line">var b = bar( 3 ); // 2 3</div><div class="line">console.log( b ); // 5</div><div class="line"></div><div class="line">// 另一种使用方法是创建一个可以重复使用的辅助函数：</div><div class="line"></div><div class="line">// 简单的辅助绑定函数</div><div class="line">function bind(fn, obj) &#123;</div><div class="line">	return function() &#123;</div><div class="line">		return fn.apply( obj, arguments );</div><div class="line">	&#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var bar = bind( foo, obj );</div><div class="line">var b = bar( 3 ); // 2 3</div><div class="line">console.log( b ); // 5</div><div class="line"></div><div class="line">// ES5提供了内置的方法 Function.prototype.bind：</div><div class="line"></div><div class="line">var bar = foo.bind( obj );</div><div class="line">var b = bar( 3 ); // 2 3</div><div class="line">console.log( b ); // 5</div><div class="line">// bind(..) 返回一个新函数，把参数设置为 this 的上下文并调用原始函数。</div></pre></td></tr></table></figure>
<p>许多函数都提供了一个可选的参数，称为“上下文”（context），作用和 bind 一样，确保回调函数使用指定的 this 。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function foo(el) &#123;</div><div class="line">	console.log( el, this.id );</div><div class="line">&#125;</div><div class="line">var obj = &#123;</div><div class="line"> 	id: &quot;awesome&quot;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">[1, 2, 3].forEach( foo, obj ); // 调用foo(..)时把this绑定到obj（实际上就是通过 call(..) 或者 apply(..) 实现了显式绑定）</div><div class="line">// 1 awesome 2 awesome 3 awesome</div></pre></td></tr></table></figure></p>
<p>优先级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">function foo() &#123;</div><div class="line">	console.log( this.a );</div><div class="line">&#125;</div><div class="line">var obj1 = &#123;</div><div class="line">	a: 1,</div><div class="line">	foo: foo</div><div class="line">&#125;;</div><div class="line">var obj2 = &#123;</div><div class="line">	a: 2,</div><div class="line">	foo: foo</div><div class="line">&#125;;</div><div class="line">obj1.foo(); // 1 （隐式绑定）</div><div class="line">obj1.foo.call( obj2 ); // 2 （显式绑定优先级更高）</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">function foo(something) &#123;</div><div class="line">	this.a = something;</div><div class="line">&#125;</div><div class="line">var obj1 = &#123;</div><div class="line">	foo: foo</div><div class="line">&#125;;</div><div class="line">var obj2 = &#123;&#125;;</div><div class="line"></div><div class="line">obj1.foo( 1 ); // </div><div class="line">console.log( obj1.a ); // 1</div><div class="line"></div><div class="line">obj1.foo.call( obj2, 2 ); // </div><div class="line">console.log( obj2.a ); // 2</div><div class="line"></div><div class="line">var bar = new obj1.foo( 3 );</div><div class="line">console.log( obj1.a ); // 1</div><div class="line">console.log( bar.a ); // 3 （new 绑定比隐式绑定优先级高）</div></pre></td></tr></table></figure>
<p>new 和 call / apply 无法一起使用，因此无法通过 new foo.call(obj1) 来直接测试。<br>先回忆一下硬绑定是如何工作的。<br>Function.prototype.bind(..) 会创建一个新的函数，这个函数忽略它当前的 this 绑定（无论绑定的对象是什么），并把我们提供的对象绑定到 this 上。<br>看起来硬绑定（也是显式绑定）似乎比 new 绑定的优先级更高。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">function foo(something) &#123;</div><div class="line">	this.a = something;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var obj1 = &#123;&#125;;</div><div class="line">var bar = foo.bind( obj1 ); // （ bar 被硬绑定到 obj1 上）</div><div class="line">bar( 2 );</div><div class="line">console.log( obj1.a ); // 2</div><div class="line"></div><div class="line">var baz = new bar(3);</div><div class="line">console.log( obj1.a ); // 2 （new bar(3) 没有把 obj1.a 修改为3）</div><div class="line">console.log( baz.a ); // 3</div></pre></td></tr></table></figure></p>
<p>再看看之前的辅助函数 bind ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function bind(fn, obj) &#123;</div><div class="line">	return function() &#123;</div><div class="line">		fn.apply( obj, arguments );</div><div class="line">	&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看起来在辅助函数中 new 操作符的调用无法修改 this 绑定，但刚才 new 确实修改了 this 绑定。</p>
<p>硬绑定可以把 this 强制绑定到指定的对象（除了使用 new），防止默认绑定。<br>但硬绑定会大大降低灵活性，使用硬绑定后无法使用隐式绑定或者显式绑定来修改 this 。<br>如果给默认绑定指定一个全局对象和 undefined 以外的值，就可以实现和硬绑定相同的效果，同时保留隐式绑定或者显式绑定修改 this 的能力。</p>
<p>通过软绑定来实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">if (!Function.prototype.softBind) &#123;</div><div class="line">	Function.prototype.softBind = function(obj) &#123;</div><div class="line">		var fn = this;</div><div class="line">		var curried = [].slice.call( arguments, 1 );</div><div class="line">		var bound = function() &#123;</div><div class="line">			// 对指定的函数进行封装</div><div class="line">			return fn.apply(</div><div class="line">				// 检查调用时 this ，如果 this 绑定全局或者undefined，就把指定对象obj绑定到this，否则不修改this</div><div class="line">				(!this || this === (window || global)) ?</div><div class="line">				obj : this</div><div class="line">				curried.concat.apply( curried, arguments ) // 支持可选的柯里化</div><div class="line">			);</div><div class="line">		&#125;;</div><div class="line">		bound.prototype = Object.create( fn.prototype );</div><div class="line">		return bound;</div><div class="line">	&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">function foo() &#123;</div><div class="line">	console.log(&quot;name: &quot; + this.name);</div><div class="line">&#125;</div><div class="line">var obj = &#123; name: &quot;obj&quot; &#125;,</div><div class="line">	obj2 = &#123; name: &quot;obj2&quot; &#125;,</div><div class="line">	obj3 = &#123; name: &quot;obj3&quot; &#125;;</div><div class="line"></div><div class="line">var fooOBJ = foo.softBind( obj );</div><div class="line"></div><div class="line">fooOBJ(); // name: obj</div><div class="line"></div><div class="line">obj2.foo = foo.softBind(obj);</div><div class="line"></div><div class="line">obj2.foo(); // name: obj2 （没有被影响）</div><div class="line"></div><div class="line">fooOBJ.call( obj3 ); // name: obj3 （依然可以更改）</div><div class="line"></div><div class="line">setTimeout( obj2.foo, 1000 ); // name: obj</div></pre></td></tr></table></figure>
<p>总结：要判断一个运行中函数的 this 绑定，就需要找到这个函数的直接调用位置。</p>
<ul>
<li>在 new 中调用（new 绑定）？this指向构造函数的实例对象。<br>var f = new F();</li>
<li>通过 call 、apply （显式绑定）或者硬绑定调用？this指向指定对象。<br>var f1 = f.call(obj);</li>
<li>当函数作为对象的方法调用，（隐式绑定）？this指向上下文对象。（只有该函数直接被某对象调用时，函数中this才指向该对象。嵌套函数的 this不会继承上层函数的 this，如果需要，可以用一个变量保存上层函数的this。）<br>var bar = obj1.foo();</li>
<li>单纯函数调用？使用默认绑定（指向全局对象）。严格模式下，指向undefined。<br>var bar = foo();</li>
</ul>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	

</div>


		<footer>
			

<p>
  Powered by <a href="https://hexo.io">Hexo</a>  | with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme
</p>
<p>
  &copy; 2016 <a href="http://huangzhike.github.io"> Huangzhike </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
