<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>[笔记]-模块&amp;封装（一） | 一切都沉淀为笔记</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="原始写法1234567891011var count= 0;function module()&amp;#123;	count++;	console.log(count)&amp;#125;module();module();console.log(count) // 2// 缺点：污染了全局变量，无法保证不与其他">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-模块&amp;封装（一）"/>
		
		<meta property="og:site_name" content="一切都沉淀为笔记"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<script>var timeStart = new Date();</script>
		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		
		
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一切都沉淀为笔记</a>
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="/" title="">
						<i class="fa fa-home"></i>首页
					</a>
				</li>
				
				<li>
					<a href="/archives" title="">
						<i class="fa fa-list"></i>存档
					</a>
				</li>
				
				<li>
					<a href="/resume" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-模块&amp;封装（一）</h2>
				
				<div>
					<span class="post-time">2016-10-31 12:18</span>
				</div>	
				
				<div class="article-content">
				<p>原始写法<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var <span class="built_in">count</span>= <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span></span> <span class="keyword">module</span>()&#123;</div><div class="line">	<span class="built_in">count</span>++;</div><div class="line">	console.<span class="built_in">log</span>(<span class="built_in">count</span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">module</span>();</div><div class="line"><span class="keyword">module</span>();</div><div class="line">console.<span class="built_in">log</span>(<span class="built_in">count</span>) // <span class="number">2</span></div><div class="line"></div><div class="line">// 缺点：污染了全局变量，无法保证不与其他模块发生变量名冲突，模块之间看不出直接关系。</div></pre></td></tr></table></figure></p>
<p>对象写法：把模块写成一个对象，所有的模块放到对象里面。<br>``<br>var module ={<br>    _count : 0,<br>    m1 : function (){<br>        //…<br>    },<br>    m2 : function (){<br>        //…<br>    }<br>};<br>// m1()和 m2()，都封装在module对象里。使用时调用这个对象的属性：module.m1();<br>// 这样也会暴露模块，比如，外部代码可以直接改变内部计数器的值：module._count = 5;</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="undefined"></span></div><div class="line">闭包写法</div></pre></td></tr></table></figure>
<p>function module(initial) {<br>    var _count = initial || 0;<br>    return {<br>        counter: function () {<br>        _count++;<br>        console.log( _count );<br>        }<br>    };<br>}</p>
<p>var c1 = module();<br>c1.counter(); // 1<br>c1.counter(); // 2</p>
<p>var c2 = module(10);<br>c2.counter(); // 11<br>c2.counter(); // 12</p>
<p>console.log(_count); // _count is not defined （减少全局变量，将变量私有化）</p>
<p>// module() 每次调用都会创建一个新的模块实例。<br>// 当只需要一个实例时，可以利用IIFE实现单例。<br>// 有的函数只需要执行一次，比如初始化，也可以使用匿名立即执行函数，外部无法引用它内部的变量（变量如果不加 var 关键字，默认的会添加到全局对象的属性上，别的函数可能误用），在执行完后就会被释放，并且不会污染全局对象。<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">立即执行函数写法（Immediately-Invoked <span class="keyword">Function</span> <span class="title">Expression，IIFE），可以不暴露私有成员。</span></div></pre></td></tr></table></figure></p>
<p>var module = (function(){<br>    var _count = 0;<br>    var m1 = function(){<br>        //…<br>    };<br>    var m2 = function(){<br>        //…<br>    };<br>    return {<br>        m1 : m1,<br>        m2 : m2<br>    };<br>})();</p>
<p>// 返回一个闭包，外部代码无法读取内部的_count变量。<br><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="http"></span></div><div class="line"></div><div class="line"><span class="golo"></span></div><div class="line">（宽）放大模式（<span class="keyword">augmentation</span>）：如果一个模块很大，必须分成几个部分，或者一个模块继承另一个模块。</div></pre></td></tr></table></figure></p>
<p>var module = (function (mod){<br>    mod.m3 = function () {<br>        //…<br>    };<br>    return mod; // 为module模块添加了一个新方法 m3()，然后返回新的module模块<br>})(module || {}); // 有时可能加载一个不存在空对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">输入全局变量</div><div class="line">独立性是模块的重要特点，模块内部最好不与程序其他部分直接交互。为了在模块内部调用全局变量，必须显式地将其他变量输入模块。</div></pre></td></tr></table></figure></p>
<p>var module = (function ($, YAHOO) {<br>    //…<br>})(jQuery, YAHOO);</p>
<p>// 上面的module模块需要使用jQuery库和YUI库，就把这两个库（其实是两个模块）当作参数输入module。<br>// 这样做除了保证模块的独立性，还使得模块之间的依赖关系变得明显。<br><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="coffeescript"></span></div><div class="line">命名空间</div><div class="line"></div><div class="line">全局变量会绑定到<span class="built_in">window</span>上，不同的JavaScript文件如果使用了同名的变量和函数，都会造成命名冲突。</div><div class="line">一个方法是把自己所有变量和函数全部绑定到一个全局变量中。例如：</div></pre></td></tr></table></figure></p>
<p>var MYSPACE = {}; // 唯一的全局变量MYSPACE</p>
<p>MYSPACE.name = “M”; // 其他变量</p>
<p>MYSPACE.foo = function () { // 其他函数<br>    return “foo”;<br>};<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">命名冲突也可以通过自执行匿名函数创建命名空间解决。</div></pre></td></tr></table></figure></p>
<p>(function() {<br>    // 函数创建一个命名空间（块级作用域）</p>
<p>})(); // 立即执行此匿名函数</p>
<p>(function() {})()<br>+function(){}();<br>(function(){}());<br>void function(){}(); // undefined</p>
<p>// 只要临时需要一些变量，就可以使用自执行匿名函数，限制向全局作用域中添加过多的变量和函数。<br><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="http"></span></div><div class="line"></div><div class="line"><span class="undefined">优化内存</span></div></pre></td></tr></table></figure></p>
<p>function comparision(propertyName){<br>    return function (obj1, obj2) {<br>        var value1 = obj1[propertyName];<br>        var value2 = obj2[propertyName];<br>        if (value1 &lt; value2){<br>            return -1;<br>        } else if (value1 &gt; value2){<br>            return 1;<br>        } else {<br>            return 0;<br>        }<br>    };<br>}</p>
<p>var com = comparision(“name”); // 创建函数</p>
<p>var result = com({name:”Nicolas”},{name:”Greg”}); // 调用函数</p>
<p>com = null; // 解除对匿名函数的引用（释放内存）</p>
<p>// 全局对象、全局对象属性、闭包外部函数（保存着对象）以及循环引用变量的引用如果不再有用，将其值设置为null解除引用，避免内存泄露。</p>
<p>function Handler(){<br>    var ele = document.getElementById(“ele”);<br>    var id  = ele.id;<br>    ele.onclick = function(){<br>        alert(id);<br>    };<br>    ele = null;<br>}</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="http"></span></div><div class="line"></div><div class="line"><span class="undefined"></span></div><div class="line"> 缓存</div><div class="line"></div><div class="line">假设有一个很耗时的函数，可以将函数结果存储起来，每次调用这个函数时，首先在缓存中查找，如果找到了，直接返回查找到的值，如果找不到，则计算然后更新缓存并返回值。</div><div class="line">闭包可以做到这一点，因为它不会释放外部的引用，从而函数内部的值可以得以保留。</div></pre></td></tr></table></figure>
<p>var Cached = (function(){<br>    var cache = {},<br>    count = [];<br>    return {<br>        attachBox : function(dsid){<br>            if(dsid in cache){ // 如果结果在缓存中<br>                return cache[dsid]; // 直接返回缓存中的对象<br>            }<br>            var fsb = new uikit.webctrl.SearchBox(dsid); // 新建<br>            cache[dsid] = fsb; // 更新缓存<br>            if(count.length &gt; 100){ // 保正缓存的大小&lt;=100<br>                delete cache[count.shift()];<br>            }<br>            return fsb;<br>        },<br>        clearBox : function(dsid){<br>            if(dsid in cache){<br>                cache[dsid].clearSelection();<br>            }<br>        }<br>    };<br>})();</p>
<p>Cached.attachBox(“ele”);</p>
<p>// 这样，当第二次调用 Cached.attachBox(“ele”)时，可以从缓存中取道该对象。<br>```</p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			
<p>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme modified by  Huangzhike </p>
<p>&copy; 2016 <a href="https://huangzhike.github.io"> Huangzhike </a></p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
