<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <script>
            var timeStart = new Date();
        </script>
        
        <title>[ç¬”è®°]-Ajax | ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜</title>
        
        <meta name="author" content="huangzhike">
        
        
        <meta name="description" content="Ajaxï¼šAsynchronous Javascript And XML

åˆ›å»ºXMLHttpRequestå¯¹è±¡
åˆ›å»ºä¸€ä¸ªæ–°çš„HTTPè¯·æ±‚ï¼Œå¹¶æŒ‡å®šè¯¥HTTPè¯·æ±‚çš„æ–¹æ³•ã€URLåŠéªŒè¯ä¿¡æ¯
è®¾ç½®å“åº”HTTPè¯·æ±‚çŠ¶æ€å˜åŒ–çš„å‡½æ•°
å‘é€HTTPè¯·æ±‚
è·å–å¼‚æ­¥è°ƒç”¨è¿”å›çš„æ•°æ®
ä½¿ç”¨JavaScriptå’ŒDOMå®ç°">
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        
        <meta property="og:title" content="[ç¬”è®°]-Ajax"/>
        
        <meta property="og:site_name" content="ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜"/>
        
        
        <!-- favicon -->
        <link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
        <meta name="msapplication-TileColor" content="#009688">
        <meta name="msapplication-TileImage" content="/mstile-144x144.ico">
        <meta name="theme-color" content="#009688">
        <!-- favicon end -->
        <!-- <link href="//ok.ico" rel="icon"> -->
        
        <!-- toc -->
        <!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
        <!-- material design -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
        <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
        
        <!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
        <!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
    <meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">èœå•</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" title="ä¸‹ä¸€å¥æ˜¯ï¼šå®¢æœ‰å¯äººæœŸä¸æ¥ã€‚å°æ—¶å€™ï¼Œå–œæ¬¢é åœ¨é˜³å°ä¸Šï¼Œä¸€è¾¹å¹é£ï¼Œä¸€è¾¹çœ‹ä¹¦ï¼Œå–œæ¬¢è¯»ä¹¦å—ï¼Œéªšå¹´ï¼Ÿ" href="/">ä¹¦å½“å¿«æ„è¯»æ˜“å°½</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" target="_blank" rel="noopener" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

    <div class="container" >
        <div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[ç¬”è®°]-Ajax</h2>
				
				<div>
					<div class="post-time">2016-12-12</div>
				</div>
				
				<div class="article-content">
				<p>Ajaxï¼šAsynchronous Javascript And XML</p>
<ul>
<li>åˆ›å»ºXMLHttpRequestå¯¹è±¡</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„HTTPè¯·æ±‚ï¼Œå¹¶æŒ‡å®šè¯¥HTTPè¯·æ±‚çš„æ–¹æ³•ã€URLåŠéªŒè¯ä¿¡æ¯</li>
<li>è®¾ç½®å“åº”HTTPè¯·æ±‚çŠ¶æ€å˜åŒ–çš„å‡½æ•°</li>
<li>å‘é€HTTPè¯·æ±‚</li>
<li>è·å–å¼‚æ­¥è°ƒç”¨è¿”å›çš„æ•°æ®</li>
<li>ä½¿ç”¨JavaScriptå’ŒDOMå®ç°å±€éƒ¨åˆ·æ–°</li>
</ul>
<pre class=" language-JavaScript"><code class="language-JavaScript">var xmlHttp = new XMLHttpRequest();
xmlHttp.open('GET', 'demo.php', 'true');
xmlHttp.send();
xmlHttp.onreadystatechange = function() {
    if(xmlHttp.readyState === 4 & xmlHttp.status === 200) {
    }
}</code></pre>
<p>åˆ›å»ºXMLHttpRequestå¯¹è±¡</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">var xmlhttp;
if (window.XMLHttpRequest) {
        //  IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
} else {
        // IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
}</code></pre>
<p>å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä½¿ç”¨XMLHttpRequestå¯¹è±¡çš„open()å’Œsend()æ–¹æ³•ï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.open("GET","ajax_info.txt",true);
// methodï¼šè¯·æ±‚ç±»å‹ï¼›GETæˆ–POST
// urlï¼šæ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„ä½ç½®
// asyncï¼štrueï¼ˆå¼‚æ­¥ï¼‰æˆ–falseï¼ˆåŒæ­¥ï¼‰
xmlhttp.send();
// send(string)å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨
// stringï¼šä»…ç”¨äºPOSTè¯·æ±‚</code></pre>
<ul>
<li>GETè¯·æ±‚</li>
</ul>
<p>ç®€å•çš„GETè¯·æ±‚ï¼Œå¯èƒ½å¾—åˆ°ç¼“å­˜çš„ç»“æœï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.open("GET","/try/ajax/get.php", true);
xmlhttp.send();</code></pre>
<p>å‘URLæ·»åŠ å”¯ä¸€çš„IDï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.open("GET", "/try/ajax/get.php?t=" + Math.random(), true);
xmlhttp.send();</code></pre>
<p>é€šè¿‡GETæ–¹æ³•å‘é€ä¿¡æ¯ï¼Œå‘URLæ·»åŠ ä¿¡æ¯ï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.open("GET", "/try/ajax/get2.php?fname=Henry&lname=Ford", true);
xmlhttp.send();</code></pre>
<p>POSTè¯·æ±‚</p>
<p>ç®€å•POSTè¯·æ±‚ï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.open("POST","/try/ajax/post.php",true);
xmlhttp.send();</code></pre>
<p>å¦‚æœéœ€è¦åƒè¡¨å•é‚£æ · POST æ•°æ®ï¼Œä½¿ç”¨ setRequestHeader() æ·»åŠ  HTTP å¤´ï¼Œç„¶ååœ¨ send() æ–¹æ³•ä¸­è§„å®šå‘é€çš„æ•°æ®ï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.open("POST", "/try/ajax/post2.php", true);
xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
xmlhttp.send("fname=Henry&lname=Ford");</code></pre>
<p>å½“ async=true æ—¶ï¼Œè¯·è§„å®šåœ¨å“åº”å¤„äº onreadystatechange äº‹ä»¶ä¸­çš„å°±ç»ªçŠ¶æ€æ—¶çš„å‡½æ•°ï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.onreadystatechange=function(){
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        document.getElementById("myDiv").innerHTML = xmlhttp.responseText;
    }
}

xmlhttp.open("GET", "/try/ajax/ajax_info.txt", true);
xmlhttp.send();</code></pre>
<p>ç”¨async=falseï¼Œå°†open()æ–¹æ³•ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ”¹ä¸ºfalseï¼Œæ­¤æ—¶ä¸è¦onreadystatechangeå‡½æ•°ï¼ŒæŠŠä»£ç æ”¾åˆ°send()è¯­å¥åé¢å³å¯ï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">xmlhttp.open("GET", "/try/ajax/ajax_info.txt", false);
xmlhttp.send();
document.getElementById("myDiv").innerHTML = xmlhttp.responseText;</code></pre>
<p>è·å¾—æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ï¼Œä½¿ç”¨XMLHttpRequestå¯¹è±¡çš„responseTextæˆ–responseXMLå±æ€§ã€‚</p>
<p>responseTextï¼šè·å¾—å­—ç¬¦ä¸²å½¢å¼çš„å“åº”æ•°æ®</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">document.getElementById("myDiv").innerHTML=xmlhttp.responseText;</code></pre>
<p>responseXMLï¼šè·å¾—XMLå½¢å¼çš„å“åº”æ•°æ®</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">// è¯·æ±‚cd_catalog.xmlæ–‡ä»¶ï¼Œå¹¶è§£æå“åº”
xmlDoc = xmlhttp.responseXML;
txt = "";
x = xmlDoc.getElementsByTagName("ARTIST");
for (i = 0; i<x.length; i++) {
        txt = txt + x[i].childNodes[0].nodeValue + "<br>";
}
document.getElementById("myDiv").innerHTML=txt;</code></pre>
<p>æ¯å½“readyStateæ”¹å˜æ—¶ï¼Œå°±ä¼šè§¦å‘onreadystatechangeäº‹ä»¶ã€‚</p>
<p>readyStateå±æ€§å­˜æœ‰XMLHttpRequestçš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>XMLHttpRequestå¯¹è±¡çš„ä¸‰ä¸ªå±æ€§ï¼š</p>
<ul>
<li>onreadystatechangeï¼šå­˜å‚¨å‡½æ•°ï¼ˆæˆ–å‡½æ•°åï¼‰ï¼Œæ¯å½“readyStateå±æ€§æ”¹å˜æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚</li>
<li>readyStatï¼šå­˜æœ‰XMLHttpRequestçš„çŠ¶æ€ã€‚ä»0åˆ°4å˜åŒ–ã€‚<ul>
<li>0: è¯·æ±‚æœªåˆå§‹åŒ–</li>
<li>1: æœåŠ¡å™¨è¿æ¥å·²å»ºç«‹</li>
<li>2: è¯·æ±‚å·²æ¥æ”¶</li>
<li>3: è¯·æ±‚å¤„ç†ä¸­</li>
<li>4: è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª</li>
</ul>
</li>
<li>status<ul>
<li>200: â€œOKâ€</li>
<li>404: æœªæ‰¾åˆ°é¡µé¢</li>
</ul>
</li>
</ul>
<pre class=" language-JavaScript"><code class="language-JavaScript">// onreadystatechangeäº‹ä»¶è¢«è§¦å‘5æ¬¡ï¼ˆ0 - 4ï¼‰ï¼Œå¯¹åº”readyStateæ¯ä¸ªå˜åŒ–
xmlhttp.onreadystatechange = function() {
    // è¡¨ç¤ºå“åº”å·²å°±ç»ª
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        document.getElementById("myDiv").innerHTML = xmlhttp.responseText;
        }
    }</code></pre>
<p>ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°ä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>å¦‚æœå­˜åœ¨å¤šä¸ªAJAXä»»åŠ¡ï¼Œåº”è¯¥ç¼–å†™ä¸€ä¸ªæ ‡å‡†çš„å‡½æ•°ï¼Œå¹¶ä¸ºAJAXä»»åŠ¡è°ƒç”¨è¯¥å‡½æ•°ã€‚</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">// onkeyup äº‹ä»¶è§¦å‘å‡½æ•° showHint
function showHint(str){
    var xmlhttp;
    if (str.length == 0) { 
        document.getElementById("txtHint").innerHTML = "";
        return;
    }
    xmlhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            document.getElementById("txtHint").innerHTML = xmlhttp.responseText;
        }
    }
    // å‘ URL æ·»åŠ å‚æ•° q ï¼ˆå¸¦æœ‰è¾“å…¥æ¡†çš„å†…å®¹ï¼‰
    xmlhttp.open("GET","/try/ajax/gethint.php?q=" + str, true);
    xmlhttp.send();
}</code></pre>
<pre class=" language-JavaScript"><code class="language-JavaScript">function loadDoc() {
    // åˆ›å»º XMLHttpRequest å¯¹è±¡
    var xhttp = new XMLHttpRequest();
    // å½“æœåŠ¡å™¨å“åº”å°±ç»ªæ—¶æ‰§è¡Œçš„å‡½æ•°
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            myFunction(this);
        }
    };
    // å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨
    xhttp.open("GET", "cd_catalog.xml", true);
    xhttp.send();
}

function myFunction(xml) {
}</code></pre>
<pre class=" language-JavaScript"><code class="language-JavaScript">// å°è£…çš„ä¸€ä¸ªajaxå‡½æ•°
function ajax(type, url, data, sucess, failed) {
    var xhr = null;

    xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");

    var type = type.toUpperCase();
    var random = Math.random();

    if (typeof data == "object") {
        var str = "";
        for (var key in data) {
            str += key + "=" + data[key] + â€œ & â€;
        }
        data = str.replace(/&$/, "");
    }
    if (type == "GET") {
        data ? xhr.open("GET", url + "?" + data, ture) : xhr.open("GET", url + "?t=" + random, ture);
        xhr.send();
    } else if (type == "POST") {
        xhr.open("POST", url, ture);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send(data);
    }
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            sucess(xhr.responseText);
        } else if (failed) {
            failed(xhr.status);
        }
    }
}</code></pre>
<pre class=" language-JavaScript"><code class="language-JavaScript">// GET
document.getElementById("").onclick = function() {
    var request = new XMlHttpRequest();
    request.open("GET", "service.php?number=" + document.getElementById("keyword").value);
    request.send();
    request.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            document.getElementById("result").innerHTML = request.responseText;
        }
    }
}</code></pre>
<pre class=" language-JavaScript"><code class="language-JavaScript">// POST
document.getElementById("").onclick = function() {
    var request = new XMlHttpRequest();
    request.open("POST", "service.php");
    var data = "name=" + document.getElementById("").value + 
        "&sex=" + document.getElementById("").value + 
        "&job=" + document.getElementById("").value;
    request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    request.send(data);
    request.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            document.getElementById("result").innerHTML = request.responseText;
        }
    }
}</code></pre>
<p>Jsonè§£æï¼ševalï¼›JSON.parse</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">// JSON
{
    "sucess": ture,
    "msg": "OK"
}

document.getElementById("").onclick = function() {
    var request = new XMlHttpRequest();
    request.open("GET", "service.php?number=" + document.getElementById("keyword").value);
    request.send();
    request.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            var data = JSON.parse(request.responseText);
            if (data.sucess) {
                document.getElementById("result").innerHTML = data.msg;
            }
        }
    }
}</code></pre>
<p>ä½¿ç”¨XMLHttpRequestsæ—¶æ³¨æ„è®¾ç½®è¶…æ—¶ï¼Œå½“é•¿æ—¶é—´æ²¡æœ‰å“åº”æ—¶ï¼Œåº”è¯¥ä¸­æ­¢æ‰è¿æ¥ï¼Œå¯é€šè¿‡setTimeoutå®Œæˆï¼ŒåŒæ—¶æ³¨æ„ï¼Œä¸è¦åŒæ—¶å‘èµ·å¤šä¸ªXMLHttpRequestsè¯·æ±‚ï¼š</p>
<pre class=" language-JavaScript"><code class="language-JavaScript">var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (this.readyState == 4) {
        clearTimeout(timeout);
        // do something with response data
    }
}
var timeout = setTimeout(function() {
    xhr.abort(); // call error callback
}, 60 * 1000 /* timeout after a minute */ );
xhr.open('GET', url, true);
xhr.send();</code></pre>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


        <footer>
             
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

        </footer>
    </div>
    <!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
    <script>
        var timeEnd = new Date();
        console.log('è€—æ—¶ï¼š' + (timeEnd - timeStart));
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre').forEach((block) => {
                block.classList.add("line-numbers");
            });
        });
    </script>
    <!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
    <!-- material design -->
    <!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
    <!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
    <!-- toc -->
    <!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
    <!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
    <!-- <script src="/js/main.js"></script> -->
    <script src="/js/prism.js"></script>
</body>
</html>
