<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>[笔记]-Ajax | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="用手记笔记，用心记笔记，用脑记笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-Ajax"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<script>var timeStart = new Date();</script>
		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		
		
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>首页
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>存档
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-Ajax</h2>
				
				<div>
					<span class="post-time">2016-12-12 15:58</span>
				</div>	
				
				<div class="article-content">
				<ul>
<li><p>Ajax：Asynchronous Javascript And XML</p>
<ul>
<li>(1)创建XMLHttpRequest对象</li>
<li>(2)创建一个新的HTTP请求，并指定该HTTP请求的方法、URL及验证信息</li>
<li>(3)设置响应HTTP请求状态变化的函数</li>
<li>(4)发送HTTP请求</li>
<li>(5)获取异步调用返回的数据</li>
<li>(6)使用JavaScript和DOM实现局部刷新<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">xmlHttp.open(<span class="string">'GET'</span>, <span class="string">'demo.php'</span>, <span class="string">'true'</span>);</div><div class="line">xmlHttp.send();</div><div class="line">xmlHttp.onreadystatechange = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(xmlHttp.readyState === <span class="number">4</span> &amp; xmlHttp.status === <span class="number">200</span>) &#123;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>创建 XMLHttpRequest 对象：所有现代浏览器（IE7+）</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (window.XMLHttpRequest) &#123;</div><div class="line">		<span class="comment">//  IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">		xmlhttp = <span class="keyword">new</span> <span class="type">XMLHttpRequest</span>();</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="comment">// IE6, IE5 </span></div><div class="line">		xmlhttp = <span class="keyword">new</span> <span class="type">ActiveXObject</span>(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>向服务器发送请求，使用 XMLHttpRequest 对象的 open() 和 send() 方法：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">GET</span>"</span>,<span class="string">"ajax_info.txt"</span>,true);</div><div class="line">// method：请求类型；GET 或 POST</div><div class="line">// url：文件在服务器上的位置</div><div class="line">// async：true（异步）或 false（同步）</div><div class="line">xmlhttp.send();</div><div class="line">// send(string)将请求发送到服务器</div><div class="line">// string：仅用于 POST 请求</div></pre></td></tr></table></figure>
</li>
<li><p>GET 请求</p>
<ul>
<li><p>简单的 GET 请求，可能得到缓存的结果：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">GET</span>"</span>,<span class="string">"/try/ajax/get.php"</span>, true);</div><div class="line">xmlhttp.send();</div></pre></td></tr></table></figure>
</li>
<li><p>向 URL 添加唯一的 ID：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">GET</span>"</span>, <span class="string">"/try/ajax/get.php?t="</span> + Math.random(), true);</div><div class="line">xmlhttp.send();</div></pre></td></tr></table></figure>
</li>
<li><p>通过 GET 方法发送信息，向 URL 添加信息：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">GET</span>"</span>, <span class="string">"/try/ajax/get2.php?fname=Henry&amp;lname=Ford"</span>, true);</div><div class="line">xmlhttp.send();</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>POST 请求</p>
<ul>
<li><p>简单 POST 请求：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">POST</span>"</span>,<span class="string">"/try/ajax/post.php"</span>,true);</div><div class="line">xmlhttp.send();</div></pre></td></tr></table></figure>
</li>
<li><p>如果需要像表单那样 POST 数据，使用 setRequestHeader() 添加 HTTP 头，然后在 send() 方法中规定发送的数据：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">POST</span>"</span>, <span class="string">"/try/ajax/post2.php"</span>, true);</div><div class="line">xmlhttp.setRequestHeader(<span class="string">"Content-type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</div><div class="line">xmlhttp.send(<span class="string">"fname=Henry&amp;lname=Ford"</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>当 async=true 时，请规定在响应处于 onreadystatechange 事件中的就绪状态时的函数：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">xmlhttp.onreadystatechange=function()&#123;</div><div class="line">	if (xmlhttp.readyState == <span class="number">4</span> &amp;&amp; xmlhttp.status == <span class="number">200</span>) &#123;</div><div class="line">		document.getElementById(<span class="string">"myDiv"</span>).innerHTML = xmlhttp.responseText;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">GET</span>"</span>, <span class="string">"/try/ajax/ajax_info.txt"</span>, true);</div><div class="line">xmlhttp.send();</div></pre></td></tr></table></figure>
</li>
<li><p>用 async=false，将 open() 方法中的第三个参数改为 false，此时不要 onreadystatechange 函数，把代码放到 send() 语句后面即可：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"<span class="keyword">GET</span>"</span>, <span class="string">"/try/ajax/ajax_info.txt"</span>, false);</div><div class="line">xmlhttp.send();</div><div class="line">document.getElementById(<span class="string">"myDiv"</span>).innerHTML = xmlhttp.responseText;</div></pre></td></tr></table></figure>
</li>
<li><p>获得来自服务器的响应，使用 XMLHttpRequest 对象的 responseText 或 responseXML 属性。</p>
<ul>
<li><p>responseText：获得字符串形式的响应数据</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">document.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText<span class="comment">;</span></div></pre></td></tr></table></figure>
</li>
<li><p>responseXML    ：获得 XML 形式的响应数据</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 请求 cd_catalog.xml 文件，并解析响应</div><div class="line"><span class="attr">xmlDoc</span> = xmlhttp.responseXML;</div><div class="line"><span class="attr">txt</span> = <span class="string">""</span>;</div><div class="line"><span class="attr">x</span> = xmlDoc.getElementsByTagName(<span class="string">"ARTIST"</span>);</div><div class="line">for (<span class="attr">i</span> = <span class="number">0</span>; i&lt;x.length; i++) &#123;</div><div class="line">		<span class="attr">txt</span> = txt + x[i].childNodes[<span class="number">0</span>].nodeValue + <span class="string">"&lt;br&gt;"</span>;</div><div class="line">&#125;</div><div class="line">document.getElementById(<span class="string">"myDiv"</span>).<span class="attr">innerHTML=txt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>每当 readyState 改变时，就会触发 onreadystatechange 事件。</p>
</li>
<li>readyState 属性存有 XMLHttpRequest 的状态信息。</li>
<li><p>XMLHttpRequest 对象的三个属性：</p>
<ul>
<li>onreadystatechange    存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</li>
<li>readyState 存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。<ul>
<li>0: 请求未初始化</li>
<li>1: 服务器连接已建立</li>
<li>2: 请求已接收</li>
<li>3: 请求处理中</li>
<li>4: 请求已完成，且响应已就绪</li>
</ul>
</li>
<li>status    <ul>
<li>200: “OK”</li>
<li>404: 未找到页面<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// onreadystatechange 事件被触发 5 次（0 - 4），对应 readyState 每个变化</span></div><div class="line">xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="comment">// 当 readyState 等于 4 且状态为 200 时，表示响应已就绪</span></div><div class="line">	<span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span> &amp;&amp; xmlhttp.status == <span class="number">200</span>) &#123;</div><div class="line">		<span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML = xmlhttp.responseText;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>使用回调函数，回调函数以参数形式传递给另一个函数。</p>
</li>
<li><p>如果存在多个 AJAX 任务，应该编写一个标准的函数，并为 AJAX 任务调用该函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// onkeyup 事件触发函数 showHint</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showHint</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> xmlhttp;</div><div class="line">	<span class="keyword">if</span> (str.length == <span class="number">0</span>) &#123; </div><div class="line">		<span class="built_in">document</span>.getElementById(<span class="string">"txtHint"</span>).innerHTML = <span class="string">""</span>;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	xmlhttp = <span class="built_in">window</span>.XMLHttpRequest ? <span class="keyword">new</span> XMLHttpRequest() : <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">	xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span> &amp;&amp; xmlhttp.status == <span class="number">200</span>) &#123;</div><div class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"txtHint"</span>).innerHTML = xmlhttp.responseText;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 向 URL 添加参数 q （带有输入框的内容）</span></div><div class="line">	xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"/try/ajax/gethint.php?q="</span> + str,<span class="literal">true</span>);</div><div class="line">	xmlhttp.send();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadDoc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="comment">// 创建 XMLHttpRequest 对象</span></div><div class="line">	<span class="keyword">var</span> xhttp = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">	<span class="comment">// 当服务器响应就绪时执行的函数</span></div><div class="line">	xhttp.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.readyState == <span class="number">4</span> &amp;&amp; <span class="keyword">this</span>.status == <span class="number">200</span>) &#123;</div><div class="line">			myFunction(<span class="keyword">this</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="comment">// 将请求发送到服务器</span></div><div class="line">	xhttp.open(<span class="string">"GET"</span>, <span class="string">"cd_catalog.xml"</span>, <span class="literal">true</span>);</div><div class="line">	xhttp.send();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params">xml</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> i;</div><div class="line">	<span class="keyword">var</span> xmlDoc = xml.responseXML;</div><div class="line">	<span class="comment">// 构建一个 HTML 表格</span></div><div class="line">	<span class="keyword">var</span> table = <span class="string">"&lt;tr&gt;&lt;th&gt;Artist&lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;/tr&gt;"</span>;</div><div class="line">	<span class="comment">// 从 XML 文件中提取节点</span></div><div class="line">	<span class="keyword">var</span> x = xmlDoc.getElementsByTagName(<span class="string">"CD"</span>);</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; x.length; i++) &#123;</div><div class="line">		table += </div><div class="line">			<span class="string">"&lt;tr&gt;&lt;td&gt;"</span> + </div><div class="line">			x[i].getElementsByTagName(<span class="string">"ARTIST"</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue + </div><div class="line">			<span class="string">"&lt;/td&gt;&lt;td&gt;"</span> + </div><div class="line">			x[i].getElementsByTagName(<span class="string">"TITLE"</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue + </div><div class="line">			<span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 使用 XML 数据的 填充 id="demo" 的表格元素</span></div><div class="line">	<span class="built_in">document</span>.getElementById(<span class="string">"demo"</span>).innerHTML = table;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">// 封装的一个ajax函数</div><div class="line">function ajax(type, url, data, sucess, failed) &#123;</div><div class="line">	var xhr = null;</div><div class="line"></div><div class="line">	xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line"></div><div class="line">	var type = type.toUpperCase();</div><div class="line">	var random = Math.random();</div><div class="line"></div><div class="line">	if (typeof data == <span class="string">"object"</span>) &#123;</div><div class="line">		var str = <span class="string">""</span>;</div><div class="line">		for (var key in data) &#123;</div><div class="line">			str += key + <span class="string">"="</span> + data<span class="string">[key]</span> + “ &amp; ”;</div><div class="line">		&#125;</div><div class="line">		data = str.replace(/&amp;$/, <span class="string">""</span>);</div><div class="line">	&#125;</div><div class="line">	if (type == <span class="string">"<span class="keyword">GET</span>"</span>) &#123;</div><div class="line">		data ? xhr.open(<span class="string">"<span class="keyword">GET</span>"</span>, url + <span class="string">"?"</span> + data, ture) : xhr.open(<span class="string">"<span class="keyword">GET</span>"</span>, url + <span class="string">"?t="</span> + random, ture);</div><div class="line">		xhr.send();</div><div class="line">	&#125; else if (type == <span class="string">"<span class="keyword">POST</span>"</span>) &#123;</div><div class="line">		xhr.open(<span class="string">"<span class="keyword">POST</span>"</span>, url, ture);</div><div class="line">		xhr.setRequestHeader(<span class="string">"Content-type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</div><div class="line">		xhr.send(data);</div><div class="line">	&#125;</div><div class="line">	xhr.onreadystatechange = function() &#123;</div><div class="line">		if (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</div><div class="line">			sucess(xhr.responseText);</div><div class="line">		&#125; else if (failed) &#123;</div><div class="line">			failed(xhr.status);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// GET</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">""</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> request = <span class="keyword">new</span> XMlHttpRequest();</div><div class="line">	request.open(<span class="string">"GET"</span>, <span class="string">"service.php?number="</span> + <span class="built_in">document</span>.getElementById(<span class="string">"keyword"</span>).value);</div><div class="line">	request.send();</div><div class="line">	request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</div><div class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"result"</span>).innerHTML = request.responseText;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// POST</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">""</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> request = <span class="keyword">new</span> XMlHttpRequest();</div><div class="line">	request.open(<span class="string">"POST"</span>, <span class="string">"service.php"</span>);</div><div class="line">	<span class="keyword">var</span> data = <span class="string">"name="</span> + <span class="built_in">document</span>.getElementById(<span class="string">""</span>).value + </div><div class="line">		<span class="string">"&amp;sex="</span> + <span class="built_in">document</span>.getElementById(<span class="string">""</span>).value + </div><div class="line">		<span class="string">"&amp;job="</span> + <span class="built_in">document</span>.getElementById(<span class="string">""</span>).value;</div><div class="line">	request.setRequestHeader(<span class="string">"Content-type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</div><div class="line">	request.send(data);</div><div class="line">	request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</div><div class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"result"</span>).innerHTML = request.responseText;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>Json解析；eval；JSON.parse</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// JSON</span></div><div class="line">&#123;</div><div class="line">	<span class="string">"sucess"</span>: ture,</div><div class="line">	<span class="string">"msg"</span>: <span class="string">"OK"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">""</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> request = <span class="keyword">new</span> XMlHttpRequest();</div><div class="line">	request.open(<span class="string">"GET"</span>, <span class="string">"service.php?number="</span> + <span class="built_in">document</span>.getElementById(<span class="string">"keyword"</span>).value);</div><div class="line">	request.send();</div><div class="line">	request.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</div><div class="line">			<span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(request.responseText);</div><div class="line">			<span class="keyword">if</span> (data.sucess) &#123;</div><div class="line">				<span class="built_in">document</span>.getElementById(<span class="string">"result"</span>).innerHTML = data.msg;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>jQuery</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	$(<span class="string">"#search"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		$ajax(&#123;</div><div class="line">			<span class="keyword">type</span>: <span class="string">"GET"</span>,</div><div class="line">			data Type: <span class="string">"json"</span>,</div><div class="line">			url: <span class="string">"service.php?number="</span> + $(<span class="string">"#keyword"</span>).val(),</div><div class="line">			sucess: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">				$(# <span class="string">""</span>).html(data.msg);</div><div class="line">			&#125;,</div><div class="line">			error: <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR</span>) </span>&#123;&#125;</div><div class="line">		&#125;)</div><div class="line">	&#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	$(<span class="string">"#search"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		$ajax(&#123;</div><div class="line">			<span class="keyword">type</span>: <span class="string">"POST"</span>,</div><div class="line">			data Type: <span class="string">"json"</span>,</div><div class="line">			data: &#123;</div><div class="line">				name: $(# <span class="string">""</span>).val(),</div><div class="line">				sex: $(# <span class="string">""</span>).val(),</div><div class="line">				job: $(# <span class="string">""</span>).val(),</div><div class="line">			&#125;,</div><div class="line">			url: <span class="string">"service.php?number="</span> + $(<span class="string">"#keyword"</span>).val(),</div><div class="line">			sucess: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">				$(# <span class="string">""</span>).html(data.msg);</div><div class="line">			&#125;,</div><div class="line">			error: <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR</span>) </span>&#123;&#125;</div><div class="line">		&#125;)</div><div class="line">	&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>使用XMLHttpRequests时注意设置超时，当长时间没有响应时，应该中止掉连接，可通过setTimeout完成，同时注意，不要同时发起多个XMLHttpRequests请求：</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.readyState == <span class="number">4</span>) &#123;</div><div class="line">		clearTimeout(timeout);</div><div class="line">		<span class="comment">// do something with response data </span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">var</span> timeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	xhr.abort(); <span class="comment">// call error callback  </span></div><div class="line">&#125;, <span class="number">60</span> * <span class="number">1000</span> <span class="comment">/* timeout after a minute */</span> );</div><div class="line">xhr.open(<span class="string">'GET'</span>, <span class="built_in">url</span>, <span class="literal">true</span>);</div><div class="line">xhr.send();</div></pre></td></tr></table></figure>
</li>
<li><p>优点：</p>
<ul>
<li>（1）通过异步，不会造成UI卡死，提升了用户体验</li>
<li>（2）减少不必要的数据往返，减少了带宽占用，省流量</li>
<li>（3）Ajax在客户端运行，减少了大用户量下的服务器负载</li>
<li>（4）Ajax可以实现局部刷新</li>
</ul>
</li>
<li><p>缺点：</p>
<ul>
<li>（1）后退按钮无效</li>
<li>（2）搜索引擎不友好</li>
<li>（3）不容易调试</li>
<li>（4）多个请求同时触发时，由于回调时间不确定，会造成混乱</li>
<li>（5）IE缓存问题，如果请求方法是<code>GET</code>，并且请求的<code>URL</code>不变，请求结果就会被缓存</li>
</ul>
</li>
<li><p>Ajax请求的页面历史记录</p>
<ul>
<li>通过锚点来记录状态，<code>location.hash</code>。让浏览器记录Ajax请求时页面状态的变化</li>
<li>通过<code>HTML5</code>的<code>history.pushState</code>，实现浏览器地址栏的无刷新改变</li>
</ul>
</li>
<li><p>Ajax 解决浏览器缓存问题？</p>
<ul>
<li>1、在ajax发送请求前加上：<code>anyAjaxObj.setRequestHeader(&quot;If-Modified-Since&quot;, &quot;0&quot;)</code></li>
<li>2、在ajax发送请求前加上：<code>anyAjaxObj.setRequestHeader(&quot;Cache-Control&quot;,&quot;no-cache&quot;)</code></li>
<li>3、在URL后面加上一个随机数：<code>open(&#39;GET&#39;, &#39;demo.php?rand =+ Math.random()&#39;, true);</code></li>
<li>4、在URL后面加上时间戳：<code>&quot;t=&quot; + new Date().getTime();</code></li>
<li>5、如果使用jQuery：<code>$.ajaxSetup({cache:false})</code></li>
</ul>
</li>
<li><p>GET和POST的区别，何时使用POST？</p>
<ul>
<li>与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用</li>
<li>GET：一般用于信息获取，使用URL传递参数，对所发送信息的数量也有限制</li>
<li>POST：一般用于修改服务器上的资源，对所发送的信息没有限制</li>
<li>GET使用Request.QueryString取得变量的值</li>
<li>POST通过Request.Form获取变量的值</li>
<li><p>也就是说Get通过地址栏来传值，而Post是通过提交表单来传值</p>
</li>
<li><p>以下情况，使用 POST ：</p>
<ul>
<li>无法使用缓存文件（更新服务器上的文件或数据库）</li>
<li>向服务器发送大量数据（POST 没有数据量限制）</li>
<li>发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</li>
</ul>
</li>
</ul>
</li>
<li><p>认识</p>
<ul>
<li>GET使用URL或Cookie传参。而POST将数据放在BODY中。</li>
<li>GET的URL会有长度上的限制，则POST的数据则可以非常大。</li>
<li>POST比GET安全，因为数据在地址栏上不可见。</li>
</ul>
</li>
<li>很不幸，这些区别全是错误的：</li>
<li>GET和POST与数据如何传递没有关系<ul>
<li>GET和POST是由HTTP协议定义的。在HTTP协议中，使用哪个Method与应用层的数据如何传输是没有相互关系的。</li>
<li>HTTP没有要求，如果Method是POST数据就要放在BODY中。也没有要求，如果Method是GET，数据就一定要放在URL中而不能放在BODY中。</li>
<li>而且，现代的Web Server都支持GET中包含BODY这样的请求。虽然这种请求不可能从浏览器发出。</li>
</ul>
</li>
<li>HTTP协议对GET和POST都没有对长度的限制<ul>
<li>HTTP协议明确地指出了，HTTP头和Body都没有长度的要求：<ul>
<li>浏览器。</li>
<li>服务器。URL长了，对服务器也是负担。如果有人恶意构造几个几M大小的URL，并不停地访问服务器。服务器的最大并发数显然会下降。另一种方式是，把告诉服务器Content-Length是一个很大的数，然后只给服务器发一点儿数据，服务器就傻等着，哪怕有超时设置，这种故意的次次访问超时也能让服务器吃不了兜着走。有鉴于此，多数服务器出于安全、稳定方面的考虑，会给URL长度加限制。但是这个限制是针对所有HTTP请求的，与GET、POST没有关系。</li>
</ul>
</li>
</ul>
</li>
<li>安全不安全和GET、POST没有关系<ul>
<li>EncodeURL参数，或是Base64，Decode，截包并重发</li>
</ul>
</li>
</ul>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			
<p>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme modified by <b> Huangzhike </b></p>
<p>&copy; 2017 <a href="https://huangzhike.github.io"><b> Huangzhike </b></a></p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
