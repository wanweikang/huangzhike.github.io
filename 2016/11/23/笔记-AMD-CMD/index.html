<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-AMD-CMD | 学而时习之</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-AMD-CMD">
		
		<meta property="og:site_name" content="学而时习之">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">学而时习之</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-AMD-CMD</h2>
				
				<div>
					<div class="post-time">2016-11-23</div>
				</div>
				
				<div class="article-content">
				<p><strong>参考</strong>：<br><a href="http://blog.csdn.net/jackwen110200/article/details/52105493" target="_blank" rel="noopener">http://blog.csdn.net/jackwen110200/article/details/52105493</a><br><a href="https://www.zhihu.com/question/20342350" target="_blank" rel="noopener">https://www.zhihu.com/question/20342350</a><br><a href="https://yuguo.us/weblog/javascript-module-development-history/" target="_blank" rel="noopener">https://yuguo.us/weblog/javascript-module-development-history/</a></p>
<ul>
<li><p>JS阻塞浏览器渲染：alert执行时，html一片空白，<span>body</span>并显示，点击确定后才出现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;script type=&quot;text/javascript&quot; src=&quot;main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;span&gt;body&lt;/span&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">main.js:</span><br><span class="line">(function()&#123;alert(&quot;it works&quot;);&#125;)()</span><br></pre></td></tr></table></figure>
</li>
<li><p>body已出现在页面中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;script src=&quot;require.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">	&lt;script&gt;require([&quot;a&quot;]);&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;span&gt;body&lt;/span&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">// a.js: </span><br><span class="line">define(function()&#123;alert(&quot;it works&quot;);&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>CommonJS（服务端）：NodeJS参照CommonJS规范实现模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var math = require(&apos;math&apos;);</span><br><span class="line">math.add(2,3);</span><br></pre></td></tr></table></figure>
</li>
<li><p>AMD（Asynchronous Module Definition）：RequireJS基于AMD实现，CommonJS不适用于浏览器端，因为脚本来自服务端，请求需要时间，如果等待math.js加载完，页面渲染就卡住了，浏览器端不能用同步加载（synchronous），要异步加载（asynchronous）。</p>
</li>
<li><p>AMD也用require()语句加载模块，它要求两个参数：<code>require([module], callback);</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">require([&apos;math&apos;], function (math) &#123;</span><br><span class="line">	math.add(2, 3);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载这个文件，也可能使网页失去响应。</p>
<ul>
<li>一，放网页底部；</li>
<li>二，<code>&lt;script src=&quot;path/to/require.js&quot; defer async&gt;&lt;/script&gt;</code>，async：异步加载。IE只支持defer。</li>
</ul>
</li>
</ul>
<ul>
<li><p>RequireJS：JavaScript模块载入框架，基本功能“模块化加载”</p>
<ul>
<li>防止js加载阻塞页面渲染</li>
<li>可以按需、并行、延时载入js库</li>
<li>声明不同js文件之间的依赖</li>
<li>让代码以模块化方式组织</li>
<li>使用程序调用的方式加载js，防出现如下场景：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;a.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;b.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;c.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>CMD（Common Module Definition）：浏览器实现SeaJS，解决的问题和requireJS一样。</p>
</li>
<li><p>AMD与CMD区别：对依赖模块的执行不同，不是加载方式不同。</p>
<ul>
<li>“requireJS异步加载模块，SeaJS同步加载模块”，实际上不准确，加载模块都是异步的</li>
<li>AMD推崇依赖前置，在定义模块时就要声明其依赖的模块</li>
<li>CMD推崇就近依赖，在用到模块时再require，才知道依赖了哪些模块</li>
<li>requireJS和SeaJS都支持对方的写法</li>
<li>同样都是异步加载模块，AMD在加载模块完成后就会执行改模块，所有模块都加载完后进入回调执行</li>
<li>CMD加载完依赖模块后并不执行，所有依赖模块加载完后进入主逻辑，遇到require语句时才执行</li>
</ul>
</li>
</ul>
<ul>
<li>模块：<ul>
<li>可维护性。</li>
<li>命名空间。</li>
<li>重用代码。</li>
</ul>
</li>
</ul>
<ul>
<li><p>使用匿名函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line"></span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
</li>
<li><p>把全局函数注入到匿名函数，如Query。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(function (globalVariable) &#123;</span><br><span class="line"></span><br><span class="line"> &#125;(globalVariable));</span><br></pre></td></tr></table></figure>
</li>
<li><p>globalVarible 是唯一一个全局的变量。这种做法比完全匿名的闭包的好处是，代码结构更清晰，而且性能更好。</p>
</li>
<li>能够看到函数内部传递进来了全局变量，所以依赖关系非常清晰。</li>
<li>其次在函数内部调用 globalVarible 的时候，解释器能够直接找到局部的 globalVarible，就不用上溯到外部的 globalVarible。</li>
<li>因为是 JavaScript 是引用传值，也可以在函数内，对这个全局的 globalVarible 进行修改。</li>
<li>比如<code>globalVarible = &quot;foo&quot;</code>; 不会改变全局的 globalVarible 对象， 但<code>globalVarible.name =&quot;foo&quot;</code>; 会改变全局的 globalVariable 对象的 name 属性。</li>
</ul>
<ul>
<li>提供一个对象作为接口</li>
<li><p>上面的方式没有区分“私有属性”和“公开属性”。 下面使用一个返回的函数，来指定对象接口，就像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var myGradesCalculate = (function () &#123;</span><br><span class="line"></span><br><span class="line">	var myGrades = [93, 95, 88, 0, 55, 91];</span><br><span class="line"></span><br><span class="line">	return &#123;</span><br><span class="line">		average: function() &#123;</span><br><span class="line"></span><br><span class="line">			var total = myGrades.reduce(function(accumulator, item) &#123;</span><br><span class="line">					return accumulator + item;</span><br><span class="line">				&#125;, 0);</span><br><span class="line">				</span><br><span class="line">			return &apos;Your average grade is &apos; + total / myGrades.length + &apos;.&apos;;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">myGradesCalculate.average();</span><br></pre></td></tr></table></figure>
</li>
<li><p>立即执行的匿名函数返回了一个对象。通过这种方式，我们可以定义 failing() 和 average() 是公开的接口，而 myGrades 是私有属性。</p>
</li>
</ul>
<ul>
<li><p>上一段代码不是很清晰，因为声明跟实现放在一起了，改良成更加清晰的代码，把要公开的属性专门放在一个对象声明中返回：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var myGradesCalculate = (function () &#123;</span><br><span class="line"></span><br><span class="line">	var myGrades = [93, 95, 88, 0, 55, 91];</span><br><span class="line"></span><br><span class="line">	var average = function() &#123;</span><br><span class="line">		var total = myGrades.reduce(function(accumulator, item) &#123;</span><br><span class="line">				return accumulator + item;</span><br><span class="line">			&#125;, 0);</span><br><span class="line"></span><br><span class="line">		return&apos;Your average grade is &apos; + total / myGrades.length + &apos;.&apos;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	return &#123;</span><br><span class="line">		average: average</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">myGradesCalculate.average();</span><br></pre></td></tr></table></figure>
</li>
<li><p>这段代码中，默认所有的变量和方法都是私有的，只有在最后显示 return 一个对象的时候，才选择性暴露出对外接口，接口很清晰。</p>
</li>
</ul>
<ul>
<li><p>CommonJS 和 AMD</p>
<ul>
<li>上面这些方法都有一个共同点：使用一个特定的全局模块名来把一些私有变量和方法包起来，然后通过闭包来创建一个私有的命名空间。</li>
<li>这样也就有一个共同的缺点，就是无法管理不同模块之间的依赖关系。</li>
<li>比如说，如果项目用到了 Backbone.js 库，会把 Backbone.js 的代码引入到项目中。</li>
<li>不过，由于 Backbone 依赖 Underscore.js，所以 Backbone.js 的代码需要放在 Underscore.js 之后。</li>
<li>当依赖的库多起来了，记住这些库应该以什么样的顺序去加载就是一件很头疼的事情了。</li>
<li>另一个明显的缺点是，依次引入这些模块仍然没有解决命名空间冲突的问题。</li>
<li>比如 jQuery 和其他库可能都使用了 $ 来作为暴露的名字，或者引用了同一个模块的两个不同版本怎么办？</li>
<li>幸运的是，有两个已经得到广泛支持的解决方案：CommonJS 和 AMD</li>
<li>CommonJS 最开始是 Mozilla 的工程师于 2009 年开始的一个项目，它的目的是让浏览器之外的 JavaScript （比如服务器端或者桌面端）能够通过模块化的方式来开发和协作。</li>
<li>在 CommonJS 的规范中，每个 JavaScript 文件就是一个独立的模块上下文（module context），在这个上下文中默认创建的属性都是私有的。</li>
<li>也就是说，在一个文件定义的变量（还包括函数和类），都是私有的，对其他文件是不可见的。</li>
<li>推荐的做法是，通过 module.exports 对象来暴露对外的接口。</li>
<li>Node 就采用了 CommonJS 规范来实现模块依赖。</li>
</ul>
</li>
<li><p>创建一个最简单的模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function myModule() &#123;</span><br><span class="line">	this.hello = function() &#123;</span><br><span class="line">		return &apos;hello!&apos;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = myModule;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在定义了自己的 function 之后，通过 module.exports 来暴露了出去。</p>
</li>
<li>为什么可以在没有定义 module 的情况下就使用它？因为 module 是 CommonJS 规范中预先已经定义好的对象，就像 global 一样。</li>
<li><p>如果其他代码想使用 myModule 模块，只需要 require 就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var myModule = require(&apos;myModule&apos;);</span><br><span class="line">var myModuleInstance = new myModule();</span><br><span class="line">myModuleInstance.hello(); // &apos;hello!&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>这种做法有两个明显的优势：</p>
<ul>
<li>避免全局命名空间污染，require 进来的模块可以被赋值到自己随意定义的局部变量中，所以即使是同一个模块的不同版本也可以完美兼容</li>
<li>让各个模块的依赖关系变得很清晰</li>
</ul>
</li>
</ul>
<ul>
<li><p>需要注意的是，CommonJS 规范的主要适用场景是服务器端编程，所以采用同步加载模块的策略。如果我们依赖3个模块，代码会一个一个依次加载它们。</p>
</li>
<li><p>因为服务器端的模块加载主要来源硬盘、或者内存，所以加载速度比较快，同步加载并不是很大问题。但是如果是在浏览器场景中，同步加载就有很大问题，因为从网络中加载一个模块比从硬盘加载慢得多。在等待加载的过程中，浏览器会挂起当前的进程，直到模块下载完成。</p>
</li>
</ul>
<ul>
<li><p>AMD</p>
<ul>
<li>有同步方案，当然也有异步方案。在浏览器端，更常用 AMD 来实现模块化开发。AMD 是 Asynchronous Module Definition 的简称，即“异步模块定义”。</li>
<li>AMD 模块的使用方式：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define([&apos;myModule&apos;, &apos;myOtherModule&apos;], function(myModule, myOtherModule) &#123;</span><br><span class="line">	console.log(myModule.hello());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>ES6 模块</p>
<ul>
<li>上面所有这些模型定义，没有一种是 JavaScript 语言原生支持的。无论是 AMD 还是 CommonJS，这些都是 JavaScript 函数来模拟的，ES6 开始引入了原生的模块功能。</li>
</ul>
</li>
</ul>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
