<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-Gulp高级实例 | 学而时习之</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-Gulp高级实例">
		
		<meta property="og:site_name" content="学而时习之">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">学而时习之</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-Gulp高级实例</h2>
				
				<div>
					<div class="post-time">2016-11-04</div>
				</div>
				
				<div class="article-content">
				<p><strong>2016-11-15更新</strong><br>参考出处：<a href="https://github.com/nimojs/gulp-book" target="_blank" rel="noopener">https://github.com/nimojs/gulp-book</a></p>
<ul>
<li>可以用package.json保存所有 npm install –save-dev gulp-xxx 模块依赖和模块版本。</li>
<li><p>命令行输入<code>npm init</code>，依次要求补全项目信息，可以回车跳过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name: (gulp-demo) </span><br><span class="line">version: (1.0.0) </span><br><span class="line">description: </span><br><span class="line">entry point: (index.js) </span><br><span class="line">test command: </span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Is this ok? (yes)</span><br></pre></td></tr></table></figure>
</li>
<li><p>最终在当前目录中创建 package.json 文件并生成类似代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;name&quot;: &quot;gulp-demo&quot;,</span><br><span class="line">	&quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class="line">	&quot;description&quot;: &quot;&quot;,</span><br><span class="line">	&quot;scripts&quot;: &#123;</span><br><span class="line">		&quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;repository&quot;: &#123;</span><br><span class="line">		&quot;type&quot;: &quot;git&quot;,</span><br><span class="line">		&quot;url&quot;: &quot;https://github.com/nimojs/gulp-demo.git&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;keywords&quot;: [</span><br><span class="line">		&quot;gulp&quot;,</span><br><span class="line">	],</span><br><span class="line">	&quot;author&quot;: &quot;nimojs &lt;nimo.jser@gmail.com&gt;&quot;,</span><br><span class="line">	&quot;license&quot;: &quot;MIT&quot;,</span><br><span class="line">	&quot;bugs&quot;: &#123;</span><br><span class="line">		&quot;url&quot;: &quot;https://github.com/nimojs/gulp-demo/issues&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;homepage&quot;: &quot;https://github.com/nimojs/gulp-demo&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装依赖：安装 gulp 到项目（防止全局 gulp 升级后与此项目 gulpfile.js 代码不兼容）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp --save-dev</span><br><span class="line"></span><br><span class="line">// 此时打开 package.json 会发现多了如下代码</span><br><span class="line">&quot;devDependencies&quot;: &#123;</span><br><span class="line">	&quot;gulp&quot;: &quot;^3.8.11&quot; // 声明此项目的开发依赖 gulp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装其他依赖：<code>npm install gulp-uglify gulp-watch-path stream-combiner2 gulp-sourcemaps gulp-minify-css gulp-autoprefixer gulp-less gulp-ruby-sass gulp-imagemin gulp-util --save-dev</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 此时，package.json 将会更新</span><br><span class="line">&quot;devDependencies&quot;: &#123;</span><br><span class="line">	&quot;colors&quot;: &quot;^1.0.3&quot;,</span><br><span class="line">	&quot;gulp&quot;: &quot;^3.8.11&quot;,</span><br><span class="line">	&quot;gulp-autoprefixer&quot;: &quot;^2.1.0&quot;,</span><br><span class="line">	&quot;gulp-imagemin&quot;: &quot;^2.2.1&quot;,</span><br><span class="line">	&quot;gulp-less&quot;: &quot;^3.0.2&quot;,</span><br><span class="line">	&quot;gulp-minify-css&quot;: &quot;^1.0.0&quot;,</span><br><span class="line">	&quot;gulp-ruby-sass&quot;: &quot;^1.0.1&quot;,</span><br><span class="line">	&quot;gulp-sourcemaps&quot;: &quot;^1.5.1&quot;,</span><br><span class="line">	&quot;gulp-uglify&quot;: &quot;^1.1.0&quot;,</span><br><span class="line">	&quot;gulp-watch-path&quot;: &quot;^0.0.7&quot;,</span><br><span class="line">	&quot;stream-combiner2&quot;: &quot;^1.0.2&quot;</span><br><span class="line">&#125;</span><br><span class="line">// 当分享这份gulpfile.js 配置时，不需要发送node_modules/</span><br><span class="line">// 只需在命令行输入`npm install`就可以检测 package.json 中的 devDependencies 并安装所有依赖。</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件分为2类，一类是源码，一类是编译压缩后的版本。文件夹分别为src和dist。(注意区分dist 和dest)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">└── src/</span><br><span class="line">│</span><br><span class="line">└── dist/</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 src/ 下创建前端资源对应的的文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">└── src/</span><br><span class="line">├── less/    *.less 文件</span><br><span class="line">├── sass/    *.scss *.sass 文件</span><br><span class="line">├── css/     *.css  文件</span><br><span class="line">├── js/      *.js 文件</span><br><span class="line">├── fonts/   字体文件</span><br><span class="line">└── images/   图片</span><br><span class="line">└── dist/</span><br></pre></td></tr></table></figure>
</li>
<li><p>让命令行输出的文字带颜色：gulp 自带的输出都带时间和颜色。利用 gulp-util 实现同样效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var gulp = require(&apos;gulp&apos;);</span><br><span class="line">var gutil = require(&apos;gulp-util&apos;);</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;default&apos;, function () &#123;</span><br><span class="line">	gutil.log(&apos;message&apos;)</span><br><span class="line">	gutil.log(gutil.colors.red(&apos;error&apos;))</span><br><span class="line">	gutil.log(gutil.colors.green(&apos;message:&apos;) + &quot;some&quot;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>gulp-uglify：检测src/js/目录下的 js 文件修改后，压缩 js/ 中所有 js 文件并输出到 dist/js/ 中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var uglify = require(&apos;gulp-uglify&apos;);</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;uglifyjs&apos;, function () &#123;</span><br><span class="line">	gulp.src(&apos;src/js/**/*.js&apos;)</span><br><span class="line">		.pipe(uglify())</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/js&apos;))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;default&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/js/**/*.js&apos;, [&apos;uglifyjs&apos;])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>命令行输入 gulp 后会出现如下消息，表示已经启动。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[20:39:50] Using gulpfile ~/Documents/code/gulp-book/demo/chapter7/gulpfile.js</span><br><span class="line">[20:39:50] Starting &apos;default&apos;...</span><br><span class="line">[20:39:50] Finished &apos;default&apos; after 13 ms</span><br><span class="line"></span><br><span class="line">// 此时编辑 src/js/log.js 文件并保存，命令行会出现如下消息，表示检测到 src/js/**/*.js 文件修改后重新编译所有 js。</span><br><span class="line">[20:39:52] Starting &apos;js&apos;...</span><br><span class="line">[20:39:52] Finished &apos;js&apos; after 14 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>此配置有性能问题，当 gulp.watch 检测到 src/js/目录下的js文件有修改时会将所有文件全部编译。实际上只需重新编译被修改的文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// gulp.watch第二个参数为function </span><br><span class="line">gulp.watch(&apos;src/js/**/*.js&apos;, function (event) &#123;</span><br><span class="line">	console.log(event);</span><br><span class="line">	event &#123;</span><br><span class="line">		// 不管是添加，改变或是删除</span><br><span class="line">		type: &apos;changed&apos;, </span><br><span class="line">		// 触发事件的文件路径</span><br><span class="line">		path: &apos;/Users/nimojs/Documents/code/gulp-book/demo/chapter7/src/js/log.js&apos;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">// 利用event检测某个js 文件被修改</span><br></pre></td></tr></table></figure>
</li>
<li><p>gulp-watch-path 配合 event 获取编译路径和输出路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">var watchPath = require(&apos;gulp-watch-path&apos;);</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;watchjs&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/js/**/*.js&apos;, function (event) &#123;</span><br><span class="line">		var paths = watchPath(event, &apos;src/&apos;, &apos;dist/&apos;);</span><br><span class="line">		/*</span><br><span class="line">		paths &#123; </span><br><span class="line">			srcPath: &apos;src/js/log.js&apos;,</span><br><span class="line">			srcDir: &apos;src/js/&apos;,</span><br><span class="line">			distPath: &apos;dist/js/log.js&apos;,</span><br><span class="line">			distDir: &apos;dist/js/&apos;,</span><br><span class="line">			srcFilename: &apos;log.js&apos;,</span><br><span class="line">			distFilename: &apos;log.js&apos; </span><br><span class="line">		&#125;</span><br><span class="line">		*/</span><br><span class="line">		gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath);</span><br><span class="line">		gutil.log(&apos;Dist &apos; + paths.distPath);</span><br><span class="line"></span><br><span class="line">		gulp.src(paths.srcPath)</span><br><span class="line">			.pipe(uglify())</span><br><span class="line">			.pipe(gulp.dest(paths.distDir))</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">/*</span><br><span class="line">watchPath(event, search, replace, distExt)</span><br><span class="line">event：gulp.watch回调函数的event</span><br><span class="line">search：需要被替换的起始字符串</span><br><span class="line">replace	：第三个参数是新的的字符串</span><br><span class="line">distExt：扩展名(非必填)</span><br><span class="line">*/</span><br><span class="line">gulp.task(&apos;default&apos;, [&apos;watchjs&apos;]);</span><br><span class="line"></span><br><span class="line">// 此时编辑 src/js/log.js 文件并保存，命令行会出现消息，表示检测到 src/js/log.js 文件修改后只重新编译 log.js。</span><br><span class="line">[21:47:25] changed src/js/log.js</span><br><span class="line">[21:47:25] Dist dist/js/log.js</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑 log.js 文件时，如果文件有语法错误时，gulp会终止运行并报错。使用stream-combiner2 捕获错误信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// 当 log.js 缺少` )`</span><br><span class="line">log(&apos;gulp-book&apos;</span><br><span class="line"></span><br><span class="line">var handleError = function (err) &#123;</span><br><span class="line">	var colors = gutil.colors;</span><br><span class="line">	console.log(&apos;\n&apos;)</span><br><span class="line">	gutil.log(colors.red(&apos;Error!&apos;))</span><br><span class="line">	gutil.log(&apos;fileName: &apos; + colors.red(err.fileName))</span><br><span class="line">	gutil.log(&apos;lineNumber: &apos; + colors.red(err.lineNumber))</span><br><span class="line">	gutil.log(&apos;message: &apos; + err.message)</span><br><span class="line">	gutil.log(&apos;plugin: &apos; + colors.yellow(err.plugin))</span><br><span class="line">&#125;</span><br><span class="line">var combiner = require(&apos;stream-combiner2&apos;);</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;watchjs&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/js/**/*.js&apos;, function (event) &#123;</span><br><span class="line">		var paths = watchPath(event, &apos;src/&apos;, &apos;dist/&apos;)</span><br><span class="line">		/*</span><br><span class="line">		paths</span><br><span class="line">		&#123; srcPath: &apos;src/js/log.js&apos;,</span><br><span class="line">		srcDir: &apos;src/js/&apos;,</span><br><span class="line">		distPath: &apos;dist/js/log.js&apos;,</span><br><span class="line">		distDir: &apos;dist/js/&apos;,</span><br><span class="line">		srcFilename: &apos;log.js&apos;,</span><br><span class="line">		distFilename: &apos;log.js&apos; &#125;</span><br><span class="line">		*/</span><br><span class="line">		gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath)</span><br><span class="line">		gutil.log(&apos;Dist &apos; + paths.distPath)</span><br><span class="line">		var combined = combiner.obj([</span><br><span class="line">			gulp.src(paths.srcPath),</span><br><span class="line">			uglify(),</span><br><span class="line">			gulp.dest(paths.distDir)</span><br><span class="line">		])</span><br><span class="line">		combined.on(&apos;error&apos;, handleError)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 此时当编译错误的语法时，命令行会出现错误提示。而且不会让 gulp 停止运行。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 压缩前</span><br><span class="line">var log = function (msg) &#123;</span><br><span class="line">	console.log(&apos;--------&apos;);</span><br><span class="line">	console.log(msg)</span><br><span class="line">	console.log(&apos;--------&apos;);</span><br><span class="line">&#125;</span><br><span class="line">log(&#123;a:1&#125;)</span><br><span class="line">log(&apos;gulp-book&apos;)</span><br><span class="line"></span><br><span class="line">// 压缩后</span><br><span class="line">var log=function(o)&#123;console.log(&quot;--------&quot;),console.log(o),console.log(&quot;--------&quot;)&#125;;log(&#123;a:1&#125;),log(&quot;gulp-book&quot;);</span><br><span class="line"></span><br><span class="line">// 压缩后的代码不存在换行符和空白符，可以使用sourcemap帮助调试</span><br><span class="line"></span><br><span class="line">var sourcemaps = require(&apos;gulp-sourcemaps&apos;)</span><br><span class="line">// ...</span><br><span class="line">var combined = combiner.obj([</span><br><span class="line">	gulp.src(paths.srcPath),</span><br><span class="line">	sourcemaps.init(),</span><br><span class="line">	uglify(),</span><br><span class="line">	sourcemaps.write(&apos;./&apos;),</span><br><span class="line">	gulp.dest(paths.distDir)</span><br><span class="line">])</span><br><span class="line">// ...</span><br><span class="line">// 此时 dist/js/ 中也会生成对应的 .map 文件，以便用 Chrome 控制台调试代码。</span><br></pre></td></tr></table></figure>
<ul>
<li><p>有时需要一次编译所有 js 文件。可以配置 uglifyjs 任务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(&apos;uglifyjs&apos;, function () &#123;</span><br><span class="line">	var combined = combiner.obj([</span><br><span class="line">		gulp.src(&apos;src/js/**/*.js&apos;),</span><br><span class="line">		sourcemaps.init(),</span><br><span class="line">		uglify(),</span><br><span class="line">		sourcemaps.write(&apos;./&apos;),</span><br><span class="line">		gulp.dest(&apos;dist/js/&apos;)</span><br><span class="line">	])</span><br><span class="line">	combined.on(&apos;error&apos;, handleError)</span><br><span class="line">&#125;)</span><br><span class="line">// 命令行输入 gulp uglifyjs 以压缩 src/js/ 下的所有 js 文件。</span><br></pre></td></tr></table></figure>
</li>
<li><p>不使用LESS或SASS直接编写CSS，但要压缩CSS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var minifycss = require(&apos;gulp-minify-css&apos;);</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;watchcss&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/css/**/*.css&apos;, function (event) &#123;</span><br><span class="line">		var paths = watchPath(event, &apos;src/&apos;, &apos;dist/&apos;)</span><br><span class="line">		gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath)</span><br><span class="line">		gutil.log(&apos;Dist &apos; + paths.distPath)</span><br><span class="line">		gulp.src(paths.srcPath)</span><br><span class="line">			.pipe(sourcemaps.init())</span><br><span class="line">			.pipe(minifycss())</span><br><span class="line">			.pipe(sourcemaps.write(&apos;./&apos;))</span><br><span class="line">			.pipe(gulp.dest(paths.distDir))</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;default&apos;, [&apos;watchjs&apos;,&apos;watchcss&apos;])</span><br></pre></td></tr></table></figure>
</li>
<li><p>autoprefixer：解析CSS文件并且添加浏览器前缀到CSS规则里。只需编写标准语法css，autoprefixer会自动补全。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 处理前：</span><br><span class="line">.demo &#123;</span><br><span class="line">	display:flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 处理后：</span><br><span class="line">.demo &#123;</span><br><span class="line">	display:-webkit-flex;</span><br><span class="line">	display:-ms-flexbox;</span><br><span class="line">	display:flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 watchcss 任务中加入 autoprefixer:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(&apos;watchcss&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/css/**/*.css&apos;, function (event) &#123;</span><br><span class="line">		var paths = watchPath(event, &apos;src/&apos;, &apos;dist/&apos;)</span><br><span class="line">		gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath)</span><br><span class="line">		gutil.log(&apos;Dist &apos; + paths.distPath)</span><br><span class="line">		gulp.src(paths.srcPath)</span><br><span class="line">			.pipe(sourcemaps.init())</span><br><span class="line">			.pipe(autoprefixer(&#123;</span><br><span class="line">				browsers: &apos;last 2 versions&apos;</span><br><span class="line">			&#125;))</span><br><span class="line">			.pipe(minifycss())</span><br><span class="line">			.pipe(sourcemaps.write(&apos;./&apos;))</span><br><span class="line">			.pipe(gulp.dest(paths.distDir))</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>一次编译所有 css 文件。可以配置 minifyss 任务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(&apos;minifycss&apos;, function () &#123;</span><br><span class="line">	gulp.src(&apos;src/css/**/*.css&apos;)</span><br><span class="line">		.pipe(sourcemaps.init())</span><br><span class="line">		.pipe(autoprefixer(&#123;</span><br><span class="line">			browsers: &apos;last 2 versions&apos;</span><br><span class="line">		&#125;))</span><br><span class="line">		.pipe(minifycss())</span><br><span class="line">		.pipe(sourcemaps.write(&apos;./&apos;))</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/css/&apos;))</span><br><span class="line">&#125;)</span><br><span class="line">// 命令行输入 gulp minifyss 以压缩 src/css/ 下的所有 .css 文件并复制到 dist/css 目录下</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>配置 Less 任务</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">var less = require(&apos;gulp-less&apos;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;watchless&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/less/**/*.less&apos;, function (event) &#123;</span><br><span class="line">	var paths = watchPath(event, &apos;src/less/&apos;, &apos;dist/css/&apos;)</span><br><span class="line">	gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath)</span><br><span class="line">	gutil.log(&apos;Dist &apos; + paths.distPath)</span><br><span class="line">	var combined = combiner.obj([</span><br><span class="line">		gulp.src(paths.srcPath),</span><br><span class="line">		sourcemaps.init(),</span><br><span class="line">		autoprefixer(&#123;</span><br><span class="line">			browsers: &apos;last 2 versions&apos;</span><br><span class="line">		&#125;),</span><br><span class="line">		less(),</span><br><span class="line">		minifycss(),</span><br><span class="line">		sourcemaps.write(&apos;./&apos;),</span><br><span class="line">		gulp.dest(paths.distDir)</span><br><span class="line">	])</span><br><span class="line">	combined.on(&apos;error&apos;, handleError)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;lesscss&apos;, function () &#123;</span><br><span class="line">	var combined = combiner.obj([</span><br><span class="line">		gulp.src(&apos;src/less/**/*.less&apos;),</span><br><span class="line">		sourcemaps.init(),</span><br><span class="line">		autoprefixer(&#123;</span><br><span class="line">			browsers: &apos;last 2 versions&apos;</span><br><span class="line">		&#125;),</span><br><span class="line">		less(),</span><br><span class="line">		minifycss(),</span><br><span class="line">		sourcemaps.write(&apos;./&apos;),</span><br><span class="line">		gulp.dest(&apos;dist/css/&apos;)</span><br><span class="line">	])</span><br><span class="line">	combined.on(&apos;error&apos;, handleError)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;default&apos;, [&apos;watchjs&apos;, &apos;watchcss&apos;, &apos;watchless&apos;])</span><br></pre></td></tr></table></figure></p>
<p><strong>配置 Sass 任务</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(&apos;watchsass&apos;,function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/sass/**/*&apos;, function (event) &#123;</span><br><span class="line">	var paths = watchPath(event, &apos;src/sass/&apos;, &apos;dist/css/&apos;)</span><br><span class="line">	gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath)</span><br><span class="line">	gutil.log(&apos;Dist &apos; + paths.distPath)</span><br><span class="line">	sass(paths.srcPath)</span><br><span class="line">		.on(&apos;error&apos;, function (err) &#123;</span><br><span class="line">			console.error(&apos;Error!&apos;, err.message);</span><br><span class="line">		&#125;)</span><br><span class="line">		.pipe(sourcemaps.init())</span><br><span class="line">		.pipe(minifycss())</span><br><span class="line">		.pipe(autoprefixer(&#123;</span><br><span class="line">			browsers: &apos;last 2 versions&apos;</span><br><span class="line">		&#125;))</span><br><span class="line">		.pipe(sourcemaps.write(&apos;./&apos;))</span><br><span class="line">		.pipe(gulp.dest(paths.distDir))</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;sasscss&apos;, function () &#123;</span><br><span class="line">	sass(&apos;src/sass/&apos;)</span><br><span class="line">		.on(&apos;error&apos;, function (err) &#123;</span><br><span class="line">			console.error(&apos;Error!&apos;, err.message);</span><br><span class="line">		&#125;)</span><br><span class="line">		.pipe(sourcemaps.init())</span><br><span class="line">		.pipe(minifycss())</span><br><span class="line">		.pipe(autoprefixer(&#123;</span><br><span class="line">			browsers: &apos;last 2 versions&apos;</span><br><span class="line">		&#125;))</span><br><span class="line">		.pipe(sourcemaps.write(&apos;./&apos;))</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/css&apos;))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;default&apos;, [&apos;watchjs&apos;, &apos;watchcss&apos;, &apos;watchless&apos;, &apos;watchsass&apos;, &apos;watchsass&apos;])</span><br></pre></td></tr></table></figure></p>
<p><strong>配置 image 任务</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var imagemin = require(&apos;gulp-imagemin&apos;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;watchimage&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/images/**/*&apos;, function (event) &#123;</span><br><span class="line">		var paths = watchPath(event,&apos;src/&apos;,&apos;dist/&apos;)</span><br><span class="line"></span><br><span class="line">		gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath)</span><br><span class="line">		gutil.log(&apos;Dist &apos; + paths.distPath)</span><br><span class="line"></span><br><span class="line">		gulp.src(paths.srcPath)</span><br><span class="line">			.pipe(imagemin(&#123;</span><br><span class="line">				progressive: true</span><br><span class="line">			&#125;))</span><br><span class="line">			.pipe(gulp.dest(paths.distDir))</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;image&apos;, function () &#123;</span><br><span class="line">	gulp.src(&apos;src/images/**/*&apos;)</span><br><span class="line">		.pipe(imagemin(&#123;</span><br><span class="line">			progressive: true</span><br><span class="line">		&#125;))</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/images&apos;))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p><strong>配置文件复制任务</strong>：复制 src/fonts/ 文件到 dist/ 中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(&apos;watchcopy&apos;, function () &#123;</span><br><span class="line">	gulp.watch(&apos;src/fonts/**/*&apos;, function (event) &#123;</span><br><span class="line">	var paths = watchPath(event)</span><br><span class="line"></span><br><span class="line">	gutil.log(gutil.colors.green(event.type) + &apos; &apos; + paths.srcPath)</span><br><span class="line">	gutil.log(&apos;Dist &apos; + paths.distPath)</span><br><span class="line"></span><br><span class="line">	gulp.src(paths.srcPath)</span><br><span class="line">		.pipe(gulp.dest(paths.distDir))</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;copy&apos;, function () &#123;</span><br><span class="line">	gulp.src(&apos;src/fonts/**/*&apos;)</span><br><span class="line">		.pipe(gulp.dest(&apos;dist/fonts/&apos;))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;default&apos;, [&apos;watchjs&apos;, &apos;watchcss&apos;, &apos;watchless&apos;, &apos;watchsass&apos;, &apos;watchimage&apos;, &apos;watchcopy&apos;])</span><br></pre></td></tr></table></figure></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
