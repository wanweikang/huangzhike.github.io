<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
				<script>var timeStart = new Date();</script>
		
		<title>[笔记]-Gulp高级实例 | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="用手记笔记，用心记笔记，用脑记笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-Gulp高级实例"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

		    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-Gulp高级实例</h2>
				
				<div>
					<span class="post-time">2016-11-04 18:12:22</span>
				</div>	
				
				<div class="article-content">
				<p><strong>2016-11-15更新</strong><br>参考出处：<a href="https://github.com/nimojs/gulp-book" target="_blank" rel="external">https://github.com/nimojs/gulp-book</a></p>
<ul>
<li>可以用package.json保存所有 npm install –save-dev gulp-xxx 模块依赖和模块版本。</li>
<li><p>命令行输入<code>npm init</code>，依次要求补全项目信息，可以回车跳过</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">name: (gulp-demo) </div><div class="line">version: (1.0.0) </div><div class="line">description: </div><div class="line">entry point: (index.js) </div><div class="line"><span class="keyword">test </span>command: </div><div class="line">...</div><div class="line">...</div><div class="line">Is this ok? (yes)</div></pre></td></tr></table></figure>
</li>
<li><p>最终在当前目录中创建 package.json 文件并生成类似代码：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="attr">"name"</span>: <span class="string">"gulp-demo"</span>,</div><div class="line">	<span class="attr">"version"</span>: <span class="string">"0.0.0"</span>,</div><div class="line">	<span class="attr">"description"</span>: <span class="string">""</span>,</div><div class="line">	<span class="attr">"scripts"</span>: &#123;</div><div class="line">		<span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attr">"repository"</span>: &#123;</div><div class="line">		<span class="attr">"type"</span>: <span class="string">"git"</span>,</div><div class="line">		<span class="attr">"url"</span>: <span class="string">"https://github.com/nimojs/gulp-demo.git"</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attr">"keywords"</span>: [</div><div class="line">		<span class="string">"gulp"</span>,</div><div class="line">	],</div><div class="line">	<span class="attr">"author"</span>: <span class="string">"nimojs &lt;nimo.jser@gmail.com&gt;"</span>,</div><div class="line">	<span class="attr">"license"</span>: <span class="string">"MIT"</span>,</div><div class="line">	<span class="attr">"bugs"</span>: &#123;</div><div class="line">		<span class="attr">"url"</span>: <span class="string">"https://github.com/nimojs/gulp-demo/issues"</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attr">"homepage"</span>: <span class="string">"https://github.com/nimojs/gulp-demo"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>安装依赖：安装 gulp 到项目（防止全局 gulp 升级后与此项目 gulpfile.js 代码不兼容）</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">npm install gulp --<span class="built_in">save</span>-<span class="built_in">dev</span></div><div class="line"></div><div class="line"><span class="comment">// 此时打开 package.json 会发现多了如下代码</span></div><div class="line"><span class="string">"devDependencies"</span>: &#123;</div><div class="line">	<span class="string">"gulp"</span>: <span class="string">"^3.8.11"</span> <span class="comment">// 声明此项目的开发依赖 gulp</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>安装其他依赖：<code>npm install gulp-uglify gulp-watch-path stream-combiner2 gulp-sourcemaps gulp-minify-css gulp-autoprefixer gulp-less gulp-ruby-sass gulp-imagemin gulp-util --save-dev</code></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 此时，package.json 将会更新</span></div><div class="line"><span class="string">"devDependencies"</span>: &#123;</div><div class="line">	<span class="string">"colors"</span>: <span class="string">"^1.0.3"</span>,</div><div class="line">	<span class="string">"gulp"</span>: <span class="string">"^3.8.11"</span>,</div><div class="line">	<span class="string">"gulp-autoprefixer"</span>: <span class="string">"^2.1.0"</span>,</div><div class="line">	<span class="string">"gulp-imagemin"</span>: <span class="string">"^2.2.1"</span>,</div><div class="line">	<span class="string">"gulp-less"</span>: <span class="string">"^3.0.2"</span>,</div><div class="line">	<span class="string">"gulp-minify-css"</span>: <span class="string">"^1.0.0"</span>,</div><div class="line">	<span class="string">"gulp-ruby-sass"</span>: <span class="string">"^1.0.1"</span>,</div><div class="line">	<span class="string">"gulp-sourcemaps"</span>: <span class="string">"^1.5.1"</span>,</div><div class="line">	<span class="string">"gulp-uglify"</span>: <span class="string">"^1.1.0"</span>,</div><div class="line">	<span class="string">"gulp-watch-path"</span>: <span class="string">"^0.0.7"</span>,</div><div class="line">	<span class="string">"stream-combiner2"</span>: <span class="string">"^1.0.2"</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 当分享这份gulpfile.js 配置时，不需要发送node_modules/</span></div><div class="line"><span class="comment">// 只需在命令行输入`npm install`就可以检测 package.json 中的 devDependencies 并安装所有依赖。</span></div></pre></td></tr></table></figure>
</li>
<li><p>文件分为2类，一类是源码，一类是编译压缩后的版本。文件夹分别为src和dist。(注意区分dist 和dest)</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">└── src/</div><div class="line">│</div><div class="line">└── <span class="built_in">dist</span>/</div></pre></td></tr></table></figure>
</li>
<li><p>在 src/ 下创建前端资源对应的的文件夹</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">└── src/</div><div class="line">├── less/    *<span class="selector-class">.less</span> 文件</div><div class="line">├── sass/    *<span class="selector-class">.scss</span> *<span class="selector-class">.sass</span> 文件</div><div class="line">├── css/     *<span class="selector-class">.css</span>  文件</div><div class="line">├── js/      *<span class="selector-class">.js</span> 文件</div><div class="line">├── fonts/   字体文件</div><div class="line">└── images/   图片</div><div class="line">└── dist/</div></pre></td></tr></table></figure>
</li>
<li><p>让命令行输出的文字带颜色：gulp 自带的输出都带时间和颜色。利用 gulp-util 实现同样效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</div><div class="line"><span class="keyword">var</span> gutil = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	gutil.log(<span class="string">'message'</span>)</div><div class="line">	gutil.log(gutil.colors.red(<span class="string">'error'</span>))</div><div class="line">	gutil.log(gutil.colors.green(<span class="string">'message:'</span>) + <span class="string">"some"</span>)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>gulp-uglify：检测src/js/目录下的 js 文件修改后，压缩 js/ 中所有 js 文件并输出到 dist/js/ 中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'uglifyjs'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	gulp.src(<span class="string">'src/js/**/*.js'</span>)</div><div class="line">		.pipe(uglify())</div><div class="line">		.pipe(gulp.dest(<span class="string">'dist/js'</span>))</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	gulp.watch(<span class="string">'src/js/**/*.js'</span>, [<span class="string">'uglifyjs'</span>])</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>命令行输入 gulp 后会出现如下消息，表示已经启动。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="name">20:39:50</span>] Using gulpfile ~/Documents/code/gulp-book/demo/chapter7/gulpfile.js</div><div class="line">[<span class="name">20:39:50</span>] Starting <span class="symbol">'default</span><span class="symbol">'...</span></div><div class="line">[<span class="name">20:39:50</span>] Finished <span class="symbol">'default</span>' after <span class="number">13</span> ms</div><div class="line"></div><div class="line">// 此时编辑 src/js/log.js 文件并保存，命令行会出现如下消息，表示检测到 src/js/**/*.js 文件修改后重新编译所有 js。</div><div class="line">[<span class="name">20:39:52</span>] Starting <span class="symbol">'js</span><span class="symbol">'...</span></div><div class="line">[<span class="name">20:39:52</span>] Finished <span class="symbol">'js</span>' after <span class="number">14</span> ms</div></pre></td></tr></table></figure>
</li>
<li><p>此配置有性能问题，当 gulp.watch 检测到 src/js/目录下的js文件有修改时会将所有文件全部编译。实际上只需重新编译被修改的文件。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// gulp.watch第二个参数为function </span></div><div class="line"><span class="selector-tag">gulp</span><span class="selector-class">.watch</span>(<span class="string">'src/js/**/*.js'</span>, function (event) &#123;</div><div class="line">	<span class="selector-tag">console</span><span class="selector-class">.log</span>(event);</div><div class="line">	<span class="selector-tag">event</span> &#123;</div><div class="line">		<span class="comment">// 不管是添加，改变或是删除</span></div><div class="line">		<span class="attribute">type</span>: <span class="string">'changed'</span>, </div><div class="line">		<span class="comment">// 触发事件的文件路径</span></div><div class="line">		<span class="attribute">path</span>: <span class="string">'/Users/nimojs/Documents/code/gulp-book/demo/chapter7/src/js/log.js'</span></div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 利用event检测某个js 文件被修改</span></div></pre></td></tr></table></figure>
</li>
<li><p>gulp-watch-path 配合 event 获取编译路径和输出路径。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">var watchPath = <span class="built_in">require</span>(<span class="string">'gulp-watch-path'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'watchjs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span></span> &#123;</div><div class="line">	gulp.watch(<span class="string">'src/js/**/*.js'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(event)</span></span> &#123;</div><div class="line">		var paths = watchPath(event, <span class="string">'src/'</span>, <span class="string">'dist/'</span>);</div><div class="line">		/*</div><div class="line">		paths &#123; </div><div class="line">			srcPath: <span class="string">'src/js/log.js'</span>,</div><div class="line">			srcDir: <span class="string">'src/js/'</span>,</div><div class="line">			distPath: <span class="string">'dist/js/log.js'</span>,</div><div class="line">			distDir: <span class="string">'dist/js/'</span>,</div><div class="line">			srcFilename: <span class="string">'log.js'</span>,</div><div class="line">			distFilename: <span class="string">'log.js'</span> </div><div class="line">		&#125;</div><div class="line">		*/</div><div class="line">		gutil.log(gutil.colors.green(event.<span class="built_in">type</span>) + <span class="string">' '</span> + paths.srcPath);</div><div class="line">		gutil.log(<span class="string">'Dist '</span> + paths.distPath);</div><div class="line"></div><div class="line">		gulp.src(paths.srcPath)</div><div class="line">			.pipe(uglify())</div><div class="line">			.pipe(gulp.dest(paths.distDir))</div><div class="line">	&#125;);</div><div class="line">&#125;);</div><div class="line">/*</div><div class="line">watchPath(event, search, replace, distExt)</div><div class="line">event：gulp.watch回调函数的event</div><div class="line">search：需要被替换的起始字符串</div><div class="line">replace	：第三个参数是新的的字符串</div><div class="line">distExt：扩展名(非必填)</div><div class="line">*/</div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'watchjs'</span>]);</div><div class="line"></div><div class="line">// 此时编辑 src/js/log.js 文件并保存，命令行会出现消息，表示检测到 src/js/log.js 文件修改后只重新编译 log.js。</div><div class="line">[<span class="number">21</span>:<span class="number">47</span>:<span class="number">25</span>] changed src/js/log.js</div><div class="line">[<span class="number">21</span>:<span class="number">47</span>:<span class="number">25</span>] Dist dist/js/log.js</div></pre></td></tr></table></figure>
</li>
<li><p>编辑 log.js 文件时，如果文件有语法错误时，gulp会终止运行并报错。使用stream-combiner2 捕获错误信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 当 log.js 缺少` )`</span></div><div class="line">log(<span class="string">'gulp-book'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> handleError = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> colors = gutil.colors;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'\n'</span>)</div><div class="line">	gutil.log(colors.red(<span class="string">'Error!'</span>))</div><div class="line">	gutil.log(<span class="string">'fileName: '</span> + colors.red(err.fileName))</div><div class="line">	gutil.log(<span class="string">'lineNumber: '</span> + colors.red(err.lineNumber))</div><div class="line">	gutil.log(<span class="string">'message: '</span> + err.message)</div><div class="line">	gutil.log(<span class="string">'plugin: '</span> + colors.yellow(err.plugin))</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> combiner = <span class="built_in">require</span>(<span class="string">'stream-combiner2'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'watchjs'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	gulp.watch(<span class="string">'src/js/**/*.js'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> paths = watchPath(event, <span class="string">'src/'</span>, <span class="string">'dist/'</span>)</div><div class="line">		<span class="comment">/*</span></div><div class="line">		paths</div><div class="line">		&#123; srcPath: 'src/js/log.js',</div><div class="line">		srcDir: 'src/js/',</div><div class="line">		distPath: 'dist/js/log.js',</div><div class="line">		distDir: 'dist/js/',</div><div class="line">		srcFilename: 'log.js',</div><div class="line">		distFilename: 'log.js' &#125;</div><div class="line">		*/</div><div class="line">		gutil.log(gutil.colors.green(event.type) + <span class="string">' '</span> + paths.srcPath)</div><div class="line">		gutil.log(<span class="string">'Dist '</span> + paths.distPath)</div><div class="line">		<span class="keyword">var</span> combined = combiner.obj([</div><div class="line">			gulp.src(paths.srcPath),</div><div class="line">			uglify(),</div><div class="line">			gulp.dest(paths.distDir)</div><div class="line">		])</div><div class="line">		combined.on(<span class="string">'error'</span>, handleError)</div><div class="line">	&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 此时当编译错误的语法时，命令行会出现错误提示。而且不会让 gulp 停止运行。</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 压缩前</span></div><div class="line"><span class="keyword">var</span> log = <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'--------'</span>);</div><div class="line">	<span class="built_in">console</span>.log(msg)</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'--------'</span>);</div><div class="line">&#125;</div><div class="line">log(&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;)</div><div class="line">log(<span class="string">'gulp-book'</span>)</div><div class="line"></div><div class="line"><span class="comment">// 压缩后</span></div><div class="line"><span class="keyword">var</span> log=<span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"--------"</span>),<span class="built_in">console</span>.log(o),<span class="built_in">console</span>.log(<span class="string">"--------"</span>)&#125;;log(&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;),log(<span class="string">"gulp-book"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 压缩后的代码不存在换行符和空白符，可以使用sourcemap帮助调试</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> sourcemaps = <span class="built_in">require</span>(<span class="string">'gulp-sourcemaps'</span>)</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keyword">var</span> combined = combiner.obj([</div><div class="line">	gulp.src(paths.srcPath),</div><div class="line">	sourcemaps.init(),</div><div class="line">	uglify(),</div><div class="line">	sourcemaps.write(<span class="string">'./'</span>),</div><div class="line">	gulp.dest(paths.distDir)</div><div class="line">])</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="comment">// 此时 dist/js/ 中也会生成对应的 .map 文件，以便用 Chrome 控制台调试代码。</span></div></pre></td></tr></table></figure>
<ul>
<li><p>有时需要一次编译所有 js 文件。可以配置 uglifyjs 任务。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'uglifyjs'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">var</span> combined = combiner.obj([</div><div class="line">		gulp.src(<span class="string">'src/js/**/*.js'</span>),</div><div class="line">		sourcemaps.init(),</div><div class="line">		uglify(),</div><div class="line">		sourcemaps.write(<span class="string">'./'</span>),</div><div class="line">		gulp.dest(<span class="string">'dist/js/'</span>)</div><div class="line">	])</div><div class="line">	combined.on(<span class="string">'error'</span>, handleError)</div><div class="line">&#125;)</div><div class="line"><span class="comment">// 命令行输入 gulp uglifyjs 以压缩 src/js/ 下的所有 js 文件。</span></div></pre></td></tr></table></figure>
</li>
<li><p>不使用LESS或SASS直接编写CSS，但要压缩CSS</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>);</div><div class="line"></div><div class="line">gulp.task(<span class="string">'watchcss'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	gulp.watch(<span class="string">'src/css/**/*.css'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> paths = watchPath(event, <span class="string">'src/'</span>, <span class="string">'dist/'</span>)</div><div class="line">		gutil.log(gutil.colors.green(event.type) + <span class="string">' '</span> + paths.srcPath)</div><div class="line">		gutil.log(<span class="string">'Dist '</span> + paths.distPath)</div><div class="line">		gulp.src(paths.srcPath)</div><div class="line">			.pipe(sourcemaps.init())</div><div class="line">			.pipe(minifycss())</div><div class="line">			.pipe(sourcemaps.write(<span class="string">'./'</span>))</div><div class="line">			.pipe(gulp.dest(paths.distDir))</div><div class="line">	&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'watchjs'</span>,<span class="string">'watchcss'</span>])</div></pre></td></tr></table></figure>
</li>
<li><p>autoprefixer：解析CSS文件并且添加浏览器前缀到CSS规则里。只需编写标准语法css，autoprefixer会自动补全。 </p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 处理前：</span></div><div class="line"><span class="selector-class">.demo</span> &#123;</div><div class="line">	<span class="attribute">display</span>:flex;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 处理后：</span></div><div class="line"><span class="selector-class">.demo</span> &#123;</div><div class="line">	<span class="attribute">display</span>:-webkit-flex;</div><div class="line">	<span class="attribute">display</span>:-ms-flexbox;</div><div class="line">	<span class="attribute">display</span>:flex;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>在 watchcss 任务中加入 autoprefixer:</p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'watchcss'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">	gulp.watch(<span class="string">'src/css/**/*.css'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> &#123;</span></div><div class="line">		var paths = watchPath(event, <span class="string">'src/'</span>, <span class="string">'dist/'</span>)</div><div class="line">		gutil.<span class="built_in">log</span>(gutil.colors.green(event.<span class="built_in">type</span>) + <span class="string">' '</span> + paths.srcPath)</div><div class="line">		gutil.<span class="built_in">log</span>(<span class="string">'Dist '</span> + paths.distPath)</div><div class="line">		gulp.src(paths.srcPath)</div><div class="line">			.pipe(sourcemaps.init())</div><div class="line">			.pipe(autoprefixer(&#123;</div><div class="line">				browsers: <span class="string">'last 2 versions'</span></div><div class="line">			&#125;))</div><div class="line">			.pipe(minifycss())</div><div class="line">			.pipe(sourcemaps.write(<span class="string">'./'</span>))</div><div class="line">			.pipe(gulp.dest(paths.distDir))</div><div class="line">	&#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>一次编译所有 css 文件。可以配置 minifyss 任务。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">gulp</span><span class="selector-class">.task</span>(<span class="string">'minifycss'</span>, function () &#123;</div><div class="line">	<span class="selector-tag">gulp</span><span class="selector-class">.src</span>(<span class="string">'src/css/**/*.css'</span>)</div><div class="line">		<span class="selector-class">.pipe</span>(sourcemaps.init())</div><div class="line">		<span class="selector-class">.pipe</span>(autoprefixer(&#123;</div><div class="line">			<span class="attribute">browsers</span>: <span class="string">'last 2 versions'</span></div><div class="line">		&#125;))</div><div class="line">		<span class="selector-class">.pipe</span>(minifycss())</div><div class="line">		<span class="selector-class">.pipe</span>(sourcemaps.write(<span class="string">'./'</span>))</div><div class="line">		<span class="selector-class">.pipe</span>(gulp.dest(<span class="string">'dist/css/'</span>))</div><div class="line">&#125;)</div><div class="line"><span class="comment">// 命令行输入 gulp minifyss 以压缩 src/css/ 下的所有 .css 文件并复制到 dist/css 目录下</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>配置 Less 任务</strong><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">var less = require(<span class="string">'gulp-less'</span>)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'watchless'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">	gulp.watch(<span class="string">'src/less/**/*.less'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> &#123;</span></div><div class="line">	var paths = watchPath(event, <span class="string">'src/less/'</span>, <span class="string">'dist/css/'</span>)</div><div class="line">	gutil.<span class="built_in">log</span>(gutil.colors.green(event.<span class="built_in">type</span>) + <span class="string">' '</span> + paths.srcPath)</div><div class="line">	gutil.<span class="built_in">log</span>(<span class="string">'Dist '</span> + paths.distPath)</div><div class="line">	var combined = combiner.obj([</div><div class="line">		gulp.src(paths.srcPath),</div><div class="line">		sourcemaps.init(),</div><div class="line">		autoprefixer(&#123;</div><div class="line">			browser<span class="variable">s:</span> <span class="string">'last 2 versions'</span></div><div class="line">		&#125;),</div><div class="line">		less(),</div><div class="line">		minifycss(),</div><div class="line">		sourcemaps.<span class="keyword">write</span>(<span class="string">'./'</span>),</div><div class="line">		gulp.dest(paths.distDir)</div><div class="line">	])</div><div class="line">	combined.<span class="keyword">on</span>(<span class="string">'error'</span>, handleError)</div><div class="line">	&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'lesscss'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">	var combined = combiner.obj([</div><div class="line">		gulp.src(<span class="string">'src/less/**/*.less'</span>),</div><div class="line">		sourcemaps.init(),</div><div class="line">		autoprefixer(&#123;</div><div class="line">			browser<span class="variable">s:</span> <span class="string">'last 2 versions'</span></div><div class="line">		&#125;),</div><div class="line">		less(),</div><div class="line">		minifycss(),</div><div class="line">		sourcemaps.<span class="keyword">write</span>(<span class="string">'./'</span>),</div><div class="line">		gulp.dest(<span class="string">'dist/css/'</span>)</div><div class="line">	])</div><div class="line">	combined.<span class="keyword">on</span>(<span class="string">'error'</span>, handleError)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'watchjs'</span>, <span class="string">'watchcss'</span>, <span class="string">'watchless'</span>])</div></pre></td></tr></table></figure></p>
<p><strong>配置 Sass 任务</strong><br><figure class="highlight scilab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'watchsass'</span>,<span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">	gulp.watch(<span class="string">'src/sass/**/*'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> &#123;</span></div><div class="line">	var paths = watchPath(event, <span class="string">'src/sass/'</span>, <span class="string">'dist/css/'</span>)</div><div class="line">	gutil.<span class="built_in">log</span>(gutil.colors.green(event.<span class="built_in">type</span>) + <span class="string">' '</span> + paths.srcPath)</div><div class="line">	gutil.<span class="built_in">log</span>(<span class="string">'Dist '</span> + paths.distPath)</div><div class="line">	sass(paths.srcPath)</div><div class="line">		.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> &#123;</span></div><div class="line">			console.<span class="built_in">error</span>(<span class="string">'Error!'</span>, err.message);</div><div class="line">		&#125;)</div><div class="line">		.pipe(sourcemaps.init())</div><div class="line">		.pipe(minifycss())</div><div class="line">		.pipe(autoprefixer(&#123;</div><div class="line">			browsers: <span class="string">'last 2 versions'</span></div><div class="line">		&#125;))</div><div class="line">		.pipe(sourcemaps.write(<span class="string">'./'</span>))</div><div class="line">		.pipe(gulp.dest(paths.distDir))</div><div class="line">	&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'sasscss'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">	sass(<span class="string">'src/sass/'</span>)</div><div class="line">		.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> &#123;</span></div><div class="line">			console.<span class="built_in">error</span>(<span class="string">'Error!'</span>, err.message);</div><div class="line">		&#125;)</div><div class="line">		.pipe(sourcemaps.init())</div><div class="line">		.pipe(minifycss())</div><div class="line">		.pipe(autoprefixer(&#123;</div><div class="line">			browsers: <span class="string">'last 2 versions'</span></div><div class="line">		&#125;))</div><div class="line">		.pipe(sourcemaps.write(<span class="string">'./'</span>))</div><div class="line">		.pipe(gulp.dest(<span class="string">'dist/css'</span>))</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'watchjs'</span>, <span class="string">'watchcss'</span>, <span class="string">'watchless'</span>, <span class="string">'watchsass'</span>, <span class="string">'watchsass'</span>])</div></pre></td></tr></table></figure></p>
<p><strong>配置 image 任务</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'watchimage'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	gulp.watch(<span class="string">'src/images/**/*'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> paths = watchPath(event,<span class="string">'src/'</span>,<span class="string">'dist/'</span>)</div><div class="line"></div><div class="line">		gutil.log(gutil.colors.green(event.type) + <span class="string">' '</span> + paths.srcPath)</div><div class="line">		gutil.log(<span class="string">'Dist '</span> + paths.distPath)</div><div class="line"></div><div class="line">		gulp.src(paths.srcPath)</div><div class="line">			.pipe(imagemin(&#123;</div><div class="line">				<span class="attr">progressive</span>: <span class="literal">true</span></div><div class="line">			&#125;))</div><div class="line">			.pipe(gulp.dest(paths.distDir))</div><div class="line">	&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'image'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	gulp.src(<span class="string">'src/images/**/*'</span>)</div><div class="line">		.pipe(imagemin(&#123;</div><div class="line">			<span class="attr">progressive</span>: <span class="literal">true</span></div><div class="line">		&#125;))</div><div class="line">		.pipe(gulp.dest(<span class="string">'dist/images'</span>))</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p><strong>配置文件复制任务</strong>：复制 src/fonts/ 文件到 dist/ 中<br><figure class="highlight scilab"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'watchcopy'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">	gulp.watch(<span class="string">'src/fonts/**/*'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> &#123;</span></div><div class="line">	var paths = watchPath(event)</div><div class="line"></div><div class="line">	gutil.<span class="built_in">log</span>(gutil.colors.green(event.<span class="built_in">type</span>) + <span class="string">' '</span> + paths.srcPath)</div><div class="line">	gutil.<span class="built_in">log</span>(<span class="string">'Dist '</span> + paths.distPath)</div><div class="line"></div><div class="line">	gulp.src(paths.srcPath)</div><div class="line">		.pipe(gulp.dest(paths.distDir))</div><div class="line">	&#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'copy'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> &#123;</span></div><div class="line">	gulp.src(<span class="string">'src/fonts/**/*'</span>)</div><div class="line">		.pipe(gulp.dest(<span class="string">'dist/fonts/'</span>))</div><div class="line">&#125;)</div><div class="line"></div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'watchjs'</span>, <span class="string">'watchcss'</span>, <span class="string">'watchless'</span>, <span class="string">'watchsass'</span>, <span class="string">'watchimage'</span>, <span class="string">'watchcopy'</span>])</div></pre></td></tr></table></figure></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
