<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>[笔记]-MVVM&amp;模板引擎 | 用手记笔记，用心记笔记，用脑记笔记</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="一个放笔记的地方">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-MVVM&amp;模板引擎"/>
		
		<meta property="og:site_name" content="用手记笔记，用心记笔记，用脑记笔记"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<script>var timeStart = new Date();</script>
		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		
		
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">用手记笔记，用心记笔记，用脑记笔记</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="/" title="">
						<i class="fa fa-home"></i>首页
					</a>
				</li>
				
				<li>
					<a href="/archives" title="">
						<i class="fa fa-list"></i>存档
					</a>
				</li>
				
				<li>
					<a href="/resume" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-MVVM&amp;模板引擎</h2>
				
				<div>
					<span class="post-time">2016-11-25 21:08</span>
				</div>	
				
				<div class="article-content">
				<p><strong>来源</strong>：<a href="http://www.liaoxuefeng.com" target="_blank" rel="external">http://www.liaoxuefeng.com</a></p>
<p>JavaScript在浏览器中操作HTML，经历了若干发展阶段：</p>
<ul>
<li>直接用JavaScript操作DOM节点，使用浏览器提供的原生API；</li>
<li>由于原生API不好用，还要考虑浏览器兼容性，jQuery横空出世；</li>
<li>MVC模式，需要服务器端配合，JavaScript可以在前端修改服务器渲染后的数据；</li>
<li><p>现在前端页面越来越复杂，用户对于交互性要求也越来越高，MVVM模型应运而生。</p>
<ul>
<li>MVVM最早由微软提出来，它借鉴了桌面应用程序的MVC思想，在前端页面中，把Model用纯JavaScript对象表示，View负责显示，两者做到了最大限度的分离。</li>
<li>把Model和View关联起来的就是ViewModel。ViewModel把Model的数据同步到View显示出来，还把View的修改同步回Model。</li>
<li>用JavaScript编写一个通用的ViewModel，这样，就可以复用整个MVVM模型了。</li>
</ul>
</li>
<li><p>MVVM框架和jQuery操作DOM区别？</p>
<ul>
<li><p>如果使用MVVM框架来实现同样的功能，首先并不关心DOM的结构，而是关心数据如何存储。最简单的数据存储方式是使用JavaScript对象：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">var person</span> = &#123;</div><div class="line">	name: <span class="string">'Bart'</span>,</div><div class="line">	age: 12</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>把变量person看作Model，把HTML某些DOM节点看作View，假定它们之间被绑定了。</p>
</li>
<li>把显示的name从Bart改为Homer，把显示的age从12改为51，并不操作DOM，而是直接修改JavaScript对象：</li>
<li>改变JavaScript对象的状态，导致DOM对应的变化，关注点从操作DOM成了更新JavaScript对象的状态。</li>
<li>MVVM的设计思想：关注Model的变化，让MVVM框架自动更新DOM的状态，把开发者从操作DOM中解脱出来。</li>
<li>MVVM就是在前端上，应用了扩展的MVC模式，关心Model的变化，MVVM框架自动把Model的变化映射到DOM结构上。</li>
<li>单向绑定，就是把Model绑定到View，用JavaScript代码更新Model时，View就会自动更新。</li>
<li>双向绑定，如果用户更新了View，Model的数据也自动被更新了，就是双向绑定。</li>
</ul>
</li>
</ul>
<p><strong>来源</strong>：Node.js开发指南 BYVoid<br><strong>注</strong>：修改hexo博客时会用到。<br>模板引擎（Template Engine）是一个从页面模板根据一定的规则生成 HTML 的工具。<br>PHP 原本是 Personal Home Page Tools 的简称，用于取代 Perl 和 CGI 的组合，功能是让代码嵌入在 HTML 中执行，以产生动态的页面，因此 PHP 堪称是最早的模板引擎的雏形。<br>随后的 ASP、JSP 都沿用了这个模式，即建立一个 HTML 页面模板，插入可执行的代码，运行时动态生成 HTML。<br>整个网站就由一个个页面模板组成，所有逻辑都嵌入在模板中。大大降低了动态网页开发的门槛，但随着规模的扩大，页面功能逻辑与页面布局样式耦合，网站规模变大以后逐渐难以维护。<br>这些问题制约了早期模板引擎的发展，直到 MVC 开发模式普及，模板引擎才开始遍地开花。<br>现代的模板引擎是 MVC 的一部分，在功能划分上它严格属于视图部分，因此功能以生成 HTML 页面为核心，不会引入过多的编程语言的功能。<br>模板引擎的功能是将页面模板和要显示的数据结合起来生成 HTML 页面。<br>它既可以运行在服务器端又可以运行在客户端，大多数时候它都在服务器端直接被解析为 HTML，解析完成后再传输给客户端，客户端甚至无法判断页面是否是模板引擎生成的。<br>在 MVC 架构中，模板引擎包含在服务器端。控制器得到用户请求后，从模型获取数据，调用模板引擎。模板引擎以数据和页面模板为输入，生成 HTML 页面，然后返回给控制器，由控制器交回客户端。<br>基于 JavaScript 的模板引擎有许多种实现，推荐使用 ejs （Embedded JavaScript），因为它十分简单，而且与 Express 集成良好。<br>通过如下语句调用模板引擎：<code>res.render(&#39;index&#39;, { title: &#39;Express&#39; });</code><br>res.render 的功能是调用模板引擎，并将其产生的页面直接返回给客户端。它接受两个参数：</p>
<ul>
<li>第一个是模板的名称，即 views 目录下的模板文件名，不包含文件的扩展名；</li>
<li>第二个参数是传递给模板的数据，用于模板翻译。<br>index.ejs 内容如下：<code>&lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;</code>；<br><code>&lt;%= title %&gt;</code>用于模板变量显示，在模板翻译时会被替换成 Express，因为 res.render 传递了 <code>{ title: &#39;Express&#39; }</code>。<br>ejs 只有以下3种标签</li>
<li><code>&lt;% code %&gt;</code> ：JavaScript 代码。</li>
<li><code>&lt;%= code %&gt;</code> ：显示替换过 HTML 特殊字符的内容。</li>
<li><code>&lt;%- code %&gt;</code> ：显示原始 HTML 内容。<br>看到的不止这两行，原因是 Express 还自动套用了 layout.ejs：<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span></span><span class="ruby"> title </span><span class="xml"><span class="tag">%&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">href</span>=<span class="string">'/stylesheets/style.css'</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">%-</span></span><span class="ruby"> body </span><span class="xml"><span class="tag">%&gt;</span></span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>layout.ejs 是一个页面布局模板，它描述了整个页面的框架结构，默认情况下每个单独的页面都继承自这个框架，替换掉 &lt;%- body %&gt; 部分。<br>一般为了保持整个网站的一致风格，HTML 页面的 <head> 部分以及页眉页脚中的大量内容是重复的，因此可以把它们放在 layout.ejs 中。<br>当然，这个功能并不是强制的，如果想关闭它，可以在 app.js 的中 app.configure 中添加以下内容，这样页面布局功能就被关闭了：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.<span class="keyword">set</span>(<span class="string">'view options'</span>, &#123;</div><div class="line">	layout: <span class="literal">false</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></head></p>
<p>一个网站可能需要不止一种页面布局，可以在页面模板翻译时指定页面布局，即设置 layout 属性：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">function</span>(req, res) &#123;</div><div class="line">	<span class="selector-tag">res</span><span class="selector-class">.render</span>(<span class="string">'userlist'</span>, &#123;</div><div class="line">		<span class="attribute">title</span>: <span class="string">'用户列表后台管理系统'</span>,</div><div class="line">		<span class="attribute">layout</span>: <span class="string">'admin'</span></div><div class="line">	&#125;);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 在翻译 userlist 页面模板时套用 admin.ejs 作为页面布局</span></div></pre></td></tr></table></figure></p>
<p>Express 的视图系统还支持片段视图 （partials），它是一个页面的片段，通常是重复的内容，用于迭代显示。<br>通过它你可以将相对独立的页面块分割出去，而且可以避免显式地使用 for 循环。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app.js </span></div><div class="line"><span class="selector-tag">app</span><span class="selector-class">.get</span>(<span class="string">'/list'</span>, function(req, res) &#123;</div><div class="line">	<span class="selector-tag">res</span><span class="selector-class">.render</span>(<span class="string">'list'</span>, &#123;</div><div class="line">		<span class="attribute">title</span>: <span class="string">'List'</span>,</div><div class="line">		<span class="attribute">items</span>: [<span class="number">1991</span>, <span class="string">'byvoid'</span>, <span class="string">'express'</span>, <span class="string">'Node.js'</span>]</div><div class="line">	&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>在 views 目录下新建 list.ejs：<code>&lt;ul&gt;&lt;%- partial(&#39;listitem&#39;, items) %&gt;&lt;/ul&gt;</code><br>同时新建 listitem.ejs：<code>&lt;li&gt;&lt;%= listitem %&gt;&lt;/li&gt;</code><br>访问 <code>http://localhost:3000/list</code>，可以在源代码中看到以下内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>List<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">href</span>=<span class="string">'/stylesheets/style.css'</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>1991<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>byvoid<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>express<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>Node.js<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>partial 是一个可以在视图中使用函数，它接受两个参数：</p>
<ul>
<li>第一个是片段视图的名称；</li>
<li>第二个可以是一个对象或一个数组；<ul>
<li>如果是一个对象，那么片段视图中上下文变量引用的就是这个对象；</li>
<li>如果是一个数组，那么其中每个元素依次被迭代应用到片段视图。片段视图中上下文变量名就是视图文件名，例如上面的 ‘listitem’ 。</li>
</ul>
</li>
</ul>
<p>Express 提供了视图助手，允许在视图中访问全局的函数或对象，不用每次调用视图解析时单独传入。前面的 partial 就是一个视图助手。<br>视图助手有两类：</p>
<ul>
<li>静态视图助手可以是任何类型的对象，包括接受任意参数的函数，但访问到的对象必须是与用户请求无关的；</li>
<li>动态视图助手只能是一个函数，这个函数不能接受参数，但可以访问 req 和 res 对象。</li>
<li>静态视图助手可以通过 app.helpers() 函数注册，它接受一个对象，对象的每个属性名称为视图助手的名称，属性值对应视图助手的值。</li>
<li>动态视图助手则通过 app.dynamicHelpers()注册，方法与静态视图助手相同，但每个属性的值必须为一个函数，该函数提供 req 和 res ：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line">app.helpers(&#123;</div><div class="line">	<span class="attr">inspect</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> util.inspect(obj, <span class="literal">true</span>);</div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line">app.dynamicHelpers(&#123;</div><div class="line">	<span class="attr">headers</span>: <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> req.headers;</div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line">app.get(<span class="string">'/helper'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">	res.render(<span class="string">'helper'</span>, &#123;</div><div class="line">		<span class="attr">title</span>: <span class="string">'Helpers'</span></div><div class="line">	&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>对应的视图helper、ejs的内容如下：<code>&lt;%=inspect(headers)%&gt;</code></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			
<p>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme modified by <b> Huangzhike </b></p>
<p>&copy; 2016 <a href="https://huangzhike.github.io"><b> Huangzhike </b></a></p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
