<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <script>
            var timeStart = new Date();
        </script>
        
        <title>[ç¬”è®°]-Shiro | ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜</title>
        
        <meta name="author" content="huangzhike">
        
        
        <meta name="description" content="ä¸»è¦æ¥æº
é¢˜å¤–è¯ï¼šè¯è¯´åŸä½œè€…åšå®¢å†™å¾—å¾ˆå¥½ï¼Œä½†æ˜¯GitHubä¸Šé¢çš„é¡¹ç›®æœ‰äº›è¿è¡Œä¸äº†ã€‚ã€‚ã€‚è€Œä¸”æœ‰é”™è¯¯ã€‚ã€‚ã€‚é¢ã€‚ã€‚ã€‚IDEAç›´æ¥å¯¼å…¥ï¼Œæ”¹æ”¹æ•°æ®åº“å°±è¡Œã€‚ã€‚ã€‚ç»“æœæ ¹æœ¬è·‘ä¸èµ·æ¥ã€‚ã€‚ã€‚ä¸€å¼€å§‹æˆ‘è¿˜ä¸€ä¸ªä¸€ä¸ªå»æ’é™¤ï¼Œåæ¥å¹²è„†ç›´æ¥çœ‹ä»£ç äº†ã€‚ã€‚ã€‚
å¦ä¸€ä¸ªé¢˜å¤–è¯ï¼šShiroè¿™ä¸œè¥¿ä¸€ç‚¹ä¹Ÿä¸ä¼˜é›…ã€‚ã€‚ã€‚


subjectï¼šä¸»ä½“ï¼Œ">
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        
        <meta property="og:title" content="[ç¬”è®°]-Shiro"/>
        
        <meta property="og:site_name" content="ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜"/>
        
        
        <!-- favicon -->
        <link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
        <meta name="msapplication-TileColor" content="#009688">
        <meta name="msapplication-TileImage" content="/mstile-144x144.ico">
        <meta name="theme-color" content="#009688">
        <!-- favicon end -->
        <!-- <link href="//ok.ico" rel="icon"> -->
        
        <!-- toc -->
        <!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
        <!-- material design -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
        <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
        
        <!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
        <!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
    <meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">èœå•</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" title="ä¸‹ä¸€å¥æ˜¯ï¼šå®¢æœ‰å¯äººæœŸä¸æ¥ã€‚å°æ—¶å€™ï¼Œå–œæ¬¢é åœ¨é˜³å°ä¸Šï¼Œä¸€è¾¹å¹é£ï¼Œä¸€è¾¹çœ‹ä¹¦ï¼Œå–œæ¬¢è¯»ä¹¦å—ï¼Œéªšå¹´ï¼Ÿ" href="/">ä¹¦å½“å¿«æ„è¯»æ˜“å°½</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" target="_blank" rel="noopener" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

    <div class="container" >
        <div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[ç¬”è®°]-Shiro</h2>
				
				<div>
					<div class="post-time">2018-01-10</div>
				</div>
				
				<div class="article-content">
				<p><a href="https://github.com/codingXiaxw/shiro" target="_blank" rel="noopener">ä¸»è¦æ¥æº</a></p>
<p>é¢˜å¤–è¯ï¼šè¯è¯´åŸä½œè€…åšå®¢å†™å¾—å¾ˆå¥½ï¼Œä½†æ˜¯GitHubä¸Šé¢çš„é¡¹ç›®æœ‰äº›è¿è¡Œä¸äº†ã€‚ã€‚ã€‚è€Œä¸”æœ‰é”™è¯¯ã€‚ã€‚ã€‚é¢ã€‚ã€‚ã€‚IDEAç›´æ¥å¯¼å…¥ï¼Œæ”¹æ”¹æ•°æ®åº“å°±è¡Œã€‚ã€‚ã€‚ç»“æœæ ¹æœ¬è·‘ä¸èµ·æ¥ã€‚ã€‚ã€‚ä¸€å¼€å§‹æˆ‘è¿˜ä¸€ä¸ªä¸€ä¸ªå»æ’é™¤ï¼Œåæ¥å¹²è„†ç›´æ¥çœ‹ä»£ç äº†ã€‚ã€‚ã€‚</p>
<p>å¦ä¸€ä¸ªé¢˜å¤–è¯ï¼šShiroè¿™ä¸œè¥¿ä¸€ç‚¹ä¹Ÿä¸ä¼˜é›…ã€‚ã€‚ã€‚</p>
<hr>
<ul>
<li><p>subjectï¼šä¸»ä½“ï¼Œè¿›è¡Œèº«ä»½è®¤è¯ã€‚</p>
</li>
<li><p>principalï¼šèº«ä»½ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œå¦‚ç”¨æˆ·åï¼Œé‚®ç®±ï¼›åªæœ‰ä¸€ä¸ªä¸»èº«ä»½ä¿¡æ¯ï¼ˆprimary principalï¼‰ã€‚</p>
</li>
<li><p>credentialï¼šå‡­è¯ï¼Œå¦‚å¯†ç ã€‚</p>
</li>
</ul>
<p>ä¸»ä½“åœ¨è¿›è¡Œèº«ä»½è®¤è¯æ—¶éœ€è¦æä¾›èº«ä»½ä¿¡æ¯å’Œå‡­è¯ä¿¡æ¯ã€‚</p>
<p>æƒé™æ•°æ®æ¨¡å‹ï¼š</p>
<p>ç”¨æˆ·ï¼ˆè´¦å·å’Œå¯†ç ï¼‰ã€è§’è‰²ï¼ˆè§’è‰²åç§°ï¼‰ã€æƒé™ï¼ˆèµ„æºå’Œæƒé™ï¼‰ã€ç”¨æˆ·è§’è‰²å…³ç³»ï¼ˆç”¨æˆ·idã€è§’è‰²idï¼‰ã€è§’è‰²æƒé™å…³ç³»ï¼ˆè§’è‰²idã€æƒé™idï¼‰ã€‚</p>
<p>é€šå¸¸å°†èµ„æºè¡¨å’Œæƒé™è¡¨åˆå¹¶ä¸ºä¸€å¼ æƒé™è¡¨ã€‚</p>
<p>è§’è‰²ï¼šå¯ä»¥ç†è§£ä¸ºæƒé™çš„é›†åˆï¼Œä¸€èˆ¬èµ‹äºˆç”¨æˆ·è§’è‰²è€Œä¸æ˜¯æƒé™ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥æ‹¥æœ‰ä¸€ç»„æƒé™ã€‚</p>
<ul>
<li>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶<pre class=" language-java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">'éƒ¨é—¨ç»ç†'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<p>if (user.hasRole(â€˜éƒ¨é—¨ç»ç†â€™) || user.hasRole(â€˜æ€»ç»ç†â€™)) {}</p>
<pre><code>
* åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰
```java
if (user.hasPermission(&#39;æƒé™æ ‡è¯†ç¬¦&#39;)) {}</code></pre><ul>
<li><p>Authenticationï¼šè®¤è¯ã€‚</p>
</li>
<li><p>Authorizationï¼šæˆæƒï¼ŒæŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ã€‚</p>
</li>
<li><p>Cryptographyï¼šåŠ å¯†ï¼Œå¦‚å¯†ç åŠ å¯†å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æ˜æ–‡å­˜å‚¨ã€‚</p>
</li>
<li><p>Remember Meï¼šè®°ä½æˆ‘ï¼Œå³ä¸€æ¬¡ç™»å½•åï¼Œä¸‹æ¬¡å†æ¥çš„è¯ä¸ç”¨ç™»å½•äº†ã€‚</p>
</li>
<li><p>Subjectï¼šä¸»ä½“ï¼Œæ‰€æœ‰Subjectéƒ½ç»‘å®šåˆ°SecurityManagerï¼Œä¸Subjectçš„æ‰€æœ‰äº¤äº’éƒ½å§”æ‰˜ç»™SecurityManagerã€‚</p>
</li>
<li><p>SecurityManagerï¼šå®‰å…¨ç®¡ç†å™¨ï¼›å¯ä»¥çœ‹æˆDispatcherServletå‰ç«¯æ§åˆ¶å™¨ã€‚</p>
</li>
<li><p>Realmï¼šåŸŸï¼Œä»Realmè·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼‰ã€‚</p>
</li>
</ul>
<p>Shiroæ”¯æŒä¸‰ç§æˆæƒçš„æ–¹å¼ã€‚</p>
<ul>
<li>ç¬¬ä¸€ç§ï¼šç¼–ç¨‹å¼<pre class=" language-java"><code class="language-java">Subject subject <span class="token operator">=</span> SecurityUtils<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// æœ‰æƒé™  </span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// æ— æƒé™  </span>
<span class="token punctuation">}</span></code></pre>
</li>
<li>ç¬¬äºŒç§ï¼šæ³¨è§£å¼<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RequiresRoles</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//æœ‰æƒé™  </span>
<span class="token punctuation">}</span></code></pre>
</li>
<li>ç¬¬ä¸‰ç§ï¼šJSPæ ‡ç­¾<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasRole</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>admin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasRole</span><span class="token punctuation">></span></span></code></pre>
</li>
</ul>
<p>å®é™…å¼€å‘ä¸­ä½¿ç”¨åä¸¤ç§æ–¹å¼ã€‚</p>
<p>web.xml</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- shiro filterï¼ŒDelegatingFilterProxyé€šè¿‡ä»£ç†æ¨¡å¼å°†å®¹å™¨ä¸­çš„beanå’Œæ­¤filterå…³è” --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>shiroFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>org.springframework.web.filter.DelegatingFilterProxy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>targetFilterLifecycle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è¯¥å€¼ç¼ºçœä¸º false ç”Ÿå‘½å‘¨æœŸç”± SpringApplicationContext ç®¡ç† --></span>
        <span class="token comment" spellcheck="true">&lt;!-- true åˆ™è¡¨ç¤ºç”± ServletContainer ç®¡ç† --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- filter bean idï¼Œä¸è®¾ç½®åˆ™æ‰¾ä¸filter-nameåŒåbean --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>targetBeanName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>shiroFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>shiroFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span></code></pre>
<p>applicationContext-shiro.xml</p>
<pre class=" language-xml"><code class="language-xml">    <span class="token comment" spellcheck="true">&lt;!-- web.xml shiro filter bean --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shiroFilter<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.spring.web.ShiroFilterFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è®¤è¯æäº¤åœ°å€ï¼Œæ²¡æœ‰è®¤è¯ä¼šè¯·æ±‚æ­¤åœ°å€è®¤è¯ï¼Œç”±formAuthenticationFilterè¿›è¡Œè¡¨å•è®¤è¯ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/login.action<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è®¤è¯æˆåŠŸç»Ÿä¸€è·³è½¬åœ°å€ï¼Œä¸é…ç½®çš„è¯è®¤è¯æˆåŠŸä¼šè‡ªåŠ¨åˆ°ä¸Šä¸€ä¸ªè¯·æ±‚è·¯å¾„ --></span>
        <span class="token comment" spellcheck="true">&lt;!-- &lt;property name="successUrl" value=""/> --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>unauthorizedUrl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/refuse.jsp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

        <span class="token comment" spellcheck="true">&lt;!-- è‡ªå®šä¹‰filter --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>filters<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">></span></span>
                <span class="token comment" spellcheck="true">&lt;!-- å°†è‡ªå®šä¹‰çš„FormAuthenticationFilteræ³¨å…¥shiroFiler --></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authc<span class="token punctuation">"</span></span> <span class="token attr-name">value-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>formAuthenticationFilter<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>

        <span class="token comment" spellcheck="true">&lt;!-- è¿‡è™‘å™¨é“¾ï¼Œä»ä¸Šå‘ä¸‹æ‹¦æˆªï¼Œä¸€èˆ¬å°†/**æ”¾åœ¨æœ€ä¸‹è¾¹ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>filterChainDefinitions<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>
                <span class="token comment" spellcheck="true">&lt;!-- ä¸‹é¢valueå€¼çš„ç¬¬ä¸€ä¸ª'/'ä»£è¡¨çš„è·¯å¾„æ˜¯ç›¸å¯¹äºHttpServletRequest.getContextPath() --></span> 
                <span class="token comment" spellcheck="true">&lt;!-- é™æ€èµ„æºè®¾ç½®åŒ¿åè®¿é—® --></span>
                /img/**=anon
                /js/**=anon
                /css/**=anon
                <span class="token comment" spellcheck="true">&lt;!-- éªŒè¯ç  --></span>
                /validatecode.jsp=anon
                <span class="token comment" spellcheck="true">&lt;!-- è¯·æ±‚è¿™ä¸ªåœ°å€å°±è‡ªåŠ¨é€€å‡ºï¼ŒLogoutFilteræ‹¦æˆªï¼Œè‡ªåŠ¨æ³¨é”€æ¸…é™¤session --></span>
                /logout.action=logout
                <span class="token comment" spellcheck="true">&lt;!-- éœ€è¦item:queryæƒé™ï¼Œå–æ¶ˆurlæ‹¦æˆªé…ç½®ï¼Œé‡‡ç”¨æ³¨è§£ --></span>
                <span class="token comment" spellcheck="true">&lt;!-- /items/queryItems.action=perms[item:query] --></span>
                <span class="token comment" spellcheck="true">&lt;!-- é…ç½®è®°ä½æˆ‘æˆ–è®¤è¯é€šè¿‡å¯ä»¥è®¿é—®çš„åœ°å€ --></span>
                <span class="token comment" spellcheck="true">&lt;!-- ä½¿ç”¨UserFilterï¼Œå°†è®°ä½æˆ‘å³å¯è®¿é—®çš„åœ°å€é…ç½®è®©UserFilteræ‹¦æˆªï¼Œä¸ç„¶ä¼šè¢«/**=authcæ‹¦æˆª --></span>
                /index.jsp=user 
                /first.action=user 
                /welcome.jsp=user
                <span class="token comment" spellcheck="true">&lt;!-- -/**=authc è¡¨ç¤ºæ‰€æœ‰çš„urléƒ½å¿…é¡»è®¤è¯æ‰å¯ä»¥è®¿é—® --></span>
                /**=authc
                <span class="token comment" spellcheck="true">&lt;!-- /**=anon è¡¨ç¤ºæ‰€æœ‰çš„urléƒ½å¯ä»¥åŒ¿åè®¿é—® --></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- å®‰å…¨ç®¡ç†å™¨ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.web.mgt.DefaultWebSecurityManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- æ³¨å…¥Realm --></span>
        <span class="token comment" spellcheck="true">&lt;!-- Single realm app. If you have multiple realms, use the 'realms' property instead. --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>realm<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>customRealm<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- æ³¨å…¥ä¼šè¯ç®¡ç†å™¨ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è®°ä½æˆ‘ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMeManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMeManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- ç›¸å½“äºè°ƒç”¨SecurityUtils.setSecurityManager(securityManager) --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.beans.factory.config.MethodInvokingFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>staticMethod<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.SecurityUtils.setSecurityManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>arguments<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- è‡ªå®šä¹‰Realm --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>customRealm<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shiro.CustomRealm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- å°†å‡­è¯åŒ¹é…å™¨è®¾ç½®åˆ°realmä¸­ï¼ŒrealmæŒ‰ç…§å‡­è¯åŒ¹é…å™¨è¦æ±‚è¿›è¡Œæ•£åˆ— --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>credentialsMatcher<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>credentialsMatcher<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- å¼€å¯ç¼“å­˜ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cachingEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è®¤è¯ä¿¡æ¯:è¿™é‡Œä¸è¿›è¡Œç¼“å­˜ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authenticationCachingEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- ehcacheä¸­é…ç½®çš„è®¤è¯ç¼“å­˜åç§° --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authenticationCacheName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authenticationCache<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- æˆæƒä¿¡æ¯:è¿™é‡Œè¿›è¡Œç¼“å­˜ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authorizationCachingEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- ehcacheä¸­é…ç½®çš„æˆæƒç¼“å­˜åç§° --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authorizationCacheName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>authorizationCache<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- è‡ªå®šä¹‰formè®¤è¯è¿‡æ»¤å™¨ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>formAuthenticationFilter<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shiro.CustomFromAuthenticationFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è¡¨å•è´¦å·çš„inputå --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>usernameParam<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è¡¨å•å¯†ç çš„inputå --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>passwordParam<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- rememberMeçš„inputå --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMeParam<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMe<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- å‡­è¯åŒ¹é…å™¨ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>credentialsMatcher<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.authc.credential.HashedCredentialsMatcher<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- æ•°æ®åº“ä¸­å­˜å‚¨åˆ°çš„md5çš„æ•£åˆ—å€¼ï¼Œåœ¨Realmä¸­éœ€è¦è®¾ç½®æ•°æ®åº“ä¸­çš„æ•£åˆ—å€¼ --></span>
        <span class="token comment" spellcheck="true">&lt;!-- è®©Shiroè¿›è¡Œæ•£åˆ—å¯¹æ¯”æ—¶å’ŒåŸå§‹æ•°æ®åº“ä¸­çš„æ•£åˆ—å€¼ä½¿ç”¨çš„ç®—æ³•ä¸€è‡´ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hashAlgorithmName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>md5<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hashIterations<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- ç¼“å­˜ç®¡ç†å™¨ --></span>
    <span class="token comment" spellcheck="true">&lt;!-- ehcache-core.jar --></span>
    <span class="token comment" spellcheck="true">&lt;!-- shiro-ehcache.jar --></span>
    <span class="token comment" spellcheck="true">&lt;!-- é»˜è®¤å…³é—­è®¤è¯ç¼“å­˜ï¼Œé»˜è®¤å¼€å¯æˆæƒç¼“å­˜ --></span>
    <span class="token comment" spellcheck="true">&lt;!-- ç”¨æˆ·è®¤è¯é€šè¿‡æ—¶ï¼Œè¯¥ç”¨æˆ·ç¬¬ä¸€æ¬¡æˆæƒï¼Œè°ƒç”¨RealmæŸ¥è¯¢æ•°æ®åº“æŸ¥è¯¢è¯¥ç”¨æˆ·çš„æˆæƒä¿¡æ¯ç„¶åç»™è¯¥ç”¨æˆ·æˆæƒ --></span>
    <span class="token comment" spellcheck="true">&lt;!-- ç”¨æˆ·ç¬¬äºŒæ¬¡æˆæƒæ—¶ï¼Œä¸è°ƒç”¨RealmæŸ¥è¯¢æ•°æ®åº“ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºæˆæƒä¿¡æ¯ï¼ˆæƒé™æ ‡è¯†ç¬¦ï¼‰ç„¶åç»™è¯¥ç”¨æˆ·æˆæƒ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.cache.ehcache.EhCacheManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cacheManagerConfigFile<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>classpath:shiro-ehcache.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- ä¼šè¯ç®¡ç†å™¨ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.web.session.mgt.DefaultWebSessionManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- sessionçš„å¤±æ•ˆæ—¶é•¿ï¼Œå•ä½æ¯«ç§’ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>globalSessionTimeout<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>600000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- åˆ é™¤å¤±æ•ˆçš„session --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>deleteInvalidSessions<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- ä¼šè¯Cookieæ¨¡æ¿ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionIdCookie<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionIdCookie<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- ä¼šè¯Session IDç”Ÿæˆå™¨ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionIdGenerator<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- ä¼šè¯Cookieæ¨¡æ¿ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionIdCookie<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.web.servlet.SimpleCookie<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionId<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!--cookieçš„æœ‰æ•ˆæ—¶é—´ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>maxAge<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- rememberMeManagerç®¡ç†å™¨ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMeManager<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.web.mgt.CookieRememberMeManager<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cookie<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMeCookie<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- è®°ä½æˆ‘cookie --></span>
    <span class="token comment" spellcheck="true">&lt;!-- ç™»é™†é€‰æ‹©è‡ªåŠ¨ç™»é™†æœ¬æ¬¡ç™»é™†æˆåŠŸä¼šå‘cookieå†™èº«ä»½ä¿¡æ¯ï¼Œä¸‹æ¬¡ç™»é™†ä»cookieä¸­å–å‡ºèº«ä»½ä¿¡æ¯å®ç°è‡ªåŠ¨ç™»é™† --></span>
    <span class="token comment" spellcheck="true">&lt;!-- æ¶‰åŠåˆ°sessionçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ŒPOJOç±»åº”è¯¥å®ç°Serializableæ¥å£ï¼Œå¦‚ActiveUser SysPermission --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMeCookie<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.web.servlet.SimpleCookie<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- rememberMeæ—¶cookieçš„åå­— --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMe<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- è®°ä½æˆ‘cookieç”Ÿæ•ˆæ—¶é—´7å¤© --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>maxAge<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>604800<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token comment" spellcheck="true">&lt;!-- ä¼šè¯Cookieæ¨¡æ¿ --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionIdCookie<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sessionIdCookie<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

    <span class="token comment" spellcheck="true">&lt;!-- ç”Ÿå‘½å‘¨æœŸ --></span>
    <span class="token comment" spellcheck="true">&lt;!-- &lt;bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor"/> --></span>

    <span class="token comment" spellcheck="true">&lt;!-- å¯ç”¨shiroæ³¨è§£ --></span>
    <span class="token comment" spellcheck="true">&lt;!-- &lt;bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator" depends-on="lifecycleBeanPostProcessor"/> --></span>

    <span class="token comment" spellcheck="true">&lt;!-- å¼€å¯shiroæ³¨è§£ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span> <span class="token attr-name">proxy-target-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
</code></pre>
<p>Shiroå®ç°ç™»å½•è®¤è¯</p>
<p>ç™»å½•æ˜¯åœ¨è¡¨å•è¿›è¡Œçš„ï¼Œé€šè¿‡Shiroè¡¨å•è¿‡æ»¤å™¨<code>FormAuthenticationFilter</code>å®ç°ã€‚</p>
<p>ç”¨æˆ·æ²¡æœ‰è®¤è¯æ—¶ï¼Œè¯·æ±‚<code>loginurl</code>è®¤è¯ï¼Œæäº¤ç”¨æˆ·èº«ä»½å’Œå¯†ç ï¼Œ<code>FormAuthenticationFilter</code>æ‹¦æˆªå–å‡º<code>requestä¸­</code>çš„<code>username</code>å’Œ<code>password</code>ï¼ˆ<code>username</code>å’Œ<code>password</code>å†™æ­»äº†ï¼‰ã€‚</p>
<p><code>FormAuthenticationFilter</code>è°ƒç”¨<code>Realm</code>ä¼ å…¥ä¸€ä¸ª<code>token</code>ï¼ˆ<code>username</code>å’Œ<code>password</code>ä¼ å…¥åˆ°<code>token</code>ä¸­ï¼‰ï¼Œ<code>Realm</code>è®¤è¯æ—¶æ ¹æ®<code>username</code>åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼ˆå°†åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„ä¿¡æ¯ä¿å­˜åœ¨åœ¨<code>Activeuser</code>å¯¹è±¡ä¸­ï¼ŒåŒ…æ‹¬<code>userid</code>ã€<code>usercode</code>ã€<code>username</code>ã€<code>menus</code>ï¼‰ï¼Œç„¶åè¿”å›ä¸€ä¸ª<code>AuthenticationInfo</code>å¯¹è±¡ã€‚</p>
<p>å¦‚æœæŸ¥è¯¢ä¸åˆ°ï¼Œ<code>Realm</code>è¿”å›<code>null</code>ï¼ŒåŒæ—¶<code>FormAuthenticationFilter</code>ä¼šå‘<code>request</code>åŸŸä¸­å¡«å……å¼‚å¸¸ä¿¡æ¯ã€‚</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SysService sysService<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// @RequestMapping("/login")</span>
    <span class="token comment" spellcheck="true">// public String login(HttpSession session, String randomcode, String usercode, String password)</span>
    <span class="token comment" spellcheck="true">//         throws Exception {</span>
    <span class="token comment" spellcheck="true">//     // sessionä¸­è·å–æ­£ç¡®éªŒè¯ç </span>
    <span class="token comment" spellcheck="true">//     String validateCode = (String) session.getAttribute("validateCode");</span>
    <span class="token comment" spellcheck="true">//     if (!randomcode.equals(validateCode))</span>
    <span class="token comment" spellcheck="true">//         throw new CustomException("éªŒè¯ç ä¸æ­£ç¡®");</span>
    <span class="token comment" spellcheck="true">//     // è°ƒç”¨serviceæ ¡éªŒç”¨æˆ·å¸å·å’Œå¯†ç çš„æ­£ç¡®æ€§</span>
    <span class="token comment" spellcheck="true">//     ActiveUser activeUser = sysService.authenticat(usercode, password);</span>
    <span class="token comment" spellcheck="true">//     // å¦‚æœserviceæ ¡éªŒé€šè¿‡ï¼Œå°†ç”¨æˆ·èº«ä»½è®°å½•åˆ°session</span>
    <span class="token comment" spellcheck="true">//     session.setAttribute("activeUser", activeUser);</span>
    <span class="token comment" spellcheck="true">//     // é‡å®šå‘</span>
    <span class="token comment" spellcheck="true">//     return "redirect:/first.action";</span>
    <span class="token comment" spellcheck="true">// }</span>

    <span class="token comment" spellcheck="true">// ç™»å½•æäº¤åœ°å€ï¼Œå’Œé…ç½®çš„loginUrlä¸€è‡´</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">login</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// å¦‚æœç™»å½•å¤±è´¥ä»requestä¸­è·å–è®¤è¯å¼‚å¸¸ä¿¡æ¯</span>
        String exceptionClassName <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"shiroLoginFailure"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// æŠ›å‡ºæŒ‡å®šå¼‚å¸¸ä¿¡æ¯</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>exceptionClassName <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>UnknownAccountException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exceptionClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// æœ€ç»ˆæŠ›ç»™å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆå·²é…ç½®ï¼‰</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CustomException</span><span class="token punctuation">(</span><span class="token string">"è´¦å·ä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>IncorrectCredentialsException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exceptionClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CustomException</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·å/å¯†ç é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"randomCodeError"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exceptionClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CustomException</span><span class="token punctuation">(</span><span class="token string">"éªŒè¯ç é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æœ€ç»ˆåœ¨å¼‚å¸¸å¤„ç†å™¨ç”ŸæˆæœªçŸ¥é”™è¯¯</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// æ­¤æ–¹æ³•ä¸å¤„ç†ç™»å½•æˆåŠŸï¼Œshiroè®¤è¯æˆåŠŸä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸Šä¸€ä¸ªè·¯å¾„</span>
        <span class="token comment" spellcheck="true">// ç™»å½•å¤±è´¥è¿”å›åˆ°loginé¡µé¢</span>
        <span class="token keyword">return</span> <span class="token string">"login"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// @RequestMapping("/logout")</span>
    <span class="token comment" spellcheck="true">// public String logout(HttpSession session) throws Exception {</span>
    <span class="token comment" spellcheck="true">//     session.invalidate();</span>
    <span class="token comment" spellcheck="true">//     // é‡å®šå‘</span>
    <span class="token comment" spellcheck="true">//     return "redirect:/first.action";</span>
    <span class="token comment" spellcheck="true">// }</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// æ³¨å…¥service</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SysService sysService<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// è®¾ç½®Realmåç§°</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"customRealm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * è®¤è¯ä¿¡æ¯ è®¤è¯å›è°ƒå‡½æ•° ç™»å½•æ—¶è°ƒç”¨
     * é¦–å…ˆæ ¹æ®ä¼ å…¥çš„ç”¨æˆ·åè·å–Userä¿¡æ¯ï¼›
     * å¦‚æœuserä¸ºç©ºï¼Œé‚£ä¹ˆæŠ›å‡ºæ²¡æ‰¾åˆ°å¸å·å¼‚å¸¸UnknownAccountExceptionï¼›
     * å¦‚æœuseræ‰¾åˆ°ä½†é”å®šäº†æŠ›å‡ºé”å®šå¼‚å¸¸LockedAccountExceptionï¼›
     * æœ€åç”ŸæˆAuthenticationInfoä¿¡æ¯ï¼Œäº¤ç»™é—´æ¥çˆ¶ç±»AuthenticatingRealmä½¿ç”¨CredentialsMatcherè¿›è¡Œåˆ¤æ–­å¯†ç æ˜¯å¦åŒ¹é…ï¼›
     * å¦‚æœä¸åŒ¹é…å°†æŠ›å‡ºå¯†ç é”™è¯¯å¼‚å¸¸IncorrectCredentialsExceptionï¼›
     * å¦å¤–å¦‚æœå¯†ç é‡è¯•æ¬¡æ•°å¤ªå¤šå°†æŠ›å‡ºè¶…å‡ºé‡è¯•æ¬¡æ•°å¼‚å¸¸ExcessiveAttemptsExceptionï¼›
     * åœ¨ç»„è£…SimpleAuthenticationInfoä¿¡æ¯æ—¶ï¼Œéœ€è¦ä¼ å…¥ï¼šèº«ä»½ä¿¡æ¯ï¼ˆç”¨æˆ·åï¼‰ã€å‡­æ®ï¼ˆå¯†æ–‡å¯†ç ï¼‰ã€åŠ å¯†ç›ï¼ˆusername+saltï¼‰ï¼Œ
     * CredentialsMatcherä½¿ç”¨ç›åŠ å¯†ä¼ å…¥çš„æ˜æ–‡å¯†ç å’Œæ­¤å¤„çš„å¯†æ–‡å¯†ç è¿›è¡ŒåŒ¹é…ã€‚
     */</span>

    <span class="token comment" spellcheck="true">// å…ˆè®¤è¯ ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ ä¹Ÿå¯ä»¥å®ç°AuthenticationToken</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> AuthenticationInfo <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span>AuthenticationToken token<span class="token punctuation">)</span> 
            <span class="token keyword">throws</span> AuthenticationException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// è¿™é‡Œè®¿é—®ä¸€æ¬¡ï¼Œå¯ä»¥è®¡æ•°ä¸€æ¬¡ï¼Œè®¡æ•°å¤§äºxæ—¶ï¼Œè®¾ç½®ç”¨æˆ·è¢«é”å®šä¸€å°æ—¶DisabledAccountException</span>

        <span class="token comment" spellcheck="true">// UsernamePasswordToken uPToken = (UsernamePasswordToken) token;</span>
        <span class="token comment" spellcheck="true">// String name = uPToken.getUsername();</span>
        <span class="token comment" spellcheck="true">// String password = String.valueOf(uPToken.getPassword());</span>

        <span class="token comment" spellcheck="true">// tokenæ˜¯ç”¨æˆ·è¾“å…¥çš„ï¼Œå–å‡ºèº«ä»½ä¿¡æ¯ userCodeæ˜¯beançš„å±æ€§</span>
        String userCode <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å¯†ç </span>
        <span class="token comment" spellcheck="true">// String password = new String((char[]) token.getCredentials());</span>

        <span class="token comment" spellcheck="true">// æ ¹æ®ç”¨æˆ·è¾“å…¥çš„userCodeä¸›æ•°æ®åº“æŸ¥è¯¢</span>
        SysUser sysUser <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sysUser <span class="token operator">=</span> sysService<span class="token punctuation">.</span><span class="token function">findSysUserByUserCode</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// æ˜¯å¦ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sysUser <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnknownAccountException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>Boolean<span class="token punctuation">.</span>TRUE<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockedAccountException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// activeUserå°±æ˜¯ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯principalï¼Œä½ ä¹Ÿå¯ä»¥ç”¨usernameä»€ä¹ˆçš„ä»£æ›¿</span>
        ActiveUser activeUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activeUser<span class="token punctuation">.</span><span class="token function">setUserid</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activeUser<span class="token punctuation">.</span><span class="token function">setUsercode</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getUsercode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        activeUser<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// æ ¹æ®ç”¨æˆ·idï¼Œserviceå–å‡ºèœå•</span>
        List<span class="token operator">&lt;</span>SysPermission<span class="token operator">></span> menus <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            menus <span class="token operator">=</span> sysService<span class="token punctuation">.</span><span class="token function">findMenuListByUserId</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// å°†ç”¨æˆ·èœå•è®¾ç½®åˆ°activeUserï¼ŒæˆåŠŸç™»å½•åç”¨æˆ·èœå•æ˜¾ç¤º</span>
        activeUser<span class="token punctuation">.</span><span class="token function">setMenus</span><span class="token punctuation">(</span>menus<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// ä»æ•°æ®åº“æŸ¥è¯¢å‡ºæ¥çš„è´¦å·åå’Œå¯†ç ä¸ç”¨æˆ·è¾“å…¥çš„è´¦å·å’Œå¯†ç å¯¹æ¯”</span>
        <span class="token comment" spellcheck="true">// å½“ç”¨æˆ·æ‰§è¡Œç™»å½•æ—¶ åœ¨æ–¹æ³•å¤„ç†ä¸Šè¦å®ç°subject.login(token);</span>
        <span class="token comment" spellcheck="true">// ç„¶åä¼šè‡ªåŠ¨è¿›å…¥è¿™ä¸ªç±»è¿›è¡Œè®¤è¯</span>

        <span class="token comment" spellcheck="true">// é€šè¿‡realmå°†ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯å’Œä»æ•°æ®åº“ä¸­æŸ¥åˆ°çš„æ•°æ®è¿›è¡Œå¯¹æ¯”</span>
        <span class="token comment" spellcheck="true">// æŸ¥ä¸åˆ°è¿”å›nullï¼ŒæŸ¥è¯¢åˆ°ï¼Œè¿”å›è®¤è¯ä¿¡æ¯AuthenticationInfo</span>
        <span class="token comment" spellcheck="true">// äº¤ç»™AuthenticatingRealmä½¿ç”¨CredentialsMatcherè¿›è¡Œå¯†ç åŒ¹é…ï¼Œè§‰å¾—ä¸å¥½å¯ä»¥è‡ªå®šä¹‰å®ç°</span>
        AuthenticationInfo simpleAuthenticationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>
            activeUser<span class="token punctuation">,</span> 
            sysUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token comment" spellcheck="true">// ByteSource.Util.bytes(username + userEntity.getCredentialsSalt()), // salt=username+salt</span>
            ByteSource<span class="token punctuation">.</span>Util<span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">.</span><span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// realm name</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> simpleAuthenticationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * åªæœ‰éœ€è¦éªŒè¯æƒé™æ—¶æ‰ä¼šè°ƒç”¨, æˆæƒæŸ¥è¯¢å›è°ƒå‡½æ•°, è¿›è¡Œé‰´æƒä½†ç¼“å­˜ä¸­æ— ç”¨æˆ·çš„æˆæƒä¿¡æ¯æ—¶è°ƒç”¨
     * åœ¨é…æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼ŒåªåŠ è½½ä¸€æ¬¡
     */</span>
    <span class="token comment" spellcheck="true">// å†æˆæƒ</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> AuthorizationInfo <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span>PrincipalCollection principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// ä»principalsè·å–ä¸»èº«ä»½ä¿¡æ¯ï¼Œä¸Šè¾¹è®¤è¯å¡«å……åˆ°SimpleAuthenticationInfo</span>
        ActiveUser activeUser <span class="token operator">=</span> <span class="token punctuation">(</span>ActiveUser<span class="token punctuation">)</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// æ ¹æ®èº«ä»½ä¿¡æ¯ä»æ•°æ®åº“ä¸­è·å–æƒé™æ•°æ®ï¼Œç®€å•èµ·è§å°±ä¸ç”¨try catchäº†</span>
        List<span class="token operator">&lt;</span>SysPermission<span class="token operator">></span> permissionList <span class="token operator">=</span> sysService<span class="token punctuation">.</span><span class="token function">findPermissionListByUserId</span><span class="token punctuation">(</span>activeUser<span class="token punctuation">.</span><span class="token function">getUserid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        List<span class="token operator">&lt;</span>String<span class="token operator">></span> permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>permissionList <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>SysPermission sysPermission <span class="token operator">:</span> permissionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// å°†æƒé™æ ‡ç­¾ç¬¦æ”¾å…¥é›†åˆ</span>
                permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sysPermission<span class="token punctuation">.</span><span class="token function">getPercode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// è¿”å›æˆæƒä¿¡æ¯</span>
        SimpleAuthorizationInfo simpleAuthorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// å°†ä¸Šè¾¹æŸ¥è¯¢åˆ°æˆæƒä¿¡æ¯å¡«å……åˆ°simpleAuthorizationInfoå¯¹è±¡ä¸­</span>
        simpleAuthorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// simpleAuthorizationInfo.setRoles(sysService.findRoles("xxx"));</span>
        <span class="token keyword">return</span> simpleAuthorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// æ¸…é™¤ç¼“å­˜ï¼Œè¦æ”¾åœ¨serviceä¸­è°ƒç”¨</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearCached</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        PrincipalCollection principals <span class="token operator">=</span> SecurityUtils<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span>principals<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * æ¸…é™¤ç”¨æˆ·è®¤è¯ä¿¡æ¯
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearCachedAuthenticationInfo</span><span class="token punctuation">(</span>PrincipalCollection principalCollection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SimplePrincipalCollection principals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimplePrincipalCollection</span><span class="token punctuation">(</span>principalCollection<span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clearCachedAuthenticationInfo</span><span class="token punctuation">(</span>principals<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * æ¸…é™¤æŒ‡å®š principalCollection çš„æƒé™ä¿¡æ¯
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearCachedAuthorizationInfo</span><span class="token punctuation">(</span>PrincipalCollection principalCollection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SimplePrincipalCollection principals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimplePrincipalCollection</span><span class="token punctuation">(</span>principalCollection<span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clearCachedAuthorizationInfo</span><span class="token punctuation">(</span>principals<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">/**
     * æ¸…é™¤å½“å‰ç”¨æˆ·è®¤è¯ä¿¡æ¯
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearCachedAuthenticationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        PrincipalCollection principalCollection <span class="token operator">=</span> SecurityUtils<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SimplePrincipalCollection principals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimplePrincipalCollection</span><span class="token punctuation">(</span>principalCollection<span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clearCachedAuthenticationInfo</span><span class="token punctuation">(</span>principals<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * æ¸…é™¤å½“å‰ç”¨æˆ·æƒé™ä¿¡æ¯
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearCachedAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        PrincipalCollection principalCollection <span class="token operator">=</span> SecurityUtils<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SimplePrincipalCollection principals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimplePrincipalCollection</span><span class="token punctuation">(</span>principalCollection<span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clearCachedAuthorizationInfo</span><span class="token punctuation">(</span>principals<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * æ¸…é™¤å½“å‰ç”¨æˆ·çš„è®¤è¯å’Œæˆæƒç¼“å­˜ä¿¡æ¯
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearAllCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearCachedAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearCachedAuthenticationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>è®¤è¯ä¿¡æ¯åœ¨é¡µé¢ä¸­æ˜¾ç¤ºã€‚</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FirstAction</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/first"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">first</span><span class="token punctuation">(</span>Model model<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// ä»shiroçš„sessionä¸­å–å‡ºactiveUser</span>
        Subject subject <span class="token operator">=</span> SecurityUtils<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å–å‡ºèº«ä»½ä¿¡æ¯</span>
        ActiveUser activeUser <span class="token operator">=</span> <span class="token punctuation">(</span>ActiveUser<span class="token punctuation">)</span> subject<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// é€šè¿‡modelä¼ åˆ°é¡µé¢</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"activeUser"</span><span class="token punctuation">,</span> activeUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"/first"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>ç”¨æˆ·åœ¨è®¤è¯é€šè¿‡åè¯·æ±‚éœ€è¦æƒé™çš„èµ„æºæ—¶ä¼šè¢«<code>PermissionsAuthorizationFilter</code>æ‹¦æˆªï¼Œè°ƒç”¨<code>Realm</code>ä¸­çš„<code>doGetAuthorizationInfo</code>è·å–æ•°æ®åº“ä¸­æ­£ç¡®çš„æƒé™ï¼ŒäºŒè€…è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸é€šè¿‡ï¼Œè·³è½¬åˆ°æˆæƒå¤±è´¥é¡µé¢ã€‚</p>
<p>springmvc.xml</p>
<pre class=" language-xml"><code class="language-xml">    <span class="token comment" spellcheck="true">&lt;!-- å¼€å¯aopï¼Œå¯¹ç±»ä»£ç† --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span> <span class="token attr-name">proxy-target-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- å¼€å¯shiroæ³¨è§£æ”¯æŒ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>securityManager<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/queryItems"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span><span class="token string">"item:query"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// @RequiresRoles(value = {"admin", "student"}, logical = Logical.OR)</span>
<span class="token keyword">public</span> ModelAndView <span class="token function">queryItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>å¦ä¸€ç§æ–¹å¼åœ¨JSPæ ‡ç­¾æˆæƒã€‚</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%@</span> <span class="token attr-name">taglib</span> <span class="token attr-name">uri</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://shiro.apache.org/tags<span class="token punctuation">"</span></span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shiro<span class="token punctuation">"</span></span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- æœ‰item:updateæƒé™æ‰ç°å®ä¿®æ”¹é“¾æ¥ï¼Œæ²¡æœ‰æƒé™åˆ™ä¸æ˜¾ç¤ºä¿®æ”¹é“¾æ¥ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">shiro:</span>hasPermission</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item:update<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${pageContext.request.contextPath}/items/editItems.action?id<span class="token punctuation">=</span>${item.id}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ä¿®æ”¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">shiro:</span>hasPermission</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span></code></pre>
<table>
<thead>
<tr>
<th>æ ‡ç­¾åç§°</th>
<th align="left">æ ‡ç­¾æ¡ä»¶ï¼ˆå‡æ˜¯æ˜¾ç¤ºæ ‡ç­¾å†…å®¹ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;shiro:authenticated&gt;</code></td>
<td align="left">ç™»å½•ä¹‹å</td>
</tr>
<tr>
<td><code>&lt;shiro:notAuthenticated&gt;</code></td>
<td align="left">ä¸åœ¨ç™»å½•çŠ¶æ€æ—¶</td>
</tr>
<tr>
<td><code>&lt;shiro:guest&gt;</code></td>
<td align="left">ç”¨æˆ·åœ¨æ²¡æœ‰RememberMeæ—¶</td>
</tr>
<tr>
<td><code>&lt;shiro:user&gt;</code></td>
<td align="left">ç”¨æˆ·åœ¨RememberMeæ—¶</td>
</tr>
<tr>
<td><code>&lt;shiro:hasAnyRoles name=&quot;abc,123&quot; &gt;</code></td>
<td align="left">åœ¨æœ‰abcæˆ–è€…123è§’è‰²æ—¶</td>
</tr>
<tr>
<td><code>&lt;shiro:hasRole name=&quot;abc&quot;&gt;</code></td>
<td align="left">æ‹¥æœ‰è§’è‰²abc</td>
</tr>
<tr>
<td><code>&lt;shiro:lacksRole name=&quot;abc&quot;&gt;</code></td>
<td align="left">æ²¡æœ‰è§’è‰²abc</td>
</tr>
<tr>
<td><code>&lt;shiro:hasPermission name=&quot;abc&quot;&gt;</code></td>
<td align="left">æ‹¥æœ‰æƒé™èµ„æºabc</td>
</tr>
<tr>
<td><code>&lt;shiro:lacksPermission name=&quot;abc&quot;&gt;</code></td>
<td align="left">æ²¡æœ‰abcæƒé™èµ„æº</td>
</tr>
<tr>
<td><code>&lt;shiro:principal&gt;</code></td>
<td align="left">æ˜¾ç¤ºç”¨æˆ·èº«ä»½åç§°</td>
</tr>
<tr>
<td><code>&lt;shiro:principal property=&quot;username&quot;/&gt;</code></td>
<td align="left">æ˜¾ç¤ºç”¨æˆ·èº«ä»½ä¸­çš„å±æ€§å€¼</td>
</tr>
</tbody></table>
<p>è®¤è¯ä¹‹å‰è¿›è¡ŒéªŒè¯ç æ ¡éªŒï¼Œè€ŒShiroæä¾›çš„<code>FormAuthenticationFilter</code>ä¸­æ²¡æœ‰å¯¹éªŒè¯ç è¿›è¡Œè®¤è¯ã€‚</p>
<p>éœ€è¦ç»§æ‰¿<code>FormAuthenticationFilter</code>ï¼Œåœ¨è®¤è¯ä¹‹å‰è¿›è¡ŒéªŒè¯ç æ ¡éªŒã€‚</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomFromAuthenticationFilter</span> <span class="token keyword">extends</span> <span class="token class-name">FormAuthenticationFilter</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// æ‰€æœ‰è¯·æ±‚éƒ½ä¼šç»è¿‡çš„æ–¹æ³•</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">onAccessDenied</span><span class="token punctuation">(</span>ServletRequest request<span class="token punctuation">,</span> ServletResponse response<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// éªŒè¯ç çš„æ ¡éªŒ</span>
        HttpServletRequest httpServletRequest <span class="token operator">=</span> <span class="token punctuation">(</span>HttpServletRequest<span class="token punctuation">)</span> request<span class="token punctuation">;</span>
        HttpSession session <span class="token operator">=</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å–å‡ºsessionä¸­çš„æ­£ç¡®éªŒè¯ç </span>
        String validateCode <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"validateCode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// å–å‡ºé¡µé¢çš„éªŒè¯ç </span>
        String randomcode <span class="token operator">=</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"randomcode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>randomcode <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> validateCode <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>randomcode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>validateCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// æ ¡éªŒå¤±è´¥ï¼Œå°†éªŒè¯ç é”™è¯¯çš„å¤±è´¥ä¿¡æ¯ï¼Œé€šè¿‡shiroLoginFailureè®¾ç½®åˆ°requestä¸­</span>
            httpServletRequest<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"shiroLoginFailure"</span><span class="token punctuation">,</span> <span class="token string">"randomCodeError"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// æ‹’ç»è®¿é—®ï¼Œä¸å†æ ¡éªŒè´¦å·å’Œå¯†ç </span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAccessDenied</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// isAccessAllowed</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ç™»å½•é¡µé¢</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginform<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginform<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${baseurl}login.action<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">cellSpacing</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span> <span class="token attr-name">cellPadding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>ç”¨æˆ·åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colSpan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>usercode<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>å¯†ç ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pwd<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>éªŒè¯ç ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>randomcode<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>randomcode<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>randomcode_img<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>${baseurl}validatecode.jsp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>javascript:randomcode_refresh()</span><span class="token punctuation">></span></span>åˆ·æ–°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rememberMe<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>è‡ªåŠ¨ç™»å½•
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colSpan</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnalink<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loginsubmit()<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ç™»å½•<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reset<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btnalink<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>é‡ç½®<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre>
<p>ç”¨æˆ·æ­£å¸¸é€€å‡ºï¼Œç¼“å­˜è‡ªåŠ¨æ¸…ç©º</p>
<p>ç”¨æˆ·éæ­£å¸¸é€€å‡ºï¼Œç¼“å­˜è‡ªåŠ¨æ¸…ç©ºã€‚</p>
<p>å¦‚æœä¿®æ”¹äº†ç”¨æˆ·çš„æƒé™ï¼Œè€Œç”¨æˆ·ä¸é€€å‡ºç³»ç»Ÿï¼Œä¿®æ”¹çš„æƒé™æ— æ³•ç«‹å³ç”Ÿæ•ˆï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>Realm</code>çš„<code>clearCache</code>æ–¹æ³•æ¸…é™¤ç¼“å­˜ã€‚</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClearShiroCache</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> CustomRealm customRealm<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/clearShiroCache"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">clearShiroCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// æ¸…é™¤ç¼“å­˜ è¦åœ¨serviceè°ƒç”¨</span>
        customRealm<span class="token punctuation">.</span><span class="token function">clearCached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>shiro-ehcache.xml</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ehcache</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>noNamespaceSchemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../config/ehcache.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- diskStoreï¼šç¼“å­˜æ•°æ®æŒä¹…åŒ–çš„ç›®å½• åœ°å€  --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diskStore</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/xxx/ehcache<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultCache</span>
            <span class="token attr-name">maxElementsInMemory</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span>
            <span class="token attr-name">maxElementsOnDisk</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10000000<span class="token punctuation">"</span></span>
            <span class="token attr-name">eternal</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
            <span class="token attr-name">overflowToDisk</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
            <span class="token attr-name">diskPersistent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
            <span class="token attr-name">timeToIdleSeconds</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name">timeToLiveSeconds</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name">diskExpiryThreadIntervalSeconds</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name">memoryStoreEvictionPolicy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultCache</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ehcache</span><span class="token punctuation">></span></span></code></pre>
<p>Shiroçš„è¿‡æ»¤å™¨</p>
<ul>
<li><p>è®¤è¯è¿‡æ»¤å™¨</p>
<ul>
<li><p><code>/admins/**=anon</code>ï¼šè¯¥è·¯å¾„ä¸‹çš„èµ„æºå¯ä»¥åŒ¿åä½¿ç”¨ã€‚</p>
</li>
<li><p><code>/admins/user/**=authc</code>ï¼šè¯¥è·¯å¾„ä¸‹çš„èµ„æºéœ€è¦è®¤è¯ã€‚</p>
</li>
<li><p><code>/admins/user/**=user</code>ï¼šè¡¨ç¤ºå¿…é¡»å­˜åœ¨ç”¨æˆ·ï¼Œèº«ä»½è®¤è¯é€šè¿‡æˆ–é€šè¿‡è®°ä½æˆ‘è®¤è¯é€šè¿‡çš„å¯ä»¥è®¿é—®ï¼Œå½“ç™»å…¥æ“ä½œæ—¶ä¸åšæ£€æŸ¥ã€‚</p>
</li>
</ul>
</li>
<li><p>æˆæƒè¿‡æ»¤å™¨</p>
<ul>
<li><p><code>/admins/user/**=perms[&quot;user:add:*, user:modify:*&quot;]</code>ï¼šå½“æœ‰å¤šä¸ªå‚æ•°æ—¶å¿…é¡»æ¯ä¸ªå‚æ•°éƒ½é€šè¿‡æ‰é€šè¿‡ï¼Œç›¸å½“äº<code>isPermitedAll()</code>æ–¹æ³•ã€‚</p>
</li>
<li><p><code>/admins/user/**=roles[&quot;admin, guest&quot;]</code>ï¼šæ¯ä¸ªå‚æ•°é€šè¿‡æ‰ç®—é€šè¿‡ï¼Œç›¸å½“äº<code>hasAllRoles()</code>æ–¹æ³•ã€‚</p>
</li>
<li><p><code>/admins/user/**=rest[user]</code>ï¼šæ ¹æ®è¯·æ±‚çš„æ–¹æ³•ï¼Œç›¸å½“äº<code>/admins/user/**=perms[user:method]</code>ï¼Œå…¶ä¸­methodä¸ºpostï¼Œgetï¼Œdeleteç­‰ã€‚</p>
</li>
</ul>
</li>
</ul>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


        <footer>
             
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

        </footer>
    </div>
    <!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
    <script>
        var timeEnd = new Date();
        console.log('è€—æ—¶ï¼š' + (timeEnd - timeStart));
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre').forEach((block) => {
                block.classList.add("line-numbers");
            });
        });
    </script>
    <!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
    <!-- material design -->
    <!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
    <!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
    <!-- toc -->
    <!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
    <!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
    <!-- <script src="/js/main.js"></script> -->
    <script src="/js/prism.js"></script>
</body>
</html>
