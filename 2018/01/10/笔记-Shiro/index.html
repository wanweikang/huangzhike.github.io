<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-Shiro | 学而时习之</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-Shiro">
		
		<meta property="og:site_name" content="学而时习之">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">学而时习之</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-Shiro</h2>
				
				<div>
					<div class="post-time">2018-01-10</div>
				</div>
				
				<div class="article-content">
				<ul>
<li><a href="https://github.com/codingXiaxw/shiro" target="_blank" rel="noopener">主要来源</a></li>
</ul>
<p>题外话：话说原作者博客写得很好，但是GitHub上面的项目有些运行不了。。。而且有错误。。。额。。。IDEA直接导入，改改数据库就行。。。结果根本跑不起来。。。一开始我还一个一个去排除，后来干脆直接看代码了。。。</p>
<p>另一个题外话：Shiro这东西一点也不优雅。。。</p>
<hr>
<ul>
<li><p>subject：主体，进行身份认证。</p>
</li>
<li><p>principal：身份，可以有多个，如用户名，邮箱；只有一个主身份信息（primary principal）。</p>
</li>
<li><p>credential：凭证，如密码。</p>
</li>
</ul>
<p>主体在进行身份认证时需要提供身份信息和凭证信息。</p>
<p>权限数据模型：</p>
<p>用户（账号和密码）、角色（角色名称）、权限（资源和权限）、用户角色关系（用户id、角色id）、角色权限关系（角色id、权限id）。</p>
<p>通常将资源表和权限表合并为一张权限表。</p>
<p>角色：可以理解为权限的集合，一般赋予用户角色而不是权限，这样用户可以拥有一组权限。</p>
<ul>
<li><p>基于角色的访问控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (user.hasRole(&apos;部门经理&apos;)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">if (user.hasRole(&apos;部门经理&apos;) || user.hasRole(&apos;总经理&apos;)) &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>基于资源的访问控制（建议使用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (user.hasPermission(&apos;权限标识符&apos;)) &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Authentication：认证。</p>
</li>
<li><p>Authorization：授权，某个已认证的用户是否拥有某个权限。</p>
</li>
<li><p>Cryptography：加密，如密码加密存储到数据库，而不是明文存储。</p>
</li>
<li><p>Remember Me：记住我，即一次登录后，下次再来的话不用登录了。</p>
</li>
<li><p>Subject：主体，所有Subject都绑定到SecurityManager，与Subject的所有交互都委托给SecurityManager。</p>
</li>
<li><p>SecurityManager：安全管理器；可以看成DispatcherServlet前端控制器。</p>
</li>
<li><p>Realm：域，从Realm获取安全数据（如用户、角色、权限）。</p>
</li>
</ul>
<p>Shiro支持三种授权的方式。</p>
<ul>
<li><p>第一种：编程式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line">if (subject.hasRole(&quot;admin&quot;)) &#123;</span><br><span class="line">	// 有权限  </span><br><span class="line">&#125; else &#123;</span><br><span class="line">	// 无权限  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第二种：注解式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RequiresRoles(&quot;admin&quot;)</span><br><span class="line">public void hello() &#123;</span><br><span class="line">	//有权限  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三种：JSP标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;shiro:hasRole name=&quot;admin&quot;&gt;</span><br><span class="line">&lt;/shiro:hasRole&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>实际开发中使用后两种方式。</p>
<p>web.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- shiro filter，DelegatingFilterProxy通过代理模式将容器中的bean和此filter关联 --&gt;</span><br><span class="line">&lt;filter&gt;</span><br><span class="line">	&lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;</span><br><span class="line">	&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;</span><br><span class="line">	&lt;init-param&gt;</span><br><span class="line">		&lt;param-name&gt;targetFilterLifecycle&lt;/param-name&gt;</span><br><span class="line">		&lt;!-- 该值缺省为 false 生命周期由 SpringApplicationContext 管理 --&gt;</span><br><span class="line">		&lt;!-- true 则表示由 ServletContainer 管理 --&gt;</span><br><span class="line">		&lt;param-value&gt;true&lt;/param-value&gt;</span><br><span class="line">	&lt;/init-param&gt;</span><br><span class="line">	&lt;!-- filter bean id，不设置则找与filter-name同名bean --&gt;</span><br><span class="line">	&lt;init-param&gt;</span><br><span class="line">		&lt;param-name&gt;targetBeanName&lt;/param-name&gt;</span><br><span class="line">		&lt;param-value&gt;shiroFilter&lt;/param-value&gt;</span><br><span class="line">	&lt;/init-param&gt;</span><br><span class="line">&lt;/filter&gt;</span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">	&lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;</span><br><span class="line">	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">&lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure></p>
<p>applicationContext-shiro.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- web.xml shiro filter bean --&gt;</span><br><span class="line">&lt;bean id=&quot;shiroFilter&quot; class=&quot;org.apache.shiro.spring.web.ShiroFilterFactoryBean&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;securityManager&quot; ref=&quot;securityManager&quot;/&gt;</span><br><span class="line">	&lt;!-- 认证提交地址，没有认证会请求此地址认证，由formAuthenticationFilter进行表单认证 --&gt;</span><br><span class="line">	&lt;property name=&quot;loginUrl&quot; value=&quot;/login.action&quot;/&gt;</span><br><span class="line">	&lt;!-- 认证成功统一跳转地址，不配置的话认证成功会自动到上一个请求路径 --&gt;</span><br><span class="line">	&lt;!-- &lt;property name=&quot;successUrl&quot; value=&quot;&quot;/&gt; --&gt;</span><br><span class="line">	&lt;property name=&quot;unauthorizedUrl&quot; value=&quot;/refuse.jsp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 自定义filter --&gt;</span><br><span class="line">	&lt;property name=&quot;filters&quot;&gt;</span><br><span class="line">		&lt;map&gt;</span><br><span class="line">			&lt;!-- 将自定义的FormAuthenticationFilter注入shiroFiler --&gt;</span><br><span class="line">			&lt;entry key=&quot;authc&quot; value-ref=&quot;formAuthenticationFilter&quot;/&gt;</span><br><span class="line">		&lt;/map&gt;</span><br><span class="line">	&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 过虑器链，从上向下拦截，一般将/**放在最下边 --&gt;</span><br><span class="line">	&lt;property name=&quot;filterChainDefinitions&quot;&gt;</span><br><span class="line">		&lt;value&gt;</span><br><span class="line">			&lt;!-- 下面value值的第一个&apos;/&apos;代表的路径是相对于HttpServletRequest.getContextPath() --&gt; </span><br><span class="line">			&lt;!-- 静态资源设置匿名访问 --&gt;</span><br><span class="line">			/img/**=anon</span><br><span class="line">			/js/**=anon</span><br><span class="line">			/css/**=anon</span><br><span class="line">			&lt;!-- 验证码 --&gt;</span><br><span class="line">			/validatecode.jsp=anon</span><br><span class="line">			&lt;!-- 请求这个地址就自动退出，LogoutFilter拦截，自动注销清除session --&gt;</span><br><span class="line">			/logout.action=logout</span><br><span class="line">			&lt;!-- 需要item:query权限，取消url拦截配置，采用注解 --&gt;</span><br><span class="line">			&lt;!-- /items/queryItems.action=perms[item:query] --&gt;</span><br><span class="line">			&lt;!-- 配置记住我或认证通过可以访问的地址 --&gt;</span><br><span class="line">			&lt;!-- 使用UserFilter，将记住我即可访问的地址配置让UserFilter拦截，不然会被/**=authc拦截 --&gt;</span><br><span class="line">			/index.jsp=user </span><br><span class="line">			/first.action=user </span><br><span class="line">			/welcome.jsp=user</span><br><span class="line">			&lt;!-- -/**=authc 表示所有的url都必须认证才可以访问 --&gt;</span><br><span class="line">			/**=authc</span><br><span class="line">			&lt;!-- /**=anon 表示所有的url都可以匿名访问 --&gt;</span><br><span class="line">		&lt;/value&gt;</span><br><span class="line">	&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 安全管理器 --&gt;</span><br><span class="line">&lt;bean id=&quot;securityManager&quot; class=&quot;org.apache.shiro.web.mgt.DefaultWebSecurityManager&quot;&gt;</span><br><span class="line">	&lt;!-- 注入Realm --&gt;</span><br><span class="line">	&lt;!-- Single realm app. If you have multiple realms, use the &apos;realms&apos; property instead. --&gt;</span><br><span class="line">	&lt;property name=&quot;realm&quot; ref=&quot;customRealm&quot;/&gt;</span><br><span class="line">	&lt;!-- 注入缓存管理器 --&gt;</span><br><span class="line">	&lt;property name=&quot;cacheManager&quot; ref=&quot;cacheManager&quot;/&gt;</span><br><span class="line">	&lt;!-- 注入会话管理器 --&gt;</span><br><span class="line">	&lt;property name=&quot;sessionManager&quot; ref=&quot;sessionManager&quot;/&gt;</span><br><span class="line">	&lt;!-- 记住我 --&gt;</span><br><span class="line">	&lt;property name=&quot;rememberMeManager&quot; ref=&quot;rememberMeManager&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 相当于调用SecurityUtils.setSecurityManager(securityManager) --&gt;</span><br><span class="line">&lt;bean class=&quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;staticMethod&quot; value=&quot;org.apache.shiro.SecurityUtils.setSecurityManager&quot;/&gt;</span><br><span class="line">	&lt;property name=&quot;arguments&quot; ref=&quot;securityManager&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 自定义Realm --&gt;</span><br><span class="line">&lt;bean id=&quot;customRealm&quot; class=&quot;shiro.CustomRealm&quot;&gt;</span><br><span class="line">	&lt;!-- 将凭证匹配器设置到realm中，realm按照凭证匹配器要求进行散列 --&gt;</span><br><span class="line">	&lt;property name=&quot;credentialsMatcher&quot; ref=&quot;credentialsMatcher&quot;/&gt;</span><br><span class="line">	&lt;!-- 开启缓存 --&gt;</span><br><span class="line">	&lt;property name=&quot;cachingEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">	&lt;!-- 认证信息:这里不进行缓存 --&gt;</span><br><span class="line">	&lt;property name=&quot;authenticationCachingEnabled&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">	&lt;!-- ehcache中配置的认证缓存名称 --&gt;</span><br><span class="line">	&lt;property name=&quot;authenticationCacheName&quot; value=&quot;authenticationCache&quot;/&gt;</span><br><span class="line">	&lt;!-- 授权信息:这里进行缓存 --&gt;</span><br><span class="line">	&lt;property name=&quot;authorizationCachingEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">	&lt;!-- ehcache中配置的授权缓存名称 --&gt;</span><br><span class="line">	&lt;property name=&quot;authorizationCacheName&quot; value=&quot;authorizationCache&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 自定义form认证过滤器 --&gt;</span><br><span class="line">&lt;bean id=&quot;formAuthenticationFilter&quot; class=&quot;shiro.CustomFromAuthenticationFilter&quot;&gt;</span><br><span class="line">	&lt;!-- 表单账号的input名 --&gt;</span><br><span class="line">	&lt;property name=&quot;usernameParam&quot; value=&quot;username&quot;/&gt;</span><br><span class="line">	&lt;!-- 表单密码的input名 --&gt;</span><br><span class="line">	&lt;property name=&quot;passwordParam&quot; value=&quot;password&quot;/&gt;</span><br><span class="line">	&lt;!-- rememberMe的input名 --&gt;</span><br><span class="line">	&lt;property name=&quot;rememberMeParam&quot; value=&quot;rememberMe&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 凭证匹配器 --&gt;</span><br><span class="line">&lt;bean id=&quot;credentialsMatcher&quot; class=&quot;org.apache.shiro.authc.credential.HashedCredentialsMatcher&quot;&gt;</span><br><span class="line">	&lt;!-- 数据库中存储到的md5的散列值，在Realm中需要设置数据库中的散列值 --&gt;</span><br><span class="line">	&lt;!-- 让Shiro进行散列对比时和原始数据库中的散列值使用的算法一致 --&gt;</span><br><span class="line">	&lt;property name=&quot;hashAlgorithmName&quot; value=&quot;md5&quot;/&gt;</span><br><span class="line">	&lt;property name=&quot;hashIterations&quot; value=&quot;1&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 缓存管理器 --&gt;</span><br><span class="line">&lt;!-- ehcache-core.jar --&gt;</span><br><span class="line">&lt;!-- shiro-ehcache.jar --&gt;</span><br><span class="line">&lt;!-- 默认关闭认证缓存，默认开启授权缓存 --&gt;</span><br><span class="line">&lt;!-- 用户认证通过时，该用户第一次授权，调用Realm查询数据库查询该用户的授权信息然后给该用户授权 --&gt;</span><br><span class="line">&lt;!-- 用户第二次授权时，不调用Realm查询数据库，直接从缓存中取出授权信息（权限标识符）然后给该用户授权 --&gt;</span><br><span class="line">&lt;bean id=&quot;cacheManager&quot; class=&quot;org.apache.shiro.cache.ehcache.EhCacheManager&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;cacheManagerConfigFile&quot; value=&quot;classpath:shiro-ehcache.xml&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 会话管理器 --&gt;</span><br><span class="line">&lt;bean id=&quot;sessionManager&quot; class=&quot;org.apache.shiro.web.session.mgt.DefaultWebSessionManager&quot;&gt;</span><br><span class="line">	&lt;!-- session的失效时长，单位毫秒 --&gt;</span><br><span class="line">	&lt;property name=&quot;globalSessionTimeout&quot; value=&quot;600000&quot;/&gt;</span><br><span class="line">	&lt;!-- 删除失效的session --&gt;</span><br><span class="line">	&lt;property name=&quot;deleteInvalidSessions&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">	&lt;!-- 会话Cookie模板 --&gt;</span><br><span class="line">	&lt;property name=&quot;sessionIdCookie&quot; ref=&quot;sessionIdCookie&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 会话Session ID生成器 --&gt;</span><br><span class="line">&lt;bean id=&quot;sessionIdGenerator&quot; class=&quot;org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 会话Cookie模板 --&gt;</span><br><span class="line">&lt;bean id=&quot;sessionIdCookie&quot; class=&quot;org.apache.shiro.web.servlet.SimpleCookie&quot;&gt;</span><br><span class="line">	&lt;constructor-arg value=&quot;sessionId&quot;/&gt;</span><br><span class="line">	&lt;!--cookie的有效时间 --&gt;</span><br><span class="line">	&lt;property name=&quot;maxAge&quot; value=&quot;-1&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- rememberMeManager管理器 --&gt;</span><br><span class="line">&lt;bean id=&quot;rememberMeManager&quot; class=&quot;org.apache.shiro.web.mgt.CookieRememberMeManager&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;cookie&quot; ref=&quot;rememberMeCookie&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 记住我cookie --&gt;</span><br><span class="line">&lt;!-- 登陆选择自动登陆本次登陆成功会向cookie写身份信息，下次登陆从cookie中取出身份信息实现自动登陆 --&gt;</span><br><span class="line">&lt;!-- 涉及到session的序列化与反序列化，POJO类应该实现Serializable接口，如ActiveUser SysPermission --&gt;</span><br><span class="line">&lt;bean id=&quot;rememberMeCookie&quot; class=&quot;org.apache.shiro.web.servlet.SimpleCookie&quot;&gt;</span><br><span class="line">	&lt;!-- rememberMe时cookie的名字 --&gt;</span><br><span class="line">	&lt;constructor-arg value=&quot;rememberMe&quot;/&gt;</span><br><span class="line">	&lt;!-- 记住我cookie生效时间7天 --&gt;</span><br><span class="line">	&lt;property name=&quot;maxAge&quot; value=&quot;604800&quot;/&gt;</span><br><span class="line">	&lt;!-- 会话Cookie模板 --&gt;</span><br><span class="line">	&lt;property name=&quot;sessionIdCookie&quot; ref=&quot;sessionIdCookie&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 生命周期 --&gt;</span><br><span class="line">&lt;!-- &lt;bean id=&quot;lifecycleBeanPostProcessor&quot; class=&quot;org.apache.shiro.spring.LifecycleBeanPostProcessor&quot;/&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 启用shiro注解 --&gt;</span><br><span class="line">&lt;!-- &lt;bean class=&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot; depends-on=&quot;lifecycleBeanPostProcessor&quot;/&gt; --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 开启shiro注解 --&gt;</span><br><span class="line">&lt;aop:config proxy-target-class=&quot;true&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;bean class=&quot;org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;securityManager&quot; ref=&quot;securityManager&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>Shiro实现登录认证</p>
<p>登录是在表单进行的，通过Shiro表单过滤器<code>FormAuthenticationFilter</code>实现。</p>
<p>用户没有认证时，请求<code>loginurl</code>认证，提交用户身份和密码，<code>FormAuthenticationFilter</code>拦截取出<code>request中</code>的<code>username</code>和<code>password</code>（<code>username</code>和<code>password</code>写死了）。</p>
<p><code>FormAuthenticationFilter</code>调用<code>Realm</code>传入一个<code>token</code>（<code>username</code>和<code>password</code>传入到<code>token</code>中），<code>Realm</code>认证时根据<code>username</code>在数据库中查询（将在数据库中查询到的信息保存在在<code>Activeuser</code>对象中，包括<code>userid</code>、<code>usercode</code>、<code>username</code>、<code>menus</code>），然后返回一个<code>AuthenticationInfo</code>对象。</p>
<p>如果查询不到，<code>Realm</code>返回<code>null</code>，同时<code>FormAuthenticationFilter</code>会向<code>request</code>域中填充异常信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class LoginController &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private SysService sysService;</span><br><span class="line"></span><br><span class="line">	// @RequestMapping(&quot;/login&quot;)</span><br><span class="line">	// public String login(HttpSession session, String randomcode, String usercode, String password)</span><br><span class="line">	//         throws Exception &#123;</span><br><span class="line">	//     // session中获取正确验证码</span><br><span class="line">	//     String validateCode = (String) session.getAttribute(&quot;validateCode&quot;);</span><br><span class="line">	//     if (!randomcode.equals(validateCode))</span><br><span class="line">	//         throw new CustomException(&quot;验证码不正确&quot;);</span><br><span class="line">	//     // 调用service校验用户帐号和密码的正确性</span><br><span class="line">	//     ActiveUser activeUser = sysService.authenticat(usercode, password);</span><br><span class="line">	//     // 如果service校验通过，将用户身份记录到session</span><br><span class="line">	//     session.setAttribute(&quot;activeUser&quot;, activeUser);</span><br><span class="line">	//     // 重定向</span><br><span class="line">	//     return &quot;redirect:/first.action&quot;;</span><br><span class="line">	// &#125;</span><br><span class="line"></span><br><span class="line">	// 登录提交地址，和配置的loginUrl一致</span><br><span class="line">	@RequestMapping(&quot;/login&quot;)</span><br><span class="line">	public String login(HttpServletRequest request) throws Exception &#123;</span><br><span class="line">		// 如果登录失败从request中获取认证异常信息</span><br><span class="line">		String exceptionClassName = (String) request.getAttribute(&quot;shiroLoginFailure&quot;);</span><br><span class="line">		// 抛出指定异常信息</span><br><span class="line">		if (exceptionClassName != null) &#123;</span><br><span class="line">			if (UnknownAccountException.class.getName().equals(exceptionClassName)) &#123;</span><br><span class="line">				// 最终抛给全局异常处理器（已配置）</span><br><span class="line">				throw new CustomException(&quot;账号不存在&quot;);</span><br><span class="line">			&#125; else if (IncorrectCredentialsException.class.getName().equals(exceptionClassName)) &#123;</span><br><span class="line">				throw new CustomException(&quot;用户名/密码错误&quot;);</span><br><span class="line">			&#125; else if (&quot;randomCodeError&quot;.equals(exceptionClassName)) &#123;</span><br><span class="line">				throw new CustomException(&quot;验证码错误&quot;);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				throw new Exception(); // 最终在异常处理器生成未知错误</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		// 此方法不处理登录成功，shiro认证成功会自动跳转到上一个路径</span><br><span class="line">		// 登录失败返回到login页面</span><br><span class="line">		return &quot;login&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// @RequestMapping(&quot;/logout&quot;)</span><br><span class="line">	// public String logout(HttpSession session) throws Exception &#123;</span><br><span class="line">	//     session.invalidate();</span><br><span class="line">	//     // 重定向</span><br><span class="line">	//     return &quot;redirect:/first.action&quot;;</span><br><span class="line">	// &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">public class CustomRealm extends AuthorizingRealm &#123;</span><br><span class="line"></span><br><span class="line">	// 注入service</span><br><span class="line">	@Autowired</span><br><span class="line">	private SysService sysService;</span><br><span class="line"></span><br><span class="line">	// 设置Realm名称</span><br><span class="line">	@Override</span><br><span class="line">	public void setName(String name) &#123;</span><br><span class="line">		super.setName(&quot;customRealm&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 认证信息 认证回调函数 登录时调用</span><br><span class="line">	 * 首先根据传入的用户名获取User信息；</span><br><span class="line">	 * 如果user为空，那么抛出没找到帐号异常UnknownAccountException；</span><br><span class="line">	 * 如果user找到但锁定了抛出锁定异常LockedAccountException；</span><br><span class="line">	 * 最后生成AuthenticationInfo信息，交给间接父类AuthenticatingRealm使用CredentialsMatcher进行判断密码是否匹配；</span><br><span class="line">	 * 如果不匹配将抛出密码错误异常IncorrectCredentialsException；</span><br><span class="line">	 * 另外如果密码重试次数太多将抛出超出重试次数异常ExcessiveAttemptsException；</span><br><span class="line">	 * 在组装SimpleAuthenticationInfo信息时，需要传入：身份信息（用户名）、凭据（密文密码）、加密盐（username+salt），</span><br><span class="line">	 * CredentialsMatcher使用盐加密传入的明文密码和此处的密文密码进行匹配。</span><br><span class="line">	 */</span><br><span class="line">	</span><br><span class="line">	// 先认证 从数据库查询用户信息 也可以实现AuthenticationToken</span><br><span class="line">	@Override</span><br><span class="line">	protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) </span><br><span class="line">			throws AuthenticationException &#123;</span><br><span class="line">		// 这里访问一次，可以计数一次，计数大于x时，设置用户被锁定一小时DisabledAccountException</span><br><span class="line"></span><br><span class="line">		// UsernamePasswordToken uPToken = (UsernamePasswordToken) token;</span><br><span class="line">		// String name = uPToken.getUsername();</span><br><span class="line">		// String password = String.valueOf(uPToken.getPassword());</span><br><span class="line"></span><br><span class="line">		// token是用户输入的，取出身份信息 userCode是bean的属性</span><br><span class="line">		String userCode = (String) token.getPrincipal();</span><br><span class="line">		// 密码</span><br><span class="line">		// String password = new String((char[]) token.getCredentials());</span><br><span class="line"></span><br><span class="line">		// 根据用户输入的userCode丛数据库查询</span><br><span class="line">		SysUser sysUser = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			sysUser = sysService.findSysUserByUserCode(userCode);</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		// 是否从数据库中查询到用户信息</span><br><span class="line">		if (sysUser == null) &#123;</span><br><span class="line">			throw new UnknownAccountException();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (Boolean.TRUE.equals(sysUser.getLocked())) &#123;</span><br><span class="line">			throw new LockedAccountException();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		// activeUser就是用户的身份信息principal，你也可以用username什么的代替</span><br><span class="line">		ActiveUser activeUser = new ActiveUser();</span><br><span class="line">		activeUser.setUserid(sysUser.getId());</span><br><span class="line">		activeUser.setUsercode(sysUser.getUsercode());</span><br><span class="line">		activeUser.setUsername(sysUser.getUsername());</span><br><span class="line"></span><br><span class="line">		// 根据用户id，service取出菜单</span><br><span class="line">		List&lt;SysPermission&gt; menus = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			menus = sysService.findMenuListByUserId(sysUser.getId());</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		// 将用户菜单设置到activeUser，成功登录后用户菜单显示</span><br><span class="line">		activeUser.setMenus(menus);</span><br><span class="line"></span><br><span class="line">		// 从数据库查询出来的账号名和密码与用户输入的账号和密码对比</span><br><span class="line">		// 当用户执行登录时 在方法处理上要实现subject.login(token);</span><br><span class="line">		// 然后会自动进入这个类进行认证</span><br><span class="line"></span><br><span class="line">		// 通过realm将用户输入的信息和从数据库中查到的数据进行对比</span><br><span class="line">		// 查不到返回null，查询到，返回认证信息AuthenticationInfo</span><br><span class="line">		// 交给AuthenticatingRealm使用CredentialsMatcher进行密码匹配，觉得不好可以自定义实现</span><br><span class="line">		AuthenticationInfo simpleAuthenticationInfo = new SimpleAuthenticationInfo(</span><br><span class="line">			activeUser, </span><br><span class="line">			sysUser.getPassword(), </span><br><span class="line">			// ByteSource.Util.bytes(username + userEntity.getCredentialsSalt()), // salt=username+salt</span><br><span class="line">			ByteSource.Util.bytes(sysUser.getSalt()), </span><br><span class="line">			this.getName() // realm name</span><br><span class="line">		);</span><br><span class="line">		return simpleAuthenticationInfo;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 只有需要验证权限时才会调用, 授权查询回调函数, 进行鉴权但缓存中无用户的授权信息时调用</span><br><span class="line">	 * 在配有缓存的情况下，只加载一次</span><br><span class="line">	 */</span><br><span class="line">	// 再授权</span><br><span class="line">	@Override</span><br><span class="line">	protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123;</span><br><span class="line"></span><br><span class="line">		// 从principals获取主身份信息，上边认证填充到SimpleAuthenticationInfo</span><br><span class="line">		ActiveUser activeUser = (ActiveUser) principals.getPrimaryPrincipal();</span><br><span class="line"></span><br><span class="line">		// 根据身份信息从数据库中获取权限数据，简单起见就不用try catch了</span><br><span class="line">		List&lt;SysPermission&gt; permissionList = sysService.findPermissionListByUserId(activeUser.getUserid());</span><br><span class="line"></span><br><span class="line">		List&lt;String&gt; permissions = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">		if (permissionList != null) &#123;</span><br><span class="line">			for (SysPermission sysPermission : permissionList) &#123;</span><br><span class="line">				// 将权限标签符放入集合</span><br><span class="line">				permissions.add(sysPermission.getPercode());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		// 返回授权信息</span><br><span class="line">		SimpleAuthorizationInfo simpleAuthorizationInfo = new SimpleAuthorizationInfo();</span><br><span class="line"></span><br><span class="line">		// 将上边查询到授权信息填充到simpleAuthorizationInfo对象中</span><br><span class="line">		simpleAuthorizationInfo.addStringPermissions(permissions);</span><br><span class="line">		// simpleAuthorizationInfo.setRoles(sysService.findRoles(&quot;xxx&quot;));</span><br><span class="line">		return simpleAuthorizationInfo;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 清除缓存，要放在service中调用</span><br><span class="line">	public void clearCached() &#123;</span><br><span class="line">		PrincipalCollection principals = SecurityUtils.getSubject().getPrincipals();</span><br><span class="line">		super.clearCache(principals);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 清除用户认证信息</span><br><span class="line">	 */</span><br><span class="line">	@Override</span><br><span class="line">	public void clearCachedAuthenticationInfo(PrincipalCollection principalCollection) &#123;</span><br><span class="line">		SimplePrincipalCollection principals = new SimplePrincipalCollection(principalCollection, getName());</span><br><span class="line">		super.clearCachedAuthenticationInfo(principals);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 清除指定 principalCollection 的权限信息</span><br><span class="line">	 */</span><br><span class="line">	@Override</span><br><span class="line">	public void clearCachedAuthorizationInfo(PrincipalCollection principalCollection) &#123;</span><br><span class="line">		SimplePrincipalCollection principals = new SimplePrincipalCollection(principalCollection, getName());</span><br><span class="line">		super.clearCachedAuthorizationInfo(principals);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 清除当前用户认证信息</span><br><span class="line">	 */</span><br><span class="line">	public void clearCachedAuthenticationInfo() &#123;</span><br><span class="line">		PrincipalCollection principalCollection = SecurityUtils.getSubject().getPrincipals();</span><br><span class="line">		SimplePrincipalCollection principals = new SimplePrincipalCollection(principalCollection, getName());</span><br><span class="line">		super.clearCachedAuthenticationInfo(principals);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 清除当前用户权限信息</span><br><span class="line">	 */</span><br><span class="line">	public void clearCachedAuthorizationInfo() &#123;</span><br><span class="line">		PrincipalCollection principalCollection = SecurityUtils.getSubject().getPrincipals();</span><br><span class="line">		SimplePrincipalCollection principals = new SimplePrincipalCollection(principalCollection, getName());</span><br><span class="line">		super.clearCachedAuthorizationInfo(principals);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 清除当前用户的认证和授权缓存信息</span><br><span class="line">	 */</span><br><span class="line">	public void clearAllCache() &#123;</span><br><span class="line">		clearCachedAuthorizationInfo();</span><br><span class="line">		clearCachedAuthenticationInfo();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>认证信息在页面中显示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class FirstAction &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;/first&quot;)</span><br><span class="line">	public String first(Model model) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">		// 从shiro的session中取出activeUser</span><br><span class="line">		Subject subject = SecurityUtils.getSubject();</span><br><span class="line">		// 取出身份信息</span><br><span class="line">		ActiveUser activeUser = (ActiveUser) subject.getPrincipal();</span><br><span class="line">		// 通过model传到页面</span><br><span class="line">		model.addAttribute(&quot;activeUser&quot;, activeUser);</span><br><span class="line">		return &quot;/first&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户在认证通过后请求需要权限的资源时会被<code>PermissionsAuthorizationFilter</code>拦截，调用<code>Realm</code>中的<code>doGetAuthorizationInfo</code>获取数据库中正确的权限，二者进行对比，如果不通过，跳转到授权失败页面。</p>
<p>springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启aop，对类代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启shiro注解支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/queryItems"</span>)</span><br><span class="line"><span class="meta">@RequiresPermissions</span>(<span class="string">"item:query"</span>)</span><br><span class="line"><span class="comment">// @RequiresRoles(value = &#123;"admin", "student"&#125;, logical = Logical.OR)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">queryItems</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>另一种方式在JSP标签授权。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://shiro.apache.org/tags"</span> <span class="attr">prefix</span>=<span class="string">"shiro"</span> %&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 有item:update权限才现实修改链接，没有权限则不显示修改链接 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">shiro:hasPermission</span> <span class="attr">name</span>=<span class="string">"item:update"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/items/editItems.action?id=$&#123;item.id&#125;"</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">shiro:hasPermission</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>标签名称</th>
<th style="text-align:left">标签条件（均是显示标签内容）</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;shiro:authenticated&gt;</code></td>
<td style="text-align:left">登录之后</td>
</tr>
<tr>
<td><code>&lt;shiro:notAuthenticated&gt;</code></td>
<td style="text-align:left">不在登录状态时</td>
</tr>
<tr>
<td><code>&lt;shiro:guest&gt;</code></td>
<td style="text-align:left">用户在没有RememberMe时</td>
</tr>
<tr>
<td><code>&lt;shiro:user&gt;</code></td>
<td style="text-align:left">用户在RememberMe时</td>
</tr>
<tr>
<td><code>&lt;shiro:hasAnyRoles name=&quot;abc,123&quot; &gt;</code></td>
<td style="text-align:left">在有abc或者123角色时</td>
</tr>
<tr>
<td><code>&lt;shiro:hasRole name=&quot;abc&quot;&gt;</code></td>
<td style="text-align:left">拥有角色abc</td>
</tr>
<tr>
<td><code>&lt;shiro:lacksRole name=&quot;abc&quot;&gt;</code></td>
<td style="text-align:left">没有角色abc</td>
</tr>
<tr>
<td><code>&lt;shiro:hasPermission name=&quot;abc&quot;&gt;</code></td>
<td style="text-align:left">拥有权限资源abc</td>
</tr>
<tr>
<td><code>&lt;shiro:lacksPermission name=&quot;abc&quot;&gt;</code></td>
<td style="text-align:left">没有abc权限资源</td>
</tr>
<tr>
<td><code>&lt;shiro:principal&gt;</code></td>
<td style="text-align:left">显示用户身份名称</td>
</tr>
<tr>
<td><code>&lt;shiro:principal property=&quot;username&quot;/&gt;</code></td>
<td style="text-align:left">显示用户身份中的属性值</td>
</tr>
</tbody>
</table>
<p>认证之前进行验证码校验，而Shiro提供的<code>FormAuthenticationFilter</code>中没有对验证码进行认证。</p>
<p>需要继承<code>FormAuthenticationFilter</code>，在认证之前进行验证码校验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class CustomFromAuthenticationFilter extends FormAuthenticationFilter &#123;</span><br><span class="line"></span><br><span class="line">	// 所有请求都会经过的方法</span><br><span class="line">	@Override</span><br><span class="line">	protected boolean onAccessDenied(ServletRequest request, ServletResponse response) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">		// 验证码的校验</span><br><span class="line">		HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">		HttpSession session = httpServletRequest.getSession();</span><br><span class="line">		// 取出session中的正确验证码</span><br><span class="line">		String validateCode = (String) session.getAttribute(&quot;validateCode&quot;);</span><br><span class="line"></span><br><span class="line">		// 取出页面的验证码</span><br><span class="line">		String randomcode = httpServletRequest.getParameter(&quot;randomcode&quot;);</span><br><span class="line">		if (randomcode != null &amp;&amp; validateCode != null &amp;&amp; !randomcode.equals(validateCode)) &#123;</span><br><span class="line">			// 校验失败，将验证码错误的失败信息，通过shiroLoginFailure设置到request中</span><br><span class="line">			httpServletRequest.setAttribute(&quot;shiroLoginFailure&quot;, &quot;randomCodeError&quot;);</span><br><span class="line">			// 拒绝访问，不再校验账号和密码</span><br><span class="line">			return true;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		return super.onAccessDenied(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// isAccessAllowed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>登录页面<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"loginform"</span> <span class="attr">name</span>=<span class="string">"loginform"</span> <span class="attr">action</span>=<span class="string">"$&#123;baseurl&#125;login.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"tab"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">cellSpacing</span>=<span class="string">"6"</span> <span class="attr">cellPadding</span>=<span class="string">"8"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">colSpan</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"usercode"</span> <span class="attr">name</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"pwd"</span> <span class="attr">name</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>验证码：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"randomcode"</span> <span class="attr">name</span>=<span class="string">"randomcode"</span> <span class="attr">size</span>=<span class="string">"8"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"randomcode_img"</span> <span class="attr">src</span>=<span class="string">"$&#123;baseurl&#125;validatecode.jsp"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:randomcode_refresh()</span>&gt;</span>刷新<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"rememberMe"</span>/&gt;</span>自动登录</span><br><span class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">colSpan</span>=<span class="string">"2"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btnalink"</span> <span class="attr">onclick</span>=<span class="string">"loginsubmit()"</span> <span class="attr">value</span>=<span class="string">"登录"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">class</span>=<span class="string">"btnalink"</span> <span class="attr">value</span>=<span class="string">"重置"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>用户正常退出，缓存自动清空</p>
<p>用户非正常退出，缓存自动清空。</p>
<p>如果修改了用户的权限，而用户不退出系统，修改的权限无法立即生效，需要手动调用<code>Realm</code>的<code>clearCache</code>方法清除缓存。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class ClearShiroCache &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private CustomRealm customRealm;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(&quot;/clearShiroCache&quot;)</span><br><span class="line">	public String clearShiroCache() &#123;</span><br><span class="line"></span><br><span class="line">		// 清除缓存 要在service调用</span><br><span class="line">		customRealm.clearCached();</span><br><span class="line">		return &quot;success&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>shiro-ehcache.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">		 <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"../config/ehcache.xsd"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- diskStore：缓存数据持久化的目录 地址  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"/xxx/ehcache"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">			<span class="attr">maxElementsInMemory</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">maxElementsOnDisk</span>=<span class="string">"10000000"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">overflowToDisk</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">diskPersistent</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">timeToIdleSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">timeToLiveSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LRU"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Shiro的过滤器</p>
<ul>
<li><p>认证过滤器</p>
<ul>
<li><p><code>/admins/**=anon</code>：该路径下的资源可以匿名使用。</p>
</li>
<li><p><code>/admins/user/**=authc</code>：该路径下的资源需要认证。</p>
</li>
<li><p><code>/admins/user/**=user</code>：表示必须存在用户，身份认证通过或通过记住我认证通过的可以访问，当登入操作时不做检查。</p>
</li>
</ul>
</li>
<li><p>授权过滤器</p>
<ul>
<li><p><code>/admins/user/**=perms[&quot;user:add:*, user:modify:*&quot;]</code>：当有多个参数时必须每个参数都通过才通过，相当于<code>isPermitedAll()</code>方法。</p>
</li>
<li><p><code>/admins/user/**=roles[&quot;admin, guest&quot;]</code>：每个参数通过才算通过，相当于<code>hasAllRoles()</code>方法。</p>
</li>
<li><p><code>/admins/user/**=rest[user]</code>：根据请求的方法，相当于<code>/admins/user/**=perms[user:method]</code>，其中method为post，get，delete等。</p>
</li>
</ul>
</li>
</ul>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
