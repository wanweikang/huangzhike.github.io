<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>[笔记]-Redis | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="用手记笔记，用心记笔记，用脑记笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-Redis"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<script>var timeStart = new Date();</script>
		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		
		
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>首页
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>存档
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-Redis</h2>
				
				<div>
					<span class="post-time">2018-01-10 12:55</span>
				</div>	
				
				<div class="article-content">
				<ul>
<li>来源：<strong>The Little Redis Book</strong></li>
</ul>
<p>先装Redis服务及导入Java Redis驱动<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</div><div class="line"></div><div class="line"><span class="keyword">public</span> class RedisJava &#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args) &#123;</div><div class="line">		<span class="comment">// 连接本地服务</span></div><div class="line">		Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>);</div><div class="line">		System.out.<span class="built_in">println</span>(<span class="string">"连接成功"</span>);</div><div class="line">		<span class="comment">// 查看服务是否运行</span></div><div class="line">		System.out.<span class="built_in">println</span>(<span class="string">"服务正在运行: "</span> + jedis.ping());</div><div class="line">		<span class="comment">// 设置字符串数据</span></div><div class="line">		jedis.<span class="built_in">set</span>(<span class="string">"xxx"</span>, <span class="string">"xxx"</span>);</div><div class="line">		<span class="comment">// 获取存储的数据并输出</span></div><div class="line">		System.out.<span class="built_in">println</span>(<span class="string">"字符串为: "</span> + jedis.<span class="built_in">get</span>(<span class="string">"xxx"</span>));</div><div class="line"></div><div class="line">		<span class="comment">// 存储数据到列表中</span></div><div class="line">		jedis.lpush(<span class="string">"site-list"</span>, <span class="string">"Google"</span>);</div><div class="line">		jedis.lpush(<span class="string">"site-list"</span>, <span class="string">"Taobao"</span>);</div><div class="line">		<span class="comment">// 获取存储的数据并输出</span></div><div class="line">		List&lt;<span class="keyword">String</span>&gt; list = jedis.lrange(<span class="string">"site-list"</span>, <span class="number">0</span>, <span class="number">2</span>);</div><div class="line">		<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; list.<span class="built_in">size</span>(); i++) &#123;</div><div class="line">			System.out.<span class="built_in">println</span>(<span class="string">"列表项为: "</span> + list.<span class="built_in">get</span>(i));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// 获取数据并输出</span></div><div class="line">		<span class="comment">// keys命令需要一个模式，然后查找所有匹配的关键字</span></div><div class="line">		<span class="comment">// 这个命令不应该用在实际的产品代码</span></div><div class="line">		Set&lt;<span class="keyword">String</span>&gt; keys = jedis.keys(<span class="string">"*"</span>);</div><div class="line">		Iterator&lt;<span class="keyword">String</span>&gt; it = keys.iterator();</div><div class="line">		<span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">			<span class="keyword">String</span> <span class="built_in">key</span> = it.next();</div><div class="line">			System.out.<span class="built_in">println</span>(<span class="built_in">key</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关系型数据库里，可以认为引入了一个数据结构——表格。</p>
<p>Redis引入了5种不同的数据结构，只有一个是典型的关键字-值型结构。</p>
<p>Redis不仅仅是关键字-值型存储，Redis的5种数据结构中的每一个都至少有一个关键字和一个值。</p>
<ul>
<li>字符串（Strings)</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">set</span> <span class="selector-tag">users</span><span class="selector-pseudo">:leto</span> "&#123;<span class="attribute">name</span>: leto, planet: dune, likes: [spice]&#125;"</div><div class="line"></div><div class="line"><span class="selector-tag">get</span> <span class="selector-tag">users</span><span class="selector-pseudo">:leto</span></div></pre></td></tr></table></figure>
<ul>
<li>散列（Hashes）</li>
</ul>
<p>散列数据结构很像字符串数据结构，区别在于，散列数据结构提供了额外的间接层：一个域（Field）。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">hset <span class="string">users:</span>goku powerlevel <span class="number">9000</span></div><div class="line"></div><div class="line">hget <span class="string">users:</span>goku powerlevel</div><div class="line"></div><div class="line"><span class="comment">// 设置多个域</span></div><div class="line">hmset <span class="string">users:</span>goku race saiyan age <span class="number">737</span></div><div class="line"><span class="comment">// 获取多个域</span></div><div class="line">hmget <span class="string">users:</span>goku race powerlevel</div><div class="line"><span class="comment">// 获取所有的域和值</span></div><div class="line">hgetall <span class="string">users:</span>goku</div><div class="line"><span class="comment">// 列出所有的域</span></div><div class="line">hkeys <span class="string">users:</span>goku</div><div class="line"><span class="comment">// 删除指定的一个域</span></div><div class="line">hdel <span class="string">users:</span>goku age</div></pre></td></tr></table></figure>
<ul>
<li>列表（Lists）</li>
</ul>
<p>列表数据结构维护了值的顺序，提供了基于索引的高效操作。<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// 将一个新用户推入到列表的前端</div><div class="line">lpush newusers goku</div><div class="line"></div><div class="line">// 对列表调整，使得该列表只包含<span class="number">50</span>个最近被推入的用户</div><div class="line">ltrim newusers <span class="number">0</span> <span class="number">50</span></div><div class="line"></div><div class="line">// 获取最近的<span class="number">10</span>个用户的详细资料</div><div class="line">keys = redis.<span class="keyword">lrange</span>(<span class="string">'newusers'</span>, <span class="number">0</span>, <span class="number">10</span>)</div><div class="line">redis.mget(*keys.map &#123;|u| <span class="string">"users:#&#123;u&#125;"</span>&#125;)</div></pre></td></tr></table></figure></p>
<ul>
<li>集合（Sets）</li>
</ul>
<p>集合数据结构常常被用来存储只能唯一存在的值。没有对值进行排序，提供了高效的基于值的操作。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sadd <span class="string">friends:</span>leto ghanima paul chani jessica</div><div class="line">sadd <span class="string">friends:</span>duncan paul jessica alia</div><div class="line"></div><div class="line"><span class="comment">// 高效地（O(1)时间复杂度）识别出用户X是不是用户Y的朋友</span></div><div class="line">sismember <span class="string">friends:</span>leto jessica</div><div class="line">sismember <span class="string">friends:</span>leto vladimir</div><div class="line"></div><div class="line"><span class="comment">// 查看两个或更多的人是不是有共同的朋友</span></div><div class="line">sinter <span class="string">friends:</span>leto <span class="string">friends:</span>duncan</div></pre></td></tr></table></figure>
<ul>
<li>分类集合（Sorted Sets）</li>
</ul>
<p>分类集合类似于集合数据结构，主要区分是标记（score），提供了排序（sorting）和秩划分（ranking）的功能。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 秩分类的朋友名单</span></div><div class="line">zadd <span class="string">friends:</span>duncan <span class="number">70</span> ghanima <span class="number">95</span> paul <span class="number">95</span> chani <span class="number">75</span> jessica <span class="number">1</span> vladimir</div><div class="line"></div><div class="line"><span class="comment">// 对于duncan的朋友，计算出标记（score）为90或更高的人数</span></div><div class="line">zcount <span class="string">friends:</span>duncan <span class="number">90</span> <span class="number">100</span></div><div class="line"></div><div class="line"><span class="comment">// 获取chani在名单里的秩（rank）</span></div><div class="line">zrevrank <span class="string">friends:</span>duncan chani</div><div class="line"><span class="comment">// zrank：从高到低</span></div><div class="line"><span class="comment">// zrevrank：从低到高</span></div></pre></td></tr></table></figure>
<p>大O表示法</p>
<ul>
<li><p>常数时间复杂度<code>O(1)</code>：最快速，无论处理5个元素还是5百万个元素，相同的性能。</p>
<ul>
<li><code>sismember</code>：一个值是否属于一个集合。许多Redis命令都具有<code>O(1)</code>的时间复杂度。</li>
</ul>
</li>
<li><p>对数时间复杂度<code>O(log(N))</code>：第二快速的，其通过使需扫描的区间不断皱缩来快速完成处理，使用“分而治之”的方式。</p>
<ul>
<li><code>zadd</code>：其中N是在分类集合中的元素数量。</li>
</ul>
</li>
<li><p>线性时间复杂度<code>O(N)</code>：在一个表格的非索引列里进行查找就需要<code>O(N)</code>次操作。</p>
<ul>
<li><code>ltrim</code>：其中N不是列表所拥有的元素数量，而是被删除的元素数量。</li>
</ul>
</li>
</ul>
<p>通过不同的关键字去查询相同的值。</p>
<p>如：通过电子邮件（当用户开始登录时）去获取用户的具体信息，或者通过用户id（在用户登录后）去获取。</p>
<ul>
<li><p>不实效的解决方法，其将用户对象分别放置到两个字符串值里去：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">set</span> users:leto@dune.gov <span class="comment">"&#123;id: 9001, email: 'leto@dune.gov', ...&#125;"</span></div><div class="line"><span class="keyword">set</span> <span class="comment">users:9001</span> <span class="comment">"&#123;id: 9001, email: 'leto@dune.gov', ...&#125;"</span></div></pre></td></tr></table></figure>
</li>
<li><p>Redis没有提供将一个关键字链接到另一个的功能，可以使用散列数据，摆脱重复：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">set</span> <span class="selector-tag">users</span><span class="selector-pseudo">:9001</span> "&#123;<span class="attribute">id</span>: <span class="number">9001</span>, email: leto@dune.gov, ...&#125;"</div><div class="line"><span class="selector-tag">hset</span> <span class="selector-tag">users</span><span class="selector-pseudo">:lookup</span><span class="selector-pseudo">:email</span> <span class="selector-tag">leto</span>@<span class="keyword">dune</span>.<span class="keyword">gov</span> <span class="number">9001</span></div><div class="line">// 使用域来作为一个二级索引，然后去引用单个用户对象</div><div class="line"></div><div class="line">// 通过id来获取用户信息</div><div class="line">get users:<span class="number">9001</span></div><div class="line"></div><div class="line">// 通过电子邮箱来获取用户信息</div><div class="line">id = redis.hget(<span class="string">'users:lookup:email'</span>, <span class="string">'leto@dune.gov'</span>)</div><div class="line">user = redis.get(<span class="string">"users:#&#123;id&#125;"</span>)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>引用和索引（References and Indexes）</p>
<p>集合数据结构很常被用来实现索引：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sadd <span class="string">friends:</span>leto ghanima paul chani jessica</div><div class="line"><span class="comment">// 这个集合里的每一个成员都是一个Redis字符串数据结构的引用</span></div><div class="line"><span class="comment">// 而每一个引用的值则包含着用户对象的具体信息</span></div><div class="line"></div><div class="line"><span class="comment">// 如果chani改变了她的名字，或者删除了她的帐号，chani也有她的朋友</span></div><div class="line">sadd <span class="string">friends_of:</span>chani leto paul</div></pre></td></tr></table></figure></p>
<p>事务（Transactions）</p>
<p>Redis实际上是单线程运行的，这就是为什么每一个Redis命令都能够保证具有原子性。</p>
<p>当一个命令在执行时，没有其他命令会运行。</p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			
<p>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme modified by <b> Huangzhike </b></p>
<p>&copy; 2018 <a href="https://huangzhike.github.io"><b> Huangzhike </b></a></p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
