<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-Shiro-AJAX | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-Shiro-AJAX">
		
		<meta property="og:site_name" content="一个放笔记的地方而已">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-Shiro-AJAX</h2>
				
				<div>
					<div class="post-time">2018-01-13</div>
				</div>
				
				<div class="article-content">
				<p>因为最近想把Shiro结合AJAX使用，查了查，有些解决方法太暴力我就不贴了。</p>
<p>不保证正确，只是看了一遍。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/login&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public Object ajaxLogin(@RequestParam String username, </span><br><span class="line">		@RequestParam String password, @RequestParam boolean rememberMe) &#123;</span><br><span class="line"></span><br><span class="line">	String ret = &quot;&quot;;</span><br><span class="line">	Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">	if (!currentUser.isAuthenticated()) &#123;</span><br><span class="line">		UsernamePasswordToken token = new UsernamePasswordToken(username, password);</span><br><span class="line">		token.setRememberMe(rememberMe);</span><br><span class="line">		try &#123;</span><br><span class="line">			currentUser.login(token);</span><br><span class="line">			ret = &quot;&#123;success:true,message:&apos;登陆成功&apos;&#125;&quot;;</span><br><span class="line">		&#125; catch (UnknownAccountException ex) &#123;</span><br><span class="line">			ret = &quot;&#123;success:false,message:&apos;账号错误&apos;&#125;&quot;;</span><br><span class="line">		&#125; catch (IncorrectCredentialsException ex) &#123;</span><br><span class="line">			ret = &quot;&#123;success:false,message:&apos;密码错误&apos;&#125;&quot;;</span><br><span class="line">		&#125; catch (LockedAccountException ex) &#123;</span><br><span class="line">			ret = &quot;&#123;success:false,message:&apos;账号已被锁定，请与管理员联系&apos;&#125;&quot;;</span><br><span class="line">		&#125; catch (AuthenticationException ex) &#123;</span><br><span class="line">			ret = &quot;&#123;success:false,message:&apos;您没有授权&apos;&#125;&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// 返回json</span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>通过Controller解决：</p>
<p><code>@RequiresPermissions</code>有对应权限才可以访问</p>
<p><code>@RequiresUser</code>存在用户登录状态才可以访问</p>
<p>请求使用这些注解方式控制的方法时，如果没有通过权限校验，Shiro会抛出如下两组类型的异常。</p>
<ul>
<li>登录认证类异常<ul>
<li>UnauthenticatedException.class</li>
<li>AuthenticationException.class </li>
</ul>
</li>
<li>权限认证类异常<ul>
<li>UnauthorizedException.class</li>
<li>AuthorizationException.class </li>
</ul>
</li>
</ul>
<p>对于JSON和页面跳转，只需要做一个Ajax判断处理。</p>
<p>可以加一个标识参数，或者直接用<code>header</code>里面的<code>X-Requested-With</code>参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public abstract class BaseController &#123;</span><br><span class="line"></span><br><span class="line">	// 登录认证异常</span><br><span class="line">	@ExceptionHandler(&#123;UnauthenticatedException.class, AuthenticationException.class&#125;)</span><br><span class="line">	public String authenticationException(HttpServletRequest request, HttpServletResponse response) &#123;</span><br><span class="line">		if (WebUtils.isAjaxRequest(request)) &#123;</span><br><span class="line">			// 输出JSON</span><br><span class="line">			Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">			map.put(&quot;code&quot;, &quot;-999&quot;);</span><br><span class="line">			map.put(&quot;message&quot;, &quot;未登录&quot;);</span><br><span class="line">			WebUtils.writeJson(map, response);</span><br><span class="line">			return null;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return &quot;redirect:/system/login&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 权限异常</span><br><span class="line">	@ExceptionHandler(&#123;UnauthorizedException.class, AuthorizationException.class&#125;)</span><br><span class="line">	public String authorizationException(HttpServletRequest request, HttpServletResponse response) &#123;</span><br><span class="line">		if (WebUtils.isAjaxRequest(request)) &#123;</span><br><span class="line">			// 输出JSON</span><br><span class="line">			Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">			map.put(&quot;code&quot;, &quot;-998&quot;);</span><br><span class="line">			map.put(&quot;message&quot;, &quot;无权限&quot;);</span><br><span class="line">			WebUtils.writeJson(map, response);</span><br><span class="line">			return null;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return &quot;redirect:/system/403&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class WebUtils &#123;</span><br><span class="line">	// 是否是Ajax请求</span><br><span class="line">	public static boolean isAjaxRequest(HttpServletRequest request) &#123;</span><br><span class="line">		String requestedWith = request.getHeader(&quot;x-requested-with&quot;);</span><br><span class="line">		if (requestedWith != null &amp;&amp; requestedWith.equalsIgnoreCase(&quot;XMLHttpRequest&quot;)) &#123;</span><br><span class="line">			return Boolean.TRUE;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return Boolean.FALSE;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 输出JSON</span><br><span class="line">	private static void writeJson(Map&lt;String, Object&gt; map, HttpServletResponse response) &#123;</span><br><span class="line">		// ResponseHeader responseHeader = new ResponseHeader();</span><br><span class="line">		// responseHeader.setResponse(ResponseHeader.SC_FORBIDDEN, null);</span><br><span class="line">		PrintWriter out = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			response.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			response.setContentType(&quot;application/json; charset=utf-8&quot;);</span><br><span class="line">			out = response.getWriter();</span><br><span class="line">			out.write(JsonUtil.mapToJson(map));</span><br><span class="line">		&#125; catch (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			if (out != null) &#123;</span><br><span class="line">				out.close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping</span><br><span class="line">public class PageController extends BaseController&#123;</span><br><span class="line">	// AJAX请求时，没有登录返回对应没有登录的JSON，而不是暴力重定向到登录页面</span><br><span class="line">	@RequiresUser</span><br><span class="line">	@RequestMapping(value=&quot;/getData&quot;, method=RequestMethod.POST)</span><br><span class="line">	@ResponseBody</span><br><span class="line">	public List&lt;String&gt; getData(Model model)&#123;</span><br><span class="line">		List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">		list.add(&quot;data1&quot;);</span><br><span class="line">		list.add(&quot;data2&quot;);</span><br><span class="line">		return list;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>改Filter，也有好几种Filter改法：</p>
<p>大体是：</p>
<ul>
<li><p>判断请求是否为Ajax请求</p>
</li>
<li><p>Response输出JSON数据</p>
</li>
</ul>
<p>AJAX不能重定向，需要返回指定格式的JSON。</p>
<ul>
<li><p>AJAX调用接口没有登录时，返回指定格式JSON</p>
<ul>
<li>AdviceFilter：访问Controller之前判断是否登录</li>
</ul>
</li>
<li><p>AJAX调用接口在登录的情况下，角色认证不通过，返回指定格式JSON</p>
<ul>
<li>RolesAuthorizationFilter：认证Roles失败时回调的onAccessDenied方法，用于返回JSON或是重定向</li>
</ul>
</li>
<li><p>AJAX调用接口在登录的情况下，资源认证不通过，返回指定格式JSON</p>
<ul>
<li>PermissionsAuthorizationFilter：认证资源，也是重写onAccessDenied方法</li>
</ul>
</li>
<li><p>普通请求调用接口则进行重定向处理</p>
</li>
</ul>
<p>先来个加强版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">public class ShiroLoginFilter extends AdviceFilter &#123;</span><br><span class="line">	// private Logger logger = Logger.getLogger(ShiroLoginFilter.class);</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">	protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception &#123;</span><br><span class="line">		JSONObject jsonObj = new JSONObject();</span><br><span class="line">		String redirect_url = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">		HttpServletRequest httpReq = (HttpServletRequest) request;</span><br><span class="line">		HttpServletResponse httpRes = (HttpServletResponse) response;</span><br><span class="line"></span><br><span class="line">		httpReq.setCharacterEncoding(&quot;utf-8&quot;);</span><br><span class="line">		// =====================判断是否清除缓存=============================</span><br><span class="line">		HttpSession session = httpReq.getSession();</span><br><span class="line">		String jsessionid = session.getId();</span><br><span class="line">		// logger.info(&quot;登录的sessionid:&quot; + jsessionid);</span><br><span class="line">		Object obj = session.getAttribute(&quot;userId&quot;);</span><br><span class="line">		// logger.info(&quot;userId数据:&quot; + obj);</span><br><span class="line">		// =====================获得get的地址和后面的参数=====================</span><br><span class="line">		String urlStr = httpReq.getRequestURI();</span><br><span class="line">		String reqQueryString = httpReq.getQueryString(); // 获得问号后面的参数</span><br><span class="line">		if (!IsEmptyUtil.empty(reqQueryString)) &#123;</span><br><span class="line">			redirect_url = urlStr + &quot;?&quot; + reqQueryString;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			redirect_url = urlStr;</span><br><span class="line">		&#125;</span><br><span class="line">		if (obj == null) &#123; // 判断是否已经登录</span><br><span class="line">			String ajaxFlag = httpReq.getHeader(&quot;x-requested-with&quot;); // 获得ajax标示 XMLHttpRequest</span><br><span class="line">			// 去掉最后一个空格</span><br><span class="line">			if (ajaxFlag != null) &#123; </span><br><span class="line">				// logger.info(&quot;ajax 提交&quot;);</span><br><span class="line">				String acceptStr = httpReq.getHeader(&quot;Accept&quot;);</span><br><span class="line">				String method = httpReq.getMethod();</span><br><span class="line">				// 获得post的参数，不需要编码</span><br><span class="line">				String queryString = &quot;&quot;;</span><br><span class="line">				Map&lt;String, String[]&gt; params = httpReq.getParameterMap();</span><br><span class="line">				for (String key : params.keySet()) &#123;</span><br><span class="line">					String[] values = params.get(key);</span><br><span class="line">					for (int i = 0; i &lt; values.length; i++) &#123;</span><br><span class="line">						String value = values[i];</span><br><span class="line">						queryString += key + &quot;=&quot; + value + &quot;&amp;&quot;;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				// 返回ajax的请求参数</span><br><span class="line">				if (!IsEmptyUtil.empty(queryString)) &#123;</span><br><span class="line">					queryString = queryString.substring(0, queryString.length() - 1);</span><br><span class="line">				&#125;</span><br><span class="line">				// 获得请求datatype的类型</span><br><span class="line">				if (acceptStr.contains(&quot;json&quot;)) &#123;</span><br><span class="line">					jsonObj.put(&quot;datatype_flag&quot;, &quot;json&quot;);</span><br><span class="line">				&#125; else if (acceptStr.contains(&quot;html&quot;)) &#123;</span><br><span class="line">					jsonObj.put(&quot;datatype_flag&quot;, &quot;html&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">				// 获得是post还是get方法</span><br><span class="line">				if (method.equalsIgnoreCase(&quot;post&quot;)) &#123;</span><br><span class="line">					jsonObj.put(&quot;request_method&quot;, &quot;post&quot;);</span><br><span class="line">				&#125; else if (method.equalsIgnoreCase(&quot;get&quot;)) &#123;</span><br><span class="line">					jsonObj.put(&quot;request_method&quot;, &quot;get&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">				jsonObj.put(&quot;smallwin_flag&quot;, &quot;Y&quot;);</span><br><span class="line">				jsonObj.put(&quot;ajaxFlag&quot;, &quot;Y&quot;);</span><br><span class="line">				jsonObj.put(&quot;redirect_url&quot;, redirect_url);</span><br><span class="line">				jsonObj.put(&quot;paramsStr&quot;, queryString);</span><br><span class="line">				jsonObj.put(&quot;jsessionid&quot;, jsessionid);</span><br><span class="line">				response.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">				response.getWriter().write(jsonObj.toString());</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				// logger.info(&quot;form 提交&quot;);</span><br><span class="line">				String queryString = &quot;&quot;;</span><br><span class="line">				Map&lt;String, String[]&gt; params = httpReq.getParameterMap();</span><br><span class="line">				for (String key : params.keySet()) &#123;</span><br><span class="line">					String[] values = params.get(key);</span><br><span class="line">					for (int i = 0; i &lt; values.length; i++) &#123;</span><br><span class="line">						String value = values[i];</span><br><span class="line">						queryString += &quot;&#123;\&apos;name\&apos;&quot; + &quot;:&quot; + &quot;\&apos;&quot; + key + &quot;\&apos;&quot; + &quot;,&quot;;</span><br><span class="line">						queryString += &quot;\&apos;value\&apos;&quot; + &quot;:&quot; + &quot;\&apos;&quot; + value + &quot;\&apos;&quot; + &quot;&#125;,&quot;;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				// 返回ajax的请求参数</span><br><span class="line">				if (!IsEmptyUtil.empty(queryString)) &#123;</span><br><span class="line">					queryString = &quot;[&quot; + queryString.substring(0, queryString.length() - 1) + &quot;]&quot;;</span><br><span class="line">				&#125;</span><br><span class="line">				httpRes.sendRedirect(&quot;/anon_login.jsp?redirect_url=&quot; + redirect_url);</span><br><span class="line">			&#125;</span><br><span class="line">			return false;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return true;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class ShiroLoginFilter extends AdviceFilter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception &#123;</span><br><span class="line">		HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">		HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br><span class="line"></span><br><span class="line">		SysUser sysUser = (SysUser) httpServletRequest.getSession().getAttribute(&quot;user&quot;);</span><br><span class="line"></span><br><span class="line">		if (null == sysUser &amp;&amp; !StringUtils.contains(httpServletRequest.getRequestURI(), &quot;/login&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">			String requestedWith = httpServletRequest.getHeader(&quot;X-Requested-With&quot;);</span><br><span class="line"></span><br><span class="line">			if (StringUtils.isNotEmpty(requestedWith) &amp;&amp; StringUtils.equals(requestedWith, &quot;XMLHttpRequest&quot;)) &#123;</span><br><span class="line">				// 如果是ajax返回指定数据</span><br><span class="line">				httpServletResponse.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">				httpServletResponse.setContentType(&quot;application/json&quot;);</span><br><span class="line">				httpServletResponse.getWriter().write(JSONObject.toJSONString(responseHeader));</span><br><span class="line">				return false;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				// 不是ajax进行重定向处理</span><br><span class="line">				httpServletResponse.sendRedirect(&quot;/login/local&quot;);</span><br><span class="line">				// false-该filter过滤器已经处理，不继续执行其他过滤器</span><br><span class="line">				return false;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		// true-继续往下执行</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class ShiroRolesFilter extends RolesAuthorizationFilter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected boolean onAccessDenied(ServletRequest servletRequest, ServletResponse servletResponse) </span><br><span class="line">			throws IOException &#123;</span><br><span class="line">		HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;</span><br><span class="line">		HttpServletResponse httpServletResponse = (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">		if (WebUtils.isAjaxRequest(request)) &#123;</span><br><span class="line">			// ...</span><br><span class="line">			WebUtils.writeJson(map, response);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (StringUtils.isNotEmpty(requestedWith) &amp;&amp; StringUtils.equals(requestedWith, &quot;XMLHttpRequest&quot;)) &#123;</span><br><span class="line">			// 如果是ajax返回指定格式数据</span><br><span class="line">			ResponseHeader responseHeader = new ResponseHeader();</span><br><span class="line">			responseHeader.setResponse(ResponseHeader.SC_FORBIDDEN, null);</span><br><span class="line">			httpServletResponse.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			httpServletResponse.setContentType(&quot;application/json&quot;);</span><br><span class="line">			httpServletResponse.getWriter().write(JSONObject.toJSONString(responseHeader));</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			// 如果是普通请求进行重定向</span><br><span class="line">			httpServletResponse.sendRedirect(&quot;/403&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		// true-继续往下执行，false-该filter过滤器已经处理，不继续执行其他过滤器</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class ShiroPermsFilter extends PermissionsAuthorizationFilter &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected boolean onAccessDenied(ServletRequest servletRequest, ServletResponse servletResponse) </span><br><span class="line">			throws IOException &#123;</span><br><span class="line"></span><br><span class="line">		// 完全同上</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在实现自定义Filter的时候不要用Spring进行单例模式的bean初始化。</p>
<p>还有这种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">public class CaptchaFormAuthenticationFilter extends FormAuthenticationFilter &#123;</span><br><span class="line"></span><br><span class="line">	private static final Logger log = LoggerFactory.getLogger(CaptchaFormAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected boolean onLoginSuccess(AuthenticationToken token, </span><br><span class="line">		Subject subject, ServletRequest request, ServletResponse response) </span><br><span class="line">			throws Exception &#123;</span><br><span class="line"></span><br><span class="line">		HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">		HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br><span class="line"></span><br><span class="line">		if (WebUtils.isAjaxRequest(request)) &#123;</span><br><span class="line">			Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">			map.put(&quot;code&quot;, &quot;-999&quot;);</span><br><span class="line">			map.put(&quot;message&quot;, &quot;未登录&quot;);</span><br><span class="line">			WebUtils.writeJson(map, response);</span><br><span class="line"></span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			issueSuccessRedirect(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected boolean onLoginFailure(AuthenticationToken token, </span><br><span class="line">		AuthenticationException e, ServletRequest request, ServletResponse response) &#123;</span><br><span class="line"></span><br><span class="line">		HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">		if (!WebUtils.isAjaxRequest(request)) &#123;</span><br><span class="line">			setFailureAttribute(request, e);</span><br><span class="line">			return true;</span><br><span class="line">		&#125;</span><br><span class="line">		try &#123;</span><br><span class="line">			response.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">			response.setContentType(&quot;application/json; charset=utf-8&quot;);</span><br><span class="line">			PrintWriter out = response.getWriter();</span><br><span class="line">			String message = e.getClass().getSimpleName();</span><br><span class="line">			if (&quot;IncorrectCredentialsException&quot;.equals(message)) &#123;</span><br><span class="line">				out.println(&quot;&#123;success:false,message:&apos;密码错误&apos;&#125;&quot;);</span><br><span class="line">			&#125; else if (&quot;UnknownAccountException&quot;.equals(message)) &#123;</span><br><span class="line">				out.println(&quot;&#123;success:false,message:&apos;账号不存在&apos;&#125;&quot;);</span><br><span class="line">			&#125; else if (&quot;LockedAccountException&quot;.equals(message)) &#123;</span><br><span class="line">				out.println(&quot;&#123;success:false,message:&apos;账号被锁定&apos;&#125;&quot;);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				out.println(&quot;&#123;success:false,message:&apos;未知错误&apos;&#125;&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">			out.flush();</span><br><span class="line">			out.close();</span><br><span class="line">		&#125; catch (IOException e) &#123;</span><br><span class="line"></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 所有请求都会经过的方法</span><br><span class="line">	@Override</span><br><span class="line">	protected boolean onAccessDenied(ServletRequest request, ServletResponse response) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">		if (this.isLoginRequest(request, response)) &#123;</span><br><span class="line">			if (this.isLoginSubmission(request, response)) &#123;</span><br><span class="line">				if (log.isTraceEnabled()) &#123;</span><br><span class="line">					log.trace(&quot;Login submission detected. Attempting to execute login.&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">				if (&quot;XMLHttpRequest&quot;.equalsIgnoreCase(((HttpServletRequest) request).getHeader(&quot;X-Requested-With&quot;))) &#123;</span><br><span class="line">					String vcode = request.getParameter(&quot;vcode&quot;);</span><br><span class="line">					HttpServletRequest httpservletrequest = (HttpServletRequest) request;</span><br><span class="line">					String vvcode = (String) httpservletrequest.getSession()</span><br><span class="line">							.getAttribute(com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">					if (vvcode == null || &quot;&quot;.equals(vvcode) || !vvcode.equals(vcode)) &#123;</span><br><span class="line">						response.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">						PrintWriter out = response.getWriter();</span><br><span class="line">						out.println(&quot;&#123;success:false,message:&apos;验证码错误&apos;&#125;&quot;);</span><br><span class="line">						out.flush();</span><br><span class="line">						out.close();</span><br><span class="line">						return false;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				return executeLogin(request, response);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				if (log.isTraceEnabled()) &#123;</span><br><span class="line">					log.trace(&quot;Login page view.&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">				// allow them to see the login page ;)  </span><br><span class="line">				// 返回true表示需要继续处理</span><br><span class="line">				return true;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			if (log.isTraceEnabled()) &#123;</span><br><span class="line">				log.trace(&quot;Attempting to access a path which requires authentication. &quot; + </span><br><span class="line">					&quot;Forwarding to the Authentication url [&quot; + getLoginUrl() + &quot;]&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">			if (WebUtils.isAjaxRequest(request)) &#123;</span><br><span class="line">				// ...</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				this.saveRequestAndRedirectToLogin(request, response);</span><br><span class="line">			&#125;</span><br><span class="line">			// 返回false表示该拦截器实例已经处理了，将直接返回即可</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前端处理返回值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// 判断是否登录，没登录刷新当前页，促使Shiro拦截后跳转登录页</span><br><span class="line">function isLogin(result) &#123;</span><br><span class="line">	if (result &amp;&amp; result.login_status &amp;&amp; result.login_status == 300) &#123;</span><br><span class="line">		window.location.reload(true); // 刷新当前页</span><br><span class="line">	&#125;</span><br><span class="line">	// 这么写除了炫技还有意义吗，节约字节？</span><br><span class="line">	return !0; // 返回true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 改变状态</span><br><span class="line">function changeSessionStatus(sessionIds, status, self) &#123;</span><br><span class="line">	status = !parseInt(status);</span><br><span class="line">	// loading</span><br><span class="line">	var load = layer.load();</span><br><span class="line">	$.post(&quot;$&#123;basePath&#125;/member/changeSessionStatus.shtml&quot;, &#123;status: status, sessionIds: sessionIds&#125;, function (result) &#123;</span><br><span class="line">		layer.close(load);</span><br><span class="line">		if (isLogin(result)) &#123; // 判断是否登录</span><br><span class="line">			if (result &amp;&amp; result.status == 200) &#123;</span><br><span class="line">				// 这个return简直</span><br><span class="line">				return self.text(result.sessionStatusText),</span><br><span class="line">					self.attr(&apos;status&apos;, result.sessionStatus),</span><br><span class="line">					self.parent().prev().text(result.sessionStatusTextTd);</span><br><span class="line">				// 为什么return后面还有这东西？？？神马？？？</span><br><span class="line">				layer.msg(&apos;操作成功&apos;), !1;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				// 还可以return多个值？还是说前面那个没有返回值？</span><br><span class="line">				return layer.msg(result.message, function () &#123;&#125;), !1;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, &apos;json&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// 这些写法简直</span><br><span class="line">(function ($) &#123;</span><br><span class="line">	// 备份jquery的ajax方法  </span><br><span class="line">	var _ajax = $.ajax;</span><br><span class="line">	// 重写jquery的ajax方法  </span><br><span class="line">	$.ajax = function (opt) &#123;</span><br><span class="line">		// 备份opt中error和success方法  </span><br><span class="line">		var fn = &#123;</span><br><span class="line">			error: function (XMLHttpRequest, textStatus, errorThrown) &#123;</span><br><span class="line">			&#125;,</span><br><span class="line">			success: function (data, textStatus) &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		if (opt.error) &#123;</span><br><span class="line">			fn.error = opt.error;</span><br><span class="line">		&#125;</span><br><span class="line">		if (opt.success) &#123;</span><br><span class="line">			fn.success = opt.success;</span><br><span class="line">		&#125;</span><br><span class="line">		// 扩展增强处理  </span><br><span class="line">		var _opt = $.extend(opt, &#123;</span><br><span class="line">			error: function (XMLHttpRequest, textStatus, errorThrown) &#123;</span><br><span class="line">				// 错误方法增强处理  </span><br><span class="line">				fn.error(XMLHttpRequest, textStatus, errorThrown);</span><br><span class="line">			&#125;,</span><br><span class="line">			success: function (data, textStatus, xhr) &#123;</span><br><span class="line">				// 成功回调方法增强处理  </span><br><span class="line">				if (data.code == &apos;OSS.001&apos;) &#123;</span><br><span class="line">					parent.location.href = contextPath + &apos;/sys/manager/index&apos;;</span><br><span class="line">					return;</span><br><span class="line">				&#125;</span><br><span class="line">				fn.success(data, textStatus);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		_ajax(_opt);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
