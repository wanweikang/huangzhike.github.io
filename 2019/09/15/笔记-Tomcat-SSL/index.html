<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <script>
            var timeStart = new Date();
        </script>
        
        <title>[ç¬”è®°]-Tomcat-SSL | ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜</title>
        
        <meta name="author" content="huangzhike">
        
        
        <meta name="description" content="NioEndpoint$SocketProcessor#doRun
        @Override
        protected void doRun() {
            // ...
            try {
                int handshak">
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        
        <meta property="og:title" content="[ç¬”è®°]-Tomcat-SSL"/>
        
        <meta property="og:site_name" content="ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜"/>
        
        
        <!-- favicon -->
        <link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
        <meta name="msapplication-TileColor" content="#009688">
        <meta name="msapplication-TileImage" content="/mstile-144x144.ico">
        <meta name="theme-color" content="#009688">
        <!-- favicon end -->
        <!-- <link href="//ok.ico" rel="icon"> -->
        
        <!-- toc -->
        <!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
        <!-- material design -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
        <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
        
        <!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
        <!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
    <meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">èœå•</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" title="ä¸‹ä¸€å¥æ˜¯ï¼šå®¢æœ‰å¯äººæœŸä¸æ¥ã€‚å°æ—¶å€™ï¼Œå–œæ¬¢é åœ¨é˜³å°ä¸Šï¼Œä¸€è¾¹å¹é£ï¼Œä¸€è¾¹çœ‹ä¹¦ï¼Œå–œæ¬¢è¯»ä¹¦å—ï¼Œéªšå¹´ï¼Ÿ" href="/">ä¹¦å½“å¿«æ„è¯»æ˜“å°½</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" target="_blank" rel="noopener" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

    <div class="container" >
        <div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[ç¬”è®°]-Tomcat-SSL</h2>
				
				<div>
					<div class="post-time">2019-09-15</div>
				</div>
				
				<div class="article-content">
				<p>NioEndpoint$SocketProcessor#doRun</p>
<pre class=" language-java"><code class="language-java">        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> handshake <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">// NioChannelé»˜è®¤æ¡æ‰‹å®Œæˆï¼ŒSecureNioChanneléœ€è¦TLSæ¡æ‰‹</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">isHandshakeComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            handshake <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment" spellcheck="true">// å½“åšæ¡æ‰‹å¤±è´¥</span>
                        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">==</span> SocketEvent<span class="token punctuation">.</span>STOP <span class="token operator">||</span> event <span class="token operator">==</span> SocketEvent<span class="token punctuation">.</span>DISCONNECT <span class="token operator">||</span> event <span class="token operator">==</span> SocketEvent<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            handshake <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment" spellcheck="true">// æ¡æ‰‹æ²¡å®Œæˆ</span>
                        <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token comment" spellcheck="true">// æ‰§è¡Œæ¡æ‰‹ï¼Œå¯è¯»å¯å†™</span>
                            handshake <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">handshake</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment" spellcheck="true">// æ¡æ‰‹å®Œæˆæ—¶å¿…é¡»ä¸ºSocketEvent.OPEN_READ</span>
                            <span class="token comment" spellcheck="true">// å› ä¸ºåªåœ¨æ¡æ‰‹å®Œæˆæ—¶ä½¿ç”¨ï¼Œè¿™é‡Œè®¾ç½®ä¹Ÿæ˜¯å¯ä»¥çš„</span>
                            event <span class="token operator">=</span> SocketEvent<span class="token punctuation">.</span>OPEN_READ<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    handshake <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CancelledKeyException</span> ckx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    handshake <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment" spellcheck="true">// æ¡æ‰‹å®Œæˆ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">// Socketæ‰“å¼€çŠ¶æ€</span>
                    SocketState state <span class="token operator">=</span> SocketState<span class="token punctuation">.</span>OPEN<span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">// é»˜è®¤å¤„ç†è¯·æ±‚</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">// ConnectionHandlerï¼Œä¸€ä¸ªEndpointå…³è”ä¸€ä¸ªHandlerï¼Œå­˜æ”¾äº†Socketå’ŒProcessorçš„å…³è”</span>
                        <span class="token comment" spellcheck="true">// Socketæ‰“å¼€å¹¶ä¸”å¯è¯»çŠ¶æ€</span>
                        state <span class="token operator">=</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>socketWrapper<span class="token punctuation">,</span> SocketEvent<span class="token punctuation">.</span>OPEN_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment" spellcheck="true">// å¤„ç†æŒ‡å®šäº‹ä»¶</span>
                    <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        state <span class="token operator">=</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>socketWrapper<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment" spellcheck="true">// å…³é—­Socket</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> SocketState<span class="token punctuation">.</span>CLOSED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">// å–æ¶ˆä¹‹å‰å…³å¿ƒçš„äº‹ä»¶ï¼Œå¹¶å…³é—­Socket</span>
                        poller<span class="token punctuation">.</span><span class="token function">cancelledKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> socketWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment" spellcheck="true">// æ¡æ‰‹å¤±è´¥</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>socketWrapper<span class="token punctuation">,</span> SocketEvent<span class="token punctuation">.</span>CONNECT_FAIL<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    poller<span class="token punctuation">.</span><span class="token function">cancelledKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> socketWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment" spellcheck="true">// æ¡æ‰‹æ—¶æ²¡è¯»å®Œï¼Œé‡æ–°å…³æ³¨å¯è¯»äº‹ä»¶</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake <span class="token operator">==</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    socketWrapper<span class="token punctuation">.</span><span class="token function">registerReadInterest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment" spellcheck="true">// æ¡æ‰‹æ—¶æ²¡å†™å®Œï¼Œé‡æ–°å…³æ³¨å¯å†™äº‹ä»¶</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake <span class="token operator">==</span> SelectionKey<span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    socketWrapper<span class="token punctuation">.</span><span class="token function">registerWriteInterest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CancelledKeyException</span> cx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ...</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">VirtualMachineError</span> vme<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ...</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ...</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span></code></pre>
<p>SecureNioChannel#handshake</p>
<pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">handshake</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> read<span class="token punctuation">,</span> <span class="token keyword">boolean</span> write<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>handshakeComplete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// åˆå§‹æ¡æ‰‹å®Œæˆ</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sniComplete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// å¤„ç†SNIï¼Œåˆå§‹åŒ–SSLEngineï¼Œå¼€å§‹æ¡æ‰‹ï¼ŒSSLEngineå°è£…äº†å…·ä½“çš„æ¡æ‰‹ç»†èŠ‚</span>
            <span class="token keyword">int</span> sniResult <span class="token operator">=</span> <span class="token function">processSNI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sniResult <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// å¤„ç†æˆåŠŸ</span>
                sniComplete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> sniResult<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// å›å¤å“åº”ï¼Œå¦‚æœå†™æ²¡å®Œæˆ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">flush</span><span class="token punctuation">(</span>netOutBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// éœ€è¦é‡æ–°å…³æ³¨å¯è¯»äº‹ä»¶</span>
            <span class="token keyword">return</span> SelectionKey<span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//we still have data to write</span>
        <span class="token punctuation">}</span>
        SSLEngineResult handshake <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">/*
         * SSLEngineå†…éƒ¨å°è£…äº†SSLçš„ç»†èŠ‚å®ç°ï¼Œåº”ç”¨åªéœ€è¦æ ¹æ®å®ƒè¿”å›çš„çŠ¶æ€SSLEngineResult.HandShakeStatusæ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ
         * å››ä¸ªç¼“å†²ï¼ŒApplicationInBufferï¼ŒApplicationOutBufferï¼ŒNetInBufferï¼ŒNetOutBuffer
         * wrapï¼Œå‡ºæ ˆï¼Œåº”ç”¨çš„ç¼“å†²é€šè¿‡SSLEngineå‘åˆ°ç½‘ç»œçš„ç¼“å†²
         * unwrapï¼Œå…¥æ ˆï¼Œç½‘ç»œçš„ç¼“å†²é€šè¿‡SSLEngineå‘åˆ°åº”ç”¨çš„ç¼“å†²
         * ç®€å•è¯´å°±æ˜¯è´Ÿè´£å…¥æ ˆå’Œå‡ºæ ˆæ•°æ®åŠ å¯†å’Œè§£å¯†ä»¥åŠåŠ å¯†è§£å¯†ç®—æ³•çš„åå•†
         * åœ¨åŒæ–¹æˆåŠŸæ¡æ‰‹ä¹‹åï¼Œç»§ç»­ä½¿ç”¨SSLEngineæ¥å‘é€æ•°æ®ï¼Œå‘é€çš„æ•°æ®å°±æ˜¯åŠ å¯†è¿‡çš„äº†
         */</span>
        <span class="token comment" spellcheck="true">// å¾ªç¯å¤„ç†æ¡æ‰‹ç›´åˆ°å®Œæˆ</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>handshakeComplete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// æ¡æ‰‹çŠ¶æ€</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>handshakeStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// æ¡æ‰‹å¤±è´¥</span>
                <span class="token keyword">case</span> NOT_HANDSHAKING<span class="token operator">:</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"channel.nio.ssl.notHandshaking"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">// æ¡æ‰‹å®Œæˆ</span>
                <span class="token keyword">case</span> FINISHED<span class="token operator">:</span>
                    <span class="token comment" spellcheck="true">// æœåŠ¡ç«¯å¯åå•†çš„åè®®</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token function">hasNegotiableProtocols</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>sslEngine <span class="token keyword">instanceof</span> <span class="token class-name">SSLUtil<span class="token punctuation">.</span>ProtocolInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment" spellcheck="true">// è®¾ç½®æœ€ç»ˆåå•†çš„åè®®</span>
                            socketWrapper<span class="token punctuation">.</span><span class="token function">setNegotiatedProtocol</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>SSLUtil<span class="token punctuation">.</span>ProtocolInfo<span class="token punctuation">)</span> sslEngine<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNegotiatedProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>JreCompat<span class="token punctuation">.</span><span class="token function">isJre9Available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            socketWrapper<span class="token punctuation">.</span><span class="token function">setNegotiatedProtocol</span><span class="token punctuation">(</span>JreCompat<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getApplicationProtocol</span><span class="token punctuation">(</span>sslEngine<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment" spellcheck="true">// å¦‚æœæ‰€æœ‰æ•°æ®éƒ½å·²å†™å®Œï¼Œæ¡æ‰‹å®Œæˆ</span>
                    handshakeComplete <span class="token operator">=</span> <span class="token operator">!</span>netOutBuffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">// å¦‚æœå·²å®Œæˆæ¡æ‰‹ï¼Œè¿”å›0ï¼Œå¦åˆ™è¿˜æœ‰æ•°æ®è¦å†™</span>
                    <span class="token keyword">return</span> handshakeComplete <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> SelectionKey<span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// éœ€è¦WRAPå‘é€æ•°æ®</span>
                <span class="token keyword">case</span> NEED_WRAP<span class="token operator">:</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        handshake <span class="token operator">=</span> <span class="token function">handshakeWrap</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SSLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        handshake <span class="token operator">=</span> <span class="token function">handshakeWrap</span><span class="token punctuation">(</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Status<span class="token punctuation">.</span>OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>handshakeStatus <span class="token operator">==</span> HandshakeStatus<span class="token punctuation">.</span>NEED_TASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            handshakeStatus <span class="token operator">=</span> <span class="token function">tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Status<span class="token punctuation">.</span>CLOSED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">flush</span><span class="token punctuation">(</span>netOutBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">//wrap should always work with our buffers</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"channel.nio.ssl.unexpectedStatusDuringWrap"</span><span class="token punctuation">,</span> handshake<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>handshakeStatus <span class="token operator">!=</span> HandshakeStatus<span class="token punctuation">.</span>NEED_UNWRAP <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">flush</span><span class="token punctuation">(</span>netOutBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">//should actually return OP_READ if we have NEED_UNWRAP</span>
                        <span class="token keyword">return</span> SelectionKey<span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment" spellcheck="true">// éœ€è¦UNWRAPæ¥æ”¶æ•°æ®</span>
                <span class="token keyword">case</span> NEED_UNWRAP<span class="token operator">:</span>
                    handshake <span class="token operator">=</span> <span class="token function">handshakeUnwrap</span><span class="token punctuation">(</span>read<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Status<span class="token punctuation">.</span>OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>handshakeStatus <span class="token operator">==</span> HandshakeStatus<span class="token punctuation">.</span>NEED_TASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            handshakeStatus <span class="token operator">=</span> <span class="token function">tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment" spellcheck="true">// BUFFER_OVERFLOWï¼šç›®æ ‡ç¼“å†²åŒºæ²¡æœ‰è¶³å¤Ÿçš„å­—èŠ‚ç©ºé—´å¯ä»¥å®¹çº³ç»“æœ</span>
                    <span class="token comment" spellcheck="true">// BUFFER_UNDERFLOWï¼šä¸èƒ½å¯¹ä¼ å…¥çš„æ•°æ®è§£åŒ…ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„æºå­—èŠ‚å¯ä»¥ç”¨æ¥ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„åŒ…</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handshake<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Status<span class="token punctuation">.</span>BUFFER_UNDERFLOW<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">//read more data, reregister for OP_READ</span>
                        <span class="token keyword">return</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"channel.nio.ssl.unexpectedStatusDuringWrap"</span><span class="token punctuation">,</span> handshake<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// éœ€è¦æ‰§è¡Œä¸€äº›è€—æ—¶æ“ä½œï¼Œç”±SSLEngineå§”æ‰˜</span>
                <span class="token keyword">case</span> NEED_TASK<span class="token operator">:</span>
                    handshakeStatus <span class="token operator">=</span> <span class="token function">tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"channel.nio.ssl.invalidStatus"</span><span class="token punctuation">,</span> handshakeStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// åˆ°è¿™é‡Œæ¡æ‰‹å·²ç»å®Œæˆ</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>SecureNioChannel#processSNI</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">processSNI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ä»JDKçš„SocketChannelè¯»å–æ•°æ®åˆ°ç¼“å†²</span>
        <span class="token keyword">int</span> bytesRead <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>netInBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// æ²¡è¯»åˆ°æ•°æ®</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bytesRead <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">/*
         * Server Name Indicationï¼ŒSNI
         * TLSæ¡æ‰‹æœŸé—´æœåŠ¡å™¨éœ€è¦å‘é€è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä¸€ä¸ªIPå’Œç«¯å£å¯èƒ½é…ç½®äº†å¤šä¸ªåŸŸåï¼ŒSNIåˆ™æŒ‡å®šäº†åŸŸå
         * è¿™é‡Œçš„åŸŸåä¸æ˜¯HTTPè¯·æ±‚å¤´çš„Hostï¼Œå› ä¸ºæ¡æ‰‹æ—¶HTTPäº¤äº’è¿˜æ²¡å¼€å§‹ï¼ˆæ¡æ‰‹ä¸æ˜¯èµ°HTTPåè®®çš„ï¼‰
         */</span>
        <span class="token comment" spellcheck="true">// è¿™é‡Œä¼šä»ç¼“å†²è§£æClientHelloåŒ…</span>
        TLSClientHelloExtractor extractor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TLSClientHelloExtractor</span><span class="token punctuation">(</span>netInBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å¾ªç¯è§£æ</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>extractor<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ExtractorResult<span class="token punctuation">.</span>UNDERFLOW <span class="token operator">&amp;&amp;</span> netInBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> endpoint<span class="token punctuation">.</span><span class="token function">getSniParseLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Extractoræå–å™¨éœ€è¦æ›´å¤šæ•°æ®å»å¤„ç†ä½†æ˜¯ç¼“å†²å·²ç»æ»¡äº†ï¼Œæ‰€ä»¥éœ€è¦æ‰©å±•ç¼“å†²</span>
            <span class="token keyword">int</span> newLimit <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>netInBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> endpoint<span class="token punctuation">.</span><span class="token function">getSniParseLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"channel.nio.ssl.expandNetInBuffer"</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>newLimit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// æ‰©å¼ </span>
            netInBuffer <span class="token operator">=</span> ByteBufferUtils<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>netInBuffer<span class="token punctuation">,</span> newLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// å†æ¬¡ä»JDKçš„SocketChannelè¯»å–æ•°æ®åˆ°ç¼“å†²</span>
            sc<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>netInBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// å†æ¬¡è§£æ</span>
            extractor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TLSClientHelloExtractor</span><span class="token punctuation">(</span>netInBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        String hostName <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ å¯†å¥—ä»¶</span>
        List<span class="token operator">&lt;</span>Cipher<span class="token operator">></span> clientRequestedCiphers <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å®¢æˆ·ç«¯è¯·æ±‚çš„åº”ç”¨åè®®</span>
        List<span class="token operator">&lt;</span>String<span class="token operator">></span> clientRequestedApplicationProtocols <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>extractor<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> COMPLETE<span class="token operator">:</span>
                hostName <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">getSNIValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                clientRequestedApplicationProtocols <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">getClientRequestedApplicationProtocols</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//$FALL-THROUGH$ to set the client requested ciphers</span>
            <span class="token keyword">case</span> NOT_PRESENT<span class="token operator">:</span>
                clientRequestedCiphers <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">getClientRequestedCiphers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> NEED_READ<span class="token operator">:</span>
                <span class="token keyword">return</span> SelectionKey<span class="token punctuation">.</span>OP_READ<span class="token punctuation">;</span>
            <span class="token keyword">case</span> UNDERFLOW<span class="token operator">:</span>
                <span class="token comment" spellcheck="true">// Unable to buffer enough data to read SNI extension data</span>
                <span class="token comment" spellcheck="true">// ...</span>
                hostName <span class="token operator">=</span> endpoint<span class="token punctuation">.</span><span class="token function">getDefaultSSLHostConfigName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                clientRequestedCiphers <span class="token operator">=</span> Collections<span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> NON_SECURE<span class="token operator">:</span>
                netOutBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                netOutBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>TLSClientHelloExtractor<span class="token punctuation">.</span>USE_TLS_RESPONSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                netOutBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">flushOutbound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"channel.nio.ssl.foundHttp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// ...</span>
        <span class="token comment" spellcheck="true">// æ ¹æ®ä¸»æœºåï¼ŒåŠ å¯†å¥—ä»¶ï¼Œåº”ç”¨åè®®åˆ›å»ºSSLå¼•æ“ï¼ŒSSLEngineå†…éƒ¨å°è£…äº†æ¡æ‰‹å’Œä¼šè¯çš„å®ç°ç»†èŠ‚</span>
        sslEngine <span class="token operator">=</span> endpoint<span class="token punctuation">.</span><span class="token function">createSSLEngine</span><span class="token punctuation">(</span>hostName<span class="token punctuation">,</span> clientRequestedCiphers<span class="token punctuation">,</span> clientRequestedApplicationProtocols<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// ç¡®ä¿ä¹‹å‰åˆ›å»ºçš„åº”ç”¨ç¼“å†²è¶³å¤Ÿå¤§</span>
        <span class="token function">getBufHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>sslEngine<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getApplicationBufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// ...</span>
        netInBuffer <span class="token operator">=</span> ByteBufferUtils<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>netInBuffer<span class="token punctuation">,</span> sslEngine<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPacketBufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        netOutBuffer <span class="token operator">=</span> ByteBufferUtils<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>netOutBuffer<span class="token punctuation">,</span> sslEngine<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPacketBufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// Set limit and position to expected values</span>
        netOutBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        netOutBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// åˆå§‹åŒ–æ¡æ‰‹ï¼ŒOpenSSLEngine#beginHandshake</span>
        sslEngine<span class="token punctuation">.</span><span class="token function">beginHandshake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// æ¡æ‰‹çŠ¶æ€</span>
        handshakeStatus <span class="token operator">=</span> sslEngine<span class="token punctuation">.</span><span class="token function">getHandshakeStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>æ€»ç»“ï¼š</p>
<p>å…¶å®JDKå·²ç»æŠŠç»†èŠ‚å°è£…å¥½äº†ã€‚</p>
<p>SSLï¼ˆSocket Security Layerï¼‰å’ŒTLSï¼ˆTransport Layer Securityï¼‰åº”è¯¥æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Ÿéƒ½æ˜¯åŸºäºä¼ è¾“å±‚çš„ï¼Œå¯¹åº”ç”¨å±‚æ•°æ®çš„åŠ å¯†ã€‚</p>
<p>HTTPSé»˜è®¤ç«¯å£443ï¼ŒHTTPé»˜è®¤ç«¯å£æ˜¯80ã€‚</p>
<ul>
<li><p>SSL/TLSå®ç°äº†ä¼ è¾“çš„åŠ å¯†ï¼Œè§£å†³äº†ä¿¡æ¯è¢«ç¬¬ä¸‰æ–¹çªƒå¬ï¼ˆwiretapï¼‰çš„é—®é¢˜ã€‚</p>
</li>
<li><p>SSL/TLSå®ç°äº†æ•°æ®çš„ç­¾ååŠæ ¡éªŒï¼Œè§£å†³äº†æ•°æ®è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ï¼ˆtamperingï¼‰çš„é—®é¢˜ã€‚</p>
</li>
<li><p>SSL/TLSå®ç°äº†æ•°å­—è¯ä¹¦è®¤è¯æœºåˆ¶ï¼Œè§£å†³äº†èº«ä»½è¢«ç¬¬ä¸‰æ–¹å†’å……ï¼ˆpretendingï¼‰çš„é—®é¢˜ã€‚</p>
</li>
</ul>
<p>SSL/TLSæ¡æ‰‹åå•†çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><p>åè®®ç‰ˆæœ¬å·ï¼›</p>
</li>
<li><p>åŠ å¯†ç®—æ³•ï¼ŒåŒ…æ‹¬éå¯¹ç§°åŠ å¯†ç®—æ³•ã€åŠ¨æ€å¯†é’¥ç®—æ³•ï¼›</p>
</li>
<li><p>æ•°å­—è¯ä¹¦ï¼Œä¼ è¾“åŒæ–¹é€šè¿‡äº¤æ¢è¯ä¹¦åŠç­¾åæ ¡éªŒå¯¹å½¼æ­¤é‰´æƒï¼›</p>
</li>
<li><p>åŠ¨æ€å¯†é’¥ï¼Œä¼ è¾“æ•°æ®ä½¿ç”¨è¯¥å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ è§£å¯†ï¼Œè¯¥å¯†é’¥é€šè¿‡éå¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€‚</p>
</li>
</ul>
<p>å»ºè®®ç”¨WiresharkæŠ“åŒ…ï¼Œå‚»ç“œå¼æ“ä½œã€‚</p>
<p>å¯¹SSL/TLSå’Œå¯¹ç§°/éå¯¹ç§°åŠ å¯†æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹æˆ‘å»å¹´çš„ä¸€ç¯‡ç¬”è®°ï¼ˆä¸­é—´äººï¼‰ã€‚</p>
<p>é™„é€ä¸€å¼ æ¡æ‰‹å›¾ï¼š</p>
<p><img src="/imgs/SSL_handshake.png" alt="SSLæ¡æ‰‹"></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


        <footer>
             
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

        </footer>
    </div>
    <!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
    <script>
        var timeEnd = new Date();
        console.log('è€—æ—¶ï¼š' + (timeEnd - timeStart));
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre').forEach((block) => {
                block.classList.add("line-numbers");
            });
        });
    </script>
    <!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
    <!-- material design -->
    <!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
    <!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
    <!-- toc -->
    <!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
    <!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
    <!-- <script src="/js/main.js"></script> -->
    <script src="/js/prism.js"></script>
</body>
</html>
