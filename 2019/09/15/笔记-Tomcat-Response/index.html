<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <script>
            var timeStart = new Date();
        </script>
        
        <title>[ç¬”è®°]-Tomcat-Response | ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜</title>
        
        <meta name="author" content="huangzhike">
        
        
        <meta name="description" content="org.apache.catalina.connector.Responseï¼šåŒ…è£…åæš´éœ²ç»™Servletä½¿ç”¨ï¼Œå†…éƒ¨æœ‰ä¸ªOutputBufferï¼Œå­˜æ”¾å†™å…¥çš„å“åº”ä½“ï¼ŒåŒ…å«å­—èŠ‚ç¼“å†²å’Œå­—ç¬¦ç¼“å†²ã€‚
org.apache.coyote.Responseï¼šå†…éƒ¨ç”¨ï¼Œå†…éƒ¨ä¹Ÿæœ‰ä¸ªOutputBufferï¼Œå…³è”ä¸ºHttp">
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        
        <meta property="og:title" content="[ç¬”è®°]-Tomcat-Response"/>
        
        <meta property="og:site_name" content="ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜"/>
        
        
        <!-- favicon -->
        <link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
        <meta name="msapplication-TileColor" content="#009688">
        <meta name="msapplication-TileImage" content="/mstile-144x144.ico">
        <meta name="theme-color" content="#009688">
        <!-- favicon end -->
        <!-- <link href="//ok.ico" rel="icon"> -->
        
        <!-- toc -->
        <!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
        <!-- material design -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
        <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
        
        <!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
        <!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
    <meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">èœå•</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" title="ä¸‹ä¸€å¥æ˜¯ï¼šå®¢æœ‰å¯äººæœŸä¸æ¥ã€‚å°æ—¶å€™ï¼Œå–œæ¬¢é åœ¨é˜³å°ä¸Šï¼Œä¸€è¾¹å¹é£ï¼Œä¸€è¾¹çœ‹ä¹¦ï¼Œå–œæ¬¢è¯»ä¹¦å—ï¼Œéªšå¹´ï¼Ÿ" href="/">ä¹¦å½“å¿«æ„è¯»æ˜“å°½</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" target="_blank" rel="noopener" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

    <div class="container" >
        <div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[ç¬”è®°]-Tomcat-Response</h2>
				
				<div>
					<div class="post-time">2019-09-15</div>
				</div>
				
				<div class="article-content">
				<p>org.apache.catalina.connector.Responseï¼šåŒ…è£…åæš´éœ²ç»™Servletä½¿ç”¨ï¼Œå†…éƒ¨æœ‰ä¸ªOutputBufferï¼Œå­˜æ”¾å†™å…¥çš„å“åº”ä½“ï¼ŒåŒ…å«å­—èŠ‚ç¼“å†²å’Œå­—ç¬¦ç¼“å†²ã€‚</p>
<p>org.apache.coyote.Responseï¼šå†…éƒ¨ç”¨ï¼Œå†…éƒ¨ä¹Ÿæœ‰ä¸ªOutputBufferï¼Œå…³è”ä¸ºHttp11Processorçš„Http11OutputBufferã€‚</p>
<pre class=" language-java"><code class="language-java">        <span class="token comment" spellcheck="true">// å­—ç¬¦æµ</span>
        response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å­—èŠ‚æµ</span>
        response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å­—ç¬¦æµ</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<hr>
<p>CoyoteAdapter#service</p>
<pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>coyote<span class="token punctuation">.</span>Request req<span class="token punctuation">,</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>coyote<span class="token punctuation">.</span>Response res<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ...</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// è§£æRequestï¼Œä¸»è¦æ˜¯URIè§£ç ï¼Œå¹¶ä¸”æ ¹æ®URIæ˜ å°„å¯¹åº”çš„è°ƒç”¨é“¾</span>
            postParseSuccess <span class="token operator">=</span> <span class="token function">postParseRequest</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> request<span class="token punctuation">,</span> res<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>postParseSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// éå†StandardEngineçš„Pipelineæ£€æŸ¥Valveæ˜¯å¦æ”¯æŒå¼‚æ­¥</span>
                request<span class="token punctuation">.</span><span class="token function">setAsyncSupported</span><span class="token punctuation">(</span>connector<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAsyncSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// èŒè´£é“¾è°ƒç”¨</span>
                <span class="token comment" spellcheck="true">// StandardService StandardEngine StandardPipeline StandardEngineValve#invoke</span>
                connector<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// æ­¤æ—¶Servletè°ƒç”¨å®Œæ¯•ï¼ŒWorkerçº¿ç¨‹è¦è¿”å›äº†ï¼Œå¦‚æœæ˜¯å¼‚æ­¥è¯·æ±‚</span>
            <span class="token comment" spellcheck="true">// é€šè¿‡AsyncContextå’ŒProcessorçš„AsyncStateMachineåˆ¤æ–­</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">isAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ...</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// éå¼‚æ­¥è¯·æ±‚</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ç»“æŸè¯·æ±‚</span>
                request<span class="token punctuation">.</span><span class="token function">finishRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// ç»“æŸå“åº”ï¼Œå…³é—­Responseçš„OutputBufferï¼ŒFlushï¼Œå…³é—­Requestçš„InputBuffer</span>
                <span class="token comment" spellcheck="true">// æ‰€ä»¥åŒæ­¥æƒ…å†µä¸‹Workerçº¿ç¨‹è¿”å›åæ˜¯ä¸èƒ½å†™çš„</span>
                response<span class="token punctuation">.</span><span class="token function">finishResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Ignore</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<p>org.apache.catalina.connector.Response#finishResponse</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finishResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Writing leftover bytes</span>
        outputBuffer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>OutputBuffer#close</p>
<pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// ç¼“å†²å·²å…³é—­</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// ç¼“å†²å·²ä¸­æ–­</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>suspended<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// å¦‚æœå­—ç¬¦ç¼“å†²è¿˜æœ‰æœªè¯»å­—ç¬¦</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Flushåˆ°å­—èŠ‚ç¼“å†²å¹¶é‡ç½®ï¼Œç›´åˆ°å­—èŠ‚ç¼“å†²æ»¡äº†</span>
            <span class="token function">flushCharBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// å“åº”æ²¡æœ‰æäº¤ &amp;&amp; å“åº”æ²¡æœ‰è®¾ç½®ContentLength &amp;&amp; è¯·æ±‚æ–¹æ³•ä¸æ˜¯HEAD</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>coyoteResponse<span class="token punctuation">.</span><span class="token function">isCommitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>coyoteResponse<span class="token punctuation">.</span><span class="token function">getContentLengthLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>coyoteResponse<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"HEAD"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 101</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>coyoteResponse<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> HttpServletResponse<span class="token punctuation">.</span>SC_SWITCHING_PROTOCOLS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doFlush</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// å…¶å®ƒ</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// æŠŠå­—èŠ‚ç¼“å­˜çš„æ•°æ®Flushåˆ°ç½‘ç»œï¼Œä¼šä¿è¯å·²ç»æäº¤äº†å“åº”è¡Œå’Œå“åº”å¤´</span>
            <span class="token function">doFlush</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        closed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å½“å…³é—­å“åº”æ—¶ï¼Œè¯·æ±‚åº”è¯¥å·²ç»è¢«å®Œå…¨è¯»äº†ï¼Œæ›´è¿›ä¸€æ­¥çš„è¯»å–æ˜¯æ— æ„ä¹‰çš„ï¼Œå¹¶ä¸”å¯¹AJPé€ æˆå›°æ‰°ï¼Œæ‰€ä»¥å…³é—­è¾“å…¥ç¼“å†²</span>
        Request req <span class="token operator">=</span> <span class="token punctuation">(</span>Request<span class="token punctuation">)</span> coyoteResponse<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNote</span><span class="token punctuation">(</span>CoyoteAdapter<span class="token punctuation">.</span>ADAPTER_NOTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span>inputBuffer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">/*
         * AbstractProcessor#action
         *  æäº¤å“åº”ï¼ŒHttp11Processor#prepareResponse
         *      å¦‚æœResponseæ²¡æœ‰æäº¤ï¼Œæ£€æŸ¥å¹¶ç”Ÿæˆå“åº”è¡Œå’Œå“åº”å¤´ï¼Œæ ¹æ®å“åº”å¤´è®¾ç½®Http11OutputBufferå¯¹åº”çš„OutputFilterï¼Œç”¨æ¥å¤„ç†å“åº”ä½“å¦‚å‹ç¼©ç­‰
         *      æŠŠç”Ÿæˆå“åº”è¡Œå’Œå“åº”å¤´æ·»åŠ åˆ°Http11Processorçš„Http11OutputBufferçš„headerBuffer
         *      æäº¤Http11OutputBufferï¼Œè®¾ç½®Responseä¸ºå·²æäº¤ï¼Œæœ€ç»ˆæŠŠheaderBufferå†™åˆ°ç½‘ç»œSocketChannel
         *      æ‰€ä»¥æäº¤æ˜¯æŠŠå“åº”è¡Œå’Œå“åº”å¤´å†™åˆ°ç½‘ç»œçš„æ„æ€
         *  ç»“æŸå“åº”ï¼ŒHttp11Processor#finishResponse
         *      Http11OutputBuffer#end
         *      ç»è¿‡OutputFilterè¿‡æ»¤é“¾ï¼Œè°ƒç”¨Http11OutputBuffer$SocketOutputBuffer#endï¼Œæœ€ç»ˆè°ƒç”¨SocketWrapperBase#flushé˜»å¡å†™åˆ°SocketChannel
         */</span>
        coyoteResponse<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span>ActionCode<span class="token punctuation">.</span>CLOSE<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>OutputBuffer#flushCharBuffer</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">flushCharBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// åˆ›å»ºæœªè¯»å­—ç¬¦ç¼“å†²çš„å­ç¼“å†²ï¼Œå°†å­—ç¬¦ç¼“å†²å†™åˆ°å­—èŠ‚ç¼“å†²</span>
        <span class="token function">realWriteChars</span><span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// rewindé‡ç½®å­—ç¬¦ç¼“å†²</span>
        <span class="token function">clear</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>OutputBuffer#realWriteChars</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">realWriteChars</span><span class="token punctuation">(</span>CharBuffer from<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// å¾ªç¯å¤„ç†ï¼Œç›´åˆ°å­—ç¬¦ç¼“å†²æ‰€æœ‰çš„å­—ç¬¦éƒ½å·²è¯»</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>from<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// å°†å­—ç¬¦è½¬å­—èŠ‚ï¼Œå¹¶å†™å…¥å­—èŠ‚ç¼“å†²ï¼Œé‡Œé¢çš„æ“ä½œæ²¡å®Œå…¨çœ‹æ‡‚ï¼Œè·³è¿‡</span>
            conv<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> bb<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// å­—èŠ‚ç¼“å†²æ»¡äº†ï¼Œä¸å¯å†™</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bb<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// è·³å‡º</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// å­—èŠ‚ç¼“å†²æ²¡æ»¡ï¼Œä½†æ˜¯å­—ç¬¦ç¼“å†²è¿˜æœ‰æœªè¯»æ•°æ®</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>from<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// æŠŠå­—èŠ‚ç¼“å†²çš„æ•°æ®åˆ·åˆ°ç½‘ç»œï¼Œä¼šä¿è¯å·²ç»æäº¤äº†å“åº”è¡Œå’Œå“åº”å¤´</span>
                <span class="token function">flushByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>conv<span class="token punctuation">.</span><span class="token function">isUndeflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> bb<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> bb<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">flushByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<p>OutputBuffer#doFlush</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFlush</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> realFlush<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>suspended<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// æ­£åœ¨Flushçš„æ ‡è¯†</span>
            doFlush <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// ç¬¬ä¸€æ¬¡</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>initial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">/*
                 * AbstractProcessor#action
                 *  æäº¤å“åº”ï¼ŒHttp11Processor#prepareResponse
                 *      å¦‚æœResponseæ²¡æœ‰æäº¤ï¼Œæ£€æŸ¥å¹¶ç”Ÿæˆå“åº”è¡Œå’Œå“åº”å¤´ï¼Œæ ¹æ®å“åº”å¤´è®¾ç½®Http11OutputBufferå¯¹åº”çš„OutputFilterï¼Œç”¨æ¥å¤„ç†å“åº”ä½“å¦‚å‹ç¼©ç­‰
                 *      æŠŠç”Ÿæˆå“åº”è¡Œå’Œå“åº”å¤´æ·»åŠ åˆ°Http11Processorçš„Http11OutputBufferçš„headerBuffer
                 *      æäº¤Http11OutputBufferï¼Œè®¾ç½®Responseä¸ºå·²æäº¤ï¼Œæœ€ç»ˆæŠŠheaderBufferå†™åˆ°SocketChannel
                 *      æ‰€ä»¥æäº¤æ˜¯æŠŠå“åº”è¡Œå’Œå“åº”å¤´å†™åˆ°ç½‘ç»œçš„æ„æ€
                 * æ ‡å¿—Responseä¸ºå·²æäº¤
                 */</span>
                coyoteResponse<span class="token punctuation">.</span><span class="token function">sendHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                initial <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// å¦‚æœå­—ç¬¦ç¼“å†²æœ‰æœªè¯»æ•°æ®</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// åˆ·åˆ°å­—èŠ‚ç¼“å†²</span>
                <span class="token function">flushCharBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// å¦‚æœå­—èŠ‚ç¼“å†²æœ‰æœªè¯»æ•°æ®</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bb<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// æœ€ç»ˆæŠŠå­—èŠ‚ç¼“å†²æ•°æ®åˆ·åˆ°SocketChannel</span>
                <span class="token function">flushByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            doFlush <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>realFlush<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">/*
             * æäº¤å“åº”ï¼Œè¿‡ç¨‹è§ä¸Š
             * æŠŠHttp11OutputBufferçš„å“åº”ä½“çš„æ•°æ®Flushåˆ°ç½‘ç»œ
             */</span>
            coyoteResponse<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span>ActionCode<span class="token punctuation">.</span>CLIENT_FLUSH<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// If some exception occurred earlier, or if some IOE occurred here, notify the servlet with an IOE</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>coyoteResponse<span class="token punctuation">.</span><span class="token function">isExceptionPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClientAbortException</span><span class="token punctuation">(</span>coyoteResponse<span class="token punctuation">.</span><span class="token function">getErrorException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span></code></pre>
<p>org.apache.coyote.Response#sendHeaders</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">action</span><span class="token punctuation">(</span>ActionCode<span class="token punctuation">.</span>COMMIT<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setCommitted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Http11Processor#prepareResponse</p>
<pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">prepareResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> entityBody <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        contentDelimitation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        OutputFilter<span class="token punctuation">[</span><span class="token punctuation">]</span> outputFilters <span class="token operator">=</span> outputBuffer<span class="token punctuation">.</span><span class="token function">getFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>http09 <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> statusCode <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">&lt;</span> <span class="token number">200</span> <span class="token operator">||</span> statusCode <span class="token operator">==</span> <span class="token number">204</span> <span class="token operator">||</span> statusCode <span class="token operator">==</span> <span class="token number">205</span> <span class="token operator">||</span> statusCode <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        MessageBytes methodMB <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>methodMB<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"HEAD"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// Sendfile support</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>protocol<span class="token punctuation">.</span><span class="token function">getUseSendfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// æ£€æŸ¥å‹ç¼©</span>
        <span class="token keyword">boolean</span> useCompression <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>entityBody <span class="token operator">&amp;&amp;</span> sendfileData <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        MimeHeaders headers <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getMimeHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 404</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>entityBody <span class="token operator">||</span> statusCode <span class="token operator">==</span> HttpServletResponse<span class="token punctuation">.</span>SC_NO_CONTENT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> contentLength <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getContentLengthLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> connectionClosePresent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>http11 <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span><span class="token function">getTrailerFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// If trailer fields are set, always use chunking</span>
            outputBuffer<span class="token punctuation">.</span><span class="token function">addActiveFilter</span><span class="token punctuation">(</span>outputFilters<span class="token punctuation">[</span>Constants<span class="token punctuation">.</span>CHUNKED_FILTER<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            contentDelimitation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            headers<span class="token punctuation">.</span><span class="token function">addValue</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>TRANSFERENCODING<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>CHUNKED<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>contentLength <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            headers<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            outputBuffer<span class="token punctuation">.</span><span class="token function">addActiveFilter</span><span class="token punctuation">(</span>outputFilters<span class="token punctuation">[</span>Constants<span class="token punctuation">.</span>IDENTITY_FILTER<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            contentDelimitation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// If the response code supports an entity body and we're on HTTP 1.1 then we chunk unless we have a Connection: close header</span>
            connectionClosePresent <span class="token operator">=</span> <span class="token function">isConnectionClose</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>http11 <span class="token operator">&amp;&amp;</span> entityBody <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>connectionClosePresent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                outputBuffer<span class="token punctuation">.</span><span class="token function">addActiveFilter</span><span class="token punctuation">(</span>outputFilters<span class="token punctuation">[</span>Constants<span class="token punctuation">.</span>CHUNKED_FILTER<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                contentDelimitation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                headers<span class="token punctuation">.</span><span class="token function">addValue</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>TRANSFERENCODING<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>CHUNKED<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                outputBuffer<span class="token punctuation">.</span><span class="token function">addActiveFilter</span><span class="token punctuation">(</span>outputFilters<span class="token punctuation">[</span>Constants<span class="token punctuation">.</span>IDENTITY_FILTER<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>useCompression<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            outputBuffer<span class="token punctuation">.</span><span class="token function">addActiveFilter</span><span class="token punctuation">(</span>outputFilters<span class="token punctuation">[</span>Constants<span class="token punctuation">.</span>GZIP_FILTER<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// Add date header unless application has already set one (e.g. in a Caching Filter)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">"Date"</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            headers<span class="token punctuation">.</span><span class="token function">addValue</span><span class="token punctuation">(</span><span class="token string">"Date"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>FastHttpDateFormat<span class="token punctuation">.</span><span class="token function">getCurrentDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// FIXME: Add transfer encoding header</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>entityBody<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>contentDelimitation<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// This may disabled keep-alive to check before working out the Connection header.</span>
        <span class="token function">checkExpectationAndResponseStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// æ ¹æ®StatusCodeåˆ¤æ–­æ˜¯å¦å…³é—­keepAliveï¼Œä¸¢å¼ƒå½“å‰è¿æ¥</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>keepAlive <span class="token operator">&amp;&amp;</span> <span class="token function">statusDropsConnection</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            keepAlive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keepAlive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// é¿å…é‡å¤æ·»åŠ </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connectionClosePresent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// å“åº”å¤´æ·»åŠ Connection: close</span>
                headers<span class="token punctuation">.</span><span class="token function">addValue</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>CONNECTION<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>http11 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">getErrorState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            headers<span class="token punctuation">.</span><span class="token function">addValue</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>CONNECTION<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>Constants<span class="token punctuation">.</span>KEEPALIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// Add server header</span>
        String server <span class="token operator">=</span> protocol<span class="token punctuation">.</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>server <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// Build the response header</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// æ·»åŠ å“åº”è¡Œåˆ°headerBuffer</span>
            outputBuffer<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> size <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// éå†æ·»åŠ å“åº”å¤´åˆ°headerBuffer</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                outputBuffer<span class="token punctuation">.</span><span class="token function">sendHeader</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">// æ¢è¡Œ</span>
            outputBuffer<span class="token punctuation">.</span><span class="token function">endHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ...</span>
        <span class="token punctuation">}</span>
        outputBuffer<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Http11OutputBuffer#commit</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// æ ‡è®°ä¸ºå·²æäº¤</span>
        response<span class="token punctuation">.</span><span class="token function">setCommitted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// å†™äº†æ•°æ®</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>headerBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼</span>
            headerBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                SocketWrapperBase<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> socketWrapper <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>socketWrapper<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>socketWrapper <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">// å¦‚æœResponseè®¾ç½®äº†WriteListenerï¼Œé‚£å°±æ˜¯éé˜»å¡å†™ï¼Œå¦åˆ™é˜»å¡å†™</span>
                    socketWrapper<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">isBlocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> headerBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CloseNowException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"iob.failedwrite"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// é‡ç½®</span>
                headerBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>headerBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<p>OutputBuffer#flushByteBuffer</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">flushByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// åˆ›å»ºæœªè¯»å­—èŠ‚ç¼“å†²çš„å­ç¼“å†²ï¼Œå†™åˆ°ç½‘ç»œ</span>
        <span class="token function">realWriteBytes</span><span class="token punctuation">(</span>bb<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// rewindé‡ç½®å­—èŠ‚ç¼“å†²</span>
        <span class="token function">clear</span><span class="token punctuation">(</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>OutputBuffer#realWriteBytes</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">realWriteBytes</span><span class="token punctuation">(</span>ByteBuffer buf<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>coyoteResponse <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// å­—èŠ‚ç¼“å†²æœ‰å¯è¯»å­—èŠ‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">/*
                 * org.apache.catalina.connector.Responseå†…éƒ¨æœ‰ä¸ªç¼“å†²OutputBufferï¼ŒOutputBufferå†…éƒ¨æœ‰å­—èŠ‚å’Œå­—ç¬¦ä¸¤ä¸ªç¼“å†²
                 * org.apache.coyote.Responseå†…éƒ¨ä¹Ÿæœ‰ä¸ªç¼“å†²OutputBuffer
                 * Http11Processorå®ä¾‹åŒ–æ—¶å°†è‡ªèº«çš„Http11OutputBufferå…³è”ä¸ºorg.apache.coyote.Responseçš„ç¼“å†²
                 * Http11OutputBufferå†…éƒ¨åˆæœ‰å“åº”è¡Œå“åº”å¤´ç¼“å†²ByteBufferå’Œå“åº”ä½“HttpOutputBufferä¸¤ä¸ªç¼“å†²
                 * è¿™é‡Œæ˜¯å…ˆå°†å“åº”æäº¤ï¼Œå°†å“åº”è¡Œå“åº”å¤´çš„ç¼“å†²å†™åˆ°ç½‘ç»œï¼Œå†å°†å­—èŠ‚ç¼“å†²ç»è¿‡å±‚å±‚OutputFilterå¤„ç†ï¼Œå†å†™åˆ°ç½‘ç»œ
                 */</span>
                coyoteResponse<span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloseNowException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ...</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// ...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span></code></pre>
<p>org.apache.coyote.Response#doWrite</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doWrite</span><span class="token punctuation">(</span>ByteBuffer chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// å¯è¯»é•¿åº¦</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// Http11OutputBuffer#doWrite</span>
        outputBuffer<span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
        contentWritten <span class="token operator">+=</span> len <span class="token operator">-</span> chunk<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Http11OutputBuffer#doWrite</p>
<pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">doWrite</span><span class="token punctuation">(</span>ByteBuffer chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// å¦‚æœå“åº”æ²¡æœ‰æäº¤</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token function">isCommitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Send the connector a request for commit.</span>
            <span class="token comment" spellcheck="true">// The connector should then validate the headers, send them (using sendHeaders) and set the filters accordingly.</span>
            response<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span>ActionCode<span class="token punctuation">.</span>COMMIT<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// OutputFilterè¿‡æ»¤é“¾</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastActiveFilter <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> outputStreamOutputBuffer<span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> activeFilters<span class="token punctuation">[</span>lastActiveFilter<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<p>Http11OutputBuffe$SocketOutputBufferr#doWrite</p>
<pre class=" language-java"><code class="language-java">        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">doWrite</span><span class="token punctuation">(</span>ByteBuffer chunk<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> len <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                SocketWrapperBase<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> socketWrapper <span class="token operator">=</span> Http11OutputBuffer<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span>socketWrapper<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>socketWrapper <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">// SocketWrapperBase#write</span>
                    socketWrapper<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">isBlocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CloseNowException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"iob.failedwrite"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                len <span class="token operator">-=</span> chunk<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                byteCount <span class="token operator">+=</span> len<span class="token punctuation">;</span>
                <span class="token keyword">return</span> len<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ioe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                response<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span>ActionCode<span class="token punctuation">.</span>CLOSE_NOW<span class="token punctuation">,</span> ioe<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// Re-throw</span>
                <span class="token keyword">throw</span> ioe<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span></code></pre>
<p>Http11Processor#finishResponse</p>
<pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">finishResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        outputBuffer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Http11OutputBuffer#end</p>
<pre class=" language-java"><code class="language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>responseFinished<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// OutputFilterè¿‡æ»¤é“¾</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastActiveFilter <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// æœ€å</span>
            outputStreamOutputBuffer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// è°ƒç”¨OutputFilter</span>
            activeFilters<span class="token punctuation">[</span>lastActiveFilter<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        responseFinished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Http11OutputBuffe$SocketOutputBufferr#end</p>
<pre class=" language-java"><code class="language-java">        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
            socketWrapper<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span></code></pre>
<p>æ€»ç»“ï¼š</p>
<p>HTTP/2.0æ²¡æœ‰å¤ªå¤šäº†è§£ï¼ŒHTTP/1.1æ˜¯é˜»å¡çš„ï¼Œè¯·æ±‚-å“åº”æ¨¡å‹ï¼Œæ‰€ä»¥æ²¡æœ‰åƒRPCé‚£æ ·çš„RequestIdï¼Œä¸€ä¸ªè¯·æ±‚æ²¡å“åº”å®Œï¼Œä¸ä¼šå“åº”åé¢çš„è¯·æ±‚ã€‚</p>
<p>HTTP/1.1åŸºäºæ–‡æœ¬ï¼Œå…ˆå‘å“åº”è¡Œï¼Œå“åº”å¤´ï¼Œç„¶åæ˜¯å“åº”ä½“ï¼Œè¿™äº›æ•°æ®å¯èƒ½æ˜¯åˆ†å¤šä¸ªTCPåŒ…å‘çš„ï¼Œå…ˆåé¡ºåºç”±TCPå±‚ä¿è¯ã€‚</p>
<p>åˆ¤æ–­å“åº”æ˜¯å¦ç»“æŸçš„æ ‡å¿—æ˜¯å“åº”å¤´çš„Content-Lengthæ ‡å¿—ï¼Œå¦‚æœæ¯”å®é™…é•¿åº¦çŸ­ï¼Œåˆ™å†…å®¹è¢«æˆªæ–­ï¼Œå¦‚æœæ¯”å®é™…å†…å®¹é•¿ï¼Œé‚£å°±ä¼šä¸€ç›´pendingã€‚</p>
<p>å¦å¤–å¦‚æœå¤´éƒ¨æœ‰Transfer-Encoding: chunkedï¼Œåˆ™è¡¨æ˜æŠ¥æ–‡é‡‡ç”¨äº†åˆ†å—ç¼–ç ï¼Œåˆ†å—ä¼ è¾“ã€‚</p>
<p>æ¯ä¸ªåˆ†å—ç»“æ„ä¸ºï¼šé•¿åº¦ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼Œæ¢è¡Œï¼ˆ\r\nï¼‰ï¼Œæ•°æ®ï¼Œæ¢è¡Œï¼ˆ\r\nï¼‰ã€‚</p>
<p>å…¶ä¸­é•¿åº¦ä¸åŒ…æ‹¬CRLFã€‚</p>
<p>æœ€åä¸€ä¸ªåˆ†å—é•¿åº¦å€¼å¿…é¡»ä¸º0ï¼Œå¯¹åº”çš„åˆ†å—æ•°æ®æ²¡æœ‰å†…å®¹ï¼Œè¡¨ç¤ºç»“æŸã€‚</p>
<p>Tomcatåœ¨å‡†å¤‡å“åº”å¤´æ—¶ä¼šæ ¹æ®Content-Encodingå’ŒTransfer-Encodingå†³å®šå¤„ç†å“åº”ä½“çš„OutputFilterï¼Œç»è¿‡è¿‡æ»¤é“¾å¤„ç†å‹ç¼©æˆ–è€…åˆ†å—ï¼Œæœ€åæŠŠå­—èŠ‚åˆ·åˆ°ç½‘ç»œã€‚</p>
<p>å¦å¤–ï¼ŒServlet3.0çš„å¼‚æ­¥Servletä½¿ç”¨äº†Transfer-Encoding:chunkedå“åº”å¤´ï¼Œå› ä¸ºè¿”å›å†…å®¹çš„é•¿åº¦ä¸ç¡®å®šã€‚</p>
<p>å…³äºå¼‚æ­¥Servletï¼Œæœ¬æ¥æ˜¯æ‰“ç®—ä¸€èµ·çœ‹å®Œçš„ï¼Œä¸è¿‡æˆ‘å·²ç»çœ‹äº†ä¸‰ä¸ªæ˜ŸæœŸï¼Œå®åœ¨æ˜¯æœ‰ç‚¹è…»äº†ğŸ˜¬ï¼Œè€Œä¸”å¼‚æ­¥éƒ¨åˆ†æŒºç»•çš„ï¼Œæ‰€ä»¥å…ˆå°±è¿™æ ·å§ğŸ˜¬ã€‚</p>
<p>æ¥ä¸‹æ¥è¦çœ‹RocketMQï¼ŒGKDã€‚</p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


        <footer>
             
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

        </footer>
    </div>
    <!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
    <script>
        var timeEnd = new Date();
        console.log('è€—æ—¶ï¼š' + (timeEnd - timeStart));
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre').forEach((block) => {
                block.classList.add("line-numbers");
            });
        });
    </script>
    <!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
    <!-- material design -->
    <!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
    <!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
    <!-- toc -->
    <!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
    <!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
    <!-- <script src="/js/main.js"></script> -->
    <script src="/js/prism.js"></script>
</body>
</html>
