<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-设计模式-Java | 学而时习之</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-设计模式-Java">
		
		<meta property="og:site_name" content="学而时习之">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">学而时习之</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-设计模式-Java</h2>
				
				<div>
					<div class="post-time">2017-12-23</div>
				</div>
				
				<div class="article-content">
				<p><strong>单例模式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 饿汉式单例：在单例类被加载时候，就实例化一个对象交给自己的引用</span><br><span class="line">class Singleton &#123;</span><br><span class="line">	// 指向自己实例的私有静态引用</span><br><span class="line">	private static Singleton singleton = new Singleton();</span><br><span class="line">	// 私有构造方法</span><br><span class="line">	private Singleton() &#123;&#125;</span><br><span class="line">	// 以自己实例为返回值的静态公有方法</span><br><span class="line">	public static Singleton getInstance() &#123;</span><br><span class="line">		return singleton;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 懒汉式单例：在调用取得实例方法的时候才会实例化对象</span><br><span class="line">class Singleton &#123;</span><br><span class="line">	private static Singleton singleton;</span><br><span class="line">	private Singleton() &#123;&#125;</span><br><span class="line">	public static synchronized Singleton getInstance() &#123;</span><br><span class="line">		if (singleton == null) &#123;</span><br><span class="line">			singleton = new Singleton();</span><br><span class="line">		&#125;</span><br><span class="line">		return singleton;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class c = Class.forName(Singleton.class.getName());</span><br><span class="line">Constructor ct = c.getDeclaredConstructor();</span><br><span class="line">ct.setAccessible(true);</span><br><span class="line">// 每次运行都会产生新的单例对象</span><br><span class="line">Singleton singleton = (Singleton)ct.newInstance();</span><br></pre></td></tr></table></figure>
<ul>
<li><p>只能使用单例类提供的方法得到单例对象，不要使用反射，否则将会实例化一个新对象。</p>
</li>
<li><p>不要做断开单例类对象与类中静态引用的危险操作。</p>
</li>
<li><p>多线程使用单例使用共享资源时，注意线程安全问题。</p>
</li>
</ul>
<p><strong>工厂模式</strong>：简单工厂模式（静态工厂模式）、工厂方法模式、抽象工厂模式。</p>
<p>抽象工厂模式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// 产品接口</span><br><span class="line">interface IProduct1 &#123;</span><br><span class="line">	public void show();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IProduct2 &#123;</span><br><span class="line">	public void show();</span><br><span class="line">&#125;</span><br><span class="line">// 产品实现</span><br><span class="line">class Product1 implements IProduct1 &#123;</span><br><span class="line">	public void show() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Product2 implements IProduct2 &#123;</span><br><span class="line">	public void show() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 工厂接口</span><br><span class="line">interface IFactory &#123;</span><br><span class="line">	public IProduct1 createProduct1();</span><br><span class="line">	public IProduct2 createProduct2();</span><br><span class="line">&#125;</span><br><span class="line">// 工厂实现</span><br><span class="line">class Factory implements IFactory &#123;</span><br><span class="line">	public IProduct1 createProduct1() &#123;</span><br><span class="line">		return new Product1();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public IProduct2 createProduct2() &#123;</span><br><span class="line">		return new Product2();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		IFactory factory = new Factory();</span><br><span class="line">		factory.createProduct1().show();</span><br><span class="line">		factory.createProduct2().show();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>工厂方法模式提供的所有产品都是衍生自同一个接口或抽象类，而抽象工厂模式所提供的产品则是衍生自不同的接口或抽象类。</p>
</li>
<li><p>对于抽象工厂模式，当减少一个方法使的提供的产品不再构成产品族之后，它就变成了工厂方法模式。</p>
</li>
<li><p>扩展只需要再增加一个工厂类的实现就可以。</p>
</li>
<li><p>简单工厂只有三个要素，没有工厂接口，并且得到产品的方法一般是静态的。</p>
</li>
<li><p>工厂模式最终目的是解耦。</p>
</li>
</ul>
<p><strong>建造者模式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">// 产品类</span><br><span class="line">class Product &#123;</span><br><span class="line">	private String name;</span><br><span class="line">	private String type;</span><br><span class="line"></span><br><span class="line">	public void showProduct() &#123;</span><br><span class="line">		System.out.println(&quot;名称：&quot; + name);</span><br><span class="line">		System.out.println(&quot;型号：&quot; + type);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// setters</span><br><span class="line">&#125;</span><br><span class="line">// 抽象建造者</span><br><span class="line">// 将建造的具体过程交与子类来实现，更容易扩展</span><br><span class="line">abstract class Builder &#123;</span><br><span class="line">	// 建造产品</span><br><span class="line">	public abstract void setPart(String arg1, String arg2);</span><br><span class="line">	// 返回产品</span><br><span class="line">	public abstract Product getProduct();</span><br><span class="line">&#125;</span><br><span class="line">// 建造者</span><br><span class="line">class ConcreteBuilder extends Builder &#123;</span><br><span class="line">	private Product product = new Product();</span><br><span class="line">	// 实现方法</span><br><span class="line">	public Product getProduct() &#123;</span><br><span class="line">		return product;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setPart(String arg1, String arg2) &#123;</span><br><span class="line">		product.setName(arg1);</span><br><span class="line">		product.setType(arg2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 导演类</span><br><span class="line">public class Director &#123;</span><br><span class="line">	// 导演类一般不与产品类发生依赖关系，与导演类直接交互的是建造者类</span><br><span class="line">	private Builder builder = new ConcreteBuilder();</span><br><span class="line">	// 调用适当的建造者来组建产品</span><br><span class="line">	public Product getAProduct() &#123;</span><br><span class="line">		builder.setPart(&quot;宝马汽车&quot;, &quot;X7&quot;);</span><br><span class="line">		return builder.getProduct();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Product getBProduct() &#123;</span><br><span class="line">		builder.setPart(&quot;奥迪汽车&quot;, &quot;Q5&quot;);</span><br><span class="line">		return builder.getProduct();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Director director = new Director();</span><br><span class="line"></span><br><span class="line">		Product product1 = director.getAProduct();</span><br><span class="line">		product1.showProduct();</span><br><span class="line"></span><br><span class="line">		Product product2 = director.getBProduct();</span><br><span class="line">		product2.showProduct();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>建造者模式的封装性很好，一般产品类和建造者类比较稳定，主要的业务逻辑封装在导演类，容易扩展，实现一个新的建造者类就可以。</p>
</li>
<li><p>建造者模式只比工厂模式多了一个导演类，一般用来创建复杂对象，将对象的创建过程独立出来组成导演类。</p>
</li>
<li><p>工厂模式是将对象的全部创建过程封装在工厂类中，由工厂类向客户端提供最终的产品；</p>
</li>
<li><p>而建造者模式中，建造者类一般只提供产品类中各个组件的建造，而将具体建造过程交付给导演类。</p>
</li>
</ul>
<p><strong>原型模式</strong>：主要用于对象的复制<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 实现Cloneable接口，才可以clone</span><br><span class="line">class Prototype implements Cloneable &#123;</span><br><span class="line">	// 重写Object类的clone()方法，将protected改为public</span><br><span class="line">	public Prototype clone() &#123;</span><br><span class="line">		Prototype prototype = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			prototype = (Prototype) super.clone();</span><br><span class="line">		&#125; catch (CloneNotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		return prototype;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcretePrototype extends Prototype &#123;</span><br><span class="line">	public void show() &#123;</span><br><span class="line">		System.out.println(&quot;原型模式实现类&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		ConcretePrototype cp = new ConcretePrototype();</span><br><span class="line">		for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">			ConcretePrototype clonecp = (ConcretePrototype) cp.clone();</span><br><span class="line">			clonecp.show();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>原型模式创建对象比直接new一个对象性能好，需要重复地创建相似对象时可以考虑使用原型模式，比如需要在一个循环体内创建对象。</p>
</li>
<li><p>使用原型模式复制对象不会调用类的构造方法。</p>
<ul>
<li>单例模式中，将构造方法的访问权限设置为private，但是clone方法无视构造方法，所以，单例模式与原型模式是冲突的。</li>
</ul>
</li>
<li><p>Object类的clone方法只拷贝对象中的基本数据类型，这是浅拷贝。要实现深拷贝，必须将原型模式中的引用对象等另行拷贝：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Prototype implements Cloneable &#123;</span><br><span class="line">	private ArrayList list = new ArrayList();</span><br><span class="line"></span><br><span class="line">	public Prototype clone() &#123;</span><br><span class="line">		Prototype prototype = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			prototype = (Prototype) super.clone();</span><br><span class="line">			// 大部分的容器类都实现了Cloneable接口</span><br><span class="line">			prototype.list = (ArrayList) this.list.clone();</span><br><span class="line">		&#125; catch (CloneNotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		return prototype;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>模版方法模式</strong></p>
<p>购物一般需要三个步骤：登录、挑选商品、付款，对于登录与付款，每个人操作相同，但每个人挑选的商品是不同的。</p>
<p>某类的某个方法的实现，需要几个固定步骤，对于该类的不同对象，有些步骤是固定的，有些步骤是不同的，有些步骤是可变可不变的。</p>
<p>这种情况适合模板方法：定义一个操作中某种算法的框架，而将一些步骤延迟到子类中。</p>
<p>模板方法中：由一个抽象类和一个（或一组）实现类通过继承结构组成：</p>
<ul>
<li>模板方法：实现某种算法的方法步骤。</li>
<li>步骤方法：完成模板方法的每个阶段性方法：<ul>
<li>抽象方法：子类必须实现。</li>
<li>最终方法：子类不能重写的方法，所有子类执行都一样的步骤。</li>
<li>钩子方法：父类给出了默认实现，但子类也可以重写。</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">abstract class ShoppingService &#123;</span><br><span class="line">	// 模版方法：抽象类声明并实现，大多会定义为final</span><br><span class="line">	public void shopping() &#123;</span><br><span class="line">		login();</span><br><span class="line">		choose();</span><br><span class="line">		pay();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 子类不能重写</span><br><span class="line">	public final void login() &#123;&#125;</span><br><span class="line"></span><br><span class="line">	// 子类必须实现</span><br><span class="line">	public abstract void choose();</span><br><span class="line"></span><br><span class="line">	// 钩子方法：子类可以重写</span><br><span class="line">	public void pay() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ShoseShoppingService extends ShoppingService &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void choose() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DressShoppingService extends ShoppingService &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void choose() &#123;&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void pay() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>中介者模式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">abstract class AbstractColleague &#123;</span><br><span class="line">	protected int number;</span><br><span class="line"></span><br><span class="line">	// getter setter</span><br><span class="line"></span><br><span class="line">	// 中介者</span><br><span class="line">	public abstract void setNumber(int number, AbstractMediator am);</span><br><span class="line">&#125;</span><br><span class="line">// 同事类之间相互影响，相互依赖</span><br><span class="line">class ColleagueA extends AbstractColleague &#123;</span><br><span class="line">	// 通过中介者消息传递</span><br><span class="line">	public void setNumber(int number, AbstractMediator am) &#123;</span><br><span class="line">		this.number = number;</span><br><span class="line">		am.AaffectB();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ColleagueB extends AbstractColleague &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void setNumber(int number, AbstractMediator am) &#123;</span><br><span class="line">		this.number = number;</span><br><span class="line">		am.BaffectA();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 抽象中介者</span><br><span class="line">abstract class AbstractMediator &#123;</span><br><span class="line">	protected AbstractColleague A;</span><br><span class="line">	protected AbstractColleague B;</span><br><span class="line"></span><br><span class="line">	public AbstractMediator(AbstractColleague a, AbstractColleague b) &#123;</span><br><span class="line">		A = a;</span><br><span class="line">		B = b;</span><br><span class="line">	&#125;</span><br><span class="line">	// 各个同事类之间的通信</span><br><span class="line">	public abstract void AaffectB();</span><br><span class="line"></span><br><span class="line">	public abstract void BaffectA();</span><br><span class="line">&#125;</span><br><span class="line">// 中介者实现类</span><br><span class="line">class Mediator extends AbstractMediator &#123;</span><br><span class="line">	public Mediator(AbstractColleague a, AbstractColleague b) &#123;</span><br><span class="line">		super(a, b);</span><br><span class="line">	&#125;</span><br><span class="line">	// 处理A对B的影响</span><br><span class="line">	public void AaffectB() &#123;</span><br><span class="line">		int number = A.getNumber();</span><br><span class="line">		B.setNumber(number * 100);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 处理B对A的影响</span><br><span class="line">	public void BaffectA() &#123;</span><br><span class="line">		int number = B.getNumber();</span><br><span class="line">		A.setNumber(number / 100);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		AbstractColleague collA = new ColleagueA();</span><br><span class="line">		AbstractColleague collB = new ColleagueB();</span><br><span class="line">		AbstractMediator am = new Mediator(collA, collB);</span><br><span class="line"></span><br><span class="line">		// 通过设置A影响B</span><br><span class="line">		collA.setNumber(1000, am);</span><br><span class="line"></span><br><span class="line">		// 通过设置B影响A</span><br><span class="line">		collB.setNumber(1000, am);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实就是把处理对象关系的代码封装到中介类中，通过这个中介类来处理对象间的关系。<br>同事类之间的关系将变为星型结构，类的变动，只会影响类本身，以及中介者，减小了耦合。</p>
<p><strong>观察者模式</strong>：如果一个对象的状态发生改变，与它相关的对象也要随之做出相应的变化。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// 被观察者：接口或抽象类</span><br><span class="line">abstract class Subject &#123;</span><br><span class="line">	// 存放观察者对象，Vector线程安全，List不安全</span><br><span class="line">	private Vector obs = new Vector();</span><br><span class="line">	// 添加观察者对象</span><br><span class="line">	public void addObserver(Observer obs) &#123;</span><br><span class="line">		this.obs.add(obs);</span><br><span class="line">	&#125;</span><br><span class="line">	// 移除观察者对象</span><br><span class="line">	public void delObserver(Observer obs) &#123;</span><br><span class="line">		this.obs.remove(obs);</span><br><span class="line">	&#125;</span><br><span class="line">	// 依次调用观察者对象的对应方法</span><br><span class="line">	protected void notifyObserver() &#123;</span><br><span class="line">		for (Observer o : obs) &#123;</span><br><span class="line">			o.update();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public abstract void doSomething();</span><br><span class="line">&#125;</span><br><span class="line">// 具体的观察者：定义被观察者对象状态发生变化时要处理的逻辑</span><br><span class="line">class ConcreteSubject extends Subject &#123;</span><br><span class="line">	public void doSomething() &#123;</span><br><span class="line">		System.out.println(&quot;被观察者事件反生&quot;);</span><br><span class="line">		this.notifyObserver();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 观察者</span><br><span class="line">interface Observer &#123;</span><br><span class="line">	// update()：被观察者状态发生变化时，被触发</span><br><span class="line">	public void update();</span><br><span class="line">&#125;</span><br><span class="line">// 具体的被观察者：便于扩展，定义具体的业务逻辑</span><br><span class="line">class ConcreteObserver1 implements Observer &#123;</span><br><span class="line">	public void update() &#123;</span><br><span class="line">		System.out.println(&quot;观察者1收到信息，并进行处理。&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteObserver2 implements Observer &#123;</span><br><span class="line">	public void update() &#123;</span><br><span class="line">		System.out.println(&quot;观察者2收到信息，并进行处理。&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Subject sub = new ConcreteSubject();</span><br><span class="line"></span><br><span class="line">		sub.addObserver(new ConcreteObserver1()); // 添加观察者1</span><br><span class="line">		sub.addObserver(new ConcreteObserver2()); // 添加观察者2</span><br><span class="line">		sub.doSomething();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>就是在Subject类中关联一下Observer类，并且在doSomething方法中遍历一下Observer的update方法就行了。</p>
<p>Java有Observer接口，以及实现类Observable，对观察者角色常进行了实现。</p>
<p><strong>访问者模式</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">// 抽象元素类</span><br><span class="line">abstract class Element &#123;</span><br><span class="line">	// 声明接受哪一类访问者访问</span><br><span class="line">	public abstract void accept(IVisitor visitor);</span><br><span class="line">	// 本身的业务逻辑</span><br><span class="line">	public abstract void doSomething();</span><br><span class="line">&#125;</span><br><span class="line">// 抽象访问者</span><br><span class="line">interface IVisitor &#123;</span><br><span class="line">	// 定义哪些对象是可以被访问的</span><br><span class="line">	public void visit(ConcreteElement1 el1);</span><br><span class="line"></span><br><span class="line">	public void visit(ConcreteElement2 el2);</span><br><span class="line">&#125;</span><br><span class="line">// 元素类</span><br><span class="line">class ConcreteElement1 extends Element &#123;</span><br><span class="line">	public void doSomething() &#123;</span><br><span class="line">		System.out.println(&quot;这是元素1&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	// 实现抽象元素类所声明的accept方法</span><br><span class="line">	public void accept(IVisitor visitor) &#123;</span><br><span class="line">		visitor.visit(this);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteElement2 extends Element &#123;</span><br><span class="line">	public void doSomething() &#123;</span><br><span class="line">		System.out.println(&quot;这是元素2&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void accept(IVisitor visitor) &#123;</span><br><span class="line">		visitor.visit(this);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 访问者</span><br><span class="line">class Visitor implements IVisitor &#123;</span><br><span class="line">	// 实现抽象访问者所声明的方法，访问者访问到一个类后干什么</span><br><span class="line">	public void visit(ConcreteElement1 el1) &#123;</span><br><span class="line">		el1.doSomething();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void visit(ConcreteElement2 el2) &#123;</span><br><span class="line">		el2.doSomething();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 结构对象</span><br><span class="line">class ObjectStruture &#123;</span><br><span class="line">	public static List getList() &#123;</span><br><span class="line">		// 元素的容器</span><br><span class="line">		List list = new ArrayList();</span><br><span class="line">		Random ran = new Random();</span><br><span class="line">		for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">			int a = ran.nextInt(100);</span><br><span class="line">			if (a &gt; 50) &#123;</span><br><span class="line">				list.add(new ConcreteElement1());</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				list.add(new ConcreteElement2());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return list;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		List list = ObjectStruture.getList();</span><br><span class="line">		for (Element e : list) &#123;</span><br><span class="line">			e.accept(new Visitor());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>命令模式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// 调用者</span><br><span class="line">class Invoker &#123;</span><br><span class="line">	private Command command;</span><br><span class="line"></span><br><span class="line">	public void setCommand(Command command) &#123;</span><br><span class="line">		this.command = command;</span><br><span class="line">	&#125;</span><br><span class="line">	// 调用命令</span><br><span class="line">	public void action() &#123;</span><br><span class="line">		this.command.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Command</span><br><span class="line">abstract class Command &#123;</span><br><span class="line">	// 执行命令</span><br><span class="line">	public abstract void execute();</span><br><span class="line">&#125;</span><br><span class="line">// Command类实现类</span><br><span class="line">class ConcreteCommand extends Command &#123;</span><br><span class="line">	private Receiver receiver;</span><br><span class="line"></span><br><span class="line">	public ConcreteCommand(Receiver receiver) &#123;</span><br><span class="line">		this.receiver = receiver;</span><br><span class="line">	&#125;</span><br><span class="line">	// 命令封装</span><br><span class="line">	public void execute() &#123;</span><br><span class="line">		this.receiver.doSomething();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 接收者</span><br><span class="line">class Receiver &#123;</span><br><span class="line">	// 接收并执行命令</span><br><span class="line">	public void doSomething() &#123;</span><br><span class="line">		// 封装操作</span><br><span class="line">		System.out.println(&quot;接受者-业务逻辑处理&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Receiver receiver = new Receiver();</span><br><span class="line">		Command command = new ConcreteCommand(receiver);</span><br><span class="line">		// 客户端直接执行具体命令方式</span><br><span class="line">		command.execute();</span><br><span class="line">		// 客户端通过调用者来执行命令</span><br><span class="line">		Invoker invoker = new Invoker();</span><br><span class="line">		invoker.setCommand(command);</span><br><span class="line">		// 调用者类==&gt;命令类==&gt;接收者类</span><br><span class="line">		// 一条命令被分成了三步，命令的调用者与执行者分开</span><br><span class="line">		invoker.action();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>责任链模式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public void test(int i, Request request) &#123;</span><br><span class="line">	if (i == 1) &#123;</span><br><span class="line">		Handler1.response(request);</span><br><span class="line">	&#125; else if (i == 2) &#123;</span><br><span class="line">		Handler2.response(request);</span><br><span class="line">	&#125; else if (i == 3) &#123;</span><br><span class="line">		Handler3.response(request);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		Handler4.response(request);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">// 模拟判定条件</span><br><span class="line">class Level &#123;</span><br><span class="line">	private int level = 0;</span><br><span class="line"></span><br><span class="line">	public Level(int level) &#123;</span><br><span class="line">		this.level = level;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	public boolean above(Level level) &#123;</span><br><span class="line">		if (this.level &gt;= level.level) &#123;</span><br><span class="line">			return true;</span><br><span class="line">		&#125;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 请求</span><br><span class="line">class Request &#123;</span><br><span class="line">	Level level;</span><br><span class="line"></span><br><span class="line">	public Request(Level level) &#123;</span><br><span class="line">		this.level = level;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Level getLevel() &#123;</span><br><span class="line">		return level;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 响应</span><br><span class="line">class Response &#123;</span><br><span class="line">&#125;</span><br><span class="line">// 抽象处理类</span><br><span class="line">abstract class Handler &#123;</span><br><span class="line">	// 指向下一处理类</span><br><span class="line">	private Handler nextHandler;</span><br><span class="line">	// 处理请求的方法，把判定条件的部分放到处理类中</span><br><span class="line">	public final Response handleRequest(Request request) &#123;</span><br><span class="line">		Response response = null;</span><br><span class="line">		// 如果满足条件，则本处理类处理，否则nextHandler处理</span><br><span class="line">		// 只有处理类的处理等级高于Request的等级才处理，否则交给下一个</span><br><span class="line">		if (this.getHandlerLevel().above(request.getLevel())) &#123;</span><br><span class="line">			response = this.response(request);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			if (this.nextHandler != null) &#123;</span><br><span class="line">				this.nextHandler.handleRequest(request);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				System.out.println(&quot;-----没有合适的处理器-----&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return response;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setNextHandler(Handler handler) &#123;</span><br><span class="line">		this.nextHandler = handler;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected abstract Level getHandlerLevel();</span><br><span class="line"></span><br><span class="line">	public abstract Response response(Request request);</span><br><span class="line">&#125;</span><br><span class="line">// 具体处理类</span><br><span class="line">class ConcreteHandler1 extends Handler &#123;</span><br><span class="line">	protected Level getHandlerLevel() &#123;</span><br><span class="line">		return new Level(1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Response response(Request request) &#123;</span><br><span class="line">		System.out.println(&quot;-----请求由处理器1进行处理-----&quot;);</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteHandler2 extends Handler &#123;</span><br><span class="line">	protected Level getHandlerLevel() &#123;</span><br><span class="line">		return new Level(3);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Response response(Request request) &#123;</span><br><span class="line">		System.out.println(&quot;-----请求由处理器2进行处理-----&quot;);</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteHandler3 extends Handler &#123;</span><br><span class="line">	protected Level getHandlerLevel() &#123;</span><br><span class="line">		return new Level(5);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Response response(Request request) &#123;</span><br><span class="line">		System.out.println(&quot;-----请求由处理器3进行处理-----&quot;);</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Handler handler1 = new ConcreteHandler1();</span><br><span class="line">		Handler handler2 = new ConcreteHandler2();</span><br><span class="line">		Handler handler3 = new ConcreteHandler3();</span><br><span class="line"></span><br><span class="line">		handler1.setNextHandler(handler2);</span><br><span class="line">		handler2.setNextHandler(handler3);</span><br><span class="line">		// 执行时将请求交给第一个处理类</span><br><span class="line">		Response response = handler1.handleRequest(new Request(new Level(4)));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>策略模式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// 抽象策略</span><br><span class="line">interface IStrategy &#123;</span><br><span class="line">	// 重复的逻辑，公共代码</span><br><span class="line">	public void doSomething();</span><br><span class="line">&#125;</span><br><span class="line">// 具体策略</span><br><span class="line">class ConcreteStrategy1 implements IStrategy &#123;</span><br><span class="line">	public void doSomething() &#123;</span><br><span class="line">		System.out.println(&quot;具体策略1&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteStrategy2 implements IStrategy &#123;</span><br><span class="line">	public void doSomething() &#123;</span><br><span class="line">		System.out.println(&quot;具体策略2&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 上下文</span><br><span class="line">class Context &#123;</span><br><span class="line">	private IStrategy strategy;</span><br><span class="line"></span><br><span class="line">	public Context(IStrategy strategy) &#123;</span><br><span class="line">		// 具体策略可以根据需要替换</span><br><span class="line">		this.strategy = strategy;</span><br><span class="line">	&#125;</span><br><span class="line">	// 对策略二次封装，避免高层模块对策略的直接调用</span><br><span class="line">	public void execute() &#123;</span><br><span class="line">		strategy.doSomething();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Context context;</span><br><span class="line"></span><br><span class="line">		// 执行策略1</span><br><span class="line">		context = new Context(new ConcreteStrategy1());</span><br><span class="line">		context.execute();</span><br><span class="line"></span><br><span class="line">		// 执行策略2</span><br><span class="line">		context = new Context(new ConcreteStrategy2());</span><br><span class="line">		context.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>迭代器模式</strong>：使用最多的模式，Java语言已经完整地实现了迭代器模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">// 抽象迭代器</span><br><span class="line">interface Iterator &#123;</span><br><span class="line">	// 定义遍历元素所需要的方法</span><br><span class="line"></span><br><span class="line">	// 取得下一个元素</span><br><span class="line">	public Object next();</span><br><span class="line">	// 判断是否遍历结束</span><br><span class="line">	public boolean hasNext();</span><br><span class="line">&#125;</span><br><span class="line">// 迭代器实现</span><br><span class="line">class ConcreteIterator implements Iterator &#123;</span><br><span class="line">	private List list = new ArrayList();</span><br><span class="line">	private int cursor = 0;</span><br><span class="line"></span><br><span class="line">	public ConcreteIterator(List list) &#123;</span><br><span class="line">		this.list = list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public boolean hasNext() &#123;</span><br><span class="line">		if (cursor == list.size()) &#123;</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Object next() &#123;</span><br><span class="line">		Object obj = null;</span><br><span class="line">		if (this.hasNext()) &#123;</span><br><span class="line">			obj = this.list.get(cursor++);</span><br><span class="line">		&#125;</span><br><span class="line">		return obj;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 抽象容器，如List接口</span><br><span class="line">interface Aggregate &#123;</span><br><span class="line">	public void add(Object obj);</span><br><span class="line"></span><br><span class="line">	public void remove(Object obj);</span><br><span class="line">	// 提供一个iterator()方法</span><br><span class="line">	public Iterator iterator();</span><br><span class="line">&#125;</span><br><span class="line">// 具体容器，如ArrayList</span><br><span class="line">class ConcreteAggregate implements Aggregate &#123;</span><br><span class="line">	private List list = new ArrayList();</span><br><span class="line"></span><br><span class="line">	public void add(Object obj) &#123;</span><br><span class="line">		list.add(obj);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Iterator iterator() &#123;</span><br><span class="line">		return new ConcreteIterator(list);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void remove(Object obj) &#123;</span><br><span class="line">		list.remove(obj);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Aggregate ag = new ConcreteAggregate();</span><br><span class="line"></span><br><span class="line">		ag.add(&quot;小明&quot;);</span><br><span class="line">		ag.add(&quot;小红&quot;);</span><br><span class="line"></span><br><span class="line">		Iterator it = ag.iterator();</span><br><span class="line">		while (it.hasNext()) &#123;</span><br><span class="line">			String str = (String) it.next();</span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>备忘录模式</strong>：回滚，JDBC事务，文本编辑器的Ctrl+Z恢复等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">// 发起人</span><br><span class="line">class Originator &#123;</span><br><span class="line">	// 当前时刻的内部状态，state变量需要备份</span><br><span class="line">	private String state1 = &quot;&quot;;</span><br><span class="line">	private String state2 = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">	// getter setter</span><br><span class="line"></span><br><span class="line">	// 创建备忘录数据</span><br><span class="line">	public Memento createMemento() &#123;</span><br><span class="line">		return new Memento(BeanUtils.backupProp(this));</span><br><span class="line">	&#125;</span><br><span class="line">	// 恢复备忘录数据</span><br><span class="line">	public void restoreMemento(Memento memento) &#123;</span><br><span class="line">		BeanUtils.restoreProp(this, memento.getStateMap());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String toString() &#123;</span><br><span class="line">		return &quot;state1=&quot; + state1 + &quot;state2=&quot; + state2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 备忘录</span><br><span class="line"></span><br><span class="line">class Memento &#123;</span><br><span class="line">	// 存储Originator类中state变量的临时状态</span><br><span class="line">	private Map stateMap;</span><br><span class="line">	// 存储发起人对象的内部状态</span><br><span class="line">	public Memento(Map map) &#123;</span><br><span class="line">		this.stateMap = map;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// getter setter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class BeanUtils &#123;</span><br><span class="line">	public static Map backupProp(Object bean) &#123;</span><br><span class="line">		Map result = new HashMap();</span><br><span class="line">		try &#123;</span><br><span class="line">			BeanInfo beanInfo = Introspector.getBeanInfo(bean.getClass());</span><br><span class="line">			PropertyDescriptor[] descriptors = beanInfo.getPropertyDescriptors();</span><br><span class="line">			for (PropertyDescriptor des : descriptors) &#123;</span><br><span class="line">				String fieldName = des.getName();</span><br><span class="line">				Method getter = des.getReadMethod();</span><br><span class="line">				Object fieldValue = getter.invoke(bean, new Object[] &#123;&#125;);</span><br><span class="line">				if (!fieldName.equalsIgnoreCase(&quot;class&quot;)) &#123;</span><br><span class="line">					result.put(fieldName, fieldValue);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		return result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void restoreProp(Object bean, Map propMap) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			BeanInfo beanInfo = Introspector.getBeanInfo(bean.getClass());</span><br><span class="line">			PropertyDescriptor[] descriptors = beanInfo.getPropertyDescriptors();</span><br><span class="line">			for (PropertyDescriptor des : descriptors) &#123;</span><br><span class="line">				String fieldName = des.getName();</span><br><span class="line">				if (propMap.containsKey(fieldName)) &#123;</span><br><span class="line">					Method setter = des.getWriteMethod();</span><br><span class="line">					setter.invoke(bean, new Object[] &#123; propMap.get(fieldName) &#125;);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 管理角色</span><br><span class="line">class Caretaker &#123;</span><br><span class="line">	private Map memMap = new HashMap();</span><br><span class="line">	// 管理备忘录，向备忘录对象中写入状态或者取回状态</span><br><span class="line">	// getter setter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Client &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Originator ori = new Originator();</span><br><span class="line">		Caretaker caretaker = new Caretaker();</span><br><span class="line"></span><br><span class="line">		// ori初始化状态</span><br><span class="line">		ori.setState1(&quot;中国&quot;);</span><br><span class="line">		ori.setState2(&quot;强盛&quot;);</span><br><span class="line"></span><br><span class="line">		caretaker.setMemento(&quot;001&quot;, ori.createMemento());</span><br><span class="line"></span><br><span class="line">		// ori修改后状态</span><br><span class="line">		ori.setState1(&quot;软件&quot;);</span><br><span class="line">		ori.setState2(&quot;架构&quot;);</span><br><span class="line"></span><br><span class="line">		ori.restoreMemento(caretaker.getMemento(&quot;001&quot;));</span><br><span class="line">		// 恢复后状态</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
