<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>[笔记]-设计模式-Java | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="用手记笔记，用心记笔记，用脑记笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-设计模式-Java"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<script>var timeStart = new Date();</script>
		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		
		
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>首页
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>存档
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-设计模式-Java</h2>
				
				<div>
					<span class="post-time">2017-12-23 8:14</span>
				</div>	
				
				<div class="article-content">
				<p><strong>单例模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 饿汉式单例：在单例类被加载时候，就实例化一个对象交给自己的引用</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">	<span class="comment">// 指向自己实例的私有静态引用</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton = <span class="keyword">new</span> Singleton();</div><div class="line">	<span class="comment">// 私有构造方法</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">	<span class="comment">// 以自己实例为返回值的静态公有方法</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> singleton;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 懒汉式单例：在调用取得实例方法的时候才会实例化对象</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;</div><div class="line">			singleton = <span class="keyword">new</span> Singleton();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> singleton;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Class c = Class.forName(Singleton.class.getName());</div><div class="line">Constructor ct = c.getDeclaredConstructor();</div><div class="line">ct.setAccessible(<span class="keyword">true</span>);</div><div class="line"><span class="comment">// 每次运行都会产生新的单例对象</span></div><div class="line">Singleton singleton = (Singleton)ct.newInstance();</div></pre></td></tr></table></figure>
<ul>
<li><p>只能使用单例类提供的方法得到单例对象，不要使用反射，否则将会实例化一个新对象。</p>
</li>
<li><p>不要做断开单例类对象与类中静态引用的危险操作。</p>
</li>
<li><p>多线程使用单例使用共享资源时，注意线程安全问题。</p>
</li>
</ul>
<p><strong>工厂模式</strong>：简单工厂模式（静态工厂模式）、工厂方法模式、抽象工厂模式。</p>
<p>抽象工厂模式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 产品接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IProduct1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IProduct2</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 产品实现</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product1</span> <span class="keyword">implements</span> <span class="title">IProduct1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product2</span> <span class="keyword">implements</span> <span class="title">IProduct2</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 工厂接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IFactory</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> IProduct1 <span class="title">createProduct1</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> IProduct2 <span class="title">createProduct2</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 工厂实现</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span> <span class="keyword">implements</span> <span class="title">IFactory</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> IProduct1 <span class="title">createProduct1</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Product1();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> IProduct2 <span class="title">createProduct2</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Product2();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		IFactory factory = <span class="keyword">new</span> Factory();</div><div class="line">		factory.createProduct1().show();</div><div class="line">		factory.createProduct2().show();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>工厂方法模式提供的所有产品都是衍生自同一个接口或抽象类，而抽象工厂模式所提供的产品则是衍生自不同的接口或抽象类。</p>
</li>
<li><p>对于抽象工厂模式，当减少一个方法使的提供的产品不再构成产品族之后，它就变成了工厂方法模式。</p>
</li>
<li><p>扩展只需要再增加一个工厂类的实现就可以。</p>
</li>
<li><p>简单工厂只有三个要素，没有工厂接口，并且得到产品的方法一般是静态的。</p>
</li>
<li><p>工厂模式最终目的是解耦。</p>
</li>
</ul>
<p><strong>建造者模式</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 产品类</span></div><div class="line"><span class="keyword">class</span> <span class="title">Product</span> &#123;</div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line">	<span class="keyword">private</span> String type;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showProduct</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"名称："</span> + name);</div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"型号："</span> + type);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// setters</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 抽象建造者</span></div><div class="line"><span class="comment">// 将建造的具体过程交与子类来实现，更容易扩展</span></div><div class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Builder</span> &#123;</div><div class="line">	<span class="comment">// 建造产品</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setPart</span>(<span class="params">String arg1, String arg2</span>)</span>;</div><div class="line">	<span class="comment">// 返回产品</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Product <span class="title">getProduct</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 建造者</span></div><div class="line"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> <span class="title">extends</span> <span class="title">Builder</span> &#123;</div><div class="line">	<span class="keyword">private</span> Product product = <span class="keyword">new</span> Product();</div><div class="line">	<span class="comment">// 实现方法</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Product <span class="title">getProduct</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> product;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPart</span>(<span class="params">String arg1, String arg2</span>) </span>&#123;</div><div class="line">		product.setName(arg1);</div><div class="line">		product.setType(arg2);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 导演类</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Director</span> &#123;</div><div class="line">	<span class="comment">// 导演类一般不与产品类发生依赖关系，与导演类直接交互的是建造者类</span></div><div class="line">	<span class="keyword">private</span> Builder builder = <span class="keyword">new</span> ConcreteBuilder();</div><div class="line">	<span class="comment">// 调用适当的建造者来组建产品</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Product <span class="title">getAProduct</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		builder.setPart(<span class="string">"宝马汽车"</span>, <span class="string">"X7"</span>);</div><div class="line">		<span class="keyword">return</span> builder.getProduct();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Product <span class="title">getBProduct</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		builder.setPart(<span class="string">"奥迪汽车"</span>, <span class="string">"Q5"</span>);</div><div class="line">		<span class="keyword">return</span> builder.getProduct();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Client</span> &#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</div><div class="line">		Director director = <span class="keyword">new</span> Director();</div><div class="line"></div><div class="line">		Product product1 = director.getAProduct();</div><div class="line">		product1.showProduct();</div><div class="line"></div><div class="line">		Product product2 = director.getBProduct();</div><div class="line">		product2.showProduct();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>建造者模式的封装性很好，一般产品类和建造者类比较稳定，主要的业务逻辑封装在导演类，容易扩展，实现一个新的建造者类就可以。</p>
</li>
<li><p>建造者模式只比工厂模式多了一个导演类，一般用来创建复杂对象，将对象的创建过程独立出来组成导演类。</p>
</li>
<li><p>工厂模式是将对象的全部创建过程封装在工厂类中，由工厂类向客户端提供最终的产品；</p>
</li>
<li><p>而建造者模式中，建造者类一般只提供产品类中各个组件的建造，而将具体建造过程交付给导演类。</p>
</li>
</ul>
<p><strong>原型模式</strong>：主要用于对象的复制<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实现Cloneable接口，才可以clone</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prototype</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</div><div class="line">	<span class="comment">// 重写Object类的clone()方法，将protected改为public</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Prototype <span class="title">clone</span><span class="params">()</span> </span>&#123;</div><div class="line">		Prototype prototype = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			prototype = (Prototype) <span class="keyword">super</span>.clone();</div><div class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> prototype;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcretePrototype</span> <span class="keyword">extends</span> <span class="title">Prototype</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"原型模式实现类"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ConcretePrototype cp = <span class="keyword">new</span> ConcretePrototype();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">			ConcretePrototype clonecp = (ConcretePrototype) cp.clone();</div><div class="line">			clonecp.show();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>原型模式创建对象比直接new一个对象性能好，需要重复地创建相似对象时可以考虑使用原型模式，比如需要在一个循环体内创建对象。</p>
</li>
<li><p>使用原型模式复制对象不会调用类的构造方法。</p>
<ul>
<li>单例模式中，将构造方法的访问权限设置为private，但是clone方法无视构造方法，所以，单例模式与原型模式是冲突的。</li>
</ul>
</li>
<li><p>Object类的clone方法只拷贝对象中的基本数据类型，这是浅拷贝。要实现深拷贝，必须将原型模式中的引用对象等另行拷贝：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Prototype</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> ArrayList <span class="keyword">list</span> = <span class="keyword">new</span> ArrayList();</div><div class="line"></div><div class="line">	<span class="keyword">public</span> Prototype <span class="keyword">clone</span>() &#123;</div><div class="line">		Prototype prototype = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			prototype = (Prototype) super.<span class="keyword">clone</span>();</div><div class="line">			<span class="comment">// 大部分的容器类都实现了Cloneable接口</span></div><div class="line">			prototype.<span class="keyword">list</span> = (ArrayList) this.<span class="keyword">list</span>.<span class="keyword">clone</span>();</div><div class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> prototype;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>模版方法模式</strong></p>
<p>购物一般需要三个步骤：登录、挑选商品、付款，对于登录与付款，每个人操作相同，但每个人挑选的商品是不同的。</p>
<p>某类的某个方法的实现，需要几个固定步骤，对于该类的不同对象，有些步骤是固定的，有些步骤是不同的，有些步骤是可变可不变的。</p>
<p>这种情况适合模板方法：定义一个操作中某种算法的框架，而将一些步骤延迟到子类中。</p>
<p>模板方法中：由一个抽象类和一个（或一组）实现类通过继承结构组成：</p>
<ul>
<li>模板方法：实现某种算法的方法步骤。</li>
<li>步骤方法：完成模板方法的每个阶段性方法：<ul>
<li>抽象方法：子类必须实现。</li>
<li>最终方法：子类不能重写的方法，所有子类执行都一样的步骤。</li>
<li>钩子方法：父类给出了默认实现，但子类也可以重写。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ShoppingService</span> </span>&#123;</div><div class="line">	<span class="comment">// 模版方法：抽象类声明并实现，大多会定义为final</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shopping</span><span class="params">()</span> </span>&#123;</div><div class="line">		login();</div><div class="line">		choose();</div><div class="line">		pay();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 子类不能重写</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 子类必须实现</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="comment">// 钩子方法：子类可以重写</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShoseShoppingService</span> <span class="keyword">extends</span> <span class="title">ShoppingService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DressShoppingService</span> <span class="keyword">extends</span> <span class="title">ShoppingService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">choose</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>中介者模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractColleague</span> </span>&#123;</div><div class="line">	<span class="keyword">protected</span> <span class="keyword">int</span> number;</div><div class="line"></div><div class="line">	<span class="comment">// getter setter</span></div><div class="line"></div><div class="line">	<span class="comment">// 中介者</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(<span class="keyword">int</span> number, AbstractMediator am)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 同事类之间相互影响，相互依赖</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColleagueA</span> <span class="keyword">extends</span> <span class="title">AbstractColleague</span> </span>&#123;</div><div class="line">	<span class="comment">// 通过中介者消息传递</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(<span class="keyword">int</span> number, AbstractMediator am)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.number = number;</div><div class="line">		am.AaffectB();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColleagueB</span> <span class="keyword">extends</span> <span class="title">AbstractColleague</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(<span class="keyword">int</span> number, AbstractMediator am)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.number = number;</div><div class="line">		am.BaffectA();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 抽象中介者</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractMediator</span> </span>&#123;</div><div class="line">	<span class="keyword">protected</span> AbstractColleague A;</div><div class="line">	<span class="keyword">protected</span> AbstractColleague B;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AbstractMediator</span><span class="params">(AbstractColleague a, AbstractColleague b)</span> </span>&#123;</div><div class="line">		A = a;</div><div class="line">		B = b;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 各个同事类之间的通信</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">AaffectB</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">BaffectA</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 中介者实现类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mediator</span> <span class="keyword">extends</span> <span class="title">AbstractMediator</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Mediator</span><span class="params">(AbstractColleague a, AbstractColleague b)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(a, b);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 处理A对B的影响</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AaffectB</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> number = A.getNumber();</div><div class="line">		B.setNumber(number * <span class="number">100</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 处理B对A的影响</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BaffectA</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> number = B.getNumber();</div><div class="line">		A.setNumber(number / <span class="number">100</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		AbstractColleague collA = <span class="keyword">new</span> ColleagueA();</div><div class="line">		AbstractColleague collB = <span class="keyword">new</span> ColleagueB();</div><div class="line">		AbstractMediator am = <span class="keyword">new</span> Mediator(collA, collB);</div><div class="line"></div><div class="line">		<span class="comment">// 通过设置A影响B</span></div><div class="line">		collA.setNumber(<span class="number">1000</span>, am);</div><div class="line"></div><div class="line">		<span class="comment">// 通过设置B影响A</span></div><div class="line">		collB.setNumber(<span class="number">1000</span>, am);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实就是把处理对象关系的代码封装到中介类中，通过这个中介类来处理对象间的关系。<br>同事类之间的关系将变为星型结构，类的变动，只会影响类本身，以及中介者，减小了耦合。</p>
<p><strong>观察者模式</strong>：如果一个对象的状态发生改变，与它相关的对象也要随之做出相应的变化。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 被观察者：接口或抽象类</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</div><div class="line">	<span class="comment">// 存放观察者对象，Vector线程安全，List不安全</span></div><div class="line">	<span class="keyword">private</span> Vector obs = <span class="keyword">new</span> Vector();</div><div class="line">	<span class="comment">// 添加观察者对象</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer obs)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.obs.add(obs);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 移除观察者对象</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delObserver</span><span class="params">(Observer obs)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.obs.remove(obs);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 依次调用观察者对象的对应方法</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">for</span> (Observer o : obs) &#123;</div><div class="line">			o.update();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 具体的观察者：定义被观察者对象状态发生变化时要处理的逻辑</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="keyword">extends</span> <span class="title">Subject</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"被观察者事件反生"</span>);</div><div class="line">		<span class="keyword">this</span>.notifyObserver();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 观察者</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</div><div class="line">	<span class="comment">// update()：被观察者状态发生变化时，被触发</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 具体的被观察者：便于扩展，定义具体的业务逻辑</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver1</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"观察者1收到信息，并进行处理。"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver2</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"观察者2收到信息，并进行处理。"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Subject sub = <span class="keyword">new</span> ConcreteSubject();</div><div class="line"></div><div class="line">		sub.addObserver(<span class="keyword">new</span> ConcreteObserver1()); <span class="comment">// 添加观察者1</span></div><div class="line">		sub.addObserver(<span class="keyword">new</span> ConcreteObserver2()); <span class="comment">// 添加观察者2</span></div><div class="line">		sub.doSomething();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>就是在Subject类中关联一下Observer类，并且在doSomething方法中遍历一下Observer的update方法就行了。</p>
<p>Java有Observer接口，以及实现类Observable，对观察者角色常进行了实现。</p>
<p><strong>访问者模式</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 抽象元素类</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Element</span> </span>&#123;</div><div class="line">	<span class="comment">// 声明接受哪一类访问者访问</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(IVisitor visitor)</span></span>;</div><div class="line">	<span class="comment">// 本身的业务逻辑</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 抽象访问者</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IVisitor</span> </span>&#123;</div><div class="line">	<span class="comment">// 定义哪些对象是可以被访问的</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElement1 el1)</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElement2 el2)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 元素类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteElement1</span> <span class="keyword">extends</span> <span class="title">Element</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"这是元素1"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 实现抽象元素类所声明的accept方法</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(IVisitor visitor)</span> </span>&#123;</div><div class="line">		visitor.visit(<span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteElement2</span> <span class="keyword">extends</span> <span class="title">Element</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"这是元素2"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(IVisitor visitor)</span> </span>&#123;</div><div class="line">		visitor.visit(<span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 访问者</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span> <span class="keyword">implements</span> <span class="title">IVisitor</span> </span>&#123;</div><div class="line">	<span class="comment">// 实现抽象访问者所声明的方法，访问者访问到一个类后干什么</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElement1 el1)</span> </span>&#123;</div><div class="line">		el1.doSomething();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ConcreteElement2 el2)</span> </span>&#123;</div><div class="line">		el2.doSomething();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结构对象</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectStruture</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List <span class="title">getList</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// 元素的容器</span></div><div class="line">		List list = <span class="keyword">new</span> ArrayList();</div><div class="line">		Random ran = <span class="keyword">new</span> Random();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">			<span class="keyword">int</span> a = ran.nextInt(<span class="number">100</span>);</div><div class="line">			<span class="keyword">if</span> (a &gt; <span class="number">50</span>) &#123;</div><div class="line">				list.add(<span class="keyword">new</span> ConcreteElement1());</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				list.add(<span class="keyword">new</span> ConcreteElement2());</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> list;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		List list = ObjectStruture.getList();</div><div class="line">		<span class="keyword">for</span> (Element e : list) &#123;</div><div class="line">			e.accept(<span class="keyword">new</span> Visitor());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>命令模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 调用者</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Invoker</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Command command;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommand</span><span class="params">(Command command)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.command = command;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 调用命令</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.command.execute();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Command</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Command</span> </span>&#123;</div><div class="line">	<span class="comment">// 执行命令</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// Command类实现类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteCommand</span> <span class="keyword">extends</span> <span class="title">Command</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Receiver receiver;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConcreteCommand</span><span class="params">(Receiver receiver)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.receiver = receiver;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 命令封装</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.receiver.doSomething();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 接收者</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Receiver</span> </span>&#123;</div><div class="line">	<span class="comment">// 接收并执行命令</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// 封装操作</span></div><div class="line">		System.out.println(<span class="string">"接受者-业务逻辑处理"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Receiver receiver = <span class="keyword">new</span> Receiver();</div><div class="line">		Command command = <span class="keyword">new</span> ConcreteCommand(receiver);</div><div class="line">		<span class="comment">// 客户端直接执行具体命令方式</span></div><div class="line">		command.execute();</div><div class="line">		<span class="comment">// 客户端通过调用者来执行命令</span></div><div class="line">		Invoker invoker = <span class="keyword">new</span> Invoker();</div><div class="line">		invoker.setCommand(command);</div><div class="line">		<span class="comment">// 调用者类==&gt;命令类==&gt;接收者类</span></div><div class="line">		<span class="comment">// 一条命令被分成了三步，命令的调用者与执行者分开</span></div><div class="line">		invoker.action();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>责任链模式</strong></p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> void test(<span class="built_in">int</span> i, <span class="built_in">Request</span> <span class="built_in">request</span>) &#123;</div><div class="line">	<span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</div><div class="line">		Handler1.<span class="built_in">response</span>(<span class="built_in">request</span>);</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">2</span>) &#123;</div><div class="line">		Handler2.<span class="built_in">response</span>(<span class="built_in">request</span>);</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">3</span>) &#123;</div><div class="line">		Handler3.<span class="built_in">response</span>(<span class="built_in">request</span>);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		Handler4.<span class="built_in">response</span>(<span class="built_in">request</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 模拟判定条件</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Level</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> level = <span class="number">0</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Level</span><span class="params">(<span class="keyword">int</span> level)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.level = level;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">above</span><span class="params">(Level level)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.level &gt;= level.level) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 请求</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</div><div class="line">	Level level;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">(Level level)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.level = level;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Level <span class="title">getLevel</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> level;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 响应</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 抽象处理类</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">	<span class="comment">// 指向下一处理类</span></div><div class="line">	<span class="keyword">private</span> Handler nextHandler;</div><div class="line">	<span class="comment">// 处理请求的方法，把判定条件的部分放到处理类中</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Response <span class="title">handleRequest</span><span class="params">(Request request)</span> </span>&#123;</div><div class="line">		Response response = <span class="keyword">null</span>;</div><div class="line">		<span class="comment">// 如果满足条件，则本处理类处理，否则nextHandler处理</span></div><div class="line">		<span class="comment">// 只有处理类的处理等级高于Request的等级才处理，否则交给下一个</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.getHandlerLevel().above(request.getLevel())) &#123;</div><div class="line">			response = <span class="keyword">this</span>.response(request);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.nextHandler != <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="keyword">this</span>.nextHandler.handleRequest(request);</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				System.out.println(<span class="string">"-----没有合适的处理器-----"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> response;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNextHandler</span><span class="params">(Handler handler)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.nextHandler = handler;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Level <span class="title">getHandlerLevel</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Response <span class="title">response</span><span class="params">(Request request)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 具体处理类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler1</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">protected</span> Level <span class="title">getHandlerLevel</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Level(<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Response <span class="title">response</span><span class="params">(Request request)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"-----请求由处理器1进行处理-----"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler2</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">protected</span> Level <span class="title">getHandlerLevel</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Level(<span class="number">3</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Response <span class="title">response</span><span class="params">(Request request)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"-----请求由处理器2进行处理-----"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler3</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">protected</span> Level <span class="title">getHandlerLevel</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Level(<span class="number">5</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Response <span class="title">response</span><span class="params">(Request request)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"-----请求由处理器3进行处理-----"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Handler handler1 = <span class="keyword">new</span> ConcreteHandler1();</div><div class="line">		Handler handler2 = <span class="keyword">new</span> ConcreteHandler2();</div><div class="line">		Handler handler3 = <span class="keyword">new</span> ConcreteHandler3();</div><div class="line"></div><div class="line">		handler1.setNextHandler(handler2);</div><div class="line">		handler2.setNextHandler(handler3);</div><div class="line">		<span class="comment">// 执行时将请求交给第一个处理类</span></div><div class="line">		Response response = handler1.handleRequest(<span class="keyword">new</span> Request(<span class="keyword">new</span> Level(<span class="number">4</span>)));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>策略模式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 抽象策略</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IStrategy</span> </span>&#123;</div><div class="line">	<span class="comment">// 重复的逻辑，公共代码</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 具体策略</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategy1</span> <span class="keyword">implements</span> <span class="title">IStrategy</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"具体策略1"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteStrategy2</span> <span class="keyword">implements</span> <span class="title">IStrategy</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"具体策略2"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 上下文</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> IStrategy strategy;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(IStrategy strategy)</span> </span>&#123;</div><div class="line">		<span class="comment">// 具体策略可以根据需要替换</span></div><div class="line">		<span class="keyword">this</span>.strategy = strategy;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 对策略二次封装，避免高层模块对策略的直接调用</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</div><div class="line">		strategy.doSomething();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Context context;</div><div class="line"></div><div class="line">		<span class="comment">// 执行策略1</span></div><div class="line">		context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStrategy1());</div><div class="line">		context.execute();</div><div class="line"></div><div class="line">		<span class="comment">// 执行策略2</span></div><div class="line">		context = <span class="keyword">new</span> Context(<span class="keyword">new</span> ConcreteStrategy2());</div><div class="line">		context.execute();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>迭代器模式</strong>：使用最多的模式，Java语言已经完整地实现了迭代器模式</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 抽象迭代器</span></div><div class="line"><span class="keyword">interface</span> <span class="title">Iterator</span> &#123;</div><div class="line">	<span class="comment">// 定义遍历元素所需要的方法</span></div><div class="line"></div><div class="line">	<span class="comment">// 取得下一个元素</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">next</span>(<span class="params"></span>)</span>;</div><div class="line">	<span class="comment">// 判断是否遍历结束</span></div><div class="line">	<span class="function"><span class="keyword">public</span> boolean <span class="title">hasNext</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 迭代器实现</span></div><div class="line"><span class="keyword">class</span> <span class="title">ConcreteIterator</span> <span class="title">implements</span> <span class="title">Iterator</span> &#123;</div><div class="line">	<span class="keyword">private</span> List list = <span class="keyword">new</span> ArrayList();</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> cursor = <span class="number">0</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConcreteIterator</span>(<span class="params">List list</span>) </span>&#123;</div><div class="line">		<span class="keyword">this</span>.list = list;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> boolean <span class="title">hasNext</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (cursor == list.size()) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">next</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		Object obj = <span class="literal">null</span>;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.hasNext()) &#123;</div><div class="line">			obj = <span class="keyword">this</span>.list.<span class="keyword">get</span>(cursor++);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 抽象容器，如List接口</span></div><div class="line"><span class="keyword">interface</span> <span class="title">Aggregate</span> &#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span>(<span class="params">Object obj</span>)</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span>(<span class="params">Object obj</span>)</span>;</div><div class="line">	<span class="comment">// 提供一个iterator()方法</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">iterator</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 具体容器，如ArrayList</span></div><div class="line"><span class="keyword">class</span> <span class="title">ConcreteAggregate</span> <span class="title">implements</span> <span class="title">Aggregate</span> &#123;</div><div class="line">	<span class="keyword">private</span> List list = <span class="keyword">new</span> ArrayList();</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span>(<span class="params">Object obj</span>) </span>&#123;</div><div class="line">		list.<span class="keyword">add</span>(obj);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">iterator</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ConcreteIterator(list);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span>(<span class="params">Object obj</span>) </span>&#123;</div><div class="line">		list.<span class="keyword">remove</span>(obj);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Client</span> &#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</div><div class="line">		Aggregate ag = <span class="keyword">new</span> ConcreteAggregate();</div><div class="line"></div><div class="line">		ag.<span class="keyword">add</span>(<span class="string">"小明"</span>);</div><div class="line">		ag.<span class="keyword">add</span>(<span class="string">"小红"</span>);</div><div class="line"></div><div class="line">		Iterator it = ag.iterator();</div><div class="line">		<span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">			String str = (String) it.next();</div><div class="line">			System.<span class="keyword">out</span>.println(str);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>备忘录模式</strong>：回滚，JDBC事务，文本编辑器的Ctrl+Z恢复等。</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 发起人</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Originator</span> </span>&#123;</div><div class="line">	<span class="comment">// 当前时刻的内部状态，state变量需要备份</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> state1 = <span class="string">""</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> state2 = <span class="string">""</span>;</div><div class="line"></div><div class="line">	<span class="comment">// getter setter</span></div><div class="line"></div><div class="line">	<span class="comment">// 创建备忘录数据</span></div><div class="line">	<span class="keyword">public</span> Memento createMemento() &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="type">Memento</span>(BeanUtils.backupProp(<span class="built_in">this</span>));</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 恢复备忘录数据</span></div><div class="line">	<span class="keyword">public</span> void restoreMemento(Memento memento) &#123;</div><div class="line">		BeanUtils.restoreProp(<span class="built_in">this</span>, memento.getStateMap());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">String</span> toString() &#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"state1="</span> + state1 + <span class="string">"state2="</span> + state2;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 备忘录</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memento</span> </span>&#123;</div><div class="line">	<span class="comment">// 存储Originator类中state变量的临时状态</span></div><div class="line">	<span class="keyword">private</span> Map stateMap;</div><div class="line">	<span class="comment">// 存储发起人对象的内部状态</span></div><div class="line">	<span class="keyword">public</span> Memento(Map map) &#123;</div><div class="line">		<span class="built_in">this</span>.stateMap = map;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// getter setter</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeanUtils</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Map backupProp(Object bean) &#123;</div><div class="line">		Map result = <span class="keyword">new</span> <span class="type">HashMap</span>();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			BeanInfo beanInfo = Introspector.getBeanInfo(bean.getClass());</div><div class="line">			PropertyDescriptor[] descriptors = beanInfo.getPropertyDescriptors();</div><div class="line">			<span class="keyword">for</span> (PropertyDescriptor des : <span class="type">descriptors</span>) &#123;</div><div class="line">				<span class="keyword">String</span> fieldName = des.getName();</div><div class="line">				Method getter = des.getReadMethod();</div><div class="line">				Object fieldValue = getter.invoke(bean, <span class="keyword">new</span> <span class="type">Object</span>[] &#123;&#125;);</div><div class="line">				<span class="keyword">if</span> (!fieldName.equalsIgnoreCase(<span class="string">"class"</span>)) &#123;</div><div class="line">					result.put(fieldName, fieldValue);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> void restoreProp(Object bean, Map propMap) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			BeanInfo beanInfo = Introspector.getBeanInfo(bean.getClass());</div><div class="line">			PropertyDescriptor[] descriptors = beanInfo.getPropertyDescriptors();</div><div class="line">			<span class="keyword">for</span> (PropertyDescriptor des : <span class="type">descriptors</span>) &#123;</div><div class="line">				<span class="keyword">String</span> fieldName = des.getName();</div><div class="line">				<span class="keyword">if</span> (propMap.containsKey(fieldName)) &#123;</div><div class="line">					Method setter = des.getWriteMethod();</div><div class="line">					setter.invoke(bean, <span class="keyword">new</span> <span class="type">Object</span>[] &#123; propMap.<span class="keyword">get</span>(fieldName) &#125;);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 管理角色</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Caretaker</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Map memMap = <span class="keyword">new</span> <span class="type">HashMap</span>();</div><div class="line">	<span class="comment">// 管理备忘录，向备忘录对象中写入状态或者取回状态</span></div><div class="line">	<span class="comment">// getter setter</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>[] args) &#123;</div><div class="line">		Originator ori = <span class="keyword">new</span> <span class="type">Originator</span>();</div><div class="line">		Caretaker caretaker = <span class="keyword">new</span> <span class="type">Caretaker</span>();</div><div class="line"></div><div class="line">		<span class="comment">// ori初始化状态</span></div><div class="line">		ori.setState1(<span class="string">"中国"</span>);</div><div class="line">		ori.setState2(<span class="string">"强盛"</span>);</div><div class="line"></div><div class="line">		caretaker.setMemento(<span class="string">"001"</span>, ori.createMemento());</div><div class="line"></div><div class="line">		<span class="comment">// ori修改后状态</span></div><div class="line">		ori.setState1(<span class="string">"软件"</span>);</div><div class="line">		ori.setState2(<span class="string">"架构"</span>);</div><div class="line"></div><div class="line">		ori.restoreMemento(caretaker.getMemento(<span class="string">"001"</span>));</div><div class="line">		<span class="comment">// 恢复后状态</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			
<p>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme modified by <b> Huangzhike </b></p>
<p>&copy; 2017 <a href="https://huangzhike.github.io"><b> Huangzhike </b></a></p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
