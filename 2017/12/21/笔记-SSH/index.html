<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-SSH | 学而时习之</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-SSH">
		
		<meta property="og:site_name" content="学而时习之">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">学而时习之</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-SSH</h2>
				
				<div>
					<div class="post-time">2017-12-21</div>
				</div>
				
				<div class="article-content">
				<p><strong>12-28重新整理更新笔记</strong></p>
<p>web.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app&gt;</span><br><span class="line">	&lt;display-name&gt;SSH&lt;/display-name&gt;</span><br><span class="line">	&lt;welcome-file-list&gt;</span><br><span class="line">		&lt;welcome-file&gt;xxx.jsp&lt;/welcome-file&gt;</span><br><span class="line">	&lt;/welcome-file-list&gt;</span><br><span class="line">	&lt;!-- Spring监听器，初始化ApplicationContext对象，提供实例 --&gt;</span><br><span class="line">	&lt;!-- web.xml中监听器的启动优先级高于过滤器，配在哪无所谓 --&gt;</span><br><span class="line">	&lt;listener&gt;</span><br><span class="line">		&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</span><br><span class="line">	&lt;/listener&gt;</span><br><span class="line">	&lt;context-param&gt;</span><br><span class="line">		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">		&lt;!-- /WEB-INF/classes/applicationContext.xml --&gt;</span><br><span class="line">		&lt;param-value&gt;classpath:applicationContext*.xml&lt;/param-value&gt;</span><br><span class="line">	&lt;/context-param&gt;</span><br><span class="line">	&lt;!-- Struts过滤器 --&gt;</span><br><span class="line">	&lt;filter&gt;</span><br><span class="line">		&lt;filter-name&gt;struts2&lt;/filter-name&gt;</span><br><span class="line">		&lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter&lt;/filter-class&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">			&lt;init-param&gt;</span><br><span class="line">				&lt;param-name&gt;filterConfig&lt;/param-name&gt;</span><br><span class="line">				&lt;param-value&gt;classpath:struts.xml&lt;/param-value&gt;</span><br><span class="line">			&lt;/init-param&gt;</span><br><span class="line">		 --&gt;</span><br><span class="line">		&lt;!-- 自动扫描action，如果用注解配置Struts --&gt;</span><br><span class="line">		&lt;!-- 据说某些版本会忽略此配置，只扫描指定的文件夹命名：struts, struts2, action 或 actions --&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">			&lt;init-param&gt;</span><br><span class="line">				&lt;param-name&gt;actionPackages&lt;/param-name&gt;</span><br><span class="line">				&lt;param-value&gt;mmp.action&lt;/param-value&gt;</span><br><span class="line">			&lt;/init-param&gt;</span><br><span class="line">		 --&gt;</span><br><span class="line">	&lt;/filter&gt;</span><br><span class="line">	&lt;filter-mapping&gt;</span><br><span class="line">		&lt;filter-name&gt;struts2&lt;/filter-name&gt;</span><br><span class="line">		&lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;</span><br><span class="line">		&lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;</span><br><span class="line">		&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">	&lt;/filter-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure></p>
<p>Spring：所有的Bean均由Spring容器统一管理。</p>
<p>WEB-INF/applicationContext.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">	xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">	xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:jee=&quot;http://www.springframework.org/schema/jee&quot;</span><br><span class="line">	xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;</span><br><span class="line">		http://www.springframework.org/schema/aop </span><br><span class="line">		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd</span><br><span class="line">		http://www.springframework.org/schema/beans</span><br><span class="line">		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd</span><br><span class="line">		http://www.springframework.org/schema/context</span><br><span class="line">		http://www.springframework.org/schema/context/spring-context-4.2.xsd</span><br><span class="line">		http://www.springframework.org/schema/jee </span><br><span class="line">		http://www.springframework.org/schema/jee/spring-jee-4.2.xsd</span><br><span class="line">		http://www.springframework.org/schema/tx </span><br><span class="line">		http://www.springframework.org/schema/tx/spring-tx-4.2.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 也可以分成几个文件import，或者在web.xml直接导入 --&gt;</span><br><span class="line">	&lt;!-- &lt;import resource=&quot;config/spring/HibernateSessionFactory.xml&quot;/&gt; --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 注解配置 --&gt;</span><br><span class="line">	&lt;context:annotation-config/&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 自动扫描与装配bean（注解方式） --&gt;</span><br><span class="line">	&lt;context:component-scan base-package=&quot;mmp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Spring和Hibernate整合 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Spring支持两种方式 --&gt;</span><br><span class="line">	&lt;!-- 第一种方式：property-placeholder，仅在xml中使用，在beans.xml中获取properties文件中的对应的value --&gt;</span><br><span class="line">	&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 与下面配置等价 --&gt;</span><br><span class="line">	&lt;!-- </span><br><span class="line">		&lt;bean class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;</span><br><span class="line">			&lt;property name=&quot;locations&quot;&gt;</span><br><span class="line">				&lt;array&gt;</span><br><span class="line">					&lt;value&gt;classpath:xxx.properties&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;classpath:xxx.properties&lt;/value&gt;</span><br><span class="line">				&lt;/array&gt;</span><br><span class="line">			&lt;/property&gt;</span><br><span class="line">		&lt;/bean&gt;</span><br><span class="line">	 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 第二种方式是使用注解方式注入，主要用在Java代码中使用注解注入properties文件中相应的value值 --&gt;</span><br><span class="line">	&lt;!-- </span><br><span class="line">		&lt;bean id=&quot;prop&quot; class=&quot;org.springframework.beans.factory.config.PropertiesFactoryBean&quot;&gt;</span><br><span class="line">			&lt;property name=&quot;locations&quot;&gt;</span><br><span class="line">				&lt;array&gt;</span><br><span class="line">					&lt;value&gt;classpath:xxx.properties&lt;/value&gt;</span><br><span class="line">					&lt;value&gt;classpath:xxx.properties&lt;/value&gt;</span><br><span class="line">				&lt;/array&gt;</span><br><span class="line">			&lt;/property&gt;</span><br><span class="line">		&lt;/bean&gt;</span><br><span class="line">	 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- </span><br><span class="line">		&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</span><br><span class="line">			&lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driverClassName&#125;&quot;/&gt;</span><br><span class="line">			&lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;</span><br><span class="line">			&lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;</span><br><span class="line">			&lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;</span><br><span class="line">		&lt;/bean&gt;</span><br><span class="line">	 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 配置c3p0数据库连接池 --&gt;</span><br><span class="line">	&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">		&lt;!-- 数据连接信息，属性名和上面不一样 --&gt;</span><br><span class="line">		&lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;</span><br><span class="line">		&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://127.0.0.1:3307/mmp&quot;/&gt;</span><br><span class="line">		&lt;property name=&quot;user&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">		&lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;</span><br><span class="line">		&lt;!-- 初始化时获取三个连接，在minPoolSize与maxPoolSize之间，默认值: 3 --&gt;</span><br><span class="line">		&lt;property name=&quot;initialPoolSize&quot; value=&quot;3&quot;/&gt;</span><br><span class="line">		&lt;!-- 连接池中保留的最小连接数，默认值：3 --&gt;</span><br><span class="line">		&lt;property name=&quot;minPoolSize&quot; value=&quot;3&quot;/&gt;</span><br><span class="line">		&lt;!-- 连接池中保留的最大连接数，默认值：15 --&gt;</span><br><span class="line">		&lt;property name=&quot;maxPoolSize&quot; value=&quot;5&quot;/&gt;</span><br><span class="line">		&lt;!-- 当连接池中的连接数耗尽的时候，c3p0一次同时获取的连接数，默认值：3 --&gt;</span><br><span class="line">		&lt;property name=&quot;acquireIncrement&quot; value=&quot;3&quot;/&gt;</span><br><span class="line">		&lt;!-- 数据源内加载的PreparedStatements数量，如果maxStatements与maxStatementsPerConnection均为0，缓存被关闭，默认值：0 --&gt;</span><br><span class="line">		&lt;property name=&quot;maxStatements&quot; value=&quot;8&quot;/&gt;</span><br><span class="line">		&lt;!--maxStatementsPerConnection定义了连接池内单个连接所拥有的最大缓存statements数，默认值：0 --&gt;</span><br><span class="line">		&lt;property name=&quot;maxStatementsPerConnection&quot; value=&quot;5&quot;/&gt;</span><br><span class="line">		&lt;!--最大空闲时间,1800秒内未使用则连接被丢弃，若为0则永不丢弃，默认值：0 --&gt;</span><br><span class="line">		&lt;property name=&quot;maxIdleTime&quot; value=&quot;1800&quot;/&gt;</span><br><span class="line">		&lt;!--从数据库获取新连接失败后重复尝试的次数，默认值：30 --&gt; </span><br><span class="line">		&lt;property name=&quot;acquireRetryAttempts&quot; value=&quot;30&quot;/&gt;</span><br><span class="line">		&lt;!--每隔60秒发一次心跳信号到数据库，以保持连接的活性 --&gt;</span><br><span class="line">		&lt;property name=&quot;idleConnectionTestPeriod&quot; value=&quot;60&quot;/&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 使用注释，用AnnotationSessionFactoryBean 代替 LocalSessionFactoryBean --&gt;</span><br><span class="line">	&lt;!-- &lt;bean id=&quot;sessionFactory&quot; class=&quot;org.springframework.orm.hibernate4.annotation.AnnotationSessionFactoryBean&quot;&gt; --&gt;</span><br><span class="line">	&lt;!-- 并注明注解模型类在&apos;annotatedClasses&apos;属性，而不是&apos;mappingResources&apos;属性 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 配置 SessionFactory 的 Bean，将 SessionFactory 交由 Spring 来管理，替换掉 hibernate.cfg.xml --&gt;</span><br><span class="line">	&lt;bean id=&quot;sessionFactory&quot; class=&quot;org.springframework.orm.hibernate4.LocalSessionFactoryBean&quot;&gt;</span><br><span class="line">		&lt;!-- 指定hibernate配置文件的位置，没有就注释掉 --&gt;</span><br><span class="line">		&lt;property name=&quot;configLocation&quot; value=&quot;classpath:hibernate.cfg.xml&quot;/&gt;</span><br><span class="line">		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">		&lt;!-- 映射文件的注册，使用注释可以删去，用packagesToScan代替 --&gt;</span><br><span class="line">		&lt;property name=&quot;mappingResources&quot;&gt;</span><br><span class="line">			&lt;list&gt;</span><br><span class="line">				&lt;value&gt;mmp/model/Product.hbm.xml&lt;/value&gt;</span><br><span class="line">			&lt;/list&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">		&lt;!--自动扫描实体(如果使用Hibernate注解) --&gt;</span><br><span class="line">		&lt;!-- &lt;property name=&quot;packagesToScan&quot; value=&quot;mmp.model.*&quot;/&gt; --&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">			&lt;property name=&quot;packagesToScan&quot;&gt;</span><br><span class="line">				&lt;list&gt;</span><br><span class="line">					&lt;value&gt;mmp.model.*&lt;/value&gt;</span><br><span class="line">				&lt;/list&gt;</span><br><span class="line">			&lt;/property&gt;</span><br><span class="line">		 --&gt;</span><br><span class="line">		&lt;property name=&quot;hibernateProperties&quot;&gt;</span><br><span class="line">			&lt;props&gt;</span><br><span class="line">				&lt;!--配置Hibernate的方言--&gt;</span><br><span class="line">				&lt;prop key=&quot;hibernate.dialect&quot;&gt;org.hibernate.dialect.MySQLDialect&lt;/prop&gt;</span><br><span class="line">				&lt;prop key=&quot;hibernate.hbm2ddl.auto&quot;&gt;update&lt;/prop&gt;</span><br><span class="line">				&lt;!--格式化输出sql语句--&gt;</span><br><span class="line">				&lt;prop key=&quot;hibernate.show_sql&quot;&gt;true&lt;/prop&gt;</span><br><span class="line">				&lt;prop key=&quot;hibernate.format_sql&quot;&gt;true&lt;/prop&gt;</span><br><span class="line">				&lt;prop key=&quot;hibernate.use_sql_comments&quot;&gt;false&lt;/prop&gt;</span><br><span class="line">				&lt;!-- 指定当前 Session 所执行的上下文环境，不是 thread 而是 SpringSessionContext，表示 Session 交由 Spring 容器来管理 --&gt;</span><br><span class="line">				&lt;prop key=&quot;hibernate.current_session_context_class&quot;&gt;org.springframework.orm.hibernate4.SpringSessionContext&lt;/prop&gt;</span><br><span class="line">			&lt;/props&gt;</span><br><span class="line">			&lt;!-- 有时候hbm2ddl.auto会失效，不能够自动生成表结构，加上下面 --&gt;</span><br><span class="line">			&lt;property name=&quot;schemaUpdate&quot; value=&quot;ture&quot;/&gt;</span><br><span class="line">		&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- sessionFactory取代HibernateTemplate，HibernateTemplate是Spring的，sessionFactory是Hibernate的 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Hibernate 的 Session 要求在事务环境下，必须配置事务管理器 --&gt;</span><br><span class="line">	&lt;!-- 如果使用 Jdbc 的事务管理器，需要注入数据源 dataSource --&gt;</span><br><span class="line">	&lt;!-- 而使用 Hibernate 的事务管理器，则需要注入 sessionFactory --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 配置事务管理器，管理sessionFactory，这样所有session将会有声明式事务管理 --&gt;</span><br><span class="line">	&lt;bean id=&quot;txManager&quot; class=&quot;org.springframework.orm.hibernate4.HibernateTransactionManager&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot;/&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 第一种配置事务的方式，采用注解的方式 --&gt;</span><br><span class="line">	&lt;!-- 如果用注解实现事务管理，添加下面一句，扫描注解，并去掉&lt;tx:advice&gt;和&lt;aop:config&gt; 配置 --&gt;</span><br><span class="line">	&lt;!-- &lt;tx:annotation-driven transaction-manager=&quot;txManager&quot;/&gt; --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 第二种配置事务的方式，使用tx标签 --&gt;</span><br><span class="line">	&lt;!-- 事务通知 --&gt;</span><br><span class="line">	&lt;tx:advice id=&quot;advice&quot; transaction-manager=&quot;txManager&quot;&gt;</span><br><span class="line">		&lt;tx:attributes&gt;</span><br><span class="line">			&lt;!-- save*等等，表示对于这些开头的方法，进行事务管理 --&gt;</span><br><span class="line">			&lt;!-- REQUIRED：支持当前事务，如果当前没有事务，就新建一个事务 --&gt;</span><br><span class="line">			&lt;!-- 事务传播 --&gt;</span><br><span class="line">			&lt;tx:method name=&quot;save*&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;Exception&quot;/&gt;</span><br><span class="line">			&lt;tx:method name=&quot;*&quot; propagation=&quot;SUPPORTS&quot; rollback-for=&quot;Exception&quot;/&gt;</span><br><span class="line">		&lt;/tx:attributes&gt;</span><br><span class="line">	&lt;/tx:advice&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- AspectJ AOP --&gt;</span><br><span class="line">	&lt;aop:config&gt;</span><br><span class="line">		&lt;!-- 配置哪些包的类要切入事务 --&gt;</span><br><span class="line">		&lt;aop:pointcut id=&quot;pointcut&quot; expression=&quot;execution(* mmp.service.impl.*.*(..))&quot;/&gt;</span><br><span class="line">		&lt;!-- 第一个*代表返回值，第二个*代表子包，第三个个*代表方法名，“（..）”代表方法参数 --&gt;</span><br><span class="line">		&lt;aop:advisor advice-ref=&quot;advice&quot; pointcut-ref=&quot;pointcut&quot;/&gt;</span><br><span class="line">		&lt;!-- aop:pointcut要写在aop:advisor上面，否则会报错？ --&gt;</span><br><span class="line">	&lt;/aop:config&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 第三种配置事务的方式 ，代理 --&gt;</span><br><span class="line">	&lt;!-- </span><br><span class="line">		&lt;bean id=&quot;transactionProxy&quot; class=&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot; abstract=&quot;true&quot;&gt;</span><br><span class="line">			&lt;property name=&quot;transactionManager&quot; ref=&quot;txManager&quot;/&gt;</span><br><span class="line">			&lt;property name=&quot;transactionAttributes&quot;&gt;</span><br><span class="line">			&lt;props&gt;</span><br><span class="line">				&lt;prop key=&quot;save*&quot;&gt;PROPAGATION_REQUIRED, -Exception&lt;/prop&gt;</span><br><span class="line">				&lt;prop key=&quot;*&quot;&gt;PROPAGATION_REQUIRED, readOnly&lt;/prop&gt;</span><br><span class="line">			&lt;/props&gt;</span><br><span class="line">			&lt;/property&gt;</span><br><span class="line">		&lt;/bean&gt;</span><br><span class="line">	 --&gt;</span><br><span class="line">	&lt;!-- &lt;bean id=&quot;productServiceImpl&quot; parent=&quot;transactionProxy&quot;&gt; --&gt;</span><br><span class="line">		&lt;!-- &lt;property name=&quot;target&quot;&gt; --&gt;</span><br><span class="line">			&lt;!-- 用bean代替ref的方式 --&gt;</span><br><span class="line">			&lt;!-- &lt;bean class=&quot;mmp.service.impl.ProductServiceImpl&quot;&gt; --&gt;</span><br><span class="line">				&lt;!-- &lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot;/&gt; --&gt;</span><br><span class="line">			&lt;!-- &lt;/bean&gt; --&gt;</span><br><span class="line">		&lt;!-- &lt;/property&gt; --&gt;</span><br><span class="line">	&lt;!-- &lt;/bean&gt; --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 第四种配置事务的方式，拦截器 (老旧) --&gt;</span><br><span class="line">	&lt;!-- </span><br><span class="line">		&lt;bean id=&quot;transactionInterceptor&quot; class=&quot;org.springframework.transaction.interceptor.TransactionInterceptor&quot;&gt;</span><br><span class="line">			&lt;property name=&quot;transactionManager&quot; ref=&quot;txManager&quot;/&gt;</span><br><span class="line">			&lt;property name=&quot;transactionAttributes&quot;&gt;</span><br><span class="line">				&lt;props&gt;</span><br><span class="line">					&lt;prop key=&quot;save*&quot;&gt;PROPAGATION_REQUIRED, -Exception&lt;/prop&gt;</span><br><span class="line">					&lt;prop key=&quot;*&quot;&gt;PROPAGATION_REQUIRED, readOnly&lt;/prop&gt;</span><br><span class="line">				&lt;/props&gt;</span><br><span class="line">			&lt;/property&gt;</span><br><span class="line">		&lt;/bean&gt;</span><br><span class="line">		&lt;bean id=&quot;proxyFactory&quot; class=&quot;org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator&quot;&gt;</span><br><span class="line">			&lt;property name=&quot;interceptorNames&quot;&gt;</span><br><span class="line">				&lt;list&gt;</span><br><span class="line">					&lt;value&gt;transactionInterceptor&lt;/value&gt;</span><br><span class="line">				&lt;/list&gt;</span><br><span class="line">			&lt;/property&gt;</span><br><span class="line">			&lt;property name=&quot;beanNames&quot;&gt;</span><br><span class="line">				&lt;list&gt;</span><br><span class="line">					&lt;value&gt;*Dao&lt;/value&gt;</span><br><span class="line">				&lt;/list&gt;</span><br><span class="line">			&lt;/property&gt;</span><br><span class="line">		&lt;/bean&gt;</span><br><span class="line">	 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- MYSQL服务器本身要支持INNODB，MYSQL表的类型必须是INNODB才支持事务 --&gt;</span><br><span class="line">	&lt;!-- 修改表的类型为INNODB的SQL：alter table xxx ENGINE = innodb; --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 如果使用注解，注释掉下面 action, service, dao 的 bean，交给自动扫描 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Spring和Struts2整合 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- Action默认是多实例的，每次访问都会创建新的Action实例 --&gt;</span><br><span class="line">	&lt;!-- Struts的Action交由Spring管理后，Action默认是单例的，增加scope=&quot;prototype&quot;，使用非单例模式 --&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 将Action生命周期交给Spring  --&gt;</span><br><span class="line">	&lt;bean name=&quot;productActionBean&quot; class=&quot;mmp.action.ProductAction&quot; scope=&quot;prototype&quot;&gt;</span><br><span class="line">		&lt;!-- 注入 --&gt;</span><br><span class="line">		&lt;property name=&quot;productService&quot; ref=&quot;productServiceImpl&quot;/&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 注册 service对象 --&gt;</span><br><span class="line">	&lt;bean name=&quot;productServiceImpl&quot; class=&quot;mmp.service.impl.ProductServiceImpl&quot;&gt;</span><br><span class="line">		&lt;!-- 注入 --&gt;</span><br><span class="line">		&lt;property name=&quot;productDAO&quot; ref=&quot;productDAOImpl&quot;/&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 注册 dao对象，将 sessionFactory 注入给 Dao --&gt;</span><br><span class="line">	&lt;bean name=&quot;productDAOImpl&quot; class=&quot;mmp.dao.impl.ProductDAOImpl&quot;&gt;</span><br><span class="line">		&lt;!-- 注入 --&gt;</span><br><span class="line">		&lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot;/&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package mmp.model;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">@Table(name = &quot;product_table&quot;)</span><br><span class="line">public class Product &#123;</span><br><span class="line">	int id;</span><br><span class="line">	String name;</span><br><span class="line"></span><br><span class="line">	@Id</span><br><span class="line">	@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br><span class="line">	@Column(name = &quot;id&quot;)</span><br><span class="line">	public int getId() &#123;</span><br><span class="line">		return id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setId(int id) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Column(name = &quot;name&quot;)</span><br><span class="line">	public String getName() &#123;</span><br><span class="line">		return name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setName(String name) &#123;</span><br><span class="line">		this.name = name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dao实现类要获取到<code>SessionFactory</code>，最终获取到<code>Session</code>对象操作DB。</p>
<p><code>SessionFactory</code>对象的创建是由Spring容器管理的。</p>
<p>所以要在Dao实现类中添加<code>SessionFactory</code>属性，以便Spring通过setter注入。</p>
<p>SSH中，Dao获取Hibernate的<code>Session</code>，还可以通过<code>HibernateTemplate</code>（一般不用）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package mmp.dao;</span><br><span class="line"></span><br><span class="line">public interface ProductDAO &#123;</span><br><span class="line">	public List&lt;Product&gt; list();</span><br><span class="line">	public void add(Product p);</span><br><span class="line">	public Product get(int id);</span><br><span class="line">	public void update(Product p);</span><br><span class="line">	public void delete(Product p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package mmp.dao.impl;</span><br><span class="line"></span><br><span class="line">public class ProductDAOImpl implements ProductDAO &#123;</span><br><span class="line">	// SessionFactory是hibernate的内置对象</span><br><span class="line">	private SessionFactory sessionFactory;</span><br><span class="line">	// setter方法，注入</span><br><span class="line">	public void setSessionFactory(SessionFactory sessionFactory) &#123;</span><br><span class="line">		this.sessionFactory = sessionFactory;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public List&lt;Product&gt; list() &#123;</span><br><span class="line">		// sessionFactory实例可以按常规写法创建也可以交给Spring托管</span><br><span class="line">		// sessionFactory = new Configuration().configure().buildSessionFactory();</span><br><span class="line"></span><br><span class="line">		Session session = sessionFactory.openSession();</span><br><span class="line">		// Session session = sessionFactory.getCurrentSession();</span><br><span class="line">		// ...</span><br><span class="line">	&#125;</span><br><span class="line">	// ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果使用注解，要重写<code>setSessionFactory</code>方法，<code>@Resource(name = &quot;sessionFactory&quot;)</code>注入<code>sessionFactory</code>。</p>
<p>虽然继承了<code>HibernateTemplate</code>有<code>setSessionFactory</code>方法，但这个继承的方法没有被注解，不会被注入，需要重写。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package mmp.dao.impl;</span><br><span class="line"></span><br><span class="line">@Repository(&quot;productDAO&quot;)</span><br><span class="line">@Transactional</span><br><span class="line">public class ProductDAOImpl extends HibernateTemplate implements ProductDAO &#123;</span><br><span class="line"></span><br><span class="line">	@Resource(name = &quot;sessionFactory&quot;) // sessionFactory 的 bean id 是 sessionFactory</span><br><span class="line">	public void setSessionFactory(SessionFactory sessionFactory) &#123;</span><br><span class="line">		super.setSessionFactory(sessionFactory);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	@Transactional(readOnly = true)</span><br><span class="line">	// @Transactional(propagation = Propagation.REQUIRED, rollbackForClassName = &quot;Exception&quot;)</span><br><span class="line">	// 这个方法使用事务，举个栗子</span><br><span class="line">	public List&lt;Product&gt; list() &#123;</span><br><span class="line">		// 继承了HibernateTemplate，可以直接使用find</span><br><span class="line">		return find(&quot;from Product&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void add(Product p) &#123;</span><br><span class="line">		save(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Product get(int id) &#123;</span><br><span class="line">		return (Product)get(Product.class, id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void update(Product p) &#123;</span><br><span class="line">		super.update(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void delete(Product p) &#123;</span><br><span class="line">		super.delete(p);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package mmp.service;</span><br><span class="line"></span><br><span class="line">public interface ProductService &#123;</span><br><span class="line"></span><br><span class="line">	public List&lt;Product&gt; list();</span><br><span class="line">	public void add(Product p);</span><br><span class="line">	public Product get(int id);</span><br><span class="line">	public void update(Product p);</span><br><span class="line">	public void delete(Product p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package mmp.service.impl;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class ProductServiceImpl implements ProductService &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired // 自动装配注入DAO</span><br><span class="line">	ProductDAO productDAO;</span><br><span class="line"></span><br><span class="line">	// getters setters</span><br><span class="line"></span><br><span class="line">	@Transactional(propagation = Propagation.REQUIRED, rollbackForClassName = &quot;Exception&quot;)</span><br><span class="line">	// 表示这个方法要进行事务管理</span><br><span class="line">	public List&lt;Product&gt; list() &#123;</span><br><span class="line">		List&lt;Product&gt; products = productDAO.list();</span><br><span class="line">		if (products.isEmpty()) &#123;</span><br><span class="line">			for (int i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">				Product p = new Product();</span><br><span class="line">				p.setName(&quot;product &quot; + i);</span><br><span class="line">				productDAO.add(p);</span><br><span class="line">				products.add(p);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return products;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void add(Product p) &#123;</span><br><span class="line">		productDAO.add(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void update(Product p) &#123;</span><br><span class="line">		productDAO.update(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void delete(Product p) &#123;</span><br><span class="line">		productDAO.delete(p);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Product get(int id) &#123;</span><br><span class="line">		return productDAO.get(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>struts.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE struts PUBLIC</span><br><span class="line">	&quot;-//Apache Software Foundation//DTD Struts Configuration 2.5//EN&quot;</span><br><span class="line">	&quot;http://struts.apache.org/dtds/struts-2.5.dtd&quot;&gt;</span><br><span class="line">&lt;struts&gt;</span><br><span class="line">	&lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">	&lt;!-- 将action对象交给spring管理 --&gt;</span><br><span class="line">	&lt;constant name=&quot;struts.objectFactory&quot; value=&quot;spring&quot;/&gt;</span><br><span class="line">	&lt;constant name=&quot;struts.i18n.encoding&quot; value=&quot;UTF-8&quot;/&gt;</span><br><span class="line">	&lt;!-- 指定每次请求到达，重新加载资源文件 --&gt;</span><br><span class="line">	&lt;constant name=&quot;struts.i18n.reload&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">	&lt;!-- 指定每次配置文件更改后，自动重新加载 --&gt;</span><br><span class="line">	&lt;constant name=&quot;struts.configuration.xml.reload&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">	&lt;!-- 默认后缀名 --&gt;</span><br><span class="line">	&lt;constant name=&quot;struts.action.extension&quot; value=&quot;action,&quot;/&gt;</span><br><span class="line">	&lt;!-- 注释掉下面配置，如果使用注解 --&gt;</span><br><span class="line">	&lt;package name=&quot;helloworld&quot; extends=&quot;struts-default&quot;&gt;</span><br><span class="line">		&lt;!-- 使用 bean id productActionBean 来引用类，依赖注入 --&gt;</span><br><span class="line">		&lt;action name=&quot;listProduct&quot; class=&quot;productActionBean&quot; method=&quot;list&quot;&gt;</span><br><span class="line">			&lt;result name=&quot;listJsp&quot;&gt;list.jsp&lt;/result&gt; --&gt;</span><br><span class="line">			&lt;result name=&quot;home&quot;&gt;/index.jsp&lt;/result&gt;</span><br><span class="line">		&lt;/action&gt;</span><br><span class="line">	&lt;/package&gt;</span><br><span class="line">&lt;/struts&gt;</span><br></pre></td></tr></table></figure></p>
<p>使用了Struts2注解后，无需struts.xml。</p>
<p>然而Strut2在<code>&lt;action/&gt;</code>中使用伪类（bean id），在Spring中定义Action的Bean，将Service对象注入给Action。</p>
<p>删除了struts.xml，Spring中定义的Action的Bean，将与Struts2无关，通过Spring注解可以再次建立。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package mmp.action;</span><br><span class="line"></span><br><span class="line">@Namespace(&quot;/&quot;)</span><br><span class="line">@ParentPackage(&quot;struts-default&quot;) // 表示使用默认的一套拦截器</span><br><span class="line">@Results(&#123; </span><br><span class="line">	@Result(name = &quot;listJsp&quot;, location = &quot;/list.jsp&quot;), </span><br><span class="line">	@Result(name = &quot;home&quot;, location = &quot;/index.jsp&quot;) </span><br><span class="line">&#125;)</span><br><span class="line">public class ProductAction &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired // 自动装配注入productService</span><br><span class="line">	ProductService productService;</span><br><span class="line">	List&lt;Product&gt; products;</span><br><span class="line">	Product product;</span><br><span class="line"></span><br><span class="line">	// getters setters</span><br><span class="line"></span><br><span class="line">	@Action(&quot;listProduct&quot;)</span><br><span class="line">	public String list() &#123;</span><br><span class="line">		products = productService.list();</span><br><span class="line">		return &quot;listProduct&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String add()&#123;</span><br><span class="line">		productService.add(product);</span><br><span class="line">		return &quot;listProductAction&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	public String edit()&#123;</span><br><span class="line">		product = productService.get(product.getId());</span><br><span class="line">		return &quot;editProduct&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	public String delete()&#123;</span><br><span class="line">		productService.delete(product);</span><br><span class="line">		return &quot;listProductAction&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	public String update()&#123;</span><br><span class="line">		productService.update(product);</span><br><span class="line">		return &quot;listProductAction&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Namespace(&quot;/User&quot;)</span><br><span class="line">@Result(name=&quot;success&quot;, location=&quot;pages/login.jsp&quot;)</span><br><span class="line">public class LoginAction extends ActionSupport &#123;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/struts2example/User/login.action</span><br><span class="line">// 默认在 WEB-INF/content/下</span><br><span class="line">/struts2example/WEB-INF/content/User/pages/login.jsp</span><br></pre></td></tr></table></figure>
<p>如果JSP页面存储在其他位置，可以使用<code>@ResultPath</code>注释改变。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Namespace(&quot;/User&quot;)</span><br><span class="line">@ResultPath(value=&quot;/&quot;)</span><br><span class="line">@Result(name=&quot;success&quot;, location=&quot;pages/login.jsp&quot;)</span><br><span class="line">public class LoginAction extends ActionSupport&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/struts2example/User/login.action</span><br><span class="line">// now</span><br><span class="line">/Struts2Example/User/pages/login.jsp</span><br></pre></td></tr></table></figure>
<p>全局<code>@ResultPath</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;constant name=&quot;struts.convention.result.path&quot; value=&quot;/&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>OpenSessionInView</p>
<p>当将事务织入到Service层后，在Dao层通过<code>load()</code>等具有延迟加载功能的方法加载实体时，会出现异常：</p>
<p><code>org.hibernate.LazyInitializationException: could not initialize proxy - no Session</code>。</p>
<p>解决办法：</p>
<p>问题原因是事务应用在业务层，而延迟加载使得对Hibernate的<code>Session</code>的连续使用放在了View层。</p>
<p>若要<code>Session</code>不自动关闭，必须使其所在的事务环境不在Service层就结束，可以将<code>Session</code>的开启放在View层。</p>
<p>在web.xml中注册<code>OpenSessionInViewFilter</code>（开启Session在View），只要用户提交请求，就会先执行该过滤器，将<code>Session</code>开启。</p>
<p>该过滤器自动从Spring配置文件中查找名为<code>sessionFactory</code>的Bean，若定义的不是这个名称，需通过<code>&lt;init-param/&gt;</code>指定。</p>
<p>该过滤器应注册在<code>StrutsPrepareAndExecuteFilter</code>前面，即在进入Struts2前先过滤。</p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
