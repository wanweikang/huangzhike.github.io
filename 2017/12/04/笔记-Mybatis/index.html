<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>[笔记]-Mybatis | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="用手记笔记，用心记笔记，用脑记笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-Mybatis"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<script>var timeStart = new Date();</script>
		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		
		
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>首页
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>存档
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-Mybatis</h2>
				
				<div>
					<span class="post-time">2017-12-04 0:23</span>
				</div>	
				
				<div class="article-content">
				<p>不用看了，Mybatis有<a href="http://www.mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="external">官方中文文档</a>，写得很精简，嗯，很好。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> mybatis;</div><div class="line"><span class="keyword">use</span> mybatis;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">users</span>(<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT, <span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>), age <span class="built_in">INT</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span>(<span class="keyword">NAME</span>, age) <span class="keyword">VALUES</span>(<span class="string">'mmp'</span>, <span class="number">99</span>);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.domain;</div><div class="line"></div><div class="line"><span class="comment">// users表对应实体类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line"></div><div class="line">	<span class="comment">// getter setter</span></div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"User [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", age="</span> + age + <span class="string">"]"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>mmp.mapping包，存放SQL映射文件，在包中创建users表的SQL映射XML文件userMapper.xml<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> <span class="meta">?&gt;</span></span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE mapper </span></div><div class="line">	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" </div><div class="line">	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</div><div class="line"><span class="comment">&lt;!-- 为mapper指定namespace，包名+SQL映射文件名 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"mmp.mapping.userMapper"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- CURD：增 Create、改 Update、查 Read、删 Delete --&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- parameterType：查询时的参数类型，自动检测，一般省略 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- resultType：返回的结果集类型，本例将查询结果封装成User类对象返回 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUser"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"mmp.domain.User"</span>&gt;</span></div><div class="line">		select * from users where id=#<span class="template-variable">&#123;id&#125;</span><span class="xml"></span></div><div class="line">		<span class="comment">&lt;!-- 如果接收简单类型，#</span><span class="template-variable">&#123;&#125;</span><span class="xml"><span class="comment">中的值任意 --&gt;</span></span></div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 根据用户名称模糊查询用户信息，可能返回多条 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- $</span><span class="template-variable">&#123;&#125;</span><span class="xml"><span class="comment">：表示拼接sql串，可能引起SQL注入，不建议使用 --&gt;</span></span></div><div class="line">	<span class="comment">&lt;!-- 模糊查询“张三”，$</span><span class="template-variable">&#123;&#125;</span><span class="xml"><span class="comment">不用输入“%张三%” --&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserByName"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.String"</span> <span class="attr">resultType</span>=<span class="string">"mmp.domain.User"</span>&gt;</span></div><div class="line">		select * from users where name like '%$<span class="template-variable">&#123;value&#125;</span><span class="xml">%'</span></div><div class="line">		<span class="comment">&lt;!-- 如果接收简单类型，$</span><span class="template-variable">&#123;&#125;</span><span class="xml"><span class="comment">中只能写成value --&gt;</span></span></div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAllUsers"</span> <span class="attr">resultType</span>=<span class="string">"mmp.domain.User"</span>&gt;</span></div><div class="line">		select * from users</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addUser"</span> <span class="attr">parameterType</span>=<span class="string">"mmp.domain.User"</span>&gt;</span></div><div class="line">		insert into users(name,age) values(#<span class="template-variable">&#123;name&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;age&#125;</span><span class="xml">)</span></div><div class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></div><div class="line">		delete from users where id=#<span class="template-variable">&#123;id&#125;</span><span class="xml"></span></div><div class="line">	<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"mmp.domain.User"</span>&gt;</span></div><div class="line">		update users set name=#<span class="template-variable">&#123;name&#125;</span><span class="xml">,age=#</span><span class="template-variable">&#123;age&#125;</span><span class="xml"> where id=#</span><span class="template-variable">&#123;id&#125;</span><span class="xml"></span></div><div class="line">	<span class="tag">&lt;/<span class="name">update</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addUser"</span> <span class="attr">parameterType</span>=<span class="string">"mmp.domain.User"</span>&gt;</span></span></div><div class="line">	insert into users(name,age) values(#<span class="template-variable">&#123;name&#125;</span><span class="xml">,#</span><span class="template-variable">&#123;age&#125;</span><span class="xml">)</span></div><div class="line">	<span class="comment">&lt;!-- &lt;insert/&gt;标签中，子标签&lt;selectKey/&gt;用于获取新插入记录的主键值 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 将插入数据的主键返回到user对象中 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- keyProperty：将查询到主键值设置到上面 parameterType 指定的 Java 类对象的哪个属性 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- resultType：获取的主键的类型 --&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- order：id 的生成相对于 insert 语句的执行是在前还是在后 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- MySql 先 insert ，后生成 id，设为 AFTER --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- Oracle 先生成 id，再 insert ，设为 BEFORE --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 不指定 order，则根据 DBMS 自动选择 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- sql函数，表示得到刚insert的主键值，只适用于自增主键 --&gt;</span></div><div class="line">		select last_insert_id()</div><div class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 在插入操作还未提交时对象已经有了 id --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 无论插入操作是提交还是回滚，DB 均会为 insert 的记录分配 id，即使生回滚，id 也已经被使用 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 后面再插入并提交的记录数据，被分配的 id 是跳过此 id 后的 id --&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 首先通过MySql的uuid()得到主键，将主键设置到user对象的id属性中，insert执行时，从user对象中取出id --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- </span></div><div class="line">		&lt;selectKey keyProperty="id" order="BEFORE" resultType="java.lang.String"&gt;</div><div class="line">			SELECT uuid()</div><div class="line">		&lt;/selectKey&gt;</div><div class="line">		insert into user(id,username,birthday) value(#<span class="template-variable">&#123;id&#125;</span><span class="xml"><span class="comment">,#</span></span><span class="template-variable">&#123;username&#125;</span><span class="xml"><span class="comment">,#</span></span><span class="template-variable">&#123;birthday&#125;</span><span class="xml"><span class="comment">)</span></span></div><div class="line">	 --&gt;</div><div class="line">	<span class="comment">&lt;!-- birthday字段在MySql表中是DATE类型，在User类中是Java的`java.util.Date`类型，没有转换就插入成功 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 据说在字段中有Date和DateTime类型，插入时将实体属性设置成Timestamp就会对应Mysql的DateTime类型，Date会对应Mysql的Date类型 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- #</span><span class="template-variable">&#123;modified_date,jdbcType=TIMESTAMP&#125;</span><span class="xml"><span class="comment">、#</span></span><span class="template-variable">&#123;date,jdbcType=DATE&#125;</span><span class="xml"><span class="comment"> --&gt;</span></span></div><div class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Mybatis的配置XML文件<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE configuration </span></div><div class="line">	PUBLIC "-//mybatis.org//DTD Config 3.0//EN" </div><div class="line">	"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 引用db.properties配置文件 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>/&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 为parameterType或resultType的实体类定义别名，简化SQL映射xml文件中的引用 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 如&lt;insert id="addUser2" parameterType="user"&gt;...&lt;/insert&gt; --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 单独某一个实体类设置别名 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"mmp.domain.User"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 批量为某个包下的所有实体类设置别名,默认简单的类名,如user --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"mmp.domain"</span>/&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 若有注解，则别名为其注解值 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- </span></div><div class="line">			@Alias("user")</div><div class="line">			public class User <span class="template-variable">&#123;&#125;</span><span class="xml"><span class="comment"></span></span></div><div class="line">		 --&gt;</div><div class="line">		<span class="comment">&lt;!-- Mybatis有默认别名，如java.lang.Integer的别名为int --&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 事务管理器 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 数据库连接，POOLED：使用数据库连接池维护连接 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$</span></span><span class="template-variable">&#123;driver&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> /&gt;</span></span></div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$</span></span><span class="template-variable">&#123;url&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> /&gt;</span></span></div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$</span></span><span class="template-variable">&#123;name&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> /&gt;</span></span></div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$</span></span><span class="template-variable">&#123;password&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> /&gt;</span></span></div><div class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 注册userMapper.xml文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mmp/mapping/userMapper.xml"</span>/&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file:///xxx/XxxMapper.xml"</span>/&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 接口的全类名 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 映射xml文件名要与接口名称相同，要在同一包中 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 映射xml文件中&lt;mapper/&gt;的 namespace 属性值为接口的全类名 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"org.mybatis.builder.AuthorMapper"</span>/&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 当映射文件较多时，指定映射文件所存放的包 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 接口使用 mapper 动态代理实现 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 映射xml文件名要与接口名称相同，要在同一包中 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 映射xml文件中&lt;mapper/&gt;的 namespace 属性值为接口的全类名 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"org.mybatis.builder"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>src/db.properties<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">driver</span>=com.mysql.jdbc.Driver</div><div class="line"><span class="attr">url</span>=jdbc:mysql://localhost:<span class="number">3306</span>/mybatis</div><div class="line"><span class="attr">name</span>=root</div><div class="line"><span class="attr">password</span>=<span class="number">123456</span></div></pre></td></tr></table></figure></p>
<p>事务管理器</p>
<ul>
<li>JDBC：JDBC 的事务管理机制。MyBatis 默认关闭自动提交，需要显式的提交事务或回滚。</li>
<li>MANAGED：由容器来管理事务的整个生命周期（如 Spring）。<br>如果使用 Spring + MyBatis，则没有必要配置事务管理器。<br>这个配置几乎没做什么,它从来不提交或回滚一个连接，而是让容器来管理事务的整个生命周期。<br>默认会关闭连接，然而一些容器并不希望这样，因此需要将 closeConnection 属性设置为 false 来阻止它默认的关闭行为。<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"MANAGED"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"closeConnection"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.test;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		SqlSession sqlSession = MyBatisUtil.getSqlSession();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line"></div><div class="line">			<span class="comment">// 映射SQL标识字符串，namespace + id 找到要执行的SQL</span></div><div class="line">			String statement = <span class="string">"mmp.mapping.userMapper.getUser"</span>;</div><div class="line"></div><div class="line">			User user = sqlSession.selectOne(statement, <span class="number">1</span>);</div><div class="line"></div><div class="line">			statement = <span class="string">"mmp.mapping.userMapper.getAllUsers"</span>;</div><div class="line">			<span class="comment">// 查询结果自动封装成List&lt;User&gt;返回</span></div><div class="line">			List&lt;User&gt; lstUsers = sqlSession.selectList(statement);</div><div class="line"></div><div class="line">			statement = <span class="string">"mmp.mapping.userMapper.addUser"</span>;</div><div class="line"></div><div class="line">			User user1 = <span class="keyword">new</span> User();</div><div class="line">			user1.setName(<span class="string">"cnm"</span>);</div><div class="line">			user1.setAge(<span class="number">99</span>);</div><div class="line">			user1.setId(<span class="number">9</span>);</div><div class="line">			<span class="keyword">int</span> retResult = sqlSession.insert(statement, user1);</div><div class="line">			sqlSession.commit();</div><div class="line"></div><div class="line">			statement = <span class="string">"mmp.mapping.userMapper.updateUser"</span>;</div><div class="line">			user1.setName(<span class="string">"cnm"</span>);</div><div class="line"></div><div class="line">			retResult = sqlSession.update(statement, user1);</div><div class="line">			sqlSession.commit();</div><div class="line"></div><div class="line">			statement = <span class="string">"mmp.mapping.userMapper.deleteUser"</span>;</div><div class="line">			retResult = sqlSession.delete(statement, <span class="number">1</span>);</div><div class="line">			sqlSession.commit();</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">			sqlSession.close();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">package mmp.util;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyBatisUtil</span> &#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// 使用类加载器加载MyBatis配置文件</span></div><div class="line">		InputStream <span class="keyword">is</span> = MyBatisUtil.class.getClassLoader().getResourceAsStream(<span class="string">"conf.xml"</span>);</div><div class="line">		<span class="comment">// InputStream inputStream = org.apache.ibatis.io.Resources.getResourceAsStream("conf.xml");</span></div><div class="line">		<span class="comment">// 构建sqlSession工厂</span></div><div class="line">		<span class="comment">// 不用手工关闭InputStream，build()方法会自动将输入流关闭</span></div><div class="line">		SqlSessionFactory sessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(<span class="keyword">is</span>);</div><div class="line">		<span class="keyword">return</span> sessionFactory;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSqlSession</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// 创建sqlSession</span></div><div class="line">		<span class="comment">// 需手动提交</span></div><div class="line">		<span class="keyword">return</span> getSqlSessionFactory().openSession();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSqlSession</span>(<span class="params">boolean isAutoCommit</span>) </span>&#123;</div><div class="line">		<span class="comment">// true：自动提交</span></div><div class="line">		<span class="keyword">return</span> getSqlSessionFactory().openSession(isAutoCommit);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域。</li>
<li>SqlSessionFactory 实例是线程安全，一个应用只需要一个，最佳作用域是应用作用域，如单例或静态单例模式。</li>
<li>SqlSession 实例线程不安全，不能被共享，每个线程都应该有自己的 SqlSession 实例，最佳的作用域是请求或方法作用域。<br>不能将 SqlSession 实例引用放在类的静态域，类的实例变量也不行。<br>不能将 SqlSession 实例引用放在管理作用域中，如 Servlet 架构中的 HttpSession。<br>考虑 SqlSession 放在一个和 HTTP 请求对象相似的作用域中。<br>每次收到的 HTTP 请求，就可以打开一个 SqlSession，返回一个响应，就关闭它。<br>一个 SqlSession 对应着一次数据库会话，每次会话结束前，将其关闭，再次需要，再次创建。</li>
</ul>
<p>原始DAO开发方法</p>
<ul>
<li>需要写dao接口和dao实现类。</li>
<li>需要向dao实现类中注入sqlSessionFactory，在方法体内通过sqlSessionFactory创建sqlSession。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</div><div class="line">	<span class="comment">// 由于没和Spring整合，这里通过构造函数注入</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UserDaoImpl</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.sqlSessionFactory = sqlSessionFactory;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		SqlSession sqlSession = sqlSessionFactory.openSession();</div><div class="line">		User user = sqlSession.selectOne(<span class="string">"namespace.findUserById"</span>, id);</div><div class="line">		sqlSession.close();</div><div class="line">		<span class="keyword">return</span> user;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImplTest</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</div><div class="line">	<span class="comment">// 在执行本类所有测试方法之前先调用@Before方法，签名要求：public void，无参</span></div><div class="line">	<span class="meta">@Before</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		InputStream inputStream = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</div><div class="line">		sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		UserDao userDao = <span class="keyword">new</span> UserDaoImpl(sqlSessionFactory);</div><div class="line">		User user = userDao.findUserById(<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Mapper代理<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// mapper接口，相当于dao接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>编写对应的XML映射文件：</p>
<ul>
<li>UserMapper.xml中namespace对应UserMapper.java的完全限定名。</li>
<li>UserMapper.xml中statement的id对应UserMapper.java中方法名。</li>
<li>UserMapper.xml中statement的parameterType对应UserMapper.java的方法输入参数类型。</li>
<li>UserMapper.xml中statement的resultType对应UserMapperr.java的方法返回值类型。</li>
</ul>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</div><div class="line"><span class="comment">// 自动生成mapper代理对象</span></div><div class="line">UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</div><div class="line">User user = userMapper.findUserById(<span class="number">1</span>);</div></pre></td></tr></table></figure>
<p>mapper接口方法参数只能有一个，可以使用包装类型的pojo。</p>
<p>基于注解，注解就是要替换映射文件中的 SQL 标签。官方不建议使用。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.mapping;</div><div class="line"></div><div class="line"><span class="comment">// sql映射接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapperI</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Insert</span>(<span class="string">"insert into users(name, age) values(#&#123;name&#125;, #&#123;age&#125;)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(User user)</span></span>;</div><div class="line"></div><div class="line">	<span class="meta">@Delete</span>(<span class="string">"delete from users where id=#&#123;id&#125;"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</div><div class="line"></div><div class="line">	<span class="meta">@Update</span>(<span class="string">"update users set name=#&#123;name&#125;,age=#&#123;age&#125; where id=#&#123;id&#125;"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(User user)</span></span>;</div><div class="line"></div><div class="line">	<span class="meta">@Select</span>(<span class="string">"select * from users where id=#&#123;id&#125;"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</div><div class="line"></div><div class="line">	<span class="meta">@Select</span>(<span class="string">"select * from users"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>不需要编写具体的实现类代码，由MyBatis动态构建。<br>由于没有了映射文件，需要使用<code>&lt;package/&gt;</code>标签注册。<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">sqlSession</span> = MyBatisUtil.getSqlSession()<span class="comment">;</span></div><div class="line">try &#123;</div><div class="line">	// 自动生成mapper代理对象，动态构建出实现类对象</div><div class="line">	UserMapperI mapper = sqlSession.getMapper(UserMapperI.class)<span class="comment">;</span></div><div class="line">	User user = mapper.getById(<span class="number">8</span>)<span class="comment">;</span></div><div class="line">	List&lt;User&gt; lstUsers = mapper.getAll()<span class="comment">;</span></div><div class="line">&#125; finally &#123;</div><div class="line">	sqlSession.close()<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>总结：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SqlSession session = sqlSessionFactory.openSession()<span class="comment">;</span></div><div class="line">try &#123;</div><div class="line">	<span class="keyword">Blog </span><span class="keyword">blog </span>= (<span class="keyword">Blog) </span>session.selectOne(<span class="string">"org.mybatis.example.BlogMapper.selectBlog"</span>, <span class="number">101</span>)<span class="comment">;</span></div><div class="line">&#125; finally &#123;</div><div class="line">	session.<span class="keyword">close();</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SqlSession session = sqlSessionFactory.openSession()<span class="comment">;</span></div><div class="line">try &#123;</div><div class="line">	<span class="keyword">BlogMapper </span>mapper = session.getMapper(<span class="keyword">BlogMapper.class);</span></div><div class="line">	<span class="keyword">Blog </span><span class="keyword">blog </span>= mapper.selectBlog(<span class="number">101</span>)<span class="comment">;</span></div><div class="line">&#125; finally &#123;</div><div class="line">	session.<span class="keyword">close();</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>解决字段名与实体类属性名不相同的冲突。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orders(</div><div class="line">	order_id <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</div><div class="line">	order_no <span class="built_in">VARCHAR</span>(<span class="number">20</span>), </div><div class="line">	order_price <span class="built_in">FLOAT</span></div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> orders(order_no, order_price) <span class="keyword">VALUES</span>(<span class="string">'cnm'</span>, <span class="number">23</span>);</div></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.domain;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> &#123;</span></div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id; <span class="comment">// id =&gt; order_id</span></div><div class="line">	<span class="keyword">private</span> String orderNo; <span class="comment">// orderNo ==&gt; order_no</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">float</span> price; <span class="comment">// price ==&gt; order_price</span></div><div class="line">	<span class="comment">// getter setter</span></div><div class="line">	<span class="comment">// toString()</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SQL映射文件</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="comment">&lt;!-- 法一：别名 --&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOrder"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"mmp.domain.Order"</span>&gt;</span></div><div class="line">	select order_id id, order_no orderNo,order_price price from orders where order_id=#<span class="template-variable">&#123;id&#125;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 法二：&lt;resultMap&gt;映射实体类属性名和表的字段名 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectOrderResultMap"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"orderResultMap"</span>&gt;</span></div><div class="line">	select * from orders where order_id=#<span class="template-variable">&#123;id&#125;</span><span class="xml"></span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"mmp.domain.Order"</span> <span class="attr">id</span>=<span class="string">"orderResultMap"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- id 映射主键字段 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"order_id"</span>/&gt;</span></div><div class="line">	<span class="comment">&lt;!-- result 映射非主键字段 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"orderNo"</span> <span class="attr">column</span>=<span class="string">"order_no"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"price"</span> <span class="attr">column</span>=<span class="string">"order_price"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div></pre></td></tr></table></figure>
<p>表单中的查询条件有时无法封装为一个对象，查询方法只能携带多个参数，而不能携带将这多个参数封装的对象。两种解决办法：</p>
<ul>
<li>利用 hashMap</li>
<li>利用 Mybatis 自身的多个参数传递</li>
</ul>
<p>利用 hashMap 传递多个参数<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">select</span> id=<span class="string">"selectByDate"</span> parameterType=<span class="string">"map"</span> resultMap=<span class="string">"campaignStats"</span>&gt;</div><div class="line">		<span class="keyword">Select</span> * <span class="keyword">FROM</span> CampaignStats <span class="keyword">Where</span> statsDate &gt;= <span class="meta">#&#123;start&#125; AND statsDate &lt;= #&#123;<span class="meta-keyword">end</span>&#125;</span></div><div class="line">&lt;/<span class="keyword">select</span>&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="built_in">List</span>&lt;DpCampaignStats&gt; selectByDate(<span class="built_in">Date</span> start, <span class="built_in">Date</span> end) &#123;</div><div class="line">	SqlSession session = sqlSessionFactory.openSession();</div><div class="line">	try &#123;</div><div class="line">		<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Date</span>&gt; <span class="built_in">map</span> = <span class="literal">new</span> HashMap&lt;<span class="built_in">String</span>, <span class="built_in">Date</span>&gt;();</div><div class="line">		<span class="built_in">map</span>.put(<span class="string">"start"</span>, start);</div><div class="line">		<span class="built_in">map</span>.put(<span class="string">"end"</span>, end);</div><div class="line">		<span class="built_in">List</span>&lt;DpCampaignStats&gt; <span class="built_in">list</span> = session.selectList(<span class="string">"DpCampaignStats.selectByDate"</span>, <span class="built_in">map</span>);</div><div class="line">		<span class="keyword">return</span> <span class="built_in">list</span>;</div><div class="line">	&#125; finally &#123;</div><div class="line">		session.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Mybatis 自带的多个参数传递方法<br><figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="comment">&lt;!-- 没有 parameterType --&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByDate"</span> <span class="attr">resultMap</span>=<span class="string">"campaignStats"</span>&gt;</span></div><div class="line">	Select * FROM CampaignStats Where statsDate &gt;= #<span class="template-variable">&#123;param1&#125;</span><span class="xml"> AND statsDate <span class="tag">&lt;<span class="name">=</span> #</span></span><span class="template-variable">&#123;param2&#125;</span><span class="xml"><span class="tag"></span></span></div><div class="line">&lt;/<span class="attr">select</span>&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="built_in">List</span>&lt;DpCampaignStats&gt; selectByDate(<span class="built_in">Date</span> start, <span class="built_in">Date</span> end)&#123;</div><div class="line">	SqlSession session = sqlSessionFactory.openSession();</div><div class="line">	try &#123;</div><div class="line">		<span class="built_in">List</span>&lt;DpCampaignStats&gt; <span class="built_in">list</span> = session.selectList(<span class="string">"DpCampaignStats.selectByDate"</span>, start,end);</div><div class="line">		<span class="keyword">return</span> <span class="built_in">list</span>;</div><div class="line">	&#125; finally &#123;</div><div class="line">		session.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>推荐使用 hashMap 来传递多个参数。</p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			
<p>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme modified by <b> Huangzhike </b></p>
<p>&copy; 2017 <a href="https://huangzhike.github.io"><b> Huangzhike </b></a></p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
