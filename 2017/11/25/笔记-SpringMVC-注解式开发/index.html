<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <script>
            var timeStart = new Date();
        </script>
        
        <title>[笔记]-SpringMVC-注解式开发 | 学而时习之</title>
        
        <meta name="author" content="Huangzhike">
        
        
        <meta name="description" content="K.I.S.S">
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        
        <meta property="og:title" content="[笔记]-SpringMVC-注解式开发"/>
        
        <meta property="og:site_name" content="学而时习之"/>
        
        
        <!-- favicon -->
        <link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
        <meta name="msapplication-TileColor" content="#009688">
        <meta name="msapplication-TileImage" content="/mstile-144x144.ico">
        <meta name="theme-color" content="#009688">
        <!-- favicon end -->
        <!-- <link href="//ok.ico" rel="icon"> -->
        
        <!-- toc -->
        <!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
        <!-- material design -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
        <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
        <!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
        <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
        
        <!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
        <!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
    <meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">学而时习之</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" target="_blank" rel="noopener" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

    <div class="container" >
        <div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-SpringMVC-注解式开发</h2>
				
				<div>
					<div class="post-time">2017-11-25</div>
				</div>
				
				<div class="article-content">
				<p><strong>1-3重新整理</strong></p>
<p>注解式开发：处理器基于注解，无需在配置文件中逐个注册处理器，通过对类与方法的注解完成注册。</p>
<p>注解替换的是配置文件中对于处理器的注册部分。</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 激活SpringMVC注解扫描，如@Controller和@RequestMapping --></span>
<span class="token comment" spellcheck="true">&lt;!-- 默认扫描的包路径，base-package后的内容只是包路径，不能把类名也写出来 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mmp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span><span class="token punctuation">/></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 注解驱动 --></span>
<span class="token comment" spellcheck="true">&lt;!-- 默认加载很多参数绑定方法，如JSON转换解析器 --></span>
<span class="token comment" spellcheck="true">&lt;!-- 不用配置RequestMappingHandlerMapping和RequestMappingHandlerAdapter --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">/></span></span></code></pre>
<p><code>@Controller</code>：说明是处理器类；</p>
<p><code>@RequestMapping</code>：请求到处理器方法的映射；</p>
<p><code>@RequestParam</code>：请求参数到处理器方法的方法参数的绑定；</p>
<p><code>@ModelAttribute</code>：请求参数到命令对象的绑定；</p>
<p><code>@InitBinder</code>：自定义数据绑定注册支持，将请求参数转换到命令对象属性的对应类型；</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/login.do"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 通用映射前缀</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/login2.do"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 映射窄化  </span>
    <span class="token keyword">public</span> ModelAndView <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        ModelAndView mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 设置逻辑视图名，视图解析器会根据该名字解析到具体的视图页面</span>
        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mv<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 模型数据和逻辑视图名</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>URL：<code>http://xxx/xxx/login/login2.do</code></p>
<hr>
<p>处理器方法可以包含五类参数，由系统自动赋值。</p>
<ul>
<li>HttpServletRequest</li>
<li>HttpServletResponse</li>
<li>HttpSession</li>
<li>Model（承载数据）</li>
<li>请求参数</li>
</ul>
<hr>
<p><code>@RequestMapping(value={&quot;/login.do&quot;, &quot;/user/login.do&quot;})</code>。</p>
<p><code>@RequestMapping(value=&quot;/users/{userId}&quot;)</code>：{xxx}占位符，匹配”/users/123456”或”/users/abcd”。</p>
<p><code>@RequestMapping(value=&quot;/users/**&quot;)</code>:匹配”/users/abc/abc”。</p>
<p><code>@RequestMapping(value=&quot;/model?&quot;)</code>:匹配”/model1”或”/modela”，不匹配”/model”或”/modelaa”。</p>
<p><code>@RequestMapping(value=&quot;/model*&quot;)</code>:匹配”/modelabc”或”/model”，不匹配”/modelabc/abc”。</p>
<p><code>@RequestMapping(value=&quot;/model/*&quot;)</code>:匹配”/model/abc”，不匹配”/modelabc”。</p>
<p><code>@RequestMapping(value=&quot;/model/**/{modelId}&quot;)</code>：匹配”/model/abc/abc/123”或”/model/123”。</p>
<p><code>@RequestMapping(value=&quot;/login/{userId:\\d+}.do&quot;)</code>:{变量名:正则表达式}，匹配”/login/123.do”，不匹配”/login/abc.do”。</p>
<hr>
<p>@RequestMapping 中 params 属性中定义了请求中必须携带的参数的要求。</p>
<p><code>@RequestMapping(value=&quot;/xxx.do&quot;, params={&quot;name&quot;, &quot;age&quot;})</code>：请求中必须携带参数name与age。</p>
<p><code>@RequestMapping(value=&quot;/xxx.do&quot;, params={&quot;!name&quot;, &quot;age&quot;})</code>：请求中必须携带参数age，不能携带name。</p>
<p><code>@RequestMapping(value=&quot;/xxx.do&quot;, params={&quot;name=mdzz&quot;, &quot;ag = 23&quot;})</code>：请求中必须携带参数name，值为mdzz；必须携带age，值为23。</p>
<p><code>@RequestMapping(value=&quot;/xxx.do&quot;, params=&quot;name != mdzz&quot;)</code>：请求中必须携带参数name，值不能为mdzz。</p>
<hr>
<p><code>RequestMethod.GET</code>与<code>RequestMethod.POST</code></p>
<ul>
<li>表单请求：默认GET，可以指定POST</li>
<li>AJAX请求：默认GET，可以指定POST</li>
<li>地址栏请求：GET请求</li>
<li>超链接请求：GET请求</li>
<li>src资源路径请求：GET请求</li>
</ul>
<hr>
<p>Spring4.3中引进<code>@GetMapping</code>组合注解，等于<code>@RequestMapping(method = RequestMethod.GET)</code>。</p>
<p><code>@RequestParam</code>校正请求参数名，URL携带的参数名与处理方法中的参数名不同时，在处理方法参数前，添加<code>@RequestParam(&quot;请求参数名&quot;)</code>，将请求参数绑定控制器方法参数。</p>
<ul>
<li>value：指定请求参数的名称。</li>
<li>required：是否必须，boolean类型。</li>
<li>defaultValue：默认值。若请求 URI 中没有，当前方法参数将取该默认值。</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// http://localhost:8080/HelloSpringMVC/user?name=admin</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestParamExampleController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">userInfo</span><span class="token punctuation">(</span>Model model<span class="token punctuation">,</span> 
        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"Guest"</span><span class="token punctuation">)</span> String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 如果@RequestParam注解的参数是int基本类型，但是required=false</span>
        <span class="token comment" spellcheck="true">// 这时如果不传参数值会报错，因为不传值，会赋值为null给int</span>
        <span class="token comment" spellcheck="true">// 建议使用包装类型代替基本类型，用Integer代替int</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"userInfo"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<hr>
<p><code>@PathVariable</code>：处理器方法中接收的请求参数，可以来自请求携带的参数，也可以来自于请求<code>URI</code>中的变量，即路径变量。</p>
<ul>
<li><p>不指定参数，默认其参数名，即路径变量名与用于接收其值的属性名相同。</p>
</li>
<li><p>若路径变量名与接收其值的属性名不同，<code>@PathVariable</code>可通过参数指出路径变量名称。</p>
</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// http://localhost:8080/xxx/web/fe/default/en/document/8108/spring-mvc-for-beginners</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PathVariableExampleController</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// URI模板，@PathVariable注释将一个方法参数绑定到一个变量的值</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/web/fe/{sitePrefix}/{language}/document/{id}/{naturalText}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">documentView</span><span class="token punctuation">(</span>Model model<span class="token punctuation">,</span> 
            <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"sitePrefix"</span><span class="token punctuation">)</span> String sitePrefix<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"language"</span><span class="token punctuation">)</span> String language<span class="token punctuation">,</span> 
            <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"naturalText"</span><span class="token punctuation">)</span> String naturalText<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"sitePrefix"</span><span class="token punctuation">,</span> sitePrefix<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"language"</span><span class="token punctuation">,</span> language<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"naturalText"</span><span class="token punctuation">,</span> naturalText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// ...</span>
        <span class="token keyword">return</span> <span class="token string">"documentView"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<hr>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"welcome"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">welcome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"welcome"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 返回welcome.jsp</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ModelAndView <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ModelAndView mav <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mav<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"welcome"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 返回的文件名</span>
        mav<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"hello kitty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Map</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token string">"北京"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        mav<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"map"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 返回到DispatcherServlet</span>
        <span class="token keyword">return</span> mav<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"logout"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ModelAndView <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String message <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"logout"</span><span class="token punctuation">,</span> <span class="token string">"message"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/addProduct"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ModelAndView <span class="token function">add</span><span class="token punctuation">(</span>Product product<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        ModelAndView mav <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"showProduct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 参数product会默认被当做值加入到ModelAndView中，等于：</span>
        <span class="token comment" spellcheck="true">// mav.addObject("product", product);</span>
        <span class="token keyword">return</span> mav<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code>ModelAndView</code>即模型与视图，<code>addObject()</code>方法向模型添加数据，<code>setViewName()</code>方法向模型添加视图名称。</p>
<p><code>ModelAndView</code>的模型对象是<code>ModelMap</code>，本质是个<code>HashMap</code>。</p>
<p><code>ModelMap</code>替代<code>request.getAttribute()</code>/<code>request.setAttribute()</code></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 相当于request.setAttribute("name", student.getName());</span>
model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<hr>
<p>处理器方法，返回值有四种：</p>
<ul>
<li><p>第一种：<code>ModelAndView</code></p>
</li>
<li><p>第二种：<code>String</code></p>
</li>
<li><p>第三种：无返回值<code>void</code></p>
</li>
<li><p>第四种：返回自定义对象</p>
</li>
<li><p>返回<code>ModelAndView</code></p>
<ul>
<li>处理器方法需要跳转到其它资源，又要在跳转的资源间传递数据，返回<code>ModelAndView</code>较好。</li>
<li>返回<code>ModelAndView</code>，则需要定义<code>ModelAndView</code>对象，若只跳转不传递数据，或只传递数据不跳转（如Ajax），返回<code>ModelAndView</code>，总是有部分多余。</li>
</ul>
</li>
<li><p>返回<code>String</code></p>
<ul>
<li><code>return &quot;editItem&quot;;</code>：逻辑视图名，视图解析器转换为物理视图地址。</li>
<li>也可以直接返回物理视图名，此时不需要在视图解析器中配置前辍与后辍。</li>
</ul>
</li>
<li><p>返回<code>void</code></p>
<ul>
<li>方法参数中放入<code>HttpServletRequest</code>或<code>HttpSession</code>，可以直接将数据放入到<code>request</code>、<code>session</code>域中，也可通过<code>request.getServletContext()</code>获取<code>ServletContext</code>，将数据放入到<code>application</code>域中，然后完成请求转发与重定向。<ul>
<li>请求转发：<code>request.getRequestDispatcher(&quot;/WEB-INF/jsp/editItem.jsp&quot;).forward(request, response);</code>。</li>
<li>重定向：<code>response.sendRedirect(&quot;指定页面的完整路径&quot;);</code>。</li>
</ul>
</li>
<li>AJAX响应：处理器对请求处理后，无需跳转，返回<code>void</code>。</li>
</ul>
</li>
<li><p>返回<code>Object</code></p>
<ul>
<li>返回的<code>Object</code>对象不是逻辑视图，而是在页面显示的数据，用<code>@ResponseBody</code>注解，将转换后的<code>JSON</code>数据放入到响应体中。</li>
</ul>
</li>
</ul>
<hr>
<p>请求转发与重定向</p>
<ul>
<li><p>跳转的资源类型：跳转到页面与跳转到其它处理器。</p>
</li>
<li><p>处理器向其它资源跳转：请求转发与重定向。</p>
<ul>
<li>请求转发的页面，可以是<code>WEB-INF</code>中页面；<ul>
<li><code>forward</code>：地址栏URL不变。</li>
</ul>
</li>
<li>重定向的页面，不能为<code>WEB-INF</code>中的，重定向相当于再发一次请求，用户不能直接访问<code>WEB-INF</code>中资源。<ul>
<li><code>redirect</code>：地址栏URL改变。</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 转发</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/login.do"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">login</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 关于这里的斜杠，应该是代表根目录，如果同处根目录下，就可以不用斜杠？</span>
        <span class="token keyword">return</span> <span class="token string">"forward:/index.do"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// forward在跳转后可以取到message值</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/index.do"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">index</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"welcome"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// 重定向</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/logout.do"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">logout</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"redirect:/register.do"</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// redirect在跳转后无法取到message值</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/register.do"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> String <span class="token function">register</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">"register"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li><p>返回<code>ModelAndView</code>时的请求转发</p>
<ul>
<li>默认：<ul>
<li><code>return new ModelAndView(&quot;other&quot;);</code></li>
</ul>
</li>
<li>显式指出<ul>
<li>请求转发到页面，此时视图不会与视图解析器中的前辍与后辍拼接，必须写出相对于项目根的路径：<ul>
<li><code>return new ModelAndView(&quot;forward:/WEB-INF/jsp/show.jsp&quot;);</code></li>
</ul>
</li>
<li>请求转发到其它Controller：<ul>
<li><code>return new ModelAndView(&quot;forward:other.do&quot;);</code></li>
</ul>
</li>
</ul>
</li>
<li>请求转发向下传递数据，除了<code>request</code>，<code>session</code>外，还可存放于<code>ModelAndView</code>的<code>Model</code>中，页面通过EL表达式访问。</li>
</ul>
</li>
<li><p>返回<code>ModelAndView</code>时的重定向</p>
<ul>
<li>重定向到页面，视图不会与前辍与后辍拼接，必须写出相对于项目根的路径：<ul>
<li><code>return new ModelAndView(&quot;redirect:/show.jsp&quot;);</code></li>
</ul>
</li>
<li>重定向到其它Controller：<ul>
<li><code>return new ModelAndView(&quot;redirect:other.do&quot;);</code></li>
</ul>
</li>
<li>重定向的目标资源中，无法访问用户<code>request</code>中的数据，可以通过<code>ModelAndView</code>的<code>Model</code>携带参数。<ul>
<li>将<code>map</code>中的<code>key-value</code>，以请求参数的形式放到请求的<code>URL</code>后。</li>
<li>放入到<code>Model</code>中的<code>value</code>，只能是基本类型与<code>String</code>。</li>
<li><code>map</code>中的<code>key-value</code>以请求参数的形式放到了请求<code>URL</code>后，可以通过EL表达式中的请求参数<code>param</code>读取。</li>
</ul>
</li>
</ul>
</li>
<li><p>返回<code>String</code>时的请求转发</p>
<ul>
<li>同样不会进行前辍与后辍的拼接。<ul>
<li><code>return &quot;forward:/index.do&quot;;</code></li>
</ul>
</li>
<li>此时不能用<code>ModelAndView</code>传递数据，因为<code>ModelAndView</code>对象是局部变量，方法结束变量销毁。</li>
<li>当处理器接收到请求参数后，发现接收参数的处理器方法形参为包装类对象，除了会将参数封装为对象传递给形参外，还会存放到<code>request</code>域中。</li>
</ul>
</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/logout.do"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">logout</span><span class="token punctuation">(</span>Person person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 对象已存入request域</span>
    <span class="token keyword">return</span> <span class="token string">"redirect:/register.do"</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span></code></pre>
<ul>
<li><p>返回<code>String</code>时的重定向</p>
<ul>
<li><code>return &quot;redirect:/register.do&quot;;</code></li>
<li>重定向时，向下传递参数值<ul>
<li>重定向到页面<ul>
<li>请求<code>URL</code></li>
<li><code>HttpSession</code></li>
<li><code>Model</code>形参<ul>
<li>该方式同样也是将参数拼接到了重定向请求的<code>URL</code>后，只能是基本类型数据。</li>
</ul>
</li>
<li><code>RedirectAttributes</code>形参的<code>addAttribute()</code><ul>
<li>需要注册MVC注解驱动。</li>
<li>该方式同样也是将参数拼接到了重定向请求的<code>URL</code>后，只能是基本类型数据。</li>
</ul>
</li>
</ul>
</li>
<li>重定向到Controller<ul>
<li>请求<code>URL</code>后携带</li>
<li><code>HttpSession</code></li>
<li><code>Model</code>形参</li>
<li><code>RedirectAttributes</code>形参的<code>addAttibute()</code></li>
<li><code>RedirectAttributes</code>形参的<code>addFlushAttibute()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>返回<code>void</code>时的请求转发</p>
<ul>
<li><code>request.getRequestDispatcher(&quot;目标页面&quot;).forward(request, response);</code>。</li>
<li>向下一级传递数据<ul>
<li>将数据放到<code>request</code>或<code>session</code>中。</li>
<li>不能放到<code>Model</code>、<code>RedirectAttributes</code>中，因为它们的数据都是通过拼接到处理器方法的返回值中，作为请求的一部分向下传递，没有返回值，便无法向下传递了。</li>
</ul>
</li>
</ul>
</li>
<li><p>返回<code>void</code>时的重定向</p>
<ul>
<li><code>response.sendRedirect(&quot;目标页面&quot;);</code>。</li>
<li>若有数据向下一级传递，将数据放到<code>session</code>中。</li>
</ul>
</li>
</ul>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


        <footer>
             
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

        </footer>
    </div>
    <!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
    <script>
        var timeEnd = new Date();
        console.log('耗时：' + (timeEnd - timeStart));
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre').forEach((block) => {
                block.classList.add("line-numbers");
            });
        });
    </script>
    <!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
    <!-- material design -->
    <!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
    <!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
    <!-- toc -->
    <!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
    <!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
    <!-- <script src="/js/main.js"></script> -->
    <script src="/js/prism.js"></script>
</body>
</html>
