<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		
		<title>[笔记]-SpringMVC-数据类型转换与绑定 | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="用手记笔记，用心记笔记，用脑记笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-SpringMVC-数据类型转换与绑定"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">
		<script>var timeStart = new Date();</script>
		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		
		
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>首页
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>存档
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-SpringMVC-数据类型转换与绑定</h2>
				
				<div>
					<span class="post-time">2017-11-25 10:24</span>
				</div>	
				
				<div class="article-content">
				<p>接收页面提交的数据是通过方法形参来接收的。<br>客户端请求的key/value数据，经过参数绑定，将key/value数据绑定到controller方法的形参上，就可以在controller中使用该参数了。</p>
<p>简单类型：<code>@RequestParam</code>对简单类型的参数进行绑定。不使用<code>@RequestParam</code>，要求request传入参数名和controller方法的形参名一致。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input <span class="class"><span class="keyword">type</span></span>=<span class="string">"text"</span> name=<span class="string">"age"</span>/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</div><div class="line"><span class="keyword">public</span> <span class="function">String <span class="title">logout</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>表单提交的无论是 int 还是 double 类型的请求参数，处理器方法的形参，均可直接接收，不用接收到 String 再手工转换。<br>在 SpringMVC 框架中，有默认的类型转换器将 String 类型的数据，自动转换为相应类型的数据。<br>如果不能转换为需要的类型，要自定义类型转换器。<br>若要使表单中提交的日期字符串，被处理器方法形参直接接收为 java.util.Date，需要自定义类型转换器。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input <span class="class"><span class="keyword">type</span></span>=<span class="string">"text"</span> name=<span class="string">"birthday"</span>/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</div><div class="line"><span class="keyword">public</span> <span class="function">String <span class="title">logout</span><span class="params">(Date birthday)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实现 Converter 接口，两个泛型：第一个为待转换的类型，第二个为目标类型</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> <span class="function">Date <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</div><div class="line"></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (source != <span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(source.trim())) &#123;</div><div class="line">				SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</div><div class="line">				<span class="function"><span class="keyword">return</span> sdf.<span class="title">parse</span><span class="params">(source)</span></span>;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (ParseException e) &#123;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 注册 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myConverter"</span> <span class="attr">class</span>=<span class="string">"mmp.MyConverter"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 转换服务 Bean 来调用类型转换器 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ConversionServiceFactoryBean"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"myConverter"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </div><div class="line"><span class="comment">&lt;!-- 使用转换服务 Bean --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"conversionService"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>POJO绑定：页面中input的name和Controller的POJO形参中的属性名称一致(不是和POJO形参的名称一致)，将页面中数据绑定到POJO。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"price"</span> value=<span class="string">"$&#123;itemsCustom.price&#125;"</span>/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Items</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Integer id;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Float price;</div><div class="line">	<span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于Controller形参中POJO对象，如果属性中有日期类型，需要自定义参数绑定。</p>
<p>包装类型POJO：POJO中有另一个也是POJO的属性，即POJO套POJO。<br>这对后期程序的扩展很有用，复杂的查询条件就需要包装到这种包装类型中。</p>
<p>参数绑定：</p>
<ul>
<li>在形参中添加HttpServletRequest request参数，通过request接收。</li>
<li>在形参中让包装类型的POJO接收。</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="selector-tag">input</span> name=<span class="string">"itemsCustom.name"</span>/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemsQueryVo</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Items items;</div><div class="line">	<span class="comment">// ItemsQueryVo.itemsCustom和页面参数中一致</span></div><div class="line">	<span class="keyword">private</span> ItemsCustom itemsCustom;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 形参传入包装类型的POJO</span></div><div class="line"><span class="keyword">public</span> ModelAndView queryItems(ItemsQueryVo itemsQueryVo) <span class="keyword">throws</span> Exception</div></pre></td></tr></table></figure>
<p>数组绑定：前台传来多个同一类型的数据，Controller中使用数组形参接收。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;c:forEach items="$&#123;itemsList&#125;" var="item"&gt;</div><div class="line">	&lt;tr&gt;</div><div class="line">		&lt;td&gt;&lt;input type="checkbox" name="items_id" value="$&#123;item.id&#125;"/&gt;&lt;/td&gt;</div><div class="line">		&lt;td&gt;$&#123;item.name &#125;&lt;/td&gt;</div><div class="line">		&lt;td&gt;$&#123;item.price &#125;&lt;/td&gt;</div><div class="line">		&lt;td&gt;&lt;fmt:formatDate value="$&#123;item.createtime&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;&lt;/td&gt;</div><div class="line">		&lt;td&gt;&lt;a href="$&#123;pageContext.request.contextPath&#125;/items/editItems.action?id=$&#123;item.id&#125;"&gt;修改&lt;/a&gt;&lt;/td&gt;</div><div class="line">	&lt;/tr&gt;</div><div class="line">&lt;/c:forEach&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 批量删除商品信息</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/deleteItems"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deleteItems</span><span class="params">(Integer[] items_id)</span> <span class="keyword">throws</span> Exception</span></div></pre></td></tr></table></figure>
<p>List绑定：在需要批量提交数据时，将提交的数据绑定到List<pojo>中，如：录入多门课成绩，批量提交。</pojo></p>
<p>批量商品修改，在页面输入多个商品信息，将多个商品信息提交到Controller方法中，一次性更新多个商品信息。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;c:forEach items="$&#123;itemsList&#125;" var="item" varStatus="status"&gt;</div><div class="line">	&lt;tr&gt;</div><div class="line">		&lt;td&gt;&lt;input name="itemsList[$&#123;status.index&#125;].name" value="$&#123;item.name&#125;"/&gt;&lt;/td&gt;</div><div class="line">		&lt;td&gt;&lt;input name="itemsList[$&#123;status.index&#125;].price" value="$&#123;item.price&#125;"/&gt;&lt;/td&gt;</div><div class="line">		&lt;td&gt;&lt;input name="itemsList[$&#123;status.index&#125;].createtime" value="&lt;fmt:formatDate value="$&#123;item.createtime&#125;" pattern="yyyy-MM-dd HH:mm:ss"/&gt;"/&gt;&lt;/td&gt;</div><div class="line">	&lt;/tr&gt;</div><div class="line">&lt;/c:forEach&gt;</div></pre></td></tr></table></figure>
<p>name的格式对应包装POJO中的 List类型属性名[下标].包装POJO中List类型的属性中POJO的属性名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemsQueryVo</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Items items;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> ItemsCustom itemsCustom;</div><div class="line">	<span class="comment">// 接收页面提交的批量数据</span></div><div class="line">	<span class="keyword">private</span> List&lt;ItemsCustom&gt; itemsList;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 通过ItemsQueryVo接收批量提交的商品信息，将商品信息存储到itemsQueryVo中itemsList属性中</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/editItemsAllSubmit"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">editItemsAllSubmit</span><span class="params">(ItemsQueryVo itemsQueryVo)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Map绑定：通过在包装POJO中定义Map类型属性。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">&lt;tr&gt;</span></div><div class="line">	<span class="symbol">&lt;td&gt;</span></div><div class="line">		姓名：&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"itemInfo['name']"</span>/&gt;</div><div class="line">		年龄：&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"itemInfo['price']"</span>/&gt;</div><div class="line">	&lt;/td&gt;</div><div class="line">&lt;/<span class="keyword">tr</span>&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">QueryVo</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Map&lt;String, Object&gt; itemInfo = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">	<span class="comment">// 在包装类中定义Map对象，并添加getter/setter方法</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">userAddSubmit</span><span class="params">(QueryVo queryVo)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>数据回显：提交后，如果出现错误，将刚才提交的数据回显到刚才的提交页面。</p>
<p>POJO数据回显：POJO数据传入Controller方法后，自动将POJO数据放到request域，key等于POJO类型（首字母小写）。</p>
<p><code>@ModelAttribute</code>指定POJO回显到页面在request中的key。</p>
<p><code>@ModelAttribute</code>还可以将方法的返回值传到页面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// itemtypes表示最终将方法返回值放在request中的key</span></div><div class="line"><span class="meta">@ModelAttribute</span>(<span class="string">"itemtypes"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getItemTypes</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">	Map&lt;String, String&gt; itemTypes = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</div><div class="line">	itemTypes.put(<span class="string">"101"</span>, <span class="string">"数码"</span>);</div><div class="line">	itemTypes.put(<span class="string">"102"</span>, <span class="string">"母婴"</span>);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> itemTypes;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"itemtype"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$</span></span><span class="template-variable">&#123;itemtypes&#125;</span><span class="xml"><span class="tag"><span class="string">"</span> <span class="attr">var</span>=<span class="string">"itemtype"</span>&gt;</span></span></div><div class="line">			<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$</span></span><span class="template-variable">&#123;itemtype.key&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>$</span><span class="template-variable">&#123;itemtype.value&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></div><div class="line">		<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div></pre></td></tr></table></figure>
<p>直接使用model将提交POJO回显到页面，不用<code>@ModelAttribute</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">model.addAttribute(<span class="string">"items"</span>, itemsCustom);</div></pre></td></tr></table></figure>
<p>当数据类型转换发生异常后，返回到表单页面，让用户重写。<br>但正常情况下，发生类型转换异常（TypeMismatchException），系统会自动跳转到 400 页面。<br>若要在发生类型转换异常后，跳转到指定页面，需要捕获异常，然后通过异常处理器跳转到指定页面。<br>若仅仅是跳转，SimpleMappingExceptionResolver 就可以。<br>如果当页面返回到表单页面后，还将用户原来填写的数据显示出来，让用户更正填错的数据，需要自定义异常处理器。<br>数据回显原理：在异常处理器中，通过 request.getParameter()获取用户输入的表单原始数据，放入到 ModelAndView 中的 Model 中，然后从要转向的页面中直接通过 EL 表达式读取出，实现数据回显。<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@RequestMapping(<span class="meta-string">"/test"</span>)</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</div><div class="line">	<span class="meta">@RequestMapping(value = <span class="meta-string">"/register.do"</span>)</span></div><div class="line">	<span class="keyword">public</span> String register(int age, Date birthday) &#123;</div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"age = "</span> + age);</div><div class="line">		System.<span class="keyword">out</span>.println(<span class="string">"birthday = "</span> + birthday);</div><div class="line">		<span class="keyword">return</span> <span class="string">"/WEB-INF/jsp/show.jsp"</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@ExceptionHandler(TypeMismatchException.class)</span></div><div class="line">	<span class="keyword">public</span> ModelAndView exceptionResolver(Exception ex, HttpServletRequest request) &#123;</div><div class="line">		ModelAndView mv = new ModelAndView();</div><div class="line">		mv.addObject(<span class="string">"ex"</span>, ex);</div><div class="line">		String age = request.getParameter(<span class="string">"age"</span>);</div><div class="line">		String birthday = request.getParameter(<span class="string">"birthday"</span>);</div><div class="line">		mv.addObject(<span class="string">"age"</span>, age);</div><div class="line">		mv.addObject(<span class="string">"birthday"</span>, birthday);</div><div class="line">		mv.setViewName(<span class="string">"/index.jsp"</span>);</div><div class="line">		<span class="keyword">return</span> mv;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以上只能解决年龄有误，日期正确的回显问题。<br>若日期有误，年龄正确时，无法实现回现。<br>当日期有误时，SimpleDateFormat.parse()方法抛出 ParseException，非 TypeMismatchException。<br>让异常处理器再捕获 ParseException 完成跳转？<br>实现的自定义类型转换器的 convert()方法不能抛出异常，对异常的处理必须为 try-catch。<br>当 ParseException 发生时，convert()方法自己处理了异常，JVM 不知道有异常发生。<br>异常处理器也就无法捕获到 ParseException 了。<br>解决：当日期格式不符合要求时，手动一个类型匹配异常。<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> SimpleDateFormat getSimpleDateFormat(<span class="keyword">String</span> source) &#123;</div><div class="line">	SimpleDateFormat sdf = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>();</div><div class="line">	<span class="keyword">if</span> (Pattern.matches(<span class="string">"^\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;$"</span>, source)) &#123;</div><div class="line">		sdf = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">"yyyy-MM-dd"</span>);</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Pattern.matches(<span class="string">"^\\d&#123;4&#125;/\\d&#123;2&#125;/\\d&#123;2&#125;$"</span>, source)) &#123;</div><div class="line">		sdf = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">"yyyy/MM/dd"</span>);</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (Pattern.matches(<span class="string">"^\\d&#123;4&#125;\\d&#123;2&#125;\\d&#123;2&#125;$"</span>, source)) &#123;</div><div class="line">		sdf = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">"yyyyMMdd"</span>);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="comment">// 抛出</span></div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">TypeMismatchException</span>(<span class="string">""</span>, Date.class);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> sdf;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>TypeMismatchException 类没有无参构造器。<br>第一个参数为要匹配的值，第二个参数为要匹配的类型。<br>即当第一个参数的类型与第二参数的类型没有 is-a 关系时，该异常发生。<br>本例中要判断的值确定为 String 类型，而目标类型确定为 Date 类型，第一个参数就写了个 String 常量。</p>
<p>可以从系统提示信息中查找用户输入数据，确定哪个数据出现了类型转换异常。<br>使用 String 类的 contains()方法判断系统异常信息中是否存在用户输入数据。<br>一旦出问题的数据被确定，异常信息就可以进行准确替换了</p>
<p>在处理器中定义一个方法，根据发生类型转换异常的数据的不同而生成不同提示信息。<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">String</span> changeExceptionMessage(Exception ex, <span class="keyword">String</span> arg, <span class="keyword">String</span> paramName) &#123;</div><div class="line">	<span class="keyword">String</span> exMsg = ex.getMessage();</div><div class="line">	<span class="keyword">if</span> (exMsg.contains(arg)) &#123;</div><div class="line">		<span class="keyword">String</span> <span class="keyword">new</span><span class="type">Msg</span> = paramName + <span class="string">"【"</span> + arg + <span class="string">"】 填写有误，请重新填写"</span>;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span><span class="type">Msg</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在异常处理方法中将新生成的异常信息写入到 ModelAndView 中的 Model，页面通过 EL 表达式显示。<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@ExceptionHandler(TypeMismatchException.class)</div><div class="line">public ModelAndView exceptionResolver(Exception ex, HttpServletRequest request) &#123;</div><div class="line">	ModelAndView mv = new ModelAndView()<span class="comment">;</span></div><div class="line">	String age = request.getParameter(<span class="string">"age"</span>)<span class="comment">;</span></div><div class="line">	String <span class="keyword">birthday </span>= request.getParameter(<span class="string">"birthday"</span>)<span class="comment">;</span></div><div class="line"></div><div class="line">	String ageMsg = changeExceptionMessage(ex, age, <span class="string">"年龄"</span>)<span class="comment">;</span></div><div class="line">	mv.<span class="keyword">addObject("age", </span>age)<span class="comment">;</span></div><div class="line">	mv.<span class="keyword">addObject("ageMsg", </span>ageMsg)<span class="comment">;</span></div><div class="line"></div><div class="line">	String <span class="keyword">birthdayMsg </span>= changeExceptionMessage(ex, <span class="keyword">birthday, </span><span class="string">"生日"</span>)<span class="comment">;</span></div><div class="line">	mv.<span class="keyword">addObject("birthday", </span><span class="keyword">birthday);</span></div><div class="line">	mv.<span class="keyword">addObject("birthdayMsg", </span><span class="keyword">birthdayMsg);</span></div><div class="line">	mv.setViewName(<span class="string">"/index.jsp"</span>)<span class="comment">;</span></div><div class="line"></div><div class="line">	return mv<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>@InitBinder 标签对表单数据绑定</p>
<p>SpringMVC中，bean中定义了Date，Integer、Double等类型，如果没做处理，无法绑定到控制器。<br>先注册编辑器，控制器继承该控制器类。<br>Spring提供了实现类，如CustomDateEditor，CustomBooleanEditor，CustomNumberEditor等，也可以自己构造。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyDateEditor</span> <span class="keyword">extends</span> <span class="title">PropertyEditorSupport</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public void setAsText(<span class="type">String</span> text) <span class="keyword">throws</span> <span class="type">IllegalArgumentException</span> &#123;</div><div class="line">		<span class="type">SimpleDateFormat</span> sdf = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">		<span class="type">Date</span> date = <span class="literal">null</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			date = sdf.parse(text);</div><div class="line">		&#125; <span class="keyword">catch</span> (<span class="type">ParseException</span> e) &#123;</div><div class="line">			sdf = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">"yyyy-MM-dd"</span>);</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				date = sdf.parse(text);</div><div class="line">			&#125; <span class="keyword">catch</span> (<span class="type">ParseException</span> e1) &#123;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		setValue(date);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">DoubleEditor</span> <span class="keyword">extends</span> <span class="title">PropertiesEditor</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public void setAsText(<span class="type">String</span> text) <span class="keyword">throws</span> <span class="type">IllegalArgumentException</span> &#123;</div><div class="line">		<span class="keyword">if</span> (text == <span class="literal">null</span> || text.equals(<span class="string">""</span>)) &#123;</div><div class="line">			text = <span class="string">"0"</span>;</div><div class="line">		&#125;</div><div class="line">		setValue(<span class="type">Double</span>.parseDouble(text));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public <span class="type">String</span> getAsText() &#123;</div><div class="line">		<span class="keyword">return</span> getValue().toString();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">IntegerEditor</span> <span class="keyword">extends</span> <span class="title">PropertiesEditor</span> </span>&#123;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">FloatEditor</span> <span class="keyword">extends</span> <span class="title">PropertiesEditor</span> </span>&#123;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LongEditor</span> <span class="keyword">extends</span> <span class="title">PropertiesEditor</span> </span>&#123;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>BaseController<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@<span class="function">InitBinder</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initBinder</span><span class="params">(WebDataBinder binder)</span> &#123;</div><div class="line">	SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">	binder.registerCustomEditor(Date.<span class="keyword">class</span>, <span class="keyword">new</span> CustomDateEditor(sdf, <span class="literal">true</span>));</div><div class="line">	binder.registerCustomEditor(<span class="keyword">int</span>.<span class="keyword">class</span>, <span class="keyword">new</span> CustomNumberEditor(<span class="keyword">int</span>.<span class="keyword">class</span>, <span class="literal">true</span>));</div><div class="line">	binder.registerCustomEditor(<span class="keyword">int</span>.<span class="keyword">class</span>, <span class="keyword">new</span> IntegerEditor());</div><div class="line">	binder.registerCustomEditor(<span class="keyword">long</span>.<span class="keyword">class</span>, <span class="keyword">new</span> CustomNumberEditor(<span class="keyword">long</span>.<span class="keyword">class</span>, <span class="literal">true</span>));</div><div class="line">	binder.registerCustomEditor(<span class="keyword">long</span>.<span class="keyword">class</span>, <span class="keyword">new</span> LongEditor());</div><div class="line">	binder.registerCustomEditor(<span class="keyword">double</span>.<span class="keyword">class</span>, <span class="keyword">new</span> DoubleEditor());</div><div class="line">	binder.registerCustomEditor(<span class="keyword">float</span>.<span class="keyword">class</span>, <span class="keyword">new</span> FloatEditor());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 解析器注册 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageConverters"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"stringHttpMessageConverter"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- String类型解析器，允许直接返回String类型的消息 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"stringHttpMessageConverter"</span> </span></div><div class="line">	<span class="attr">class</span>=<span class="string">"org.springframework.http.converter.StringHttpMessageConverter"</span>/&gt;</div></pre></td></tr></table></figure>
<p>这样就可以直接将上传的日期时间字符串绑定为日期类型的数据了</p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			
<p>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https://github.com/wayou/hexo-theme-material">Material</a> theme modified by <b> Huangzhike </b></p>
<p>&copy; 2017 <a href="https://huangzhike.github.io"><b> Huangzhike </b></a></p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
