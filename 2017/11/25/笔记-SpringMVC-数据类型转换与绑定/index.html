<!DOCTYPE HTML>
<html>

<head>
    <script>
        var timeStart = new Date();
    </script>
    <meta charset="utf-8">
    
    <title>[笔记]-SpringMVC-数据类型转换与绑定 | Reunion...</title>
    
    <meta name="author" content="huangzhike">
    
    
    <meta name="description"
        content="1-1重新整理
页面提交的数据通过Controller方法形参来接收。
简单类型：@RequestParam绑定简单类型的参数。不使用@RequestParam要求request传入参数名和Controller方法的形参名一致。
&amp;lt;input type=&#34;text&#34; name=&#34;num&#34;/&gt;
">
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta property="og:title" content="[笔记]-SpringMVC-数据类型转换与绑定" />
    
    <meta property="og:site_name" content="Reunion..." />
    
    
    <!-- favicon -->
    <link rel="icon" type="image/ico" href="/logo.ico" sizes="32x32">
    <meta name="msapplication-TileColor" content="#009688">
    <meta name="msapplication-TileImage" content="/mstile-144x144.ico">
    <meta name="theme-color" content="#009688">
    <!-- favicon end -->
    <!-- <link href="//ok.ico" rel="icon"> -->
    

    <!-- <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">

<meta name="generator" content="Hexo 4.2.1"></head>
<body>
    <nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" title="早く来い、クラウド" href="/">Reunion...</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" target="_blank" rel="noopener" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

    <div class="container" >
        <div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-SpringMVC-数据类型转换与绑定</h2>
				
				<div>
					<div class="post-time">2017-11-25</div>
				</div>
				
				<div class="article-content">
				<p><strong>1-1重新整理</strong></p>
<p>页面提交的数据通过Controller方法形参来接收。</p>
<p>简单类型：<code>@RequestParam</code>绑定简单类型的参数。不使用<code>@RequestParam</code>要求request传入参数名和Controller方法的形参名一致。</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>num<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>
<pre><code>```java</code></pre><p>@RequestMapping(“/“)<br>public String what(int num) {}</p>
<pre><code>
数组绑定：同一类型的数据，Controller中使用数组形参接收。

```jsp
&lt;!-- 假设批量操作 --&gt;
&lt;c:forEach items=&quot;${itemsList}&quot; var=&quot;item&quot;&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;items_id&quot; value=&quot;${item.id}&quot;/&gt;&lt;/td&gt;
        &lt;td&gt;${item.name}&lt;/td&gt;
        &lt;td&gt;${item.price}&lt;/td&gt;
    &lt;/tr&gt;
&lt;/c:forEach&gt;</code></pre><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/editItems"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">editItems</span><span class="token punctuation">(</span>Integer<span class="token punctuation">[</span><span class="token punctuation">]</span> items_id<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>POJO绑定</p>
<pre class=" language-jsp"><code class="language-jsp"><!-- input的name和Controller的POJO形参中的属性名称一致(不是和POJO形参的名称一致)，将页面中数据绑定到POJO -->
<input type="text" name="id" value="${itemsCustom.id}"/></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Items</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Integer id<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Controller形参中的POJO对象，如果属性中有日期类型，需要自定义参数绑定</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p>包装类型POJO：POJO中有属性也是POJO，即POJO套POJO，方便扩展。</p>
<ul>
<li>在形参中添加HttpServletRequest request参数，通过request接收。</li>
<li>在形参中让包装类型的POJO接收。</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemsCustom.name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemsQueryVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Items items<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// ItemsQueryVo.itemsCustom和页面参数中一致</span>
    <span class="token keyword">private</span> ItemsCustom itemsCustom<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 形参传入包装类型的POJO</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/queryItems"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> ModelAndView <span class="token function">queryItems</span><span class="token punctuation">(</span>ItemsQueryVo itemsQueryVo<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>List绑定：将批量提交的数据绑定到List<POJO>中，如：录入多门课成绩。</p>
<pre class=" language-jsp"><code class="language-jsp"><c:forEach items="${itemsList}" var="item" varStatus="status">
    <tr>
        <!-- name对应ItemsQueryVo的 List类型属性名[下标].该属性中POJO的属性名 -->
        <td><input name="itemsList[${status.index}].name" value="${item.name}"/></td>
        <td><input name="itemsList[${status.index}].price" value="${item.price}"/></td>
        <td><input name="itemsList[${status.index}].createtime" value='<fmt:formatDate value="${item.createtime}" pattern="yyyy-MM-dd HH:mm:ss"/>'/></td>
    </tr>
</c:forEach></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemsQueryVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Items items<span class="token punctuation">;</span>
    <span class="token keyword">private</span> ItemsCustom itemsCustom<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 接收页面提交的批量数据</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>ItemsCustom<span class="token operator">></span> itemsList<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 通过ItemsQueryVo接收批量提交的商品信息，商品信息存储到itemsQueryVo中itemsList属性中</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/editItemsAllSubmit"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">editItemsAllSubmit</span><span class="token punctuation">(</span>ItemsQueryVo itemsQueryVo<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>Map绑定</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemInfo[<span class="token punctuation">'</span>name<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>itemInfo[<span class="token punctuation">'</span>price<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>
<pre class=" language-java"><code class="language-java">Public <span class="token keyword">class</span> <span class="token class-name">QueryVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> itemInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 在包装POJO类中定义Map属性，并添加getter/setter</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/userAddSubmit"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">userAddSubmit</span><span class="token punctuation">(</span>QueryVo queryVo<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>表单提交的请求参数，处理器方法的形参可直接接收，不用接收到String再手工转换。</p>
<p>SpringMVC有默认的类型转换器，如果不能转换，要自定义类型转换器。</p>
<p>要使表单中提交的日期，被处理器方法形参直接接收为<code>java.util.Date</code>，需要自定义类型转换器。</p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>birthday<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> String <span class="token function">what</span><span class="token punctuation">(</span>Date birthday<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 实现 Converter 接口，两个泛型：第一个为待转换的类型，第二个为目标类型</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDateConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Date<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Date <span class="token function">convert</span><span class="token punctuation">(</span>String source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                SimpleDateFormat sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 注册 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>myConverter<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xxx.MyDateConverter<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 转换服务 Bean 来调用类型转换器 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>conversionService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>org.springframework.context.support.ConversionServiceFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>converters<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>myConverter<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token comment" spellcheck="true">&lt;!-- &lt;bean class="xxx.MyDateConverter"/> --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 转换服务Bean是由处理器适配器调用的，将转换服务直接注入给处理器适配器 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span> <span class="token attr-name">conversion-service</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>conversionService<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>
<p>也可以用<code>@InitBinder</code>绑定表单数据</p>
<ul>
<li>Spring提供了编辑器实现类，如<code>CustomDateEditor</code>，也可以自己构造编辑器（继承PropertiesEditor）再注册编辑器。</li>
<li>Controller继承BaseController，或者直接添加该方法。</li>
</ul>
<p>BaseController</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@InitBinder</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initBinder</span><span class="token punctuation">(</span>WebDataBinder binder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    SimpleDateFormat sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    binder<span class="token punctuation">.</span><span class="token function">registerCustomEditor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CustomDateEditor</span><span class="token punctuation">(</span>sdf<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<hr>
<p>看别人博客发现一个问题，以后要注意：</p>
<p>一个service，总是400，说request有问题，server不识别。</p>
<p>Controller中可以自定义参数，只要参数和request的参数匹配就会自动注入。</p>
<p>针对自定义POJO，显然是Spring帮忙给new了一个，然后把参数扔进去。</p>
<p>测试不是setter方法的问题。</p>
<p>在POJO中添加了构造函数却没有声明无参构造，导致Spring无法调用无参构造函数，于是bad request就产生了？</p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


        <footer>
             
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

        </footer>
    </div>
    <!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
    <!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
    <script>
        var timeEnd = new Date();
        console.log('耗时：' + (timeEnd - timeStart));
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre').forEach((block) => {
                block.classList.add("line-numbers");
            });
        });
    </script>

    <script src="/js/prism.js"></script>
</body>
</html>
