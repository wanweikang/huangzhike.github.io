<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
				<script>var timeStart = new Date();</script>
		
		<title>[笔记]-MVC | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="没有鸡汤，只有笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-MVC"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-MVC</h2>
				
				<div>
					<span class="post-time">2017-11-06 15:34:17</span>
				</div>	
				
				<div class="article-content">
				<p>MVC（Model-View-Controller）</p>
<ul>
<li>Model（模型）：数据模型，包含数据和行为，可以认为是领域模型(domain)或JavaBean组件（包含数据和行为），现在一般分离开来：Value Object（数据） 和 服务层（行为）。模型提供了模型数据查询和状态更新等。<ul>
<li>数据承载 Bean ：实体类，如 Student、User 等。</li>
<li>业务处理 Bean ： Service 或 Dao 对象，处理用户提交请求。</li>
</ul>
</li>
<li>View（视图）：负责模型的展示，一般是用户界面。</li>
<li>Controller（控制器）：接收用户请求，委托给Model处理（状态改变），处理完毕后把返回的Model数据返回给视图，由View负责展示。调度工作。</li>
</ul>
<p>用户通过 View 页面向服务端提出请求，可以是表单请求、超链接请求、AJAX 请求等<br>服务端 Controller 控制器接收到请求后解析请求，找到相应的 Model 处理用户请求<br>Model 处理后，将处理结果再交给 Controller<br>Controller 接到处理结果后，根据处理结果响应 View 页面。页面经渲染（数据填充）后发送给客户端</p>
<p>一般都是Web客户端发起请求，Web服务器响应。<br>一般Web服务器不能主动通知Web客户端。虽然服务器推（如Comet）、HTML5 websocket可以实现主动通知Web客户端。</p>
<p>标准的MVC中模型能主动推数据给视图进行更新（观察者设计模式，在模型上注册视图，模型更新时自动更新视图），但在Web开发中模型无法主动推给视图（无法主动更新用户界面），因为请求-响应模型。</p>
<ul>
<li>域模型层<ul>
<li>mmp.domain：存放JavaBean类(只包含简单的属性以及属性对应的get和set方法，不包含具体的业务处理方法)，提供给数据访问层、业务处理层、Web层</li>
</ul>
</li>
<li>数据访问层<ul>
<li>mmp.dao：访问数据库的操作接口类</li>
<li>mmp.dao.impl：问数据库的操作接口的实现类</li>
</ul>
</li>
<li>业务处理层<ul>
<li>mmp.service：处理系统业务接口类</li>
<li>mmp.service.impl：处理系统业务接口的实现类</li>
</ul>
</li>
<li>Web层(表现层)<ul>
<li>mmp.web.controller：系统控制器的Servlet    </li>
<li>mmp.web.UI：用户界面的Servlet</li>
<li>mmp.web.filter：过滤器</li>
<li>mmp.web.listener：监听器</li>
</ul>
</li>
<li>mmp.util：通用工具类，提供给数据访问层、业务处理层、Web层</li>
<li>junit.test：测试类     </li>
</ul>
<p>一个良好的JavaWeb项目架构应该具有以上的11个包，搭建JavaWeb项目架构时，按照顺序创建包。</p>
<p>src目录(类目录)下面，创建用于保存用户数据的xml文件(DB.xml)</p>
<p>WEB-INF目录下创建pages目录，存放不允许直接通过URL访问的jsp页面，只能通过mmp.web.UI包的Servlet</p>
<p><strong>开发domain层</strong><br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.domain;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Serializable</span></span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> final long serialVersionUID = <span class="number">-4313782718477229465</span>L;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> id;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> userName;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> userPwd;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> email;</div><div class="line">	<span class="keyword">private</span> Date birthday;</div><div class="line">	<span class="comment">// getter... setter...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>开发数据访问层(dao、dao.impl)</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.dao;</div><div class="line"><span class="comment">// 接口类，字母I作类的前缀，表示接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</div><div class="line">	<span class="comment">// 据用户名和密码来查找用户</span></div><div class="line">	<span class="function">User <span class="title">find</span><span class="params">(String userName, String userPwd)</span></span>;</div><div class="line">	<span class="comment">// 添加用户</span></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(User user)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>多么复杂的业务，都离不开基本的CRUD(增删改查)操作，Dao层直接和数据库交互，一般都有增删改查方法。<br>实现类完成的只是数据库核心的操作，并没有专门处理数据库的打开和关闭，因为与具体的业务操作无关。<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">package mmp.dao.impl;</div><div class="line"><span class="comment">// 接口的具体实现类，"接口名(去除前缀I)+impl"或"接口名+impl"</span></div><div class="line"><span class="comment">// IUserDao接口的实现类</span></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">IUserDao</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public User find(<span class="built_in">String</span> userName, <span class="built_in">String</span> userPwd) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Document <span class="built_in">document</span> = XmlUtils.getDocument();</div><div class="line">			<span class="comment">// 使用XPath表达式来操作XML节点</span></div><div class="line">			<span class="built_in">Element</span> e = (<span class="built_in">Element</span>) <span class="built_in">document</span></div><div class="line">					.selectSingleNode(<span class="string">"//user[@userName='"</span> + userName + <span class="string">"' and @userPwd='"</span> + userPwd + <span class="string">"']"</span>);</div><div class="line">			<span class="keyword">if</span> (e == <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">			&#125;</div><div class="line">			User user = <span class="keyword">new</span> User();</div><div class="line">			user.setId(e.attributeValue(<span class="string">"id"</span>));</div><div class="line">			user.setEmail(e.attributeValue(<span class="string">"email"</span>));</div><div class="line">			user.setUserPwd(e.attributeValue(<span class="string">"userPwd"</span>));</div><div class="line">			user.setUserName(e.attributeValue(<span class="string">"userName"</span>));</div><div class="line">			<span class="built_in">String</span> birth = e.attributeValue(<span class="string">"birthday"</span>);</div><div class="line">			SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</div><div class="line">			user.setBirthday(sdf.parse(birth));</div><div class="line">			<span class="keyword">return</span> user;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"deprecation"</span>)</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	public <span class="keyword">void</span> add(User user) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			Document <span class="built_in">document</span> = XmlUtils.getDocument();</div><div class="line">			<span class="built_in">Element</span> root = <span class="built_in">document</span>.getRootElement();</div><div class="line">			<span class="built_in">Element</span> user_node = root.addElement(<span class="string">"user"</span>); <span class="comment">// 创建user结点，并挂到root</span></div><div class="line">			user_node.setAttributeValue(<span class="string">"id"</span>, user.getId());</div><div class="line">			user_node.setAttributeValue(<span class="string">"userName"</span>, user.getUserName());</div><div class="line">			user_node.setAttributeValue(<span class="string">"userPwd"</span>, user.getUserPwd());</div><div class="line">			user_node.setAttributeValue(<span class="string">"email"</span>, user.getEmail());</div><div class="line">			SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);</div><div class="line">			user_node.setAttributeValue(<span class="string">"birthday"</span>, sdf.format(user.getBirthday()));</div><div class="line">			XmlUtils.write2Xml(<span class="built_in">document</span>);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>开发service层</strong>(service层对web层提供所有的业务服务)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.service;</div><div class="line"><span class="comment">// 接口类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserService</span> </span>&#123;</div><div class="line">	<span class="comment">// 注册服务</span></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">registerUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> UserExistException</span>;</div><div class="line">	<span class="comment">// 登录服务</span></div><div class="line">	<span class="function">User <span class="title">loginUser</span><span class="params">(String userName, String userPwd)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.service.impl;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">IUserService</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> IUserDao userDao = <span class="keyword">new</span> UserDaoImpl();</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">registerUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> UserExistException </span>&#123;</div><div class="line">		<span class="keyword">if</span> (userDao.find(user.getUserName()) != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="comment">// 想上一层程序处理这个异常，以给用户一个友好提示</span></div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> UserExistException(<span class="string">"注册的用户名已存在！！！"</span>);</div><div class="line">		&#125;</div><div class="line">		userDao.add(user);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> <span class="function">User <span class="title">loginUser</span><span class="params">(String userName, String userPwd)</span> </span>&#123;</div><div class="line">		<span class="function"><span class="keyword">return</span> userDao.<span class="title">find</span><span class="params">(userName, userPwd)</span></span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>开发web层</strong></p>
<p>RegisterUIServlet为用户提供注册界面，收到用户请求后，跳到register.jsp<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.web.<span class="type">UI</span>;</div><div class="line"><span class="comment">// 为用户提供注册的用户界面的Servlet，访问RegisterUIServlet时，就跳转到WEB-INF/pages目录下的register.jsp</span></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">RegisterUIServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">	public void doGet(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response) </div><div class="line">			<span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</div><div class="line">		request.getRequestDispatcher(<span class="string">"/WEB-INF/pages/register.jsp"</span>).forward(request, response);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// 略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>mmp.web.controller包下编写用于处理用户注册的RegisterServlet<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.web.formbean;</div><div class="line"><span class="comment">// 封装的用户注册表单bean，接收register.jsp中的表单输入项的值</span></div><div class="line"><span class="keyword">public</span> class RegisterFormBean &#123;</div><div class="line">	<span class="comment">// RegisterFormBean中的属性与register.jsp中的表单输入项的name一一对应</span></div><div class="line">	<span class="comment">// &lt;input type="text" name="userName"/&gt;</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> userName;</div><div class="line">	<span class="comment">// &lt;input type="password" name="userPwd"/&gt;</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> userPwd;</div><div class="line">	<span class="comment">// &lt;input type="password" name="confirmPwd"/&gt;</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> confirmPwd;</div><div class="line">	<span class="comment">// &lt;input type="text" name="email"/&gt;</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> email;</div><div class="line">	<span class="comment">// &lt;input type="text" name="birthday"/&gt;</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">String</span> birthday;</div><div class="line">	<span class="comment">// 存储校验不通过时给用户的错误提示信息</span></div><div class="line">	<span class="keyword">private</span> Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; errors = <span class="keyword">new</span> <span class="keyword">HashMap</span>&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;();</div><div class="line">	<span class="keyword">public</span> Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; getErrors() &#123;</div><div class="line">		<span class="keyword">return</span> errors;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> setErrors(Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; errors) &#123;</div><div class="line">		<span class="keyword">this</span>.errors = errors;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// validate方法负责校验表单输入项</span></div><div class="line">	<span class="keyword">public</span> <span class="built_in">boolean</span> validate() &#123;</div><div class="line">		<span class="built_in">boolean</span> isOk = <span class="keyword">true</span>;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.userName == <span class="keyword">null</span> || <span class="keyword">this</span>.userNatrim().equals(<span class="string">""</span>)) &#123;</div><div class="line">			isOk = <span class="keyword">false</span>;</div><div class="line">			errors.put(<span class="string">"userName"</span>, <span class="string">"用户名不能为空！！"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (!<span class="keyword">this</span>.userNamatches(<span class="string">"[a-zA-Z]&#123;3,8&#125;"</span>)) &#123;</div><div class="line">				isOk = <span class="keyword">false</span>;</div><div class="line">				errors.put(<span class="string">"userName"</span>, <span class="string">"用户名必须是3-8位的字母！！"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.userPwd == <span class="keyword">null</span> || <span class="keyword">this</span>.userPwd.<span class="built_in">trim</span>().equals(<span class="string">""</span>)) &#123;</div><div class="line">			isOk = <span class="keyword">false</span>;</div><div class="line">			errors.put(<span class="string">"userPwd"</span>, <span class="string">"密码不能为空！！"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (!<span class="keyword">this</span>.userPwd.matches(<span class="string">"\\d&#123;3,8&#125;"</span>)) &#123;</div><div class="line">				isOk = <span class="keyword">false</span>;</div><div class="line">				errors.put(<span class="string">"userPwd"</span>, <span class="string">"密码必须是3-8位的数字！！"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// private String password2; 两次密码要一致</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.confirmPwd != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (!<span class="keyword">this</span>.confirmPwd.equals(<span class="keyword">this</span>.userPwd)) &#123;</div><div class="line">				isOk = <span class="keyword">false</span>;</div><div class="line">				errors.put(<span class="string">"confirmPwd"</span>, <span class="string">"两次密码不一致！！"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// private String email; 可以为空，不为空要是一个合法的邮箱</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.email != <span class="keyword">null</span> &amp;&amp; !<span class="keyword">this</span>.email.<span class="built_in">trim</span>().equals(<span class="string">""</span>)) &#123;</div><div class="line">			<span class="keyword">if</span> (!<span class="keyword">this</span>.email.matches(<span class="string">"\\w+@\\w+(\\.\\w+)+"</span>)) &#123;</div><div class="line">				isOk = <span class="keyword">false</span>;</div><div class="line">				errors.put(<span class="string">"email"</span>, <span class="string">"邮箱不是一个合法邮箱！！"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// private String birthday; 可以为空，不为空时，要是一个合法的日期</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.birthday != <span class="keyword">null</span> &amp;&amp; !<span class="keyword">this</span>.birthday.<span class="built_in">trim</span>().equals(<span class="string">""</span>)) &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				DateLocaleConverter conver = <span class="keyword">new</span> DateLocaleConverter();</div><div class="line">				conver.convert(<span class="keyword">this</span>.birthday);</div><div class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">				isOk = <span class="keyword">false</span>;</div><div class="line">				errors.put(<span class="string">"birthday"</span>, <span class="string">"生日必须要是一个日期！！"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> isOk;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// getter... setter...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>mmp.util包下创建一个WebUtils工具类，封装客户端提交的表单数据到formbean<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.util;</div><div class="line"><span class="comment">// 把request对象中的请求参数封装到bean中</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebUtils</span> </span>&#123;</div><div class="line">	<span class="comment">// 将request对象转换成T对象</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T request2Bean(HttpServletRequest request, Class&lt;T&gt; clazz) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			T bean = clazz.<span class="keyword">new</span><span class="type">Instance</span>();</div><div class="line">			Enumeration&lt;<span class="keyword">String</span>&gt; e = request.getParameterNames();</div><div class="line">			<span class="keyword">while</span> (e.hasMoreElements()) &#123;</div><div class="line">				<span class="keyword">String</span> name = (<span class="keyword">String</span>) e.nextElement();</div><div class="line">				<span class="keyword">String</span> value = request.getParameter(name);</div><div class="line">				BeanUtils.setProperty(bean, name, value);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> bean;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span>(e);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 生成UUID</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> makeId() &#123;</div><div class="line">		<span class="keyword">return</span> UUID.randomUUID().toString();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.web.controller;</div><div class="line"><span class="comment">// 处理用户注册的Servlet</span></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">RegisterServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">	public void doGet(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response) <span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</div><div class="line">		<span class="comment">// 将客户端提交的表单数据封装到RegisterFormBean对象中</span></div><div class="line">		<span class="type">RegisterFormBean</span> formbean = <span class="type">WebUtils</span>.request2Bean(request, <span class="type">RegisterFormBean</span>.<span class="keyword">class</span>);</div><div class="line">		<span class="comment">// 校验用户注册填写的表单数据</span></div><div class="line">		<span class="keyword">if</span> (formbean.validate() == <span class="literal">false</span>) &#123;<span class="comment">// 如果校验失败</span></div><div class="line">			<span class="comment">// 将封装了用户填写的表单数据的formbean对象发送回register.jsp页面的form表单中进行显示</span></div><div class="line">			request.setAttribute(<span class="string">"formbean"</span>, formbean);</div><div class="line">			<span class="comment">// 校验失败就说明是用户填写的表单数据有问题，那么就跳转回register.jsp</span></div><div class="line">			request.getRequestDispatcher(<span class="string">"/WEB-INF/pages/register.jsp"</span>).forward(request, response);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="type">User</span> user = <span class="keyword">new</span> <span class="type">User</span>();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">// 注册字符串到日期的转换器</span></div><div class="line">			<span class="type">ConvertUtils</span>.register(<span class="keyword">new</span> <span class="type">DateLocaleConverter</span>(), <span class="type">Date</span>.<span class="keyword">class</span>);</div><div class="line">			<span class="type">BeanUtils</span>.copyProperties(user, formbean); <span class="comment">// 把表单的数据填充到javabean中</span></div><div class="line">			user.setId(<span class="type">WebUtils</span>.makeId()); <span class="comment">// 设置用户的Id属性</span></div><div class="line">			<span class="type">IUserService</span> service = <span class="keyword">new</span> <span class="type">UserServiceImpl</span>();</div><div class="line">			<span class="comment">// 调用service层提供的注册用户服务实现用户注册</span></div><div class="line">			service.registerUser(user);</div><div class="line">			<span class="type">String</span> message = <span class="type">String</span>.format(<span class="string">"注册成功！！3秒后为您自动跳到登录页面！！&lt;meta http-equiv='refresh' content='3;url=%s'/&gt;"</span>,</div><div class="line">					request.getContextPath() + <span class="string">"/servlet/LoginUIServlet"</span>);</div><div class="line">			request.setAttribute(<span class="string">"message"</span>, message);</div><div class="line">			request.getRequestDispatcher(<span class="string">"/message.jsp"</span>).forward(request, response);</div><div class="line">		&#125; <span class="keyword">catch</span> (<span class="type">UserExistException</span> e) &#123;</div><div class="line">			formbean.getErrors().put(<span class="string">"userName"</span>, <span class="string">"注册用户已存在！！"</span>);</div><div class="line">			request.setAttribute(<span class="string">"formbean"</span>, formbean);</div><div class="line">			request.getRequestDispatcher(<span class="string">"/WEB-INF/pages/register.jsp"</span>).forward(request, response);</div><div class="line">		&#125; <span class="keyword">catch</span> (<span class="type">Exception</span> e) &#123;</div><div class="line">			e.printStackTrace(); <span class="comment">// 在后台记录异常</span></div><div class="line">			request.setAttribute(<span class="string">"message"</span>, <span class="string">"对不起，注册失败！！"</span>);</div><div class="line">			request.getRequestDispatcher(<span class="string">"/message.jsp"</span>).forward(request, response);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>用户注册时如果填写的表单数据校验不通过，服务器端就将一个存储了错误提示消息和表单数据的formbean对象存储到request对象中，然后发送回register.jsp页面，因此在register.jsp页面中取出request对象中formbean对象，然后将用户填写的表单数据重新回显到对应的表单项上面，将出错时的提示消息也显示到form表单上。</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="comment">&lt;!-- http://localhost:8080/MVC/servlet/RegisterUIServlet访问register.jsp页面 --&gt;</span></span></div><div class="line"><span class="comment">&lt;!-- register.jsp --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"text-align: center;"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$</span></span><span class="template-variable">&#123;pageContext.request.contextPath&#125;</span><span class="xml"><span class="tag"><span class="string">/servlet/RegisterServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></div><div class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"60%"</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">%--提取存储在request对象中的formbean对象中的表单数据(formbean.userName)以及错误提示消息(formbean.errors.userName)--%</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userName"</span> <span class="attr">value</span>=<span class="string">"$</span></span><span class="template-variable">&#123;formbean.userName&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span>$</span><span class="template-variable">&#123;formbean.errors.userName&#125;</span><span class="xml"></span></div><div class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>登录<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.web.<span class="type">UI</span>;</div><div class="line"><span class="comment">// 访问LoginUIServlet时，就跳转到WEB-INF/pages目录下的login.jsp页面</span></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LoginUIServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">	public void doGet(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response)</div><div class="line">			<span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</div><div class="line">		request.getRequestDispatcher(<span class="string">"/WEB-INF/pages/login.jsp"</span>).forward(request, response);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="comment">&lt;!-- http://localhost:8080/MVC/servlet/LoginUIServlet访问login.jsp页面 --&gt;</span></span></div><div class="line"><span class="comment">&lt;!-- /WEB-INF/pages/login.jsp --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$</span></span><span class="template-variable">&#123;pageContext.request.contextPath &#125;</span><span class="xml"><span class="tag"><span class="string">/servlet/LoginServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登陆"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.web.controller;</div><div class="line"><span class="comment">// 处理用户登录的servlet</span></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line">	public void doGet(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response) </div><div class="line">			<span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</div><div class="line">		<span class="type">String</span> username = request.getParameter(<span class="string">"username"</span>);</div><div class="line">		<span class="type">String</span> password = request.getParameter(<span class="string">"password"</span>);</div><div class="line">		<span class="type">IUserService</span> service = <span class="keyword">new</span> <span class="type">UserServiceImpl</span>();</div><div class="line">		<span class="type">User</span> user = service.loginUser(username, password);</div><div class="line">		<span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</div><div class="line">			<span class="type">String</span> message = <span class="type">String</span>.format(</div><div class="line">					<span class="string">"对不起，用户名或密码有误！！请重新登录！2秒后为您自动跳到登录页面！！&lt;meta http-equiv='refresh' content='2;url=%s'"</span>,</div><div class="line">					request.getContextPath() + <span class="string">"/servlet/LoginUIServlet"</span>);</div><div class="line">			request.setAttribute(<span class="string">"message"</span>, message);</div><div class="line">			request.getRequestDispatcher(<span class="string">"/message.jsp"</span>).forward(request, response);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 登录成功后，就将用户存储到session中</span></div><div class="line">		request.getSession().setAttribute(<span class="string">"user"</span>, user);</div><div class="line">		<span class="type">String</span> message = <span class="type">String</span>.format(<span class="string">"恭喜：%s,登陆成功！本页将在3秒后跳到首页！！&lt;meta http-equiv='refresh' content='3;url=%s'"</span>,</div><div class="line">				user.getUserName(), request.getContextPath() + <span class="string">"/index.jsp"</span>);</div><div class="line">		request.setAttribute(<span class="string">"message"</span>, message);</div><div class="line">		request.getRequestDispatcher(<span class="string">"/message.jsp"</span>).forward(request, response);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注销<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> mmp.web.controller;</div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LogoutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">	public void doGet(<span class="type">HttpServletRequest</span> request, <span class="type">HttpServletResponse</span> response) </div><div class="line">			<span class="keyword">throws</span> <span class="type">ServletException</span>, <span class="type">IOException</span> &#123;</div><div class="line">		<span class="comment">// 移除存储在session中的user对象，实现注销功能</span></div><div class="line">		request.getSession().removeAttribute(<span class="string">"user"</span>);</div><div class="line">		<span class="comment">// 字符串中有单引号，MessageFormat.format只是把单引号去掉，不会将内容填充到指定的占位符中</span></div><div class="line">		<span class="comment">// 解决方法：使用单引号引起来的字符串中使用2个单引号引起来</span></div><div class="line">		<span class="type">String</span> tempStr = <span class="type">MessageFormat</span>.format(</div><div class="line">				<span class="string">"注销成功！！3秒后为您自动跳到登录页面！！&lt;meta http-equiv=''refresh'' content=''3;url=&#123;0&#125;''/&gt;"</span>,</div><div class="line">				request.getContextPath() + <span class="string">"/servlet/LoginUIServlet"</span>);</div><div class="line">		<span class="type">String</span> message = <span class="type">String</span>.format(<span class="string">"注销成功！！3秒后为您自动跳到登录页面！！&lt;meta http-equiv='refresh' content='3;url=%s'/&gt;"</span>,</div><div class="line">				request.getContextPath() + <span class="string">"/servlet/LoginUIServlet"</span>);</div><div class="line">		request.setAttribute(<span class="string">"message"</span>, message);</div><div class="line">		request.getRequestDispatcher(<span class="string">"/message.jsp"</span>).forward(request, response);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>用户登录成功后，将登录的用户信息存储在session，将存储在session中的user删除，实现用户注销。<br>用户登录成功后跳转到index.jsp页面，点击退出登陆按钮时，访问LogoutServlet，将用户注销。<br><figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">%-</span></span></span><span class="ruby">-index.jsp -</span><span class="xml"><span class="tag"><span class="attr">-</span>%&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">%</span></span><span class="ruby">@ page language=<span class="string">"java"</span>  pageEncoding=<span class="string">"UTF-8"</span></span><span class="xml"><span class="tag">%&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">%</span></span><span class="ruby">@ taglib uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> prefix=<span class="string">"c"</span></span><span class="xml"><span class="tag">%&gt;</span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">doLogout</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				<span class="comment">// 访问LogoutServlet注销当前登录的用户</span></div><div class="line">				<span class="built_in">window</span>.location.href=<span class="string">"$&#123;pageContext.request.contextPath&#125;/servlet/LogoutServlet"</span>;</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;user==null&#125;"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/servlet/RegisterUIServlet"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/servlet/LoginUIServlet"</span>&gt;</span>登陆<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;user!=null&#125;"</span>&gt;</span></div><div class="line">			欢迎您：$&#123;user.userName&#125;</div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"退出登陆"</span> <span class="attr">onclick</span>=<span class="string">"doLogout()"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
