<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-MVC | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-MVC">
		
		<meta property="og:site_name" content="一个放笔记的地方而已">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-MVC</h2>
				
				<div>
					<div class="post-time">2017-11-06</div>
				</div>
				
				<div class="article-content">
				<p>MVC（Model-View-Controller）</p>
<ul>
<li>Model（模型）：数据模型，包含数据和行为，可以认为是领域模型(domain)或JavaBean组件（包含数据和行为），现在一般分离开来：Value Object（数据） 和 服务层（行为）。模型提供了模型数据查询和状态更新等。<ul>
<li>数据承载 Bean ：实体类，如 Student、User 等。</li>
<li>业务处理 Bean ： Service 或 Dao 对象，处理用户提交请求。</li>
</ul>
</li>
<li>View（视图）：负责模型的展示，一般是用户界面。</li>
<li>Controller（控制器）：接收用户请求，委托给Model处理（状态改变），处理完毕后把返回的Model数据返回给视图，由View负责展示。调度工作。</li>
</ul>
<p>用户通过 View 页面向服务端提出请求，可以是表单请求、超链接请求、AJAX 请求等<br>服务端 Controller 控制器接收到请求后解析请求，找到相应的 Model 处理用户请求<br>Model 处理后，将处理结果再交给 Controller<br>Controller 接到处理结果后，根据处理结果响应 View 页面。页面经渲染（数据填充）后发送给客户端</p>
<p>一般都是Web客户端发起请求，Web服务器响应。<br>一般Web服务器不能主动通知Web客户端。虽然服务器推（如Comet）、HTML5 websocket可以实现主动通知Web客户端。</p>
<p>标准的MVC中模型能主动推数据给视图进行更新（观察者设计模式，在模型上注册视图，模型更新时自动更新视图），但在Web开发中模型无法主动推给视图（无法主动更新用户界面），因为请求-响应模型。</p>
<ul>
<li>域模型层<ul>
<li>mmp.domain：存放JavaBean类(只包含简单的属性以及属性对应的get和set方法，不包含具体的业务处理方法)，提供给数据访问层、业务处理层、Web层</li>
</ul>
</li>
<li>数据访问层<ul>
<li>mmp.dao：访问数据库的操作接口类</li>
<li>mmp.dao.impl：问数据库的操作接口的实现类</li>
</ul>
</li>
<li>业务处理层<ul>
<li>mmp.service：处理系统业务接口类</li>
<li>mmp.service.impl：处理系统业务接口的实现类</li>
</ul>
</li>
<li>Web层(表现层)<ul>
<li>mmp.web.controller：系统控制器的Servlet    </li>
<li>mmp.web.UI：用户界面的Servlet</li>
<li>mmp.web.filter：过滤器</li>
<li>mmp.web.listener：监听器</li>
</ul>
</li>
<li>mmp.util：通用工具类，提供给数据访问层、业务处理层、Web层</li>
<li>junit.test：测试类     </li>
</ul>
<p>一个良好的JavaWeb项目架构应该具有以上的11个包，搭建JavaWeb项目架构时，按照顺序创建包。</p>
<p>src目录(类目录)下面，创建用于保存用户数据的xml文件(DB.xml)</p>
<p>WEB-INF目录下创建pages目录，存放不允许直接通过URL访问的jsp页面，只能通过mmp.web.UI包的Servlet</p>
<p><strong>开发domain层</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package mmp.domain;</span><br><span class="line"></span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">	private static final long serialVersionUID = -4313782718477229465L;</span><br><span class="line">	private String id;</span><br><span class="line">	private String userName;</span><br><span class="line">	private String userPwd;</span><br><span class="line">	private String email;</span><br><span class="line">	private Date birthday;</span><br><span class="line">	// getter... setter...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>开发数据访问层(dao、dao.impl)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package mmp.dao;</span><br><span class="line">// 接口类，字母I作类的前缀，表示接口</span><br><span class="line">public interface IUserDao &#123;</span><br><span class="line">	// 据用户名和密码来查找用户</span><br><span class="line">	User find(String userName, String userPwd);</span><br><span class="line">	// 添加用户</span><br><span class="line">	void add(User user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>多么复杂的业务，都离不开基本的CRUD(增删改查)操作，Dao层直接和数据库交互，一般都有增删改查方法。<br>实现类完成的只是数据库核心的操作，并没有专门处理数据库的打开和关闭，因为与具体的业务操作无关。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package mmp.dao.impl;</span><br><span class="line">// 接口的具体实现类，&quot;接口名(去除前缀I)+impl&quot;或&quot;接口名+impl&quot;</span><br><span class="line">// IUserDao接口的实现类</span><br><span class="line">public class UserDaoImpl implements IUserDao &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public User find(String userName, String userPwd) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			Document document = XmlUtils.getDocument();</span><br><span class="line">			// 使用XPath表达式来操作XML节点</span><br><span class="line">			Element e = (Element) document</span><br><span class="line">					.selectSingleNode(&quot;//user[@userName=&apos;&quot; + userName + &quot;&apos; and @userPwd=&apos;&quot; + userPwd + &quot;&apos;]&quot;);</span><br><span class="line">			if (e == null) &#123;</span><br><span class="line">				return null;</span><br><span class="line">			&#125;</span><br><span class="line">			User user = new User();</span><br><span class="line">			user.setId(e.attributeValue(&quot;id&quot;));</span><br><span class="line">			user.setEmail(e.attributeValue(&quot;email&quot;));</span><br><span class="line">			user.setUserPwd(e.attributeValue(&quot;userPwd&quot;));</span><br><span class="line">			user.setUserName(e.attributeValue(&quot;userName&quot;));</span><br><span class="line">			String birth = e.attributeValue(&quot;birthday&quot;);</span><br><span class="line">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">			user.setBirthday(sdf.parse(birth));</span><br><span class="line">			return user;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			throw new RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@SuppressWarnings(&quot;deprecation&quot;)</span><br><span class="line">	@Override</span><br><span class="line">	public void add(User user) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			Document document = XmlUtils.getDocument();</span><br><span class="line">			Element root = document.getRootElement();</span><br><span class="line">			Element user_node = root.addElement(&quot;user&quot;); // 创建user结点，并挂到root</span><br><span class="line">			user_node.setAttributeValue(&quot;id&quot;, user.getId());</span><br><span class="line">			user_node.setAttributeValue(&quot;userName&quot;, user.getUserName());</span><br><span class="line">			user_node.setAttributeValue(&quot;userPwd&quot;, user.getUserPwd());</span><br><span class="line">			user_node.setAttributeValue(&quot;email&quot;, user.getEmail());</span><br><span class="line">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">			user_node.setAttributeValue(&quot;birthday&quot;, sdf.format(user.getBirthday()));</span><br><span class="line">			XmlUtils.write2Xml(document);</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			throw new RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>开发service层</strong>(service层对web层提供所有的业务服务)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package mmp.service;</span><br><span class="line">// 接口类</span><br><span class="line">public interface IUserService &#123;</span><br><span class="line">	// 注册服务</span><br><span class="line">	void registerUser(User user) throws UserExistException;</span><br><span class="line">	// 登录服务</span><br><span class="line">	User loginUser(String userName, String userPwd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package mmp.service.impl;</span><br><span class="line"></span><br><span class="line">public class UserServiceImpl implements IUserService &#123;</span><br><span class="line"></span><br><span class="line">	private IUserDao userDao = new UserDaoImpl();</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void registerUser(User user) throws UserExistException &#123;</span><br><span class="line">		if (userDao.find(user.getUserName()) != null) &#123;</span><br><span class="line">			// 想上一层程序处理这个异常，以给用户一个友好提示</span><br><span class="line">			throw new UserExistException(&quot;注册的用户名已存在！！！&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		userDao.add(user);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public User loginUser(String userName, String userPwd) &#123;</span><br><span class="line">		return userDao.find(userName, userPwd);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>开发web层</strong></p>
<p>RegisterUIServlet为用户提供注册界面，收到用户请求后，跳到register.jsp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package mmp.web.UI;</span><br><span class="line">// 为用户提供注册的用户界面的Servlet，访问RegisterUIServlet时，就跳转到WEB-INF/pages目录下的register.jsp</span><br><span class="line">public class RegisterUIServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">	public void doGet(HttpServletRequest request, HttpServletResponse response) </span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		request.getRequestDispatcher(&quot;/WEB-INF/pages/register.jsp&quot;).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mmp.web.controller包下编写用于处理用户注册的RegisterServlet<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">package mmp.web.formbean;</span><br><span class="line">// 封装的用户注册表单bean，接收register.jsp中的表单输入项的值</span><br><span class="line">public class RegisterFormBean &#123;</span><br><span class="line">	// RegisterFormBean中的属性与register.jsp中的表单输入项的name一一对应</span><br><span class="line">	// &lt;input type=&quot;text&quot; name=&quot;userName&quot;/&gt;</span><br><span class="line">	private String userName;</span><br><span class="line">	// &lt;input type=&quot;password&quot; name=&quot;userPwd&quot;/&gt;</span><br><span class="line">	private String userPwd;</span><br><span class="line">	// &lt;input type=&quot;password&quot; name=&quot;confirmPwd&quot;/&gt;</span><br><span class="line">	private String confirmPwd;</span><br><span class="line">	// &lt;input type=&quot;text&quot; name=&quot;email&quot;/&gt;</span><br><span class="line">	private String email;</span><br><span class="line">	// &lt;input type=&quot;text&quot; name=&quot;birthday&quot;/&gt;</span><br><span class="line">	private String birthday;</span><br><span class="line">	// 存储校验不通过时给用户的错误提示信息</span><br><span class="line">	private Map&lt;String, String&gt; errors = new HashMap&lt;String, String&gt;();</span><br><span class="line">	public Map&lt;String, String&gt; getErrors() &#123;</span><br><span class="line">		return errors;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setErrors(Map&lt;String, String&gt; errors) &#123;</span><br><span class="line">		this.errors = errors;</span><br><span class="line">	&#125;</span><br><span class="line">	// validate方法负责校验表单输入项</span><br><span class="line">	public boolean validate() &#123;</span><br><span class="line">		boolean isOk = true;</span><br><span class="line">		if (this.userName == null || this.userNatrim().equals(&quot;&quot;)) &#123;</span><br><span class="line">			isOk = false;</span><br><span class="line">			errors.put(&quot;userName&quot;, &quot;用户名不能为空！！&quot;);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			if (!this.userNamatches(&quot;[a-zA-Z]&#123;3,8&#125;&quot;)) &#123;</span><br><span class="line">				isOk = false;</span><br><span class="line">				errors.put(&quot;userName&quot;, &quot;用户名必须是3-8位的字母！！&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		if (this.userPwd == null || this.userPwd.trim().equals(&quot;&quot;)) &#123;</span><br><span class="line">			isOk = false;</span><br><span class="line">			errors.put(&quot;userPwd&quot;, &quot;密码不能为空！！&quot;);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			if (!this.userPwd.matches(&quot;\\d&#123;3,8&#125;&quot;)) &#123;</span><br><span class="line">				isOk = false;</span><br><span class="line">				errors.put(&quot;userPwd&quot;, &quot;密码必须是3-8位的数字！！&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		// private String password2; 两次密码要一致</span><br><span class="line">		if (this.confirmPwd != null) &#123;</span><br><span class="line">			if (!this.confirmPwd.equals(this.userPwd)) &#123;</span><br><span class="line">				isOk = false;</span><br><span class="line">				errors.put(&quot;confirmPwd&quot;, &quot;两次密码不一致！！&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		// private String email; 可以为空，不为空要是一个合法的邮箱</span><br><span class="line">		if (this.email != null &amp;&amp; !this.email.trim().equals(&quot;&quot;)) &#123;</span><br><span class="line">			if (!this.email.matches(&quot;\\w+@\\w+(\\.\\w+)+&quot;)) &#123;</span><br><span class="line">				isOk = false;</span><br><span class="line">				errors.put(&quot;email&quot;, &quot;邮箱不是一个合法邮箱！！&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		// private String birthday; 可以为空，不为空时，要是一个合法的日期</span><br><span class="line">		if (this.birthday != null &amp;&amp; !this.birthday.trim().equals(&quot;&quot;)) &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				DateLocaleConverter conver = new DateLocaleConverter();</span><br><span class="line">				conver.convert(this.birthday);</span><br><span class="line">			&#125; catch (Exception e) &#123;</span><br><span class="line">				isOk = false;</span><br><span class="line">				errors.put(&quot;birthday&quot;, &quot;生日必须要是一个日期！！&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return isOk;</span><br><span class="line">	&#125;</span><br><span class="line">	// getter... setter...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mmp.util包下创建一个WebUtils工具类，封装客户端提交的表单数据到formbean<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package mmp.util;</span><br><span class="line">// 把request对象中的请求参数封装到bean中</span><br><span class="line">public class WebUtils &#123;</span><br><span class="line">	// 将request对象转换成T对象</span><br><span class="line">	public static &lt;T&gt; T request2Bean(HttpServletRequest request, Class&lt;T&gt; clazz) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			T bean = clazz.newInstance();</span><br><span class="line">			Enumeration&lt;String&gt; e = request.getParameterNames();</span><br><span class="line">			while (e.hasMoreElements()) &#123;</span><br><span class="line">				String name = (String) e.nextElement();</span><br><span class="line">				String value = request.getParameter(name);</span><br><span class="line">				BeanUtils.setProperty(bean, name, value);</span><br><span class="line">			&#125;</span><br><span class="line">			return bean;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			throw new RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// 生成UUID</span><br><span class="line">	public static String makeId() &#123;</span><br><span class="line">		return UUID.randomUUID().toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package mmp.web.controller;</span><br><span class="line">// 处理用户注册的Servlet</span><br><span class="line">public class RegisterServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">	public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">		// 将客户端提交的表单数据封装到RegisterFormBean对象中</span><br><span class="line">		RegisterFormBean formbean = WebUtils.request2Bean(request, RegisterFormBean.class);</span><br><span class="line">		// 校验用户注册填写的表单数据</span><br><span class="line">		if (formbean.validate() == false) &#123;// 如果校验失败</span><br><span class="line">			// 将封装了用户填写的表单数据的formbean对象发送回register.jsp页面的form表单中进行显示</span><br><span class="line">			request.setAttribute(&quot;formbean&quot;, formbean);</span><br><span class="line">			// 校验失败就说明是用户填写的表单数据有问题，那么就跳转回register.jsp</span><br><span class="line">			request.getRequestDispatcher(&quot;/WEB-INF/pages/register.jsp&quot;).forward(request, response);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		User user = new User();</span><br><span class="line">		try &#123;</span><br><span class="line">			// 注册字符串到日期的转换器</span><br><span class="line">			ConvertUtils.register(new DateLocaleConverter(), Date.class);</span><br><span class="line">			BeanUtils.copyProperties(user, formbean); // 把表单的数据填充到javabean中</span><br><span class="line">			user.setId(WebUtils.makeId()); // 设置用户的Id属性</span><br><span class="line">			IUserService service = new UserServiceImpl();</span><br><span class="line">			// 调用service层提供的注册用户服务实现用户注册</span><br><span class="line">			service.registerUser(user);</span><br><span class="line">			String message = String.format(&quot;注册成功！！3秒后为您自动跳到登录页面！！&lt;meta http-equiv=&apos;refresh&apos; content=&apos;3;url=%s&apos;/&gt;&quot;,</span><br><span class="line">					request.getContextPath() + &quot;/servlet/LoginUIServlet&quot;);</span><br><span class="line">			request.setAttribute(&quot;message&quot;, message);</span><br><span class="line">			request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);</span><br><span class="line">		&#125; catch (UserExistException e) &#123;</span><br><span class="line">			formbean.getErrors().put(&quot;userName&quot;, &quot;注册用户已存在！！&quot;);</span><br><span class="line">			request.setAttribute(&quot;formbean&quot;, formbean);</span><br><span class="line">			request.getRequestDispatcher(&quot;/WEB-INF/pages/register.jsp&quot;).forward(request, response);</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace(); // 在后台记录异常</span><br><span class="line">			request.setAttribute(&quot;message&quot;, &quot;对不起，注册失败！！&quot;);</span><br><span class="line">			request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// 略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户注册时如果填写的表单数据校验不通过，服务器端就将一个存储了错误提示消息和表单数据的formbean对象存储到request对象中，然后发送回register.jsp页面，因此在register.jsp页面中取出request对象中formbean对象，然后将用户填写的表单数据重新回显到对应的表单项上面，将出错时的提示消息也显示到form表单上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- http://localhost:8080/MVC/servlet/RegisterUIServlet访问register.jsp页面 --&gt;</span><br><span class="line">&lt;!-- register.jsp --&gt;</span><br><span class="line">&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body style=&quot;text-align: center;&quot;&gt;</span><br><span class="line">		&lt;form action=&quot;$&#123;pageContext.request.contextPath&#125;/servlet/RegisterServlet&quot; method=&quot;post&quot;&gt;</span><br><span class="line">			&lt;table width=&quot;60%&quot; border=&quot;1&quot;&gt;</span><br><span class="line">				&lt;tr&gt;</span><br><span class="line">					&lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">					&lt;td&gt;</span><br><span class="line">						&lt;%--提取存储在request对象中的formbean对象中的表单数据(formbean.userName)以及错误提示消息(formbean.errors.userName)--%&gt;</span><br><span class="line">						&lt;input type=&quot;text&quot; name=&quot;userName&quot; value=&quot;$&#123;formbean.userName&#125;&quot;&gt;$&#123;formbean.errors.userName&#125;</span><br><span class="line">					&lt;/td&gt;</span><br><span class="line">				&lt;/tr&gt;</span><br><span class="line">			&lt;/table&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>登录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package mmp.web.UI;</span><br><span class="line">// 访问LoginUIServlet时，就跳转到WEB-INF/pages目录下的login.jsp页面</span><br><span class="line">public class LoginUIServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">	public void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		request.getRequestDispatcher(&quot;/WEB-INF/pages/login.jsp&quot;).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	// 略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- http://localhost:8080/MVC/servlet/LoginUIServlet访问login.jsp页面 --&gt;</span><br><span class="line">&lt;!-- /WEB-INF/pages/login.jsp --&gt;</span><br><span class="line">&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;&lt;/title&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;form action=&quot;$&#123;pageContext.request.contextPath &#125;/servlet/LoginServlet&quot; method=&quot;post&quot;&gt;</span><br><span class="line">			&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br/&gt;</span><br><span class="line">			&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br/&gt;</span><br><span class="line">			&lt;input type=&quot;submit&quot; value=&quot;登陆&quot;&gt;</span><br><span class="line">		&lt;/form&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package mmp.web.controller;</span><br><span class="line">// 处理用户登录的servlet</span><br><span class="line">public class LoginServlet extends HttpServlet &#123;</span><br><span class="line">	public void doGet(HttpServletRequest request, HttpServletResponse response) </span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		String username = request.getParameter(&quot;username&quot;);</span><br><span class="line">		String password = request.getParameter(&quot;password&quot;);</span><br><span class="line">		IUserService service = new UserServiceImpl();</span><br><span class="line">		User user = service.loginUser(username, password);</span><br><span class="line">		if (user == null) &#123;</span><br><span class="line">			String message = String.format(</span><br><span class="line">					&quot;对不起，用户名或密码有误！！请重新登录！2秒后为您自动跳到登录页面！！&lt;meta http-equiv=&apos;refresh&apos; content=&apos;2;url=%s&apos;&quot;,</span><br><span class="line">					request.getContextPath() + &quot;/servlet/LoginUIServlet&quot;);</span><br><span class="line">			request.setAttribute(&quot;message&quot;, message);</span><br><span class="line">			request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		// 登录成功后，就将用户存储到session中</span><br><span class="line">		request.getSession().setAttribute(&quot;user&quot;, user);</span><br><span class="line">		String message = String.format(&quot;恭喜：%s,登陆成功！本页将在3秒后跳到首页！！&lt;meta http-equiv=&apos;refresh&apos; content=&apos;3;url=%s&apos;&quot;,</span><br><span class="line">				user.getUserName(), request.getContextPath() + &quot;/index.jsp&quot;);</span><br><span class="line">		request.setAttribute(&quot;message&quot;, message);</span><br><span class="line">		request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	// 略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注销<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package mmp.web.controller;</span><br><span class="line"></span><br><span class="line">public class LogoutServlet extends HttpServlet &#123;</span><br><span class="line"></span><br><span class="line">	public void doGet(HttpServletRequest request, HttpServletResponse response) </span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		// 移除存储在session中的user对象，实现注销功能</span><br><span class="line">		request.getSession().removeAttribute(&quot;user&quot;);</span><br><span class="line">		// 字符串中有单引号，MessageFormat.format只是把单引号去掉，不会将内容填充到指定的占位符中</span><br><span class="line">		// 解决方法：使用单引号引起来的字符串中使用2个单引号引起来</span><br><span class="line">		String tempStr = MessageFormat.format(</span><br><span class="line">				&quot;注销成功！！3秒后为您自动跳到登录页面！！&lt;meta http-equiv=&apos;&apos;refresh&apos;&apos; content=&apos;&apos;3;url=&#123;0&#125;&apos;&apos;/&gt;&quot;,</span><br><span class="line">				request.getContextPath() + &quot;/servlet/LoginUIServlet&quot;);</span><br><span class="line">		String message = String.format(&quot;注销成功！！3秒后为您自动跳到登录页面！！&lt;meta http-equiv=&apos;refresh&apos; content=&apos;3;url=%s&apos;/&gt;&quot;,</span><br><span class="line">				request.getContextPath() + &quot;/servlet/LoginUIServlet&quot;);</span><br><span class="line">		request.setAttribute(&quot;message&quot;, message);</span><br><span class="line">		request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	// 略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>用户登录成功后，将登录的用户信息存储在session，将存储在session中的user删除，实现用户注销。<br>用户登录成功后跳转到index.jsp页面，点击退出登陆按钮时，访问LogoutServlet，将用户注销。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--index.jsp --%&gt;</span><br><span class="line">&lt;%@ page language=&quot;java&quot;  pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;&lt;/title&gt;</span><br><span class="line">		&lt;script&gt;</span><br><span class="line">			function doLogout()&#123;</span><br><span class="line">				// 访问LogoutServlet注销当前登录的用户</span><br><span class="line">				window.location.href=&quot;$&#123;pageContext.request.contextPath&#125;/servlet/LogoutServlet&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">		&lt;/script&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;c:if test=&quot;$&#123;user==null&#125;&quot;&gt;</span><br><span class="line">			&lt;a href=&quot;$&#123;pageContext.request.contextPath&#125;/servlet/RegisterUIServlet&quot; target=&quot;_blank&quot;&gt;注册&lt;/a&gt;</span><br><span class="line">			&lt;a href=&quot;$&#123;pageContext.request.contextPath&#125;/servlet/LoginUIServlet&quot;&gt;登陆&lt;/a&gt;</span><br><span class="line">		&lt;/c:if&gt;</span><br><span class="line">		&lt;c:if test=&quot;$&#123;user!=null&#125;&quot;&gt;</span><br><span class="line">			欢迎您：$&#123;user.userName&#125;</span><br><span class="line">			&lt;input type=&quot;button&quot; value=&quot;退出登陆&quot; onclick=&quot;doLogout()&quot;&gt;</span><br><span class="line">		&lt;/c:if&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
