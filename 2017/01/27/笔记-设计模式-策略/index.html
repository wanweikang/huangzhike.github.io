<!DOCTYPE HTML>
<html>
	<head><meta name="generator" content="Hexo 3.9.0">
		<meta charset="utf-8">
		<script src="/js/highlight.js"></script>
				<script>hljs.initHighlightingOnLoad();var timeStart = new Date();</script>
		
		<title>[笔记]-设计模式-策略 | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="K.I.S.S">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-设计模式-策略">
		
		<meta property="og:site_name" content="一个放笔记的地方而已">
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>
</html>
<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-设计模式-策略</h2>
				
				<div>
					<div class="post-time">2017-01-27</div>
				</div>
				
				<div class="article-content">
				<p>参考：<br>JavaScript设计模式与开发实践 曾探<br>深入理解JavaScript 汤姆大叔<br><strong>策略模式</strong></p>
<p>最初<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var calculateBonus = function(performanceLevel, salary) &#123;</span><br><span class="line">	if (performanceLevel === &apos;S&apos;) &#123;</span><br><span class="line">		return salary * 4;</span><br><span class="line">	&#125;</span><br><span class="line">	if (performanceLevel === &apos;A&apos;) &#123;</span><br><span class="line">		return salary * 3;</span><br><span class="line">	&#125;</span><br><span class="line">	if (performanceLevel === &apos;B&apos;) &#123;</span><br><span class="line">		return salary * 2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">calculateBonus(&apos;B&apos;, 20000); // 输出：40000</span><br><span class="line">calculateBonus(&apos;S&apos;, 6000); // 输出：24000</span><br></pre></td></tr></table></figure></p>
<p>传统面向对象语言的模仿<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">var performanceS = function() &#123;&#125;;</span><br><span class="line">performanceS.prototype.calculate = function(salary) &#123;</span><br><span class="line">	return salary * 4;</span><br><span class="line">&#125;;</span><br><span class="line">var performanceA = function() &#123;&#125;;</span><br><span class="line">performanceA.prototype.calculate = function(salary) &#123;</span><br><span class="line">	return salary * 3;</span><br><span class="line">&#125;;</span><br><span class="line">var performanceB = function() &#123;&#125;;</span><br><span class="line">performanceB.prototype.calculate = function(salary) &#123;</span><br><span class="line">	return salary * 2;</span><br><span class="line">&#125;;</span><br><span class="line">// 定义奖金类 Bonus</span><br><span class="line">var Bonus = function() &#123;</span><br><span class="line">	this.salary = null; // 原始工资</span><br><span class="line">	this.strategy = null; // 绩效等级对应的策略对象</span><br><span class="line">&#125;;</span><br><span class="line">Bonus.prototype.setSalary = function(salary) &#123;</span><br><span class="line">	this.salary = salary; // 设置员工的原始工资</span><br><span class="line">&#125;;</span><br><span class="line">Bonus.prototype.setStrategy = function(strategy) &#123;</span><br><span class="line">	this.strategy = strategy; // 设置员工绩效等级对应的策略对象</span><br><span class="line">&#125;;</span><br><span class="line">Bonus.prototype.getBonus = function() &#123; </span><br><span class="line">	// 取得奖金数额</span><br><span class="line">	return this.strategy.calculate(this.salary); // 把计算奖金的操作委托给对应的策略对象</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>JavaScript 版本的策略模式</p>
<p>在 JavaScript 语言中， 函数也是对象， 所以更简单和直接的做法是把 strategy直接定义为函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var strategies = &#123;</span><br><span class="line">	&quot;S&quot;: function(salary) &#123;</span><br><span class="line">		return salary * 4;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;A&quot;: function(salary) &#123;</span><br><span class="line">		return salary * 3;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;B&quot;: function(salary) &#123;</span><br><span class="line">		return salary * 2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var calculateBonus = function(level, salary) &#123;</span><br><span class="line">	return strategies[level](salary);</span><br><span class="line">&#125;;</span><br><span class="line">console.log(calculateBonus(&apos;S&apos;, 20000)); // 输出：80000</span><br><span class="line">console.log(calculateBonus(&apos;A&apos;, 10000)); // 输出：30000</span><br></pre></td></tr></table></figure>
<p>表单校验的第一个版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var registerForm = document.getElementById(&apos;registerForm&apos;);</span><br><span class="line">registerForm.onsubmit = function() &#123;</span><br><span class="line">	if (registerForm.userName.value === &apos;&apos;) &#123;</span><br><span class="line">		alert(&apos;用户名不能为空&apos;);</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	if (registerForm.password.value.length &lt; 6) &#123;</span><br><span class="line">		alert(&apos;密码长度不能少于 6 位&apos;);</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	if (!/(^1[3|5|8][0-9]&#123;9&#125;$)/.test(registerForm.phoneNumber.value)) &#123;</span><br><span class="line">		alert(&apos;手机号码格式不正确&apos;);</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用策略模式重构表单校验<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">/***********************策略对象**************************/</span><br><span class="line">var strategies = &#123;</span><br><span class="line">	isNonEmpty: function(value, errorMsg) &#123;</span><br><span class="line">		if (value === &apos;&apos;) &#123;</span><br><span class="line">			return errorMsg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	minLength: function(value, length, errorMsg) &#123;</span><br><span class="line">		if (value.length &lt; length) &#123;</span><br><span class="line">			return errorMsg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	isMobile: function(value, errorMsg) &#123;</span><br><span class="line">		if (!/(^1[3|5|8][0-9]&#123;9&#125;$)/.test(value)) &#123;</span><br><span class="line">			return errorMsg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">/***********************Validator 类**************************/</span><br><span class="line">var Validator = function() &#123;</span><br><span class="line">	this.cache = [];</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.add = function(dom, rules) &#123;</span><br><span class="line">	var self = this;</span><br><span class="line">	for (var i = 0, rule; rule = rules[i++];) &#123;</span><br><span class="line">		(function(rule) &#123;</span><br><span class="line">			var strategyAry = rule.strategy.split(&apos;:&apos;);</span><br><span class="line">			var errorMsg = rule.errorMsg;</span><br><span class="line">			self.cache.push(function() &#123;</span><br><span class="line">				var strategy = strategyAry.shift();</span><br><span class="line"></span><br><span class="line">				strategyAry.unshift(dom.value);</span><br><span class="line">				strategyAry.push(errorMsg);</span><br><span class="line">				return strategies[strategy].apply(dom, strategyAry);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;)(rule)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.start = function() &#123;</span><br><span class="line">	for (var i = 0, validatorFunc; validatorFunc = this.cache[i++];) &#123;</span><br><span class="line">		var errorMsg = validatorFunc();</span><br><span class="line">		if (errorMsg) &#123;</span><br><span class="line">			return errorMsg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">/***********************客户调用代码**************************/</span><br><span class="line">var registerForm = document.getElementById(&apos;registerForm&apos;);</span><br><span class="line">var validataFunc = function() &#123;</span><br><span class="line">	var validator = new Validator();</span><br><span class="line">	validator.add(registerForm.userName, [&#123;</span><br><span class="line">		strategy: &apos;isNonEmpty&apos;,</span><br><span class="line">		errorMsg: &apos;用户名不能为空&apos;</span><br><span class="line">	&#125;, &#123;</span><br><span class="line">		strategy: &apos;minLength:6&apos;,</span><br><span class="line">		errorMsg: &apos;用户名长度不能小于 10 位&apos;</span><br><span class="line">	&#125;]);</span><br><span class="line">	validator.add(registerForm.password, [&#123;</span><br><span class="line">		strategy: &apos;minLength:6&apos;,</span><br><span class="line">		errorMsg: &apos;密码长度不能小于 6 位&apos;</span><br><span class="line">	&#125;]);</span><br><span class="line">	validator.add(registerForm.phoneNumber, [&#123;</span><br><span class="line">		strategy: &apos;isMobile&apos;,</span><br><span class="line">		errorMsg: &apos;手机号码格式不正确&apos;</span><br><span class="line">	&#125;]);</span><br><span class="line">	var errorMsg = validator.start();</span><br><span class="line">	return errorMsg;</span><br><span class="line">&#125;;</span><br><span class="line">registerForm.onsubmit = function() &#123;</span><br><span class="line">	var errorMsg = validataFunc();</span><br><span class="line">	if (errorMsg) &#123;</span><br><span class="line">		alert(errorMsg);</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>策略模式利用组合、 委托和多态等技术和思想， 可以避免多重条件选择语句。<br>策略模式提供了对开放— 封闭原则的完美支持， 将算法封装在独立的 strategy 中， 使得它们易于切换， 易于理解， 易于扩展。<br>策略模式中的算法也可以复用在系统的其他地方， 从而避免许多重复的复制粘贴工作。<br>在策略模式中利用组合和委托来让 Context拥有执行算法的能力， 这也是继承的一种更轻便的替代方案。<br>当然， 策略模式也有一些缺点， 但这些缺点并不严重。<br>首先， 使用策略模式会在程序中增加许多策略类或者策略对象， 但实际上这比把它们负责的逻辑堆砌在 Context中要好。<br>其次， 要使用策略模式， 必须了解所有的 strategy， 必须了解各个 strategy 之间的不同点，此时 strategy 要向客户暴露它的所有实现， 这是违反最少知识原则的。</p>
<p>在 JavaScript语言的策略模式中， 策略类往往被函数所代替， 这时策略模式就成为一种“ 隐形” 的模式。<br>在函数作为一等对象的语言中， 策略模式是隐形的。<br>strategy 就是值为函数的变量。” 在 JavaScript中， 除了使用类来封装算法和行为之外， 使用函数当然也是一种选择。<br>这些“ 算法” 可以被封装到函数中并且四处传递， 也就是常说的“ 高阶函数”。<br>实际上在 JavaScript这种将函数作为一等对象的语言里， 策略模式已经融入到了语言本身当中， 我们经常用高阶函数来封装不同的行为， 并且把它传递到另一个函数中。<br>当我们对这些函数发出“ 调用” 的消息时， 不同的函数会返回不同的执行结果。<br>在 JavaScript中，“ 函数对象的多态性” 来得更加简单。<br>前面为了清楚地表示这是一个策略模式， 特意使用了 strategies 这个名字。<br>如果去掉 strategies， 还能认出这是一个策略模式的实现吗？ 代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var S = function(salary) &#123;</span><br><span class="line">	return salary * 4;</span><br><span class="line">&#125;;</span><br><span class="line">var A = function(salary) &#123;</span><br><span class="line">	return salary * 3;</span><br><span class="line">&#125;;</span><br><span class="line">var B = function(salary) &#123;</span><br><span class="line">	return salary * 2;</span><br><span class="line">&#125;;</span><br><span class="line">var calculateBonus = function(func, salary) &#123;</span><br><span class="line">	return func(salary);</span><br><span class="line">&#125;;</span><br><span class="line">calculateBonus(S, 10000); // 输出：40000</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">validator = &#123;</span><br><span class="line">	validate: function(value, type) &#123;</span><br><span class="line">		switch (type) &#123;</span><br><span class="line">			case &apos;isNonEmpty &apos;:</span><br><span class="line">				&#123;</span><br><span class="line">					return true; // NonEmpty 验证结果                    </span><br><span class="line">				&#125;</span><br><span class="line">			case &apos;isNumber &apos;:</span><br><span class="line">				&#123;</span><br><span class="line">					return true; // Number 验证结果                          </span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">			case &apos;isAlphaNum &apos;:</span><br><span class="line">				&#123;</span><br><span class="line">					return true; // AlphaNum 验证结果                  </span><br><span class="line">				&#125;</span><br><span class="line">			default:</span><br><span class="line">				&#123;</span><br><span class="line">					return true;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>根据策略模式， 可以将相同的工作代码单独封装成不同的类， 然后通过统一的策略处理类来处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">var validator = &#123; </span><br><span class="line">	// 所有可以的验证规则处理类存放的地方，后面会单独定义  </span><br><span class="line">	types: &#123;&#125;, </span><br><span class="line">	// 验证类型所对应的错误消息   </span><br><span class="line">	messages: [], </span><br><span class="line">	// 当然需要使用的验证类型    </span><br><span class="line">	config: &#123;&#125;, </span><br><span class="line">	// 暴露的公开验证方法，传入的参数是 key =&gt; value对   </span><br><span class="line">	validate: function(data) &#123;</span><br><span class="line">		var i, msg, type, checker, result_ok; </span><br><span class="line">		// 清空所有的错误信息     </span><br><span class="line">		this.messages = [];</span><br><span class="line">		for (i in data) &#123;</span><br><span class="line">			if (data.hasOwnProperty(i)) &#123;</span><br><span class="line">				type = this.config[i]; // 根据key查询是否有存在的验证规则               </span><br><span class="line">				checker = this.types[type]; // 获取验证规则的验证类   </span><br><span class="line">				if (!type) &#123;</span><br><span class="line">					continue; // 如果验证规则不存在，则不处理             </span><br><span class="line">				&#125;</span><br><span class="line">				if (!checker) &#123; // 如果验证规则类不存在，抛出异常                   </span><br><span class="line">					throw &#123; name: &quot;ValidationError&quot;, message: &quot;No handler to validate type &quot; + type &#125;;</span><br><span class="line">				&#125;</span><br><span class="line">				result_ok = checker.validate(data[i]); // 使用查到到的单个验证类进行验证          </span><br><span class="line">				if (!result_ok) &#123;</span><br><span class="line">					msg = &quot;Invalid value for *&quot; + i + &quot;*, &quot; + checker.instructions;</span><br><span class="line">					this.messages.push(msg);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return this.hasErrors();</span><br><span class="line">	&#125;, </span><br><span class="line">	hasErrors: function() &#123;</span><br><span class="line">		return this.messages.length !== 0; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>定义types里存放的各种验证类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 验证给定的值是否不为空</span><br><span class="line">validator.types.isNonEmpty = &#123;</span><br><span class="line">	validate: function(value) &#123;</span><br><span class="line">		return value !== &quot;&quot;; </span><br><span class="line">	&#125;,</span><br><span class="line">	instructions: &quot;传入的值不能为空&quot;</span><br><span class="line">&#125;; </span><br><span class="line">// 验证给定的值是否是数字</span><br><span class="line">validator.types.isNumber = &#123;</span><br><span class="line">	validate: function(value) &#123;</span><br><span class="line">		return !isNaN(value);</span><br><span class="line">	&#125;,</span><br><span class="line">	instructions: &quot;传入的值只能是合法的数字，例如：1, 3.14 or 2010&quot;</span><br><span class="line">&#125;; </span><br><span class="line">// 验证给定的值是否只是字母或数字</span><br><span class="line">validator.types.isAlphaNum = &#123;</span><br><span class="line">	validate: function(value) &#123;</span><br><span class="line">		return !/[^a-z0-9]/i.test(value); </span><br><span class="line">	&#125;,</span><br><span class="line">	instructions: &quot;传入的值只能保护字母和数字，不能包含特殊字符&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用的时候， 首先要定义需要验证的数据集合， 然后还需要定义每种数据需要验证的规则类型， 代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var data = &#123; first_name: &quot;Tom&quot;, last_name: &quot;Xu&quot;, age: &quot;unknown&quot;, username: &quot;TomXu&quot; &#125;;</span><br><span class="line">validator.config = &#123; first_name: &apos;isNonEmpty&apos;, age: &apos;isNumber&apos;, username: &apos;isAlphaNum&apos; &#125;;</span><br></pre></td></tr></table></figure>
<p>获取验证结果的代码就简单了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">validator.validate(data);</span><br><span class="line">if (validator.hasErrors()) &#123; console.log(validator.messages.join(&quot;\n&quot;)); &#125;</span><br></pre></td></tr></table></figure></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->

	<script>var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
