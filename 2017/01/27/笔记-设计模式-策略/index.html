<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
				<script>var timeStart = new Date();</script>
		
		<title>[笔记]-设计模式-策略 | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="没有鸡汤，只有笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-设计模式-策略"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/ok.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//ok.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-设计模式-策略</h2>
				
				<div>
					<span class="post-time">2017-01-27 18:18:37</span>
				</div>	
				
				<div class="article-content">
				<p>参考：<br>JavaScript设计模式与开发实践 曾探<br>深入理解JavaScript 汤姆大叔<br><strong>策略模式</strong></p>
<p>最初<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> calculateBonus = <span class="function"><span class="keyword">function</span><span class="params">(performanceLevel, salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (performanceLevel === <span class="string">'S'</span>) &#123;</div><div class="line">		<span class="keyword">return</span> salary * <span class="number">4</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (performanceLevel === <span class="string">'A'</span>) &#123;</div><div class="line">		<span class="keyword">return</span> salary * <span class="number">3</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (performanceLevel === <span class="string">'B'</span>) &#123;</div><div class="line">		<span class="keyword">return</span> salary * <span class="number">2</span>;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line">calculateBonus(<span class="string">'B'</span>, <span class="number">20000</span>); <span class="comment">// 输出：40000</span></div><div class="line">calculateBonus(<span class="string">'S'</span>, <span class="number">6000</span>); <span class="comment">// 输出：24000</span></div></pre></td></tr></table></figure></p>
<p>传统面向对象语言的模仿<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> performanceS = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;&#125;;</div><div class="line">performanceS.prototype.calculate = <span class="function"><span class="keyword">function</span><span class="params">(salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> salary * <span class="number">4</span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> performanceA = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;&#125;;</div><div class="line">performanceA.prototype.calculate = <span class="function"><span class="keyword">function</span><span class="params">(salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> salary * <span class="number">3</span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> performanceB = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;&#125;;</div><div class="line">performanceB.prototype.calculate = <span class="function"><span class="keyword">function</span><span class="params">(salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> salary * <span class="number">2</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 定义奖金类 Bonus</span></div><div class="line"><span class="keyword">var</span> Bonus = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.salary = <span class="literal">null</span>; <span class="comment">// 原始工资</span></div><div class="line">	<span class="keyword">this</span>.strategy = <span class="literal">null</span>; <span class="comment">// 绩效等级对应的策略对象</span></div><div class="line">&#125;;</div><div class="line">Bonus.prototype.setSalary = <span class="function"><span class="keyword">function</span><span class="params">(salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.salary = salary; <span class="comment">// 设置员工的原始工资</span></div><div class="line">&#125;;</div><div class="line">Bonus.prototype.setStrategy = <span class="function"><span class="keyword">function</span><span class="params">(strategy)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.strategy = strategy; <span class="comment">// 设置员工绩效等级对应的策略对象</span></div><div class="line">&#125;;</div><div class="line">Bonus.prototype.getBonus = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; </div><div class="line">	<span class="comment">// 取得奖金数额</span></div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.strategy.calculate(<span class="keyword">this</span>.salary); <span class="comment">// 把计算奖金的操作委托给对应的策略对象</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>JavaScript 版本的策略模式</p>
<p>在 JavaScript 语言中， 函数也是对象， 所以更简单和直接的做法是把 strategy直接定义为函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> strategies = &#123;</div><div class="line">	<span class="string">"S"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> salary * <span class="number">4</span>;</div><div class="line">	&#125;,</div><div class="line">	<span class="string">"A"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> salary * <span class="number">3</span>;</div><div class="line">	&#125;,</div><div class="line">	<span class="string">"B"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">salary</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> salary * <span class="number">2</span>;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> calculateBonus = <span class="function"><span class="keyword">function</span>(<span class="params">level, salary</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> strategies[level](salary);</div><div class="line">&#125;;</div><div class="line"><span class="built_in">console</span>.log(calculateBonus(<span class="string">'S'</span>, <span class="number">20000</span>)); <span class="comment">// 输出：80000</span></div><div class="line"><span class="built_in">console</span>.log(calculateBonus(<span class="string">'A'</span>, <span class="number">10000</span>)); <span class="comment">// 输出：30000</span></div></pre></td></tr></table></figure>
<p>表单校验的第一个版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById(<span class="string">'registerForm'</span>);</div><div class="line">registerForm.onsubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (registerForm.userName.value === <span class="string">''</span>) &#123;</div><div class="line">		alert(<span class="string">'用户名不能为空'</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (registerForm.password.value.length &lt; <span class="number">6</span>) &#123;</div><div class="line">		alert(<span class="string">'密码长度不能少于 6 位'</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (!<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test(registerForm.phoneNumber.value)) &#123;</div><div class="line">		alert(<span class="string">'手机号码格式不正确'</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>用策略模式重构表单校验<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/***********************策略对象**************************/</span></div><div class="line"><span class="keyword">var</span> strategies = &#123;</div><div class="line">	<span class="attr">isNonEmpty</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value, errorMsg</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (value === <span class="string">''</span>) &#123;</div><div class="line">			<span class="keyword">return</span> errorMsg;</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">minLength</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value, length, errorMsg</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (value.length &lt; length) &#123;</div><div class="line">			<span class="keyword">return</span> errorMsg;</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">isMobile</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value, errorMsg</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (!<span class="regexp">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test(value)) &#123;</div><div class="line">			<span class="keyword">return</span> errorMsg;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">/***********************Validator 类**************************/</span></div><div class="line"><span class="keyword">var</span> Validator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.cache = [];</div><div class="line">&#125;;</div><div class="line">Validator.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">dom, rules</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, rule; rule = rules[i++];) &#123;</div><div class="line">		(<span class="function"><span class="keyword">function</span>(<span class="params">rule</span>) </span>&#123;</div><div class="line">			<span class="keyword">var</span> strategyAry = rule.strategy.split(<span class="string">':'</span>);</div><div class="line">			<span class="keyword">var</span> errorMsg = rule.errorMsg;</div><div class="line">			self.cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="keyword">var</span> strategy = strategyAry.shift();</div><div class="line"></div><div class="line">				strategyAry.unshift(dom.value);</div><div class="line">				strategyAry.push(errorMsg);</div><div class="line">				<span class="keyword">return</span> strategies[strategy].apply(dom, strategyAry);</div><div class="line">			&#125;);</div><div class="line">		&#125;)(rule)</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line">Validator.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, validatorFunc; validatorFunc = <span class="keyword">this</span>.cache[i++];) &#123;</div><div class="line">		<span class="keyword">var</span> errorMsg = validatorFunc();</div><div class="line">		<span class="keyword">if</span> (errorMsg) &#123;</div><div class="line">			<span class="keyword">return</span> errorMsg;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">/***********************客户调用代码**************************/</span></div><div class="line"><span class="keyword">var</span> registerForm = <span class="built_in">document</span>.getElementById(<span class="string">'registerForm'</span>);</div><div class="line"><span class="keyword">var</span> validataFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> validator = <span class="keyword">new</span> Validator();</div><div class="line">	validator.add(registerForm.userName, [&#123;</div><div class="line">		<span class="attr">strategy</span>: <span class="string">'isNonEmpty'</span>,</div><div class="line">		<span class="attr">errorMsg</span>: <span class="string">'用户名不能为空'</span></div><div class="line">	&#125;, &#123;</div><div class="line">		<span class="attr">strategy</span>: <span class="string">'minLength:6'</span>,</div><div class="line">		<span class="attr">errorMsg</span>: <span class="string">'用户名长度不能小于 10 位'</span></div><div class="line">	&#125;]);</div><div class="line">	validator.add(registerForm.password, [&#123;</div><div class="line">		<span class="attr">strategy</span>: <span class="string">'minLength:6'</span>,</div><div class="line">		<span class="attr">errorMsg</span>: <span class="string">'密码长度不能小于 6 位'</span></div><div class="line">	&#125;]);</div><div class="line">	validator.add(registerForm.phoneNumber, [&#123;</div><div class="line">		<span class="attr">strategy</span>: <span class="string">'isMobile'</span>,</div><div class="line">		<span class="attr">errorMsg</span>: <span class="string">'手机号码格式不正确'</span></div><div class="line">	&#125;]);</div><div class="line">	<span class="keyword">var</span> errorMsg = validator.start();</div><div class="line">	<span class="keyword">return</span> errorMsg;</div><div class="line">&#125;;</div><div class="line">registerForm.onsubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> errorMsg = validataFunc();</div><div class="line">	<span class="keyword">if</span> (errorMsg) &#123;</div><div class="line">		alert(errorMsg);</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>策略模式利用组合、 委托和多态等技术和思想， 可以避免多重条件选择语句。<br>策略模式提供了对开放— 封闭原则的完美支持， 将算法封装在独立的 strategy 中， 使得它们易于切换， 易于理解， 易于扩展。<br>策略模式中的算法也可以复用在系统的其他地方， 从而避免许多重复的复制粘贴工作。<br>在策略模式中利用组合和委托来让 Context拥有执行算法的能力， 这也是继承的一种更轻便的替代方案。<br>当然， 策略模式也有一些缺点， 但这些缺点并不严重。<br>首先， 使用策略模式会在程序中增加许多策略类或者策略对象， 但实际上这比把它们负责的逻辑堆砌在 Context中要好。<br>其次， 要使用策略模式， 必须了解所有的 strategy， 必须了解各个 strategy 之间的不同点，此时 strategy 要向客户暴露它的所有实现， 这是违反最少知识原则的。</p>
<p>在 JavaScript语言的策略模式中， 策略类往往被函数所代替， 这时策略模式就成为一种“ 隐形” 的模式。<br>在函数作为一等对象的语言中， 策略模式是隐形的。<br>strategy 就是值为函数的变量。” 在 JavaScript中， 除了使用类来封装算法和行为之外， 使用函数当然也是一种选择。<br>这些“ 算法” 可以被封装到函数中并且四处传递， 也就是常说的“ 高阶函数”。<br>实际上在 JavaScript这种将函数作为一等对象的语言里， 策略模式已经融入到了语言本身当中， 我们经常用高阶函数来封装不同的行为， 并且把它传递到另一个函数中。<br>当我们对这些函数发出“ 调用” 的消息时， 不同的函数会返回不同的执行结果。<br>在 JavaScript中，“ 函数对象的多态性” 来得更加简单。<br>前面为了清楚地表示这是一个策略模式， 特意使用了 strategies 这个名字。<br>如果去掉 strategies， 还能认出这是一个策略模式的实现吗？ 代码如下：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> S = <span class="function"><span class="keyword">function</span><span class="params">(salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> salary * <span class="number">4</span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> A = <span class="function"><span class="keyword">function</span><span class="params">(salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> salary * <span class="number">3</span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> B = <span class="function"><span class="keyword">function</span><span class="params">(salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> salary * <span class="number">2</span>;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> calculateBonus = <span class="function"><span class="keyword">function</span><span class="params">(func, salary)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> func(salary);</div><div class="line">&#125;;</div><div class="line">calculateBonus(S, <span class="number">10000</span>); <span class="comment">// 输出：40000</span></div></pre></td></tr></table></figure></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">validator = &#123;</div><div class="line">	validate: <span class="function"><span class="keyword">function</span>(<span class="params">value, <span class="keyword">type</span></span>) </span>&#123;</div><div class="line">		<span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</div><div class="line">			<span class="keyword">case</span> <span class="string">'isNonEmpty '</span>:</div><div class="line">				&#123;</div><div class="line">					<span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// NonEmpty 验证结果                    </span></div><div class="line">				&#125;</div><div class="line">			<span class="keyword">case</span> <span class="string">'isNumber '</span>:</div><div class="line">				&#123;</div><div class="line">					<span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Number 验证结果                          </span></div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">			<span class="keyword">case</span> <span class="string">'isAlphaNum '</span>:</div><div class="line">				&#123;</div><div class="line">					<span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// AlphaNum 验证结果                  </span></div><div class="line">				&#125;</div><div class="line">			<span class="keyword">default</span>:</div><div class="line">				&#123;</div><div class="line">					<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">				&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>根据策略模式， 可以将相同的工作代码单独封装成不同的类， 然后通过统一的策略处理类来处理：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> validator = &#123; </div><div class="line">	<span class="comment">// 所有可以的验证规则处理类存放的地方，后面会单独定义  </span></div><div class="line">	types: &#123;&#125;, </div><div class="line">	<span class="comment">// 验证类型所对应的错误消息   </span></div><div class="line">	messages: [], </div><div class="line">	<span class="comment">// 当然需要使用的验证类型    </span></div><div class="line">	config: &#123;&#125;, </div><div class="line">	<span class="comment">// 暴露的公开验证方法，传入的参数是 key =&gt; value对   </span></div><div class="line">	validate: function(<span class="keyword">data</span>) &#123;</div><div class="line">		<span class="keyword">var</span> i, msg, type, checker, result_ok; </div><div class="line">		<span class="comment">// 清空所有的错误信息     </span></div><div class="line">		<span class="keyword">this</span>.messages = [];</div><div class="line">		<span class="keyword">for</span> (i <span class="keyword">in</span> <span class="keyword">data</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (<span class="keyword">data</span>.hasOwnProperty(i)) &#123;</div><div class="line">				type = <span class="keyword">this</span>.config[i]; <span class="comment">// 根据key查询是否有存在的验证规则               </span></div><div class="line">				checker = <span class="keyword">this</span>.types[type]; <span class="comment">// 获取验证规则的验证类   </span></div><div class="line">				<span class="keyword">if</span> (!type) &#123;</div><div class="line">					<span class="keyword">continue</span>; <span class="comment">// 如果验证规则不存在，则不处理             </span></div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span> (!checker) &#123; <span class="comment">// 如果验证规则类不存在，抛出异常                   </span></div><div class="line">					<span class="keyword">throw</span> &#123; name: <span class="string">"ValidationError"</span>, message: <span class="string">"No handler to validate type "</span> + type &#125;;</div><div class="line">				&#125;</div><div class="line">				result_ok = checker.validate(<span class="keyword">data</span>[i]); <span class="comment">// 使用查到到的单个验证类进行验证          </span></div><div class="line">				<span class="keyword">if</span> (!result_ok) &#123;</div><div class="line">					msg = <span class="string">"Invalid value for *"</span> + i + <span class="string">"*, "</span> + checker.instructions;</div><div class="line">					<span class="keyword">this</span>.messages.push(msg);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.hasErrors();</div><div class="line">	&#125;, </div><div class="line">	hasErrors: function() &#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.messages.length !== <span class="number">0</span>; &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>定义types里存放的各种验证类：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 验证给定的值是否不为空</span></div><div class="line">validator.types.isNonEmpty = &#123;</div><div class="line">	<span class="attr">validate</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> value !== <span class="string">""</span>; </div><div class="line">	&#125;,</div><div class="line">	<span class="attr">instructions</span>: <span class="string">"传入的值不能为空"</span></div><div class="line">&#125;; </div><div class="line"><span class="comment">// 验证给定的值是否是数字</span></div><div class="line">validator.types.isNumber = &#123;</div><div class="line">	<span class="attr">validate</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> !<span class="built_in">isNaN</span>(value);</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">instructions</span>: <span class="string">"传入的值只能是合法的数字，例如：1, 3.14 or 2010"</span></div><div class="line">&#125;; </div><div class="line"><span class="comment">// 验证给定的值是否只是字母或数字</span></div><div class="line">validator.types.isAlphaNum = &#123;</div><div class="line">	<span class="attr">validate</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> !<span class="regexp">/[^a-z0-9]/i</span>.test(value); </div><div class="line">	&#125;,</div><div class="line">	<span class="attr">instructions</span>: <span class="string">"传入的值只能保护字母和数字，不能包含特殊字符"</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>使用的时候， 首先要定义需要验证的数据集合， 然后还需要定义每种数据需要验证的规则类型， 代码如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var data = &#123; <span class="string">first_name:</span> <span class="string">"Tom"</span>, <span class="string">last_name:</span> <span class="string">"Xu"</span>, <span class="string">age:</span> <span class="string">"unknown"</span>, <span class="string">username:</span> <span class="string">"TomXu"</span> &#125;;</div><div class="line">validator.config = &#123; <span class="string">first_name:</span> <span class="string">'isNonEmpty'</span>, <span class="string">age:</span> <span class="string">'isNumber'</span>, <span class="string">username:</span> <span class="string">'isAlphaNum'</span> &#125;;</div></pre></td></tr></table></figure>
<p>获取验证结果的代码就简单了：<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">validator.validate(<span class="built_in">data</span>);</div><div class="line"><span class="keyword">if</span> (validator.hasErrors()) &#123; console.<span class="keyword">log</span>(validator.messages.<span class="keyword">join</span>(<span class="string">"\n"</span>)); &#125;</div></pre></td></tr></table></figure></p>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
