<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
				<script>var timeStart = new Date();</script>
		
		<title>[笔记]-设计模式-其它 | 一个放笔记的地方而已</title>
		
		<meta name="author" content="Huangzhike">
		
		
		<meta name="description" content="用手记笔记，用心记笔记，用脑记笔记">
		
		
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<meta property="og:title" content="[笔记]-设计模式-其它"/>
		
		<meta property="og:site_name" content="一个放笔记的地方而已"/>
		
		
		<!-- favicon -->
		<link rel="icon" type="image/ico" href="/favicon.ico" sizes="32x32">
 


		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.ico">
		<meta name="theme-color" content="#009688">

		    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic"> 

		<!-- favicon end -->
		<!-- <link href="//favicon.ico" rel="icon"> -->
		
		<!-- toc -->
		<!-- <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">-->
		<!-- material design -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css"> -->
		<!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css"> -->
		<!--<link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">-->
		<link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
		 
		 
		<!-- <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>-->
		<!-- <script>window.jQuery || document.write('<script src="/libs/jquery-3.1.1.slim.min.js" type="text/javascript"><\/script>')</script>-->
	</head>

<body>
	<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">菜单</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">一个放笔记的地方而已</a>
           
		</div>
		<div id="navbar" class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				
				<li>
					<a href="https://huangzhike.github.io/" title="">
						<i class="fa fa-home"></i>Index
					</a>
				</li>
				
				<li>
					<a href="https://huangzhike.github.io/archives" title="">
						<i class="fa fa-list"></i>Archives
					</a>
				</li>
				
				<li>
					<a href="https://github.com/huangzhike" title="我的主页">
						<i class="fa fa-github"></i>GitHub
					</a>
				</li>
				
			</ul>
		</div>
	</div>
</nav>

	<div class="container" >
		<div class="row">
	
		<div class="col-md-9 center-content">
			
			<div class="content">
				<!-- index -->
				
				<h2>[笔记]-设计模式-其它</h2>
				
				<div>
					<span class="post-time">2017-01-27 18:18:37</span>
				</div>	
				
				<div class="article-content">
				<p>参考：<br>JavaScript设计模式与开发实践 曾探<br>深入理解JavaScript 汤姆大叔</p>
<p>设计模式的作用是让人们写出可复用和可维护性高的程序。</p>
<p><strong> Constructor—— 构造器模式 </strong></p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span><span class="params">(name, id)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">	<span class="keyword">this</span>.id = id;</div><div class="line">&#125;</div><div class="line">Student.prototype.getId = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.id;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student(<span class="string">"hzk"</span>, <span class="number">1</span>);</div></pre></td></tr></table></figure>
<p><strong> Prototype—— 原型模式 </strong></p>
<p>ES5提供了Object.create(prototype, optionalDescriptorObjects) 方法， 用于创建一个对象， 使其拥有指定的原型和可选属性：<br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> <span class="built_in">parent</span> = &#123;</div><div class="line">	<span class="attribute">name</span>: <span class="string">"hzk"</span>,</div><div class="line">	<span class="attribute">sayHello</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"hello, "</span> + <span class="keyword">this</span>.name;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">var</span> child = <span class="built_in">Object</span>.create(<span class="built_in">parent</span>, &#123;</div><div class="line">	<span class="attribute">id:</span><span class="string"> &#123;</span></div><div class="line">		value: <span class="number">001</span></div><div class="line">		<span class="attribute">writable</span>: <span class="literal">false</span>,</div><div class="line">		<span class="attribute">configurable</span>: <span class="literal">false</span>,</div><div class="line">		<span class="attribute">enumerable</span>: <span class="literal">false</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attribute">age</span>: &#123;</div><div class="line">		<span class="attribute">value</span>: <span class="number">22</span>,</div><div class="line">		<span class="attribute">writable</span>: <span class="literal">true</span>,</div><div class="line">		<span class="attribute">configurable</span>: <span class="literal">true</span>,</div><div class="line">		<span class="attribute">enumerable</span>: <span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>Polyfill： Object.create方法在ES5中定义， 简单的不支持optionalDescriptorObjects如下：<br>要注意浅拷贝和深拷贝， 免得出现引用问题。<br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.prototype.create = <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>) </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">	F.prototype = <span class="built_in">parent</span>;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> F();</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><strong> Mixin—— 混入模式子类化 </strong></p>
<p>子类化是指针对一个新对象， 从一个基础或超类对象中继承相关的属性。 比如B继承A， 那么B是A的子类， A是B的超类（ 父类）。<br>B的所有实例从A处继承了相关方法， 但B仍然能够定义自己的方法， 以及重写A所定义的方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Student = <span class="function"><span class="keyword">function</span>(<span class="params">name, id</span>) </span>&#123;</div><div class="line">	Person.call(<span class="keyword">this</span>, name);</div><div class="line">	<span class="keyword">this</span>.id = id;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Student.prototype = <span class="built_in">Object</span>.create(Person.prototype);</div><div class="line"></div><div class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student(<span class="string">"hzk"</span>, <span class="number">001</span>);</div><div class="line"><span class="built_in">console</span>.log(student);</div></pre></td></tr></table></figure></p>
<p>超类为Person类， 子类为Student类， 在Student类实例化时， 首先会调用超类构造函数， 将超类的属性写入到子类中， 而超类的原型也存在于子类的原型链上， 超类原型上的方法也将被子类继承。</p>
<p>可以将继承Mixin看做一种通过扩展收集功能的方式。 通过向构造函数的prototype中扩展mixin对象来实现：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实现扩展方法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">obj, mixin</span>) </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> item <span class="keyword">in</span> mixin) &#123;</div><div class="line">		obj[item] = mixin[item];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 创建需要扩展的功能集合</span></div><div class="line"><span class="keyword">var</span> myMixin = &#123;</div><div class="line">	<span class="attr">sayHello</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">" says: Hello!"</span>);</div><div class="line">	&#125;,</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 将扩展应用到构造函数prototype中</span></div><div class="line">extend(Student.prototype, myMixin);</div><div class="line"></div><div class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student(<span class="string">"hzk"</span>, <span class="number">001</span>);</div><div class="line"><span class="comment">// 新建的实例拥有扩展方法</span></div><div class="line">student.sayHello(); <span class="comment">//hzk says: Hello!</span></div></pre></td></tr></table></figure></p>
<p><strong> Factory—— 工厂模式 </strong></p>
<p>Factory是一种创建型模式， 它不显式地要求使用构造函数。 而Factory可以提供一个通用的接口来创建对象， 只需要告诉工厂需要创建的对象类型，比如有水平菜单和垂直菜单的构造函数， 分别为HorizontalMenu和VerticalMenu。 可以定义一个菜单工厂MenuFactory来进行菜单创建：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 水平菜单构造函数</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">HorizontalMenu</span><span class="params">(options)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.color = options.color || <span class="string">"black"</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 垂直菜单构造函数</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">VerticalMenu</span><span class="params">(options)</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>.color = options.color || <span class="string">"black"</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 菜单工厂</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MenuFactory</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="comment">// 默认情况下创造的菜单类型</span></div><div class="line">MenuFactory.prototype.menuClass = VerticalMenu;</div><div class="line"><span class="comment">// 工厂创建菜单的方法</span></div><div class="line">MenuFactory.prototype.createMenu = <span class="function"><span class="keyword">function</span><span class="params">(options)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (options.type === <span class="string">"vertical"</span>) &#123;</div><div class="line">		<span class="keyword">this</span>.menuClass = VerticalMenu;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="keyword">this</span>.menuClass = HorizontalMenu;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">this</span>.menuClass(options);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>工厂方法最大的好处就是提供了通用接口创建实例， 比如新增一个动画菜单AnimationMenu类如下：<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">AnimationMenu</span><span class="params">(options)</span> &#123;</span></div><div class="line">	this.<span class="built_in">color</span> = options.<span class="built_in">color</span> || <span class="string">"black"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>只需要在工厂方法中添加一个 if就行了:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 工厂创建菜单的方法</span></div><div class="line">MenuFactory.prototype.createMenu = function(<span class="keyword">options</span>) &#123;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">options</span>.type === <span class="string">"vertical"</span>) &#123;</div><div class="line">		<span class="keyword">this</span>.menuClass = VerticalMenu;</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">options</span>.type === <span class="string">"animation"</span>) &#123;</div><div class="line">		<span class="keyword">this</span>.menuClass = AnimationMenu;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="keyword">this</span>.menuClass = HorizontalMenu;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">this</span>.menuClass(<span class="keyword">options</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><strong> Abstract Factory—— 抽象工厂 </strong></p>
<p>Abstract Factory用于封装一组具有共同目标的单个工厂。 它能够将一组对象的实现细节从一般用法中分离出来。<br>当一个系统必须独立于它所创建的对象的生成方式， 或它需要与多种对象类型一起工作时， 应当使用抽象工厂，以之前的菜单工厂为例， 定义一个抽象菜单工厂：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> AbstractMenuFactory = (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">var</span> constructors = &#123;&#125;;</div><div class="line">	<span class="comment">// 根据type创建实例</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">createMenu</span><span class="params">(type, options)</span> </span>&#123;</div><div class="line">		<span class="keyword">var</span> menuConstructor = constructors[type];</div><div class="line">		<span class="keyword">return</span> menuConstructor ? <span class="keyword">new</span> menuConstructor(options) : <span class="literal">null</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 在抽象工厂中注册新菜单类型</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">registerMenu</span><span class="params">(type, constructor)</span> </span>&#123;</div><div class="line">		constructors[type] = constructor;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		createMenu: createMenu,</div><div class="line">		registerMenu: registerMenu</div><div class="line">	&#125;;</div><div class="line">&#125;());</div></pre></td></tr></table></figure></p>
<p>还是之前的三个构造函数， 首先将他们注册到抽象工厂中：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">AbstractMenuFactory</span></div><div class="line">	<span class="selector-class">.registerMenu</span>(<span class="string">"vertical"</span>, VerticalMenu)</div><div class="line">	<span class="selector-class">.registerMenu</span>(<span class="string">"horizontal"</span>, HorizontalMenu)</div><div class="line">	<span class="selector-class">.registerMenu</span>(<span class="string">"animation"</span>, AnimationMenu);</div></pre></td></tr></table></figure></p>
<p>使用抽象工厂创建实例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">	<span class="attr">color</span>: <span class="string">"blue"</span>,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> menu1 = AbstractMenuFactory.createMenu(<span class="string">"vertical"</span>, options);</div><div class="line"><span class="built_in">console</span>.log(menu1 <span class="keyword">instanceof</span> VerticalMenu); <span class="comment">// true</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> menu2 = AbstractMenuFactory.createMenu(<span class="string">"horizontal"</span>, options);</div><div class="line"><span class="built_in">console</span>.log(menu2 <span class="keyword">instanceof</span> HorizontalMenu); <span class="comment">// true</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> menu3 = AbstractMenuFactory.createMenu(<span class="string">"animation"</span>, options);</div><div class="line"><span class="built_in">console</span>.log(menu3 <span class="keyword">instanceof</span> AnimationMenu); <span class="comment">// true</span></div></pre></td></tr></table></figure></p>
<p><strong>Command—— 命令模式</strong></p>
<p>Command模式旨在将方法调用、 请求或操作封装到单一对象中， 从而根据不同的请求对客户进行参数化和传递可供执行的方法调用。<br>命令模式在 JavaScript语言中是一种隐形的模式。<br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> studentManager = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">var</span> studentList = [];</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">id, name</span>) </span>&#123;</div><div class="line">		studentList.push(&#123;</div><div class="line">			<span class="attribute">id:</span><span class="string"> id</span>,</div><div class="line">			<span class="attribute">name</span>: name</div><div class="line">		&#125;);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">		<span class="built_in">var</span> i;</div><div class="line">		<span class="keyword">for</span> (i = studentList.length; i--;) &#123;</div><div class="line">			<span class="keyword">if</span> (studentList[i].id === id) &#123;</div><div class="line">				studentList.splice(i, <span class="number">1</span>);</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">		<span class="built_in">var</span> i;</div><div class="line">		<span class="keyword">for</span> (i = studentList.length; i--;) &#123;</div><div class="line">			<span class="keyword">if</span> (studentList[i].id === id) &#123;</div><div class="line">				<span class="keyword">return</span> studentList[i];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> studentList.length;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">getAt</span>(<span class="params">index</span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> studentList[index];</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="attribute">add</span>: add,</div><div class="line">		<span class="attribute">remove</span>: remove,</div><div class="line">		<span class="attribute">get</span>: get,</div><div class="line">		<span class="attribute">getAt</span>: getAt,</div><div class="line">		<span class="attribute">count</span>: count,</div><div class="line">		<span class="attribute">execute</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">this</span>[name] &amp;&amp; <span class="keyword">this</span>[name].apply(<span class="keyword">this</span>, <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>));</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">&#125;());</div></pre></td></tr></table></figure></p>
<p>通过在传统的模块模式上增加了个excute方法， 用于实现Command模式， 而修改后的调用就可以变成这个样子：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">studentManager.<span class="built_in">execute</span>(<span class="string">"add"</span>, <span class="number">001</span>, <span class="string">"hzk"</span>)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>通过单一的方法进行参数化的调用， 拥有更强大的灵活性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Ryu = &#123;</div><div class="line">	<span class="attr">attack</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'攻击'</span>);</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">defense</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'防御'</span>);</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">jump</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'跳跃'</span>);</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">crouch</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'蹲下'</span>);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> commands = &#123;</div><div class="line">	<span class="string">"119"</span>: <span class="string">"jump"</span>, <span class="comment">// W</span></div><div class="line">	<span class="string">"115"</span>: <span class="string">"crouch"</span>, <span class="comment">// S</span></div><div class="line">	<span class="string">"97"</span>: <span class="string">"defense"</span>, <span class="comment">// A</span></div><div class="line">	<span class="string">"100"</span>: <span class="string">"attack"</span> <span class="comment">// D</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> makeCommand = <span class="function"><span class="keyword">function</span>(<span class="params">receiver, state</span>) </span>&#123;</div><div class="line">	<span class="comment">// 创建命令</span></div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		receiver[state]();</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> commandStack = []; <span class="comment">// 保存命令的堆栈</span></div><div class="line"><span class="built_in">document</span>.onkeypress = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> keyCode = ev.keyCode,</div><div class="line">		command = makeCommand(Ryu, commands[keyCode]);</div><div class="line">	<span class="keyword">if</span> (command) &#123;</div><div class="line">		command(); <span class="comment">// 执行命令</span></div><div class="line">		commandStack.push(command); <span class="comment">// 将刚刚执行过的命令保存进堆栈</span></div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'replay'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 点击播放录像</span></div><div class="line">	<span class="keyword">var</span> command;</div><div class="line">	<span class="keyword">while</span> (command = commandStack.shift()) &#123; <span class="comment">// 从堆栈里依次取出命令并执行</span></div><div class="line">		command();</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>当在键盘上敲下 W、 A、 S、 D这几个键来完成一些动作之后， 再按下 Replay按钮， 此时便会重复播放之前的动作。</p>
<p><strong> Singleton—— 单例模式 </strong></p>
<p>Singleton限制了类只能有一个实例。 如果实例不存在， 创建一个实例。 如果已经存在， 则返回实例的引用。<br>Singleton与静态类（ 对象） 不同的是， 它可以被延迟生成， 只有在需要的时候才会生成实例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> someClass = &#123;</div><div class="line">	_singleton: <span class="literal">null</span>,</div><div class="line">	getSingleton: function() &#123;</div><div class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>._singleton) &#123;</div><div class="line">			<span class="comment">// 如果为空则生成新的实例，并赋给_singleton属性</span></div><div class="line">			<span class="keyword">this</span>._singleton = &#123;&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>._singleton; <span class="comment">// _singleton属性有值就返回这个属性，保证生成的实例都是同一个对象</span></div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> instance = someClass.getSingleton(); <span class="comment">// 生成实例调用getSingleton方法</span></div></pre></td></tr></table></figure>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var singleton = (function() &#123;</div><div class="line">	var instance;</div><div class="line"></div><div class="line">	function init() &#123;</div><div class="line">		// define<span class="keyword"> private</span> methods<span class="built_in"> and </span>properties</div><div class="line">	<span class="built_in">	return </span>&#123;</div><div class="line">			// define<span class="keyword"> public</span> methods<span class="built_in"> and </span>properties</div><div class="line">		&#125;;</div><div class="line">	&#125;</div><div class="line"><span class="built_in">	return </span>&#123;</div><div class="line">		getInstance: function() &#123;</div><div class="line">		<span class="built_in">	if </span>(!instance) &#123;</div><div class="line">			<span class="built_in">	instance </span>= init();</div><div class="line">			&#125;</div><div class="line">		<span class="built_in">	return </span>instance;</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> getSingle = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> result;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> result || (result = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> bindEvent = getSingle(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">document</span>.getElementById(<span class="string">'div1'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		alert(<span class="string">'click'</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'开始渲染列表'</span>);</div><div class="line">	bindEvent();</div><div class="line">&#125;;</div><div class="line">render();</div><div class="line">render();</div><div class="line">render();</div><div class="line"><span class="comment">// render 函数和 bindEvent 函数都分别执行了 3 次， 但 div 实际上只被绑定了一次事件</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Universe</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="comment">// 缓存的实例  </span></div><div class="line">	<span class="keyword">var</span> instance = <span class="keyword">this</span>;</div><div class="line">	<span class="comment">// 重写构造函数 </span></div><div class="line">	Universe = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> instance;</div><div class="line">	&#125;;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 测试</span></div><div class="line"><span class="keyword">var</span> uni1 = <span class="keyword">new</span> Universe();</div><div class="line"><span class="keyword">var</span> uni2 = <span class="keyword">new</span> Universe();</div><div class="line"><span class="built_in">console</span>.log(uni1 === uni2); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Universe</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> instance;</div><div class="line">	Universe = <span class="function"><span class="keyword">function</span> <span class="title">Universe</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> instance;</div><div class="line">	&#125;;</div><div class="line">	<span class="comment">// 后期处理原型属性    </span></div><div class="line">	Universe.prototype = <span class="keyword">this</span>;</div><div class="line">	<span class="comment">// 实例    </span></div><div class="line">	instance = <span class="keyword">new</span> Universe();</div><div class="line">	<span class="comment">// 重设构造函数指针  </span></div><div class="line">	instance.constructor = Universe;</div><div class="line">	<span class="keyword">return</span> instance;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 添加原型属性</span></div><div class="line">Universe.prototype.nothing = <span class="literal">true</span>;</div><div class="line"><span class="keyword">var</span> uni1 = <span class="keyword">new</span> Universe();</div><div class="line">Universe.prototype.everything = <span class="literal">true</span>;</div><div class="line"><span class="keyword">var</span> uni2 = <span class="keyword">new</span> Universe();</div><div class="line"><span class="built_in">console</span>.log(uni1 === uni2); <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(uni1.nothing); <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(uni2.nothing); <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(uni1.everything); <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(uni2.everything); <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(uni1.constructor === Universe); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Universe;</div><div class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">var</span> instance;</div><div class="line">	Universe = <span class="function"><span class="keyword">function</span> <span class="title">Universe</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (instance) &#123;</div><div class="line">			<span class="keyword">return</span> instance;</div><div class="line">		&#125;</div><div class="line">		instance = <span class="keyword">this</span>;</div><div class="line">	&#125;;</div><div class="line">&#125;());</div><div class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Universe();</div><div class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Universe();</div><div class="line">alert(a === b); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p><strong> Facade—— 外观模式 </strong></p>
<p>Facade模式是一种结构型模式， 它为更大的代码体提供了一个方便的高层次接口， 能够隐藏其底层的真实复杂性。</p>
<p>在浏览器差异的时候经常会出现， 比如绑定事件：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function">function <span class="title">bindEvent</span>(<span class="params">ele, <span class="keyword">event</span>, callback</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (ele.attachEvent) &#123;</div><div class="line">		ele.attachEvent(<span class="string">"on"</span> + <span class="keyword">event</span>, function(<span class="keyword">event</span>) &#123;</div><div class="line">			<span class="keyword">event</span> = <span class="keyword">event</span> || window.<span class="keyword">event</span>;</div><div class="line">			<span class="keyword">event</span>.target = <span class="keyword">event</span>.target || <span class="keyword">event</span>.srcElement;</div><div class="line">			callback(<span class="keyword">event</span>);</div><div class="line">		&#125;);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		ele.addEventListener(<span class="keyword">event</span>, callback, <span class="literal">false</span>);</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>这样暴露给开发者的就是bindEvent方法， 上层开发者只需要去使用这个方法来完成事件绑定， 而不用关注浏览器兼容</p>
<p>Facade模式能够简化类和模块的接口， 也能从这个类或模块从使用它的代码解耦。 而且Facade易于使用， 且占用空间小。<br>Facade可能会影响到性能， 在抽象时需要考虑是否包含隐性成本</p>
<p><strong> 适配器模式 </strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> googleMap = &#123;</div><div class="line">	<span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'开始渲染谷歌地图'</span>);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> baiduMap = &#123;</div><div class="line">	<span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'开始渲染百度地图'</span>);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> renderMap = <span class="function"><span class="keyword">function</span>(<span class="params">map</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (map.show <span class="keyword">instanceof</span> <span class="built_in">Function</span>) &#123;</div><div class="line">		map.show();</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line">renderMap(googleMap); <span class="comment">// 输出：开始渲染谷歌地图</span></div><div class="line">renderMap(baiduMap); <span class="comment">// 输出：开始渲染百度地图</span></div></pre></td></tr></table></figure></p>
<p>这段程序得以顺利运行的关键是 googleMap 和 baiduMap 提供了一致的 show 方法， 但第三方的接口方法并不在控制范围之内， 假如 baiduMap 提供的显示地图的方法不叫 show 而叫 display 呢？ 此时可以通过增加 baiduMapAdapter 来解决问题：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> googleMap = &#123;</div><div class="line">	<span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'开始渲染谷歌地图'</span>);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> baiduMap = &#123;</div><div class="line">	<span class="attr">display</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'开始渲染百度地图'</span>);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> baiduMapAdapter = &#123;</div><div class="line">	<span class="attr">show</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> baiduMap.display();</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line">renderMap(googleMap); <span class="comment">// 输出：开始渲染谷歌地图</span></div><div class="line">renderMap(baiduMapAdapter); <span class="comment">// 输出：开始渲染百度地图</span></div></pre></td></tr></table></figure></p>
<p>假设编写一个渲染广东省地图的页面。 目前从第三方资源里获得了广东省的所有城市以及它们所对应的 ID， 并且成功地渲染到页面中：<br><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> getGuangdongCity = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">var</span> guangdongCity = [&#123;</div><div class="line">		<span class="attribute">name</span>: <span class="string">'shenzhen'</span>,</div><div class="line">		<span class="attribute">id:</span><span class="string"> 11,</span></div><div class="line">	&#125;, &#123;</div><div class="line">		name: <span class="string">'guangzhou'</span>,</div><div class="line">		<span class="attribute">id:</span><span class="string"> 12,</span></div><div class="line">	&#125;];</div><div class="line">	return guangdongCity;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">var</span> render = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'开始渲染广东省地图'</span>);</div><div class="line">	<span class="built_in">document</span>.write(<span class="built_in">JSON</span>.stringify(fn()));</div><div class="line">&#125;;</div><div class="line">render(getGuangdongCity);</div></pre></td></tr></table></figure></p>
<p>后来发现还缺少很多城市。 于是又在网上找到了另外一些数据资源， 但数据结构和正运行在项目中的不一致。<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var guangdongCity = &#123;</div><div class="line"><span class="symbol">	shenzhen:</span> <span class="number">11</span>,</div><div class="line"><span class="symbol">	guangzhou:</span> <span class="number">12</span>,</div><div class="line"><span class="symbol">	zhuhai:</span> <span class="number">13</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>除了改写渲染页面的前端代码之外， 另外一种更轻便的解决方式就是新增一个数据格式转换的适配器：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> addressAdapter = <span class="function"><span class="keyword">function</span><span class="params">(oldAddressfn)</span> </span>&#123;</div><div class="line">	<span class="keyword">var</span> address = &#123;&#125;,</div><div class="line">		oldAddress = oldAddressfn();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, c; c = oldAddress[i++];) &#123;</div><div class="line">		address[c.name] = c.id;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> address;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">render(addressAdapter(getGuangdongCity));</div></pre></td></tr></table></figure></p>
<p>接下来是把代码中调用 getGuangdongCity 的地方， 用经过 addressAdapter适配器转换之后的新函数来代替。</p>
<p><strong>代理模式</strong></p>
<p>虚拟代理： 惰性加载<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> miniConsole = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> cache = [];</div><div class="line">	<span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (ev.keyCode === <span class="number">113</span>) &#123;</div><div class="line">			<span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line">			script.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, fn; fn = cache[i++];) &#123;</div><div class="line">					fn();</div><div class="line">				&#125;</div><div class="line">			&#125;;</div><div class="line">			script.src = <span class="string">'miniConsole.js'</span>;</div><div class="line">			<span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(script);</div><div class="line">			<span class="built_in">document</span>.body.removeEventListener(<span class="string">'keydown'</span>, handler); <span class="comment">// 只加载一次 miniConsole.js</span></div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="built_in">document</span>.body.addEventListener(<span class="string">'keydown'</span>, handler, <span class="literal">false</span>);</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="attr">log</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">			<span class="keyword">var</span> args = <span class="built_in">arguments</span>;</div><div class="line">			cache.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="keyword">return</span> miniConsole.log.apply(miniConsole, args);</div><div class="line">			&#125;);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)();</div><div class="line"></div><div class="line">miniConsole.log(<span class="number">11</span>); <span class="comment">// 开始打印 log</span></div><div class="line"><span class="comment">// miniConsole.js 代码</span></div><div class="line">miniConsole = &#123;</div><div class="line">	<span class="attr">log</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// 真正代码略</span></div><div class="line">		<span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>));</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>缓存代理</p>
<p>先创建一个用于求乘积的函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mult = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = <span class="built_in">arguments</span>.length; i &lt; l; i++) &#123;</div><div class="line">		a = a * <span class="built_in">arguments</span>[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> a;</div><div class="line">&#125;;</div><div class="line">mult(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 输出：6</span></div><div class="line">mult(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 输出：24</span></div></pre></td></tr></table></figure></p>
<p>现在加入缓存代理函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> proxyMult = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> cache = &#123;&#125;;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.join.call(<span class="built_in">arguments</span>, <span class="string">','</span>);</div><div class="line">		<span class="keyword">if</span> (args <span class="keyword">in</span> cache) &#123;</div><div class="line">			<span class="keyword">return</span> cache[args];</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> cache[args] = mult.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">	&#125;</div><div class="line">&#125;)();</div><div class="line">proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 输出：24</span></div><div class="line">proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 输出：24</span></div></pre></td></tr></table></figure></p>
<p>当第二次调用 proxyMult(1, 2, 3, 4) 的时候， 本体 mult 函数并没有被计算， proxyMult直接返回了之前缓存好的计算结果。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment"><span class="markdown">/<span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="bullet">* 计算乘积 *</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*/</span></span></div><div class="line"><span class="keyword">var</span> mult = function() &#123;</div><div class="line">	<span class="keyword">var</span> a = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = arguments.length; i &lt; l; i++) &#123;</div><div class="line">		a = a * arguments[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> a;</div><div class="line">&#125;;</div><div class="line"><span class="comment"><span class="markdown">/<span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="bullet">* 计算加和 *</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*/</span></span></div><div class="line"><span class="keyword">var</span> plus = function() &#123;</div><div class="line">	<span class="keyword">var</span> a = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = arguments.length; i &lt; l; i++) &#123;</div><div class="line">		a = a + arguments[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> a;</div><div class="line">&#125;;</div><div class="line"><span class="comment"><span class="markdown">/<span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="bullet">* 创建缓存代理的工厂 *</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*/</span></span></div><div class="line"><span class="keyword">var</span> createProxyFactory = function(fn) &#123;</div><div class="line">	<span class="keyword">var</span> cache = &#123;&#125;;</div><div class="line">	<span class="keyword">return</span> function() &#123;</div><div class="line">		<span class="keyword">var</span> args = Array.prototype.join.call(arguments, <span class="string">','</span>);</div><div class="line">		<span class="keyword">if</span> (args <span class="keyword">in</span> cache) &#123;</div><div class="line">			<span class="keyword">return</span> cache[args];</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> cache[args] = fn.apply(<span class="keyword">this</span>, arguments);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> proxyMult = createProxyFactory(mult),</div><div class="line">	proxyPlus = createProxyFactory(plus);</div><div class="line">alert(proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 输出：24</span></div><div class="line">alert(proxyMult(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 输出：24</span></div><div class="line">alert(proxyPlus(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 输出：10</span></div><div class="line">alert(proxyPlus(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 输出：10</span></div></pre></td></tr></table></figure>

				</div>
				<!-- about -->
				
			</div>
			<!-- pagination -->
			
			<div class="comment-section">
	
	


</div>
		</div>
		
	</div>


		<footer>
			 
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	</div>
	<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<script src="/js/highlight.js"></script> 
	<script>hljs.initHighlightingOnLoad();var timeEnd = new Date();console.log('耗时：' + (timeEnd - timeStart));</script>
	<!-- <script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>-->
	<!-- material design -->
	<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script> -->
	<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>-->
	<!-- toc -->
	<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
	<!-- <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script> -->
	<!-- <script src="/libs/tocify/jquery.tocify.custom.js"></script> -->
	<!-- <script src="/js/main.js"></script> -->
</body>
</html>
